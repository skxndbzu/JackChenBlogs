<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/zookeeper.html"><meta property="og:site_name" content="éº»èŠ±çš„å°ç«™"><meta property="og:title" content="zookeeper"><meta property="og:description" content="zookeeper å°šç¡…è°·ZooKeeperè§†é¢‘æ•™ç¨‹ è§†é¢‘åœ°å€ï¼šhttps://www.bilibili.com/video/BV1to4y1C7gw/ è¯¾ç¨‹èµ„æ–™ï¼šhttps://pan.baidu.com/s/1D_atyMC1JbKo_mZ2rOE_Eg æå–ç ï¼šyyds ç¬¬ 1 ç«  Zookeeper å…¥é—¨ 1.1 æ¦‚è¿° Zookeeper æ˜¯ä¸€..."><meta property="og:type" content="article"><meta property="og:image" content="https://mouday.github.io/img/2024/06/08/30neg4c.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-23T09:26:56.000Z"><meta property="article:author" content="Jack-Chen"><meta property="article:tag" content="é›†ç¾¤"><meta property="article:tag" content="ç›‘å¬"><meta property="article:published_time" content="2023-01-06T00:00:00.000Z"><meta property="article:modified_time" content="2024-10-23T09:26:56.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"zookeeper","image":["https://mouday.github.io/img/2024/06/08/30neg4c.png","https://mouday.github.io/img/2024/06/08/buw5nh4.png","https://mouday.github.io/img/2024/06/08/00fmqhy.png","https://mouday.github.io/img/2024/06/08/czrlb54.png","https://mouday.github.io/img/2024/06/08/vxmktw8.png","https://mouday.github.io/img/2024/06/08/6uvu4bl.png","https://mouday.github.io/img/2024/06/09/m9o0gbe.png","https://mouday.github.io/img/2024/06/09/mce61ce.png","https://mouday.github.io/img/2024/06/09/h39xdwk.png","https://mouday.github.io/img/2024/06/09/g88v78b.png"],"datePublished":"2023-01-06T00:00:00.000Z","dateModified":"2024-10-23T09:26:56.000Z","author":[{"@type":"Person","name":"Jack-Chen","url":"https://chemnminghe.top"}]}</script><title>zookeeper | éº»èŠ±çš„å°ç«™</title><meta name="description" content="zookeeper å°šç¡…è°·ZooKeeperè§†é¢‘æ•™ç¨‹ è§†é¢‘åœ°å€ï¼šhttps://www.bilibili.com/video/BV1to4y1C7gw/ è¯¾ç¨‹èµ„æ–™ï¼šhttps://pan.baidu.com/s/1D_atyMC1JbKo_mZ2rOE_Eg æå–ç ï¼šyyds ç¬¬ 1 ç«  Zookeeper å…¥é—¨ 1.1 æ¦‚è¿° Zookeeper æ˜¯ä¸€...">
    <link rel="preload" href="/assets/style-Tnuk6l9P.css" as="style"><link rel="stylesheet" href="/assets/style-Tnuk6l9P.css">
    <link rel="modulepreload" href="/assets/app-1Q7c3pAr.js"><link rel="modulepreload" href="/assets/zookeeper.html-KVS3kqiE.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-qk-0Bp-k.js" as="script"><link rel="prefetch" href="/assets/intro.html-jf41P54m.js" as="script"><link rel="prefetch" href="/assets/index.html-CRsypQLN.js" as="script"><link rel="prefetch" href="/assets/index.html-WQLtFevr.js" as="script"><link rel="prefetch" href="/assets/page.html-VWBRSZAr.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬ä¸­ç§‘è½¯.html-CNndNHJ0.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬é‘«ä¸‡å®¶ç§‘æŠ€.html-CIU4JERp.js" as="script"><link rel="prefetch" href="/assets/å¤©æ´¥å‡½æ•°è§†ç•Œ.html-BHn4tbp1.js" as="script"><link rel="prefetch" href="/assets/å®‰ç¡•ä¿¡æ¯(ä¸œåŒ—éƒ¨).html-ESBrpOhf.js" as="script"><link rel="prefetch" href="/assets/ç”˜è‚ƒä¸­å·¥å›½é™….html-CVVJBXox.js" as="script"><link rel="prefetch" href="/assets/index.html-DVAUNImR.js" as="script"><link rel="prefetch" href="/assets/index.html-BNIZbkEd.js" as="script"><link rel="prefetch" href="/assets/disable.html-D0cbDbFj.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-BQOLgqKY.js" as="script"><link rel="prefetch" href="/assets/layout.html-CcRc7pZ8.js" as="script"><link rel="prefetch" href="/assets/markdown.html-DUZacFXt.js" as="script"><link rel="prefetch" href="/assets/page.html-BXY9MXdU.js" as="script"><link rel="prefetch" href="/assets/JUC.html-B4d2EnGc.js" as="script"><link rel="prefetch" href="/assets/JVM.html-BlE4tkIO.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-Bi9mEjfP.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-CdFtXMpu.js" as="script"><link rel="prefetch" href="/assets/vue.html-ojB6Th_K.js" as="script"><link rel="prefetch" href="/assets/Spring.html-Aat72f6t.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-BWOBRLgm.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-BsFxYNSQ.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-rITukcQj.js" as="script"><link rel="prefetch" href="/assets/Docker.html-DI8fYC4w.js" as="script"><link rel="prefetch" href="/assets/Git.html-6WY86wOk.js" as="script"><link rel="prefetch" href="/assets/Gradle.html-R5jfbrW1.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-M_BwE5vd.js" as="script"><link rel="prefetch" href="/assets/maven.html-BfrNIpuP.js" as="script"><link rel="prefetch" href="/assets/2.html-nvme_HAU.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-B-w5yWsN.js" as="script"><link rel="prefetch" href="/assets/2.html-CPFlDOhT.js" as="script"><link rel="prefetch" href="/assets/3.html-CWRtElzY.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®ä»‹ç».html-CSkVc5S2.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-BJCLY1w9.js" as="script"><link rel="prefetch" href="/assets/elasticsearch.html-BYasUsnl.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-CsNSCaDt.js" as="script"><link rel="prefetch" href="/assets/1.html-7m2l83S3.js" as="script"><link rel="prefetch" href="/assets/2.html-BTacdCxC.js" as="script"><link rel="prefetch" href="/assets/3.html-TuHzlomm.js" as="script"><link rel="prefetch" href="/assets/Linux.html-xVMSDPmB.js" as="script"><link rel="prefetch" href="/assets/æ“ä½œç³»ç»Ÿ.html-b8HbjUUD.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œ.html-DQTV4Qeu.js" as="script"><link rel="prefetch" href="/assets/1.html-XAOf0GIT.js" as="script"><link rel="prefetch" href="/assets/2.html-CPeJFblE.js" as="script"><link rel="prefetch" href="/assets/3.html-zcjKkedd.js" as="script"><link rel="prefetch" href="/assets/1.html-Dg6_cCNv.js" as="script"><link rel="prefetch" href="/assets/2.html-BAjf93aj.js" as="script"><link rel="prefetch" href="/assets/3.html-BS4hJcVx.js" as="script"><link rel="prefetch" href="/assets/1.html-ZBR8P9zs.js" as="script"><link rel="prefetch" href="/assets/2.html-h4FH5Y1b.js" as="script"><link rel="prefetch" href="/assets/3.html-DqBHsi3P.js" as="script"><link rel="prefetch" href="/assets/åŸç†ç¯‡.html-CeuOjSF9.js" as="script"><link rel="prefetch" href="/assets/åŸºç¡€ç¯‡.html-DMCdSy06.js" as="script"><link rel="prefetch" href="/assets/å®æˆ˜ç¯‡.html-BpTJNf-V.js" as="script"><link rel="prefetch" href="/assets/é«˜çº§ç¯‡.html-D3Wt50wK.js" as="script"><link rel="prefetch" href="/assets/404.html-CUR0_zs7.js" as="script"><link rel="prefetch" href="/assets/index.html-D0c8Gg6F.js" as="script"><link rel="prefetch" href="/assets/index.html-D0tMl3tp.js" as="script"><link rel="prefetch" href="/assets/index.html-C8qAzO7y.js" as="script"><link rel="prefetch" href="/assets/index.html-mkUws1zY.js" as="script"><link rel="prefetch" href="/assets/index.html-BvNWQlRV.js" as="script"><link rel="prefetch" href="/assets/index.html-W9QlsMbk.js" as="script"><link rel="prefetch" href="/assets/index.html-Cz3A5nOV.js" as="script"><link rel="prefetch" href="/assets/index.html-DQOISo6e.js" as="script"><link rel="prefetch" href="/assets/index.html-C_shDS0W.js" as="script"><link rel="prefetch" href="/assets/index.html-RFnu_czc.js" as="script"><link rel="prefetch" href="/assets/index.html-BKXUePqQ.js" as="script"><link rel="prefetch" href="/assets/index.html-apzbH2MC.js" as="script"><link rel="prefetch" href="/assets/index.html-CjPT6e7a.js" as="script"><link rel="prefetch" href="/assets/index.html-CwKUHEJs.js" as="script"><link rel="prefetch" href="/assets/index.html-CW1jllHR.js" as="script"><link rel="prefetch" href="/assets/index.html-Cw7Skty9.js" as="script"><link rel="prefetch" href="/assets/index.html-D6OtKsP1.js" as="script"><link rel="prefetch" href="/assets/index.html-CevHYEJY.js" as="script"><link rel="prefetch" href="/assets/index.html-5sel0nsJ.js" as="script"><link rel="prefetch" href="/assets/index.html-Ca00OiL_.js" as="script"><link rel="prefetch" href="/assets/index.html-D0Xq7xX_.js" as="script"><link rel="prefetch" href="/assets/index.html-DpTqnlmS.js" as="script"><link rel="prefetch" href="/assets/index.html-0jFPid-u.js" as="script"><link rel="prefetch" href="/assets/index.html-0aU6Ts7D.js" as="script"><link rel="prefetch" href="/assets/index.html-BSG5fdy2.js" as="script"><link rel="prefetch" href="/assets/index.html-BX3Gx8wH.js" as="script"><link rel="prefetch" href="/assets/index.html-BH7OMchJ.js" as="script"><link rel="prefetch" href="/assets/index.html-C09iAvUd.js" as="script"><link rel="prefetch" href="/assets/index.html-720WQkQh.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz9EseMW.js" as="script"><link rel="prefetch" href="/assets/index.html-BX7rVJm4.js" as="script"><link rel="prefetch" href="/assets/index.html-Co2ZJ11K.js" as="script"><link rel="prefetch" href="/assets/index.html-or4c9KE3.js" as="script"><link rel="prefetch" href="/assets/index.html-DHv1nUeh.js" as="script"><link rel="prefetch" href="/assets/index.html-a-_fwkP7.js" as="script"><link rel="prefetch" href="/assets/index.html-C5MMOz5c.js" as="script"><link rel="prefetch" href="/assets/index.html-DXC4qNUv.js" as="script"><link rel="prefetch" href="/assets/index.html-C6KQiWQw.js" as="script"><link rel="prefetch" href="/assets/index.html-DBgALRKx.js" as="script"><link rel="prefetch" href="/assets/index.html-DFB2-xIf.js" as="script"><link rel="prefetch" href="/assets/index.html-DW5qRnwT.js" as="script"><link rel="prefetch" href="/assets/index.html-BCZmyCSI.js" as="script"><link rel="prefetch" href="/assets/index.html-DN6OsREb.js" as="script"><link rel="prefetch" href="/assets/index.html-DR7XLHzJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BJvJgApa.js" as="script"><link rel="prefetch" href="/assets/index.html-DK0nW9_K.js" as="script"><link rel="prefetch" href="/assets/index.html-eEOFe2MX.js" as="script"><link rel="prefetch" href="/assets/index.html-CDmnyxoj.js" as="script"><link rel="prefetch" href="/assets/index.html-C8yAmx5R.js" as="script"><link rel="prefetch" href="/assets/index.html-DJwlJv2R.js" as="script"><link rel="prefetch" href="/assets/index.html-M5OgcfHY.js" as="script"><link rel="prefetch" href="/assets/index.html-P9ONFwUp.js" as="script"><link rel="prefetch" href="/assets/index.html-DBOr_LpB.js" as="script"><link rel="prefetch" href="/assets/index.html-CmFzzTWt.js" as="script"><link rel="prefetch" href="/assets/index.html-DPCZ_26r.js" as="script"><link rel="prefetch" href="/assets/index.html-DGApnZiH.js" as="script"><link rel="prefetch" href="/assets/index.html-CaW_r5w0.js" as="script"><link rel="prefetch" href="/assets/index.html-oAvDvqXR.js" as="script"><link rel="prefetch" href="/assets/index.html-CKitW_xu.js" as="script"><link rel="prefetch" href="/assets/index.html-BkvJo-H_.js" as="script"><link rel="prefetch" href="/assets/index.html-tBYnMJA9.js" as="script"><link rel="prefetch" href="/assets/index.html-DlIhePPq.js" as="script"><link rel="prefetch" href="/assets/index.html-d1mMCOj8.js" as="script"><link rel="prefetch" href="/assets/index.html-CtcrhILb.js" as="script"><link rel="prefetch" href="/assets/index.html-BduuL9xC.js" as="script"><link rel="prefetch" href="/assets/index.html-CS1CZVXL.js" as="script"><link rel="prefetch" href="/assets/index.html-8TwyI_f1.js" as="script"><link rel="prefetch" href="/assets/index.html-BNkJCdbp.js" as="script"><link rel="prefetch" href="/assets/index.html-C3dujje_.js" as="script"><link rel="prefetch" href="/assets/index.html-BNTn92D3.js" as="script"><link rel="prefetch" href="/assets/index.html-C-47J9XI.js" as="script"><link rel="prefetch" href="/assets/index.html-B2X6mNRZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DR8sXqKx.js" as="script"><link rel="prefetch" href="/assets/index.html-D89T-G_h.js" as="script"><link rel="prefetch" href="/assets/index.html-BqtyfX-v.js" as="script"><link rel="prefetch" href="/assets/index.html-B3pPino9.js" as="script"><link rel="prefetch" href="/assets/index.html-CNbf8WKN.js" as="script"><link rel="prefetch" href="/assets/index.html-BB8U1Z04.js" as="script"><link rel="prefetch" href="/assets/index.html-MuTY465q.js" as="script"><link rel="prefetch" href="/assets/index.html-CRj2jUAb.js" as="script"><link rel="prefetch" href="/assets/index.html-DwdTnPV7.js" as="script"><link rel="prefetch" href="/assets/index.html-DfXUzTNz.js" as="script"><link rel="prefetch" href="/assets/index.html-DMwq8ac_.js" as="script"><link rel="prefetch" href="/assets/index.html-CkgGep-W.js" as="script"><link rel="prefetch" href="/assets/index.html-DEX2Vcds.js" as="script"><link rel="prefetch" href="/assets/index.html-B5e0iBBw.js" as="script"><link rel="prefetch" href="/assets/index.html-qBWWr8af.js" as="script"><link rel="prefetch" href="/assets/index.html-B4RJ1MJD.js" as="script"><link rel="prefetch" href="/assets/index.html-XyChusb9.js" as="script"><link rel="prefetch" href="/assets/index.html-BLXihSGk.js" as="script"><link rel="prefetch" href="/assets/index.html-CGVwl457.js" as="script"><link rel="prefetch" href="/assets/index.html-Cg746Uyd.js" as="script"><link rel="prefetch" href="/assets/index.html-BAfgvSSS.js" as="script"><link rel="prefetch" href="/assets/index.html-CuzHQiin.js" as="script"><link rel="prefetch" href="/assets/index.html-B7XIl6OT.js" as="script"><link rel="prefetch" href="/assets/index.html-BlP8TJBW.js" as="script"><link rel="prefetch" href="/assets/index.html-PF14xvk6.js" as="script"><link rel="prefetch" href="/assets/index.html-C8Jcfek6.js" as="script"><link rel="prefetch" href="/assets/index.html-B-jn42h8.js" as="script"><link rel="prefetch" href="/assets/index.html-CDdu2eOT.js" as="script"><link rel="prefetch" href="/assets/index.html-xyrpfdYa.js" as="script"><link rel="prefetch" href="/assets/index.html-a4qSoKNB.js" as="script"><link rel="prefetch" href="/assets/index.html-B-af5E1r.js" as="script"><link rel="prefetch" href="/assets/index.html-BqAcJyXa.js" as="script"><link rel="prefetch" href="/assets/index.html-D8EOF5R-.js" as="script"><link rel="prefetch" href="/assets/index.html-SDE2W74l.js" as="script"><link rel="prefetch" href="/assets/index.html-BUYnPgnG.js" as="script"><link rel="prefetch" href="/assets/index.html-DD_vvRu5.js" as="script"><link rel="prefetch" href="/assets/index.html-D97hq8mB.js" as="script"><link rel="prefetch" href="/assets/index.html-DlN0zaNU.js" as="script"><link rel="prefetch" href="/assets/index.html-YDvvyl4z.js" as="script"><link rel="prefetch" href="/assets/index.html-DLILAqqc.js" as="script"><link rel="prefetch" href="/assets/index.html-o2oOeAKk.js" as="script"><link rel="prefetch" href="/assets/index.html-0b9oMOi5.js" as="script"><link rel="prefetch" href="/assets/index.html-BvFG6tmp.js" as="script"><link rel="prefetch" href="/assets/index.html-DaAG73ax.js" as="script"><link rel="prefetch" href="/assets/index.html-BYOZnHww.js" as="script"><link rel="prefetch" href="/assets/index.html-Dm8AVlMu.js" as="script"><link rel="prefetch" href="/assets/index.html-CyV7N3m6.js" as="script"><link rel="prefetch" href="/assets/index.html-C71xRMlO.js" as="script"><link rel="prefetch" href="/assets/index.html-BXyn2yIc.js" as="script"><link rel="prefetch" href="/assets/index.html-CNUO322U.js" as="script"><link rel="prefetch" href="/assets/index.html-BR6WjjXS.js" as="script"><link rel="prefetch" href="/assets/index.html-CdjJ49qX.js" as="script"><link rel="prefetch" href="/assets/index.html-ByAOLnxH.js" as="script"><link rel="prefetch" href="/assets/index.html-B-Gc9Lqs.js" as="script"><link rel="prefetch" href="/assets/index.html-BFAbHOZ8.js" as="script"><link rel="prefetch" href="/assets/index.html-BKu6TXsS.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/touxiang/vue-color-avatar3.png" alt><!----><span class="vp-site-name hide-in-pad">éº»èŠ±çš„å°ç«™</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon iconfont icon-xuexibiji" style=""></span><!--]-->å­¦ä¹ ç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interviewExperience/" aria-label="é¢è¯•ä¸“æ "><!--[--><span class="font-icon icon iconfont icon-flow-interview" style=""></span><!--]-->é¢è¯•ä¸“æ <!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/softwareTutorial/" aria-label="è½¯ä»¶æ•™ç¨‹"><!--[--><span class="font-icon icon iconfont icon-ruanjianjiaocheng1" style=""></span><!--]-->è½¯ä»¶æ•™ç¨‹<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/aboutMe/" aria-label="å…³äºæˆ‘"><!--[--><span class="font-icon icon iconfont icon-guanyuzuozhe" style=""></span><!--]-->å…³äºæˆ‘<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/skxndbzu/JackChenBlogs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-meiribikan" style=""></span><span class="vp-sidebar-title">å¿…çœ‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-zhenrenmianshi" style=""></span><span class="vp-sidebar-title">é¢è¯•ä¸“æ </span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-application--web" style=""></span><span class="vp-sidebar-title">è®¡ç®—æœºåŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-xitongsheji" style=""></span><span class="vp-sidebar-title">ç³»ç»Ÿè®¾è®¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-jurassic_data" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-kaifagongju" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/developmentTool/" aria-label="å¼€å‘å·¥å…·"><!---->å¼€å‘å·¥å…·<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¸¸ç”¨æ¡†æ¶"><!---->å¸¸ç”¨æ¡†æ¶<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¾®æœåŠ¡æ¶æ„"><!---->å¾®æœåŠ¡æ¶æ„<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/Dubbo.html" aria-label="Dubbo"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->Dubbo<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/zookeeper.html" aria-label="zookeeper"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->zookeeper<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/2.html" aria-label="é¦™è•‰ 2"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->é¦™è•‰ 2<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å‰ç«¯"><!---->å‰ç«¯<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ¶ˆæ¯ä¸­é—´ä»¶"><!---->æ¶ˆæ¯ä¸­é—´ä»¶<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="ä»‹ç»é¡µ"><!--[--><span class="font-icon icon iconfont icon-fenxiangdingqijieshao" style=""></span><!--]-->ä»‹ç»é¡µ<!----></a></li><li><a class="auto-link external-link vp-sidebar-link" href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" aria-label="å¹»ç¯ç‰‡" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon iconfont icon-huandengpian-04" style=""></span><!--]-->å¹»ç¯ç‰‡<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>zookeeper</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://chemnminghe.top" target="_blank" rel="noopener noreferrer">Jack-Chen</a></span><span property="author" content="Jack-Chen"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-06T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 25 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT25M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color0 clickable" role="navigation">åˆ†å¸ƒå¼æ¶æ„</span><!--]--><meta property="articleSection" content="åˆ†å¸ƒå¼æ¶æ„"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color0 clickable" role="navigation">é›†ç¾¤</span><span class="page-tag-item color7 clickable" role="navigation">ç›‘å¬</span><!--]--><meta property="keywords" content="é›†ç¾¤,ç›‘å¬"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¬¬-1-ç« -zookeeper-å…¥é—¨">ç¬¬ 1 ç«  Zookeeper å…¥é—¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-æ¦‚è¿°">1.1 æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-zookeeperç‰¹ç‚¹">1.2 Zookeeperç‰¹ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-3-æ•°æ®ç»“æ„">1.3 æ•°æ®ç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-4-åº”ç”¨åœºæ™¯">1.4 åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-5-ä¸‹è½½åœ°å€">1.5 ä¸‹è½½åœ°å€</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¬¬-2-ç« -zookeeper-æœ¬åœ°å®‰è£…">ç¬¬ 2 ç«  Zookeeper æœ¬åœ°å®‰è£…</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-æœ¬åœ°æ¨¡å¼å®‰è£…">2.1 æœ¬åœ°æ¨¡å¼å®‰è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-é…ç½®å‚æ•°è§£è¯»">2.2 é…ç½®å‚æ•°è§£è¯»</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¬¬-3-ç« -zookeeper-é›†ç¾¤æ“ä½œ">ç¬¬ 3 ç«  Zookeeper é›†ç¾¤æ“ä½œ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-é›†ç¾¤æ“ä½œ">3.1 é›†ç¾¤æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ">3.2 å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-å®¢æˆ·ç«¯-api-æ“ä½œ">3.3 å®¢æˆ·ç«¯ API æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-4-å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹">3.4 å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¬¬-4-ç« -æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹">ç¬¬ 4 ç«  æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-éœ€æ±‚">4.1 éœ€æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-éœ€æ±‚åˆ†æ">4.2 éœ€æ±‚åˆ†æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-å…·ä½“å®ç°">4.3 å…·ä½“å®ç°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-æµ‹è¯•">4.4 æµ‹è¯•</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¬¬-5-ç« -zookeeper-åˆ†å¸ƒå¼é”æ¡ˆä¾‹">ç¬¬ 5 ç«  ZooKeeper åˆ†å¸ƒå¼é”æ¡ˆä¾‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-1-åŸç”Ÿ-zookeeper-å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹">5.1 åŸç”Ÿ Zookeeper å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-curator-æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹">5.2 Curator æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¬¬-6-ç« -ä¼ä¸šé¢è¯•çœŸé¢˜-é¢è¯•é‡ç‚¹">ç¬¬ 6 ç«  ä¼ä¸šé¢è¯•çœŸé¢˜(é¢è¯•é‡ç‚¹)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-1-é€‰ä¸¾æœºåˆ¶">6.1 é€‰ä¸¾æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-2-ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘-zk-åˆé€‚">6.2 ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘ zk åˆé€‚?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-3-å¸¸ç”¨å‘½ä»¤">6.3 å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="zookeeper" tabindex="-1"><a class="header-anchor" href="#zookeeper"><span>zookeeper</span></a></h1><p>å°šç¡…è°·ZooKeeperè§†é¢‘æ•™ç¨‹</p><ul><li>è§†é¢‘åœ°å€ï¼šhttps://www.bilibili.com/video/BV1to4y1C7gw/</li><li>è¯¾ç¨‹èµ„æ–™ï¼š<a href="https://pan.baidu.com/s/1D_atyMC1JbKo_mZ2rOE_Eg?pwd=yyds" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1D_atyMC1JbKo_mZ2rOE_Eg</a> æå–ç ï¼šyyds</li></ul><h2 id="ç¬¬-1-ç« -zookeeper-å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#ç¬¬-1-ç« -zookeeper-å…¥é—¨"><span>ç¬¬ 1 ç«  Zookeeper å…¥é—¨</span></a></h2><h3 id="_1-1-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_1-1-æ¦‚è¿°"><span>1.1 æ¦‚è¿°</span></a></h3><p>Zookeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼æ¡†æ¶æä¾›åè°ƒæœåŠ¡çš„ Apache é¡¹ç›®ã€‚</p><figure><img src="https://mouday.github.io/img/2024/06/08/30neg4c.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Zookeeperå·¥ä½œæœºåˆ¶</p><p>Zookeeperä»è®¾è®¡æ¨¡å¼è§’åº¦æ¥ç†è§£:</p><p>æ˜¯ä¸€ä¸ªåŸºäº<code>è§‚å¯Ÿè€…æ¨¡å¼</code>è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒè´Ÿè´£å­˜å‚¨å’Œç®¡ç†å¤§å®¶éƒ½å…³å¿ƒçš„æ•°æ®ï¼Œç„¶åæ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œï¼Œä¸€æ—¦è¿™äº›æ•°æ®çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒZookeeper å°±å°†è´Ÿè´£é€šçŸ¥å·²ç»åœ¨Zookeeperä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…åšå‡ºç›¸åº”çš„ååº”ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Zookeeper=æ–‡ä»¶ç³»ç»Ÿ+é€šçŸ¥æœºåˆ¶</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-2-zookeeperç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#_1-2-zookeeperç‰¹ç‚¹"><span>1.2 Zookeeperç‰¹ç‚¹</span></a></h3><ul><li>1)Zookeeper:ä¸€ä¸ªé¢†å¯¼è€…(Leader)ï¼Œå¤šä¸ªè·Ÿéšè€…(Follower)ç»„æˆçš„é›†ç¾¤ã€‚</li><li>2)é›†ç¾¤ä¸­åªè¦æœ‰<code>åŠæ•°ä»¥ä¸Š</code>èŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚æ‰€ä»¥Zookeeperé€‚åˆå®‰è£…å¥‡æ•°å°æœåŠ¡å™¨ã€‚</li><li>3)å…¨å±€æ•°æ®ä¸€è‡´:æ¯ä¸ªServerä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼ŒClientæ— è®ºè¿æ¥åˆ°å“ªä¸ªServerï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li><li>4)æ›´æ–°è¯·æ±‚é¡ºåºæ‰§è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªClientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li>5)æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</li><li>6)å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼ŒClientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚</li></ul><h3 id="_1-3-æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-3-æ•°æ®ç»“æ„"><span>1.3 æ•°æ®ç»“æ„</span></a></h3><p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚æ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡ å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ã€‚</p><figure><img src="https://mouday.github.io/img/2024/06/08/buw5nh4.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="_1-4-åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_1-4-åº”ç”¨åœºæ™¯"><span>1.4 åº”ç”¨åœºæ™¯</span></a></h3><p>æä¾›çš„æœåŠ¡åŒ…æ‹¬:ç»Ÿä¸€å‘½åæœåŠ¡ã€ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€é›†ç¾¤ç®¡ç†ã€æœåŠ¡å™¨èŠ‚ç‚¹åŠ¨æ€ä¸Šä¸‹ çº¿ã€è½¯è´Ÿè½½å‡è¡¡ç­‰ã€‚</p><p>(1)ç»Ÿä¸€å‘½åæœåŠ¡</p><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œç»å¸¸éœ€è¦å¯¹åº”ç”¨/æœ åŠ¡è¿›è¡Œç»Ÿä¸€å‘½åï¼Œä¾¿äºè¯†åˆ«ã€‚ ä¾‹å¦‚:IPä¸å®¹æ˜“è®°ä½ï¼Œè€ŒåŸŸåå®¹æ˜“è®°ä½ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>www.baidu.com</span></span>
<span class="line"><span>    192.168.22.13</span></span>
<span class="line"><span>    192.168.22.14</span></span>
<span class="line"><span>    192.168.22.15</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)ç»Ÿä¸€é…ç½®ç®¡ç†</p><p>1)åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œé…ç½®æ–‡ä»¶åŒæ­¥éå¸¸å¸¸è§ã€‚</p><ol><li>ä¸€èˆ¬è¦æ±‚ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯æ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚ Kafka é›†ç¾¤ã€‚</li><li>å¯¹é…ç½®æ–‡ä»¶ä¿®æ”¹åï¼Œå¸Œæœ›èƒ½å¤Ÿå¿«é€ŸåŒæ­¥åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚</li></ol><p>2)é…ç½®ç®¡ç†å¯äº¤ç”±ZooKeeperå®ç°ã€‚</p><ol><li>å¯å°†é…ç½®ä¿¡æ¯å†™å…¥ZooKeeperä¸Šçš„ä¸€ä¸ªZnodeã€‚</li><li>å„ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨ç›‘å¬è¿™ä¸ªZnodeã€‚</li><li>ä¸€æ—¦Znodeä¸­çš„æ•°æ®è¢«ä¿®æ”¹ï¼ŒZooKeeperå°†é€šçŸ¥ å„ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨ã€‚</li></ol><p>(3)ç»Ÿä¸€é›†ç¾¤ç®¡ç†</p><p>1)åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå®æ—¶æŒæ¡æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯å¿…è¦çš„ã€‚</p><ol><li>å¯æ ¹æ®èŠ‚ç‚¹å®æ—¶çŠ¶æ€åšå‡ºä¸€äº›è°ƒæ•´ã€‚</li></ol><p>2)ZooKeeperå¯ä»¥å®ç°å®æ—¶ç›‘æ§èŠ‚ç‚¹çŠ¶æ€å˜åŒ–</p><ol><li>å¯å°†èŠ‚ç‚¹ä¿¡æ¯å†™å…¥ZooKeeperä¸Šçš„ä¸€ä¸ªZNodeã€‚</li><li>ç›‘å¬è¿™ä¸ªZNodeå¯è·å–å®ƒçš„å®æ—¶çŠ¶æ€å˜åŒ–ã€‚</li></ol><p>(4)æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿</p><p>å®¢æˆ·ç«¯èƒ½å®æ—¶æ´å¯Ÿåˆ°æœåŠ¡å™¨ä¸Šä¸‹çº¿çš„å˜åŒ–</p><p>(5)è½¯è´Ÿè½½å‡è¡¡</p><p>åœ¨Zookeeperä¸­è®°å½•æ¯å°æœåŠ¡å™¨çš„è®¿é—®æ•°ï¼Œè®©è®¿é—®æ•°æœ€å°‘çš„æœåŠ¡å™¨å»å¤„ç†æœ€æ–°çš„å®¢æˆ·ç«¯è¯·æ±‚</p><h3 id="_1-5-ä¸‹è½½åœ°å€" tabindex="-1"><a class="header-anchor" href="#_1-5-ä¸‹è½½åœ°å€"><span>1.5 ä¸‹è½½åœ°å€</span></a></h3><p>1)å®˜ç½‘é¦–é¡µ: https://zookeeper.apache.org/</p><p>å½’æ¡£åœ°å€ï¼šhttps://archive.apache.org/dist/zookeeper/</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>wget https://archive.apache.org/dist/zookeeper/zookeeper-3.5.7/apache-zookeeper-3.5.7-bin.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="ç¬¬-2-ç« -zookeeper-æœ¬åœ°å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ç¬¬-2-ç« -zookeeper-æœ¬åœ°å®‰è£…"><span>ç¬¬ 2 ç«  Zookeeper æœ¬åœ°å®‰è£…</span></a></h2><h3 id="_2-1-æœ¬åœ°æ¨¡å¼å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_2-1-æœ¬åœ°æ¨¡å¼å®‰è£…"><span>2.1 æœ¬åœ°æ¨¡å¼å®‰è£…</span></a></h3><p>1)å®‰è£…å‰å‡†å¤‡</p><ol><li>å®‰è£… JDK</li><li>è§£å‹æ”¹å</li></ol><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># è§£å‹åˆ°æŒ‡å®šç›®å½•</span></span>
<span class="line"><span>$ tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ä¿®æ”¹åç§°</span></span>
<span class="line"><span>$ mv apache-zookeeper-3.5.7-bin zookeeper-3.5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2)é…ç½®ä¿®æ”¹</p><p>(1)å°†/opt/module/zookeeper-3.5.7/conf è¿™ä¸ªè·¯å¾„ä¸‹çš„ zoo_sample.cfg ä¿®æ”¹ä¸º zoo.cfg;</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ mv zoo_sample.cfg zoo.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)æ‰“å¼€ zoo.cfg æ–‡ä»¶ï¼Œä¿®æ”¹ dataDir è·¯å¾„:</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ vim zoo.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¿®æ”¹å¦‚ä¸‹å†…å®¹:</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>dataDir=/opt/module/zookeeper-3.5.7/zkData</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(3)åœ¨/opt/module/zookeeper-3.5.7/è¿™ä¸ªç›®å½•ä¸Šåˆ›å»º zkData æ–‡ä»¶å¤¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ mkdir zkData</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3)æ“ä½œ Zookeeper</p><p>(1)å¯åŠ¨ Zookeeper</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ bin/zkServer.sh start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ jps </span></span>
<span class="line"><span>4020 Jps</span></span>
<span class="line"><span>4001 QuorumPeerMain</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3)æŸ¥çœ‹çŠ¶æ€</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ bin/zkServer.sh status </span></span>
<span class="line"><span>ZooKeeper JMX enabled by default</span></span>
<span class="line"><span>Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg</span></span>
<span class="line"><span>Mode: standalone</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(4)å¯åŠ¨å®¢æˆ·ç«¯</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ bin/zkCli.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(5)é€€å‡ºå®¢æˆ·ç«¯</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 0] quit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(6)åœæ­¢ Zookeeper</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ bin/zkServer.sh stop</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-2-é…ç½®å‚æ•°è§£è¯»" tabindex="-1"><a class="header-anchor" href="#_2-2-é…ç½®å‚æ•°è§£è¯»"><span>2.2 é…ç½®å‚æ•°è§£è¯»</span></a></h3><p>zoo_sample.cfg</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># The number of milliseconds of each tick</span></span>
<span class="line"><span>tickTime=2000</span></span>
<span class="line"><span># The number of ticks that the initial </span></span>
<span class="line"><span># synchronization phase can take</span></span>
<span class="line"><span>initLimit=10</span></span>
<span class="line"><span># The number of ticks that can pass between </span></span>
<span class="line"><span># sending a request and getting an acknowledgement</span></span>
<span class="line"><span>syncLimit=5</span></span>
<span class="line"><span># the directory where the snapshot is stored.</span></span>
<span class="line"><span># do not use /tmp for storage, /tmp here is just </span></span>
<span class="line"><span># example sakes.</span></span>
<span class="line"><span>dataDir=/tmp/zookeeper</span></span>
<span class="line"><span># the port at which the clients will connect</span></span>
<span class="line"><span>clientPort=2181</span></span>
<span class="line"><span># the maximum number of client connections.</span></span>
<span class="line"><span># increase this if you need to handle more clients</span></span>
<span class="line"><span>#maxClientCnxns=60</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Be sure to read the maintenance section of the </span></span>
<span class="line"><span># administrator guide before turning on autopurge.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># The number of snapshots to retain in dataDir</span></span>
<span class="line"><span>#autopurge.snapRetainCount=3</span></span>
<span class="line"><span># Purge task interval in hours</span></span>
<span class="line"><span># Set to &quot;0&quot; to disable auto purge feature</span></span>
<span class="line"><span>#autopurge.purgeInterval=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zookeeperä¸­çš„é…ç½®æ–‡ä»¶zoo.cfgä¸­å‚æ•°å«ä¹‰è§£è¯»å¦‚ä¸‹:</p><p>1)<code>tickTime</code> = 2000: é€šä¿¡å¿ƒè·³æ—¶é—´ï¼ŒZookeeperæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’</p><p>2)<code>initLimit</code> = 10: LFåˆå§‹é€šä¿¡æ—¶é™ï¼ŒLeaderå’ŒFolloweråˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°(tickTimeçš„æ•°é‡)</p><p>3)<code>syncLimit</code> = 5: LFåŒæ­¥é€šä¿¡æ—¶é™ï¼ŒLeaderå’ŒFollowerä¹‹é—´é€šä¿¡æ—¶é—´å¦‚æœè¶…è¿‡syncLimit * tickTimeï¼ŒLeaderè®¤ä¸ºFollweræ­» æ‰ï¼Œä»æœåŠ¡å™¨åˆ—è¡¨ä¸­åˆ é™¤Follwerã€‚</p><p>4)<code>dataDir</code>: ä¿å­˜Zookeeperä¸­çš„æ•°æ®ï¼Œæ³¨æ„:é»˜è®¤çš„tmpç›®å½•ï¼Œå®¹æ˜“è¢«Linuxç³»ç»Ÿå®šæœŸåˆ é™¤ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ç”¨é»˜è®¤çš„tmpç›®å½•ã€‚</p><p>5)<code>clientPort</code> = 2181: å®¢æˆ·ç«¯è¿æ¥ç«¯å£ï¼Œé€šå¸¸ä¸åšä¿®æ”¹ã€‚</p><h2 id="ç¬¬-3-ç« -zookeeper-é›†ç¾¤æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç¬¬-3-ç« -zookeeper-é›†ç¾¤æ“ä½œ"><span>ç¬¬ 3 ç«  Zookeeper é›†ç¾¤æ“ä½œ</span></a></h2><h3 id="_3-1-é›†ç¾¤æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_3-1-é›†ç¾¤æ“ä½œ"><span>3.1 é›†ç¾¤æ“ä½œ</span></a></h3><p>3.1.1 é›†ç¾¤å®‰è£…</p><p>1)é›†ç¾¤è§„åˆ’</p><p>åœ¨ hadoop102ã€hadoop103 å’Œ hadoop104 ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šéƒ½éƒ¨ç½² Zookeeperã€‚</p><p>æ€è€ƒ:å¦‚æœæ˜¯ 10 å°æœåŠ¡å™¨ï¼Œéœ€è¦éƒ¨ç½²å¤šå°‘å° Zookeeper?</p><p>2)è§£å‹å®‰è£…</p><p>(1)åœ¨ hadoop102 è§£å‹ Zookeeper å®‰è£…åŒ…åˆ°/opt/module/ç›®å½•ä¸‹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)ä¿®æ”¹ apache-zookeeper-3.5.7-bin åç§°ä¸º zookeeper-3.5.7</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ mv apache-zookeeper-3.5.7-bin/ zookeeper-3.5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3)é…ç½®æœåŠ¡å™¨ç¼–å·</p><p>(1)åœ¨/opt/module/zookeeper-3.5.7/è¿™ä¸ªç›®å½•ä¸‹åˆ›å»º zkData</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ mkdir zkData</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)åœ¨/opt/module/zookeeper-3.5.7/zkData ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª myid çš„æ–‡ä»¶</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ vi myid</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·(æ³¨æ„:ä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼)</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>æ³¨æ„:æ·»åŠ  myid æ–‡ä»¶ï¼Œä¸€å®šè¦åœ¨ Linux é‡Œé¢åˆ›å»ºï¼Œåœ¨ notepad++é‡Œé¢å¾ˆå¯èƒ½ä¹±ç </p></blockquote><p>(3)æ‹·è´é…ç½®å¥½çš„ zookeeper åˆ°å…¶ä»–æœºå™¨ä¸Š(å¯ä»¥è‡ªè¡Œæ“ä½œ)</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ xsync zookeeper-3.5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¹¶åˆ†åˆ«åœ¨ hadoop103ã€hadoop104 ä¸Šä¿®æ”¹ myid æ–‡ä»¶ä¸­å†…å®¹ä¸º 3ã€4</p><p>4)é…ç½®zoo.cfgæ–‡ä»¶</p><p>(1)é‡å‘½å/opt/module/zookeeper-3.5.7/conf è¿™ä¸ªç›®å½•ä¸‹çš„ zoo_sample.cfg ä¸º zoo.cfg</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[atguigu@hadoop102 conf]$ mv zoo_sample.cfg zoo.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)æ‰“å¼€ zoo.cfg æ–‡ä»¶</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[atguigu@hadoop102 conf]$ vim zoo.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¿®æ”¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#ä¿®æ”¹æ•°æ®å­˜å‚¨è·¯å¾„é…ç½® </span></span>
<span class="line"><span>dataDir=/opt/module/zookeeper-3.5.7/zkData</span></span>
<span class="line"><span>#å¢åŠ å¦‚ä¸‹é…ç½®</span></span>
<span class="line"><span>#######################cluster########################## </span></span>
<span class="line"><span>server.2=hadoop102:2888:3888</span></span>
<span class="line"><span>server.3=hadoop103:2888:3888</span></span>
<span class="line"><span>server.4=hadoop104:2888:3888</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3)é…ç½®å‚æ•°è§£è¯»</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>server.A=B:C:D</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>A æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨; é›†ç¾¤æ¨¡å¼ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶ myidï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨ dataDir ç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ® å°±æ˜¯ A çš„å€¼ï¼ŒZookeeper å¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸ zoo.cfg é‡Œé¢çš„é…ç½®ä¿¡æ¯æ¯” è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ª serverã€‚</li><li>B æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„åœ°å€;</li><li>C æ˜¯è¿™ä¸ªæœåŠ¡å™¨ Follower ä¸é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£;</li><li>D æ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚</li></ul><p>(4)åŒæ­¥ zoo.cfg é…ç½®æ–‡ä»¶(å¯ä»¥è‡ªè¡Œæ“ä½œ)</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[atguigu@hadoop102 conf]$ xsync zoo.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>5)é›†ç¾¤æ“ä½œ</p><p>(1)åˆ†åˆ«å¯åŠ¨ Zookeeper</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[atguigu@hadoop102 zookeeper-3.5.7]$ bin/zkServer.sh start</span></span>
<span class="line"><span>[atguigu@hadoop103 zookeeper-3.5.7]$ bin/zkServer.sh start </span></span>
<span class="line"><span>[atguigu@hadoop104 zookeeper-3.5.7]$ bin/zkServer.sh start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)æŸ¥çœ‹çŠ¶æ€</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[atguigu@hadoop102 zookeeper-3.5.7]# bin/zkServer.sh status </span></span>
<span class="line"><span>JMX enabled by default</span></span>
<span class="line"><span>Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg Mode: follower</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[atguigu@hadoop103 zookeeper-3.5.7]# bin/zkServer.sh status </span></span>
<span class="line"><span>JMX enabled by default</span></span>
<span class="line"><span>Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg Mode: leader</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[atguigu@hadoop104 zookeeper-3.4.5]# bin/zkServer.sh status</span></span>
<span class="line"><span>JMX enabled by default</span></span>
<span class="line"><span>Using config: /opt/module/zookeeper-3.5.7/bin/../conf/zoo.cfg Mode: follower</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-é€‰ä¸¾æœºåˆ¶-é¢è¯•é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#_3-1-2-é€‰ä¸¾æœºåˆ¶-é¢è¯•é‡ç‚¹"><span>3.1.2 é€‰ä¸¾æœºåˆ¶(é¢è¯•é‡ç‚¹)</span></a></h4><p><code>SID</code>:æœåŠ¡å™¨IDã€‚ç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€å° ZooKeeperé›†ç¾¤ä¸­çš„æœºå™¨ï¼Œæ¯å°æœºå™¨ä¸èƒ½é‡ å¤ï¼Œå’Œmyidä¸€è‡´ã€‚</p><p><code>ZXID</code>:äº‹åŠ¡IDã€‚ZXIDæ˜¯ä¸€ä¸ªäº‹åŠ¡IDï¼Œç”¨æ¥ æ ‡è¯†ä¸€æ¬¡æœåŠ¡å™¨çŠ¶æ€çš„å˜æ›´ã€‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œ é›†ç¾¤ä¸­çš„æ¯å°æœºå™¨çš„ZXIDå€¼ä¸ä¸€å®šå®Œå…¨ä¸€ è‡´ï¼Œè¿™å’ŒZooKeeperæœåŠ¡å™¨å¯¹äºå®¢æˆ·ç«¯â€œæ›´ æ–°è¯·æ±‚â€çš„å¤„ç†é€»è¾‘æœ‰å…³</p><p><code>Epoch</code>:æ¯ä¸ªLeaderä»»æœŸçš„ä»£å·ã€‚æ²¡æœ‰ Leaderæ—¶åŒä¸€è½®æŠ•ç¥¨è¿‡ç¨‹ä¸­çš„é€»è¾‘æ—¶é’Ÿå€¼æ˜¯ ç›¸åŒçš„ã€‚æ¯æŠ•å®Œä¸€æ¬¡ç¥¨è¿™ä¸ªæ•°æ®å°±ä¼šå¢åŠ </p><p>1ã€Zookeeperé€‰ä¸¾æœºåˆ¶â€”â€”ç¬¬ä¸€æ¬¡å¯åŠ¨</p><figure><img src="https://mouday.github.io/img/2024/06/08/00fmqhy.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>(1)æœåŠ¡å™¨1å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æœåŠ¡å™¨1æŠ•è‡ªå·±ä¸€ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨1ç¥¨æ•°ä¸€ç¥¨ï¼Œä¸å¤ŸåŠæ•°ä»¥ä¸Š(3ç¥¨)ï¼Œé€‰ä¸¾æ— æ³•å®Œæˆï¼ŒæœåŠ¡å™¨1çŠ¶æ€ä¿æŒä¸º<code>LOOKING</code>;</p><p>(2)æœåŠ¡å™¨2å¯åŠ¨ï¼Œå†å‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æœåŠ¡å™¨1å’Œ2åˆ†åˆ«æŠ•è‡ªå·±ä¸€ç¥¨å¹¶äº¤æ¢é€‰ç¥¨ä¿¡æ¯:æ­¤æ—¶æœåŠ¡å™¨1å‘ç°æœåŠ¡å™¨2çš„myidæ¯”è‡ªå·±ç›®å‰æŠ•ç¥¨æ¨ä¸¾çš„(æœåŠ¡å™¨1)å¤§ï¼Œæ›´æ”¹é€‰ç¥¨ä¸ºæ¨ä¸¾æœåŠ¡å™¨2ã€‚æ­¤æ—¶æœåŠ¡å™¨1ç¥¨æ•°0ç¥¨ï¼ŒæœåŠ¡å™¨2ç¥¨æ•°2ç¥¨ï¼Œæ²¡æœ‰åŠæ•°ä»¥ä¸Šç»“æœï¼Œé€‰ä¸¾æ— æ³•å®Œæˆï¼ŒæœåŠ¡å™¨1ï¼Œ2çŠ¶æ€ä¿æŒ<code>LOOKING</code></p><p>(3)æœåŠ¡å™¨3å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æ­¤æ—¶æœåŠ¡å™¨1å’Œ2éƒ½ä¼šæ›´æ”¹é€‰ç¥¨ä¸ºæœåŠ¡å™¨3ã€‚æ­¤æ¬¡æŠ•ç¥¨ç»“æœ:æœåŠ¡å™¨1ä¸º0ç¥¨ï¼ŒæœåŠ¡å™¨2ä¸º0ç¥¨ï¼ŒæœåŠ¡å™¨3ä¸º3ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨3çš„ç¥¨æ•°å·²ç»è¶…è¿‡åŠæ•°ï¼ŒæœåŠ¡å™¨3å½“é€‰Leaderã€‚æœåŠ¡å™¨1ï¼Œ2æ›´æ”¹çŠ¶æ€ä¸º<code>FOLLOWING</code>ï¼ŒæœåŠ¡å™¨3æ›´æ”¹çŠ¶æ€ä¸º<code>LEADING</code>;</p><p>(4)æœåŠ¡å™¨4å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æ­¤æ—¶æœåŠ¡å™¨1ï¼Œ2ï¼Œ3å·²ç»ä¸æ˜¯LOOKINGçŠ¶æ€ï¼Œä¸ä¼šæ›´æ”¹é€‰ç¥¨ä¿¡æ¯ã€‚äº¤æ¢é€‰ç¥¨ä¿¡æ¯ç»“æœ:æœåŠ¡å™¨3ä¸º3ç¥¨ï¼ŒæœåŠ¡å™¨4ä¸º1ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨4æœä»å¤šæ•°ï¼Œæ›´æ”¹é€‰ç¥¨ä¿¡æ¯ä¸ºæœåŠ¡å™¨3ï¼Œå¹¶æ›´æ”¹çŠ¶æ€ä¸º<code>FOLLOWING</code>;</p><p>(5)æœåŠ¡å™¨5å¯åŠ¨ï¼ŒåŒ4ä¸€æ ·å½“å°å¼Ÿã€‚</p><p>2ã€Zookeeperé€‰ä¸¾æœºåˆ¶â€”â€”éç¬¬ä¸€æ¬¡å¯åŠ¨</p><figure><img src="https://mouday.github.io/img/2024/06/08/czrlb54.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>(1)å½“ZooKeeperé›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨å‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¹‹ä¸€æ—¶ï¼Œå°±ä¼šå¼€å§‹è¿›å…¥Leaderé€‰ä¸¾:</p><ul><li>æœåŠ¡å™¨åˆå§‹åŒ–å¯åŠ¨ã€‚</li><li>æœåŠ¡å™¨è¿è¡ŒæœŸé—´æ— æ³•å’ŒLeaderä¿æŒè¿æ¥ã€‚</li></ul><p>(2)è€Œå½“ä¸€å°æœºå™¨è¿›å…¥Leaderé€‰ä¸¾æµç¨‹æ—¶ï¼Œå½“å‰é›†ç¾¤ä¹Ÿå¯èƒ½ä¼šå¤„äºä»¥ä¸‹ä¸¤ç§çŠ¶æ€:</p><ul><li>é›†ç¾¤ä¸­æœ¬æ¥å°±å·²ç»å­˜åœ¨ä¸€ä¸ªLeaderã€‚å¯¹äºç¬¬ä¸€ç§å·²ç»å­˜åœ¨Leaderçš„æƒ…å†µï¼Œæœºå™¨è¯•å›¾å»é€‰ä¸¾Leaderæ—¶ï¼Œä¼šè¢«å‘ŠçŸ¥å½“å‰æœåŠ¡å™¨çš„Leaderä¿¡æ¯ï¼Œå¯¹äºè¯¥æœºå™¨æ¥è¯´ï¼Œä»…ä»…éœ€è¦å’ŒLeaderæœºå™¨å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡ŒçŠ¶æ€åŒæ­¥å³å¯ã€‚</li><li>é›†ç¾¤ä¸­ç¡®å®ä¸å­˜åœ¨Leaderã€‚</li></ul><p>å‡è®¾ZooKeeperç”±5å°æœåŠ¡å™¨ç»„æˆï¼ŒSIDåˆ†åˆ«ä¸º1ã€2ã€3ã€4ã€5ï¼ŒZXIDåˆ†åˆ«ä¸º8ã€8ã€8ã€7ã€7ï¼Œå¹¶ä¸”æ­¤æ—¶SIDä¸º3çš„æœåŠ¡å™¨æ˜¯Leaderã€‚æŸä¸€æ—¶åˆ»ï¼Œ 3å’Œ5æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œå› æ­¤å¼€å§‹è¿›è¡ŒLeaderé€‰ä¸¾ã€‚</p><p>SIDä¸º1ã€2ã€4çš„æœºå™¨æŠ•ç¥¨æƒ…å†µ:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>(EPOCHï¼ŒZXIDï¼ŒSID )  (1ï¼Œ8ï¼Œ1)</span></span>
<span class="line"><span>(EPOCHï¼ŒZXIDï¼ŒSID )  (1ï¼Œ8ï¼Œ2) [å½“é€‰ä¸ºæ–°Leader]</span></span>
<span class="line"><span>(EPOCHï¼ŒZXIDï¼ŒSID )  (1ï¼Œ7ï¼Œ4)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€‰ä¸¾Leaderè§„åˆ™:</p><ol><li>EPOCHå¤§çš„ç›´æ¥èƒœå‡º</li><li>EPOCHç›¸åŒï¼Œäº‹åŠ¡idå¤§çš„èƒœå‡º</li><li>äº‹åŠ¡idç›¸åŒï¼ŒæœåŠ¡å™¨idå¤§çš„èƒœå‡º</li></ol><h4 id="_3-1-3-zk-é›†ç¾¤å¯åŠ¨åœæ­¢è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_3-1-3-zk-é›†ç¾¤å¯åŠ¨åœæ­¢è„šæœ¬"><span>3.1.3 ZK é›†ç¾¤å¯åŠ¨åœæ­¢è„šæœ¬</span></a></h4><p>1)åœ¨ hadoop102 çš„/home/atguigu/bin ç›®å½•ä¸‹åˆ›å»ºè„šæœ¬</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[atguigu@hadoop102 bin]$ vim zk.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è„šæœ¬ä¸­ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#!/bin/bash</span></span>
<span class="line"><span>case $1 in</span></span>
<span class="line"><span>&quot;start&quot;){</span></span>
<span class="line"><span>    for i in hadoop102 hadoop103 hadoop104 </span></span>
<span class="line"><span>    do</span></span>
<span class="line"><span>        echo ---------- zookeeper $i å¯åŠ¨ ------------</span></span>
<span class="line"><span>        ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span></span>
<span class="line"><span>    done </span></span>
<span class="line"><span>};;</span></span>
<span class="line"><span>&quot;stop&quot;){</span></span>
<span class="line"><span>    for i in hadoop102 hadoop103 hadoop104 </span></span>
<span class="line"><span>    do</span></span>
<span class="line"><span>        echo ---------- zookeeper $i åœæ­¢ ------------</span></span>
<span class="line"><span>        ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span></span>
<span class="line"><span>    done </span></span>
<span class="line"><span>};;</span></span>
<span class="line"><span>&quot;status&quot;){</span></span>
<span class="line"><span>    for i in hadoop102 hadoop103 hadoop104 </span></span>
<span class="line"><span>    do</span></span>
<span class="line"><span>        echo ---------- zookeeper $i çŠ¶æ€ ------------</span></span>
<span class="line"><span>        ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span></span>
<span class="line"><span>    done </span></span>
<span class="line"><span>};;</span></span>
<span class="line"><span>esac</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨è„šæœ¬</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 2)å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></span>
<span class="line"><span>[atguigu@hadoop102 bin]$ chmod u+x zk.sh </span></span>
<span class="line"><span># 3)Zookeeper é›†ç¾¤å¯åŠ¨è„šæœ¬</span></span>
<span class="line"><span>[atguigu@hadoop102 module]$ zk.sh start </span></span>
<span class="line"><span># 4)Zookeeper é›†ç¾¤åœæ­¢è„šæœ¬</span></span>
<span class="line"><span>[atguigu@hadoop102 module]$ zk.sh stop</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_3-2-å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ"><span>3.2 å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ</span></a></h3><h4 id="_3-2-1-å‘½ä»¤è¡Œè¯­æ³•" tabindex="-1"><a class="header-anchor" href="#_3-2-1-å‘½ä»¤è¡Œè¯­æ³•"><span>3.2.1 å‘½ä»¤è¡Œè¯­æ³•</span></a></h4><table><thead><tr><th style="text-align:left;">å‘½ä»¤åŸºæœ¬è¯­æ³•</th><th style="text-align:left;">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td style="text-align:left;">help</td><td style="text-align:left;">æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td></tr><tr><td style="text-align:left;">ls path</td><td style="text-align:left;">ä½¿ç”¨ ls å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ znode çš„å­èŠ‚ç‚¹ <code>å¯ç›‘å¬</code> -w ç›‘å¬å­èŠ‚ç‚¹å˜åŒ– -s é™„åŠ æ¬¡çº§ä¿¡æ¯</td></tr><tr><td style="text-align:left;">create</td><td style="text-align:left;">æ™®é€šåˆ›å»º -s å«æœ‰åºåˆ— -e ä¸´æ—¶(é‡å¯æˆ–è€…è¶…æ—¶æ¶ˆå¤±)</td></tr><tr><td style="text-align:left;">get path</td><td style="text-align:left;">è·å¾—èŠ‚ç‚¹çš„å€¼ <code>å¯ç›‘å¬</code> -w ç›‘å¬èŠ‚ç‚¹å†…å®¹å˜åŒ– -s é™„åŠ æ¬¡çº§ä¿¡æ¯</td></tr><tr><td style="text-align:left;">set</td><td style="text-align:left;">è®¾ç½®èŠ‚ç‚¹çš„å…·ä½“å€¼</td></tr><tr><td style="text-align:left;">stat</td><td style="text-align:left;">æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</td></tr><tr><td style="text-align:left;">delete</td><td style="text-align:left;">åˆ é™¤èŠ‚ç‚¹</td></tr><tr><td style="text-align:left;">deleteall</td><td style="text-align:left;">é€’å½’åˆ é™¤èŠ‚ç‚¹</td></tr></tbody></table><p>(1)å¯åŠ¨å®¢æˆ·ç«¯</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ bin/zkCli.sh -server 127.0.0.1:2181</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2)æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: hadoop102:2181(CONNECTED) 1] help</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-2-2-znode-èŠ‚ç‚¹æ•°æ®ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_3-2-2-znode-èŠ‚ç‚¹æ•°æ®ä¿¡æ¯"><span>3.2.2 znode èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</span></a></h4><p>(1)æŸ¥çœ‹å½“å‰znodeä¸­æ‰€åŒ…å«çš„å†…å®¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: hadoop102:2181(CONNECTED) 0] ls / </span></span>
<span class="line"><span>[zookeeper]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)æŸ¥çœ‹å½“å‰èŠ‚ç‚¹è¯¦ç»†æ•°æ®</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: hadoop102:2181(CONNECTED) 5] ls -s /</span></span>
<span class="line"><span>[zookeeper]cZxid = 0x0</span></span>
<span class="line"><span>ctime = Thu Jan 01 08:00:00 CST 1970 mZxid = 0x0</span></span>
<span class="line"><span>mtime = Thu Jan 01 08:00:00 CST 1970 pZxid = 0x0</span></span>
<span class="line"><span>cversion = -1</span></span>
<span class="line"><span>dataVersion = 0</span></span>
<span class="line"><span>aclVersion = 0</span></span>
<span class="line"><span>ephemeralOwner = 0x0</span></span>
<span class="line"><span>dataLength = 0</span></span>
<span class="line"><span>numChildren = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>(1)<code>czxid</code>: åˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡ zxidã€‚æ¯æ¬¡ä¿®æ”¹ZooKeeperçŠ¶æ€éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªZooKeeperäº‹åŠ¡IDã€‚äº‹åŠ¡IDæ˜¯ZooKeeperä¸­æ‰€ æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯æ¬¡ä¿®æ”¹éƒ½æœ‰å”¯ä¸€çš„ zxidï¼Œå¦‚æœ zxid1 å°äº zxid2ï¼Œé‚£ä¹ˆ zxid1 åœ¨ zxid2 ä¹‹ å‰å‘ç”Ÿã€‚</li><li>(2)<code>ctime</code>:znode è¢«åˆ›å»ºçš„æ¯«ç§’æ•°(ä» 1970 å¹´å¼€å§‹)</li><li>(3)<code>mzxid</code>:znode æœ€åæ›´æ–°çš„äº‹åŠ¡ zxid</li><li>(4)<code>mtime</code>:znode æœ€åä¿®æ”¹çš„æ¯«ç§’æ•°(ä» 1970 å¹´å¼€å§‹)</li><li>(5)<code>pZxid</code>:znode æœ€åæ›´æ–°çš„å­èŠ‚ç‚¹ zxid</li><li>(6)<code>cversion</code>:znode å­èŠ‚ç‚¹å˜åŒ–å·ï¼Œznode å­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•°</li><li>(7)<code>dataversion</code>:znode æ•°æ®å˜åŒ–å·</li><li>(8)<code>aclVersion</code>:znode è®¿é—®æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å·</li><li>(9)<code>ephemeralOwner</code>:å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯ znode æ‹¥æœ‰è€…çš„ session idã€‚å¦‚æœä¸æ˜¯ ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯ 0ã€‚</li><li>(10)<code>dataLength</code>:znode çš„æ•°æ®é•¿åº¦</li><li>(11)<code>numChildren</code>:znode å­èŠ‚ç‚¹æ•°é‡</li></ul><h4 id="_3-2-3-èŠ‚ç‚¹ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_3-2-3-èŠ‚ç‚¹ç±»å‹"><span>3.2.3 èŠ‚ç‚¹ç±»å‹</span></a></h4><p>æŒä¹…/çŸ­æš‚/æœ‰åºå·/æ— åºå·</p><ul><li>æŒä¹…(Persistent):å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹ä¸åˆ é™¤</li><li>çŸ­æš‚(Ephemeral):å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹è‡ªå·±åˆ é™¤</li></ul><figure><img src="https://mouday.github.io/img/2024/06/08/vxmktw8.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¯´æ˜: åˆ›å»ºznodeæ—¶è®¾ç½®é¡ºåºæ ‡è¯†ï¼Œznodeåç§° åä¼šé™„åŠ ä¸€ä¸ªå€¼ï¼Œé¡ºåºå·æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„è®¡æ•° å™¨ï¼Œç”±çˆ¶èŠ‚ç‚¹ç»´æŠ¤</p><p>æ³¨æ„: åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé¡ºåºå·å¯ä»¥è¢«ç”¨äºä¸ºæ‰€æœ‰çš„äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥é€š è¿‡é¡ºåºå·æ¨æ–­äº‹ä»¶çš„é¡ºåº</p><p>(1)æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨</p><p>(2)æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å·</p><p>(3)ä¸´æ—¶ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤</p><p>(4)ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å·ã€‚</p><p>1)åˆ†åˆ«åˆ›å»º2ä¸ªæ™®é€šèŠ‚ç‚¹(æ°¸ä¹…èŠ‚ç‚¹ + ä¸å¸¦åºå·)</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ create /sanguo &quot;diaochan&quot; </span></span>
<span class="line"><span>Created /sanguo</span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ create /sanguo/shuguo &quot;liubei&quot;</span></span>
<span class="line"><span>Created /sanguo/shuguo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ³¨æ„: åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œè¦èµ‹å€¼</p></blockquote><p>2)è·å¾—èŠ‚ç‚¹çš„å€¼</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ get -s /sanguo</span></span>
<span class="line"><span>diaochan</span></span>
<span class="line"><span>cZxid = 0x100000003</span></span>
<span class="line"><span>ctime = Wed Aug 29 00:03:23 CST 2018</span></span>
<span class="line"><span>mZxid = 0x100000003</span></span>
<span class="line"><span>mtime = Wed Aug 29 00:03:23 CST 2018 pZxid = 0x100000004</span></span>
<span class="line"><span>cversion = 1</span></span>
<span class="line"><span>dataVersion = 0</span></span>
<span class="line"><span>aclVersion = 0</span></span>
<span class="line"><span>ephemeralOwner = 0x0</span></span>
<span class="line"><span>dataLength = 7</span></span>
<span class="line"><span>numChildren = 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ get -s /sanguo/shuguo</span></span>
<span class="line"><span>liubei</span></span>
<span class="line"><span>cZxid = 0x100000004</span></span>
<span class="line"><span>ctime = Wed Aug 29 00:04:35 CST 2018</span></span>
<span class="line"><span>mZxid = 0x100000004</span></span>
<span class="line"><span>mtime = Wed Aug 29 00:04:35 CST 2018 pZxid = 0x100000004</span></span>
<span class="line"><span>cversion = 0</span></span>
<span class="line"><span>dataVersion = 0</span></span>
<span class="line"><span>aclVersion = 0</span></span>
<span class="line"><span>ephemeralOwner = 0x0</span></span>
<span class="line"><span>dataLength = 6</span></span>
<span class="line"><span>numChildren = 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3)åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹(æ°¸ä¹…èŠ‚ç‚¹ + å¸¦åºå·)</p><p>(1)å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„æ ¹èŠ‚ç‚¹/sanguo/weiguo</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ create /sanguo/weiguo &quot;caocao&quot;</span></span>
<span class="line"><span>Created /sanguo/weiguo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ create -s /sanguo/weiguo/zhangliao &quot;zhangliao&quot;</span></span>
<span class="line"><span>Created /sanguo/weiguo/zhangliao0000000000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ create -s /sanguo/weiguo/zhangliao &quot;zhangliao&quot;</span></span>
<span class="line"><span>Created /sanguo/weiguo/zhangliao0000000001</span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ create -s /sanguo/weiguo/xuchu &quot;xuchu&quot;</span></span>
<span class="line"><span>Created /sanguo/weiguo/xuchu0000000002</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœåŸæ¥æ²¡æœ‰åºå·èŠ‚ç‚¹ï¼Œåºå·ä» 0 å¼€å§‹ä¾æ¬¡é€’å¢ã€‚å¦‚æœåŸèŠ‚ç‚¹ä¸‹å·²æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å†æ’ åºæ—¶ä» 2 å¼€å§‹ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>4)åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹(çŸ­æš‚èŠ‚ç‚¹ + ä¸å¸¦åºå· or å¸¦åºå·)</p><p>(1)åˆ›å»ºçŸ­æš‚çš„ä¸å¸¦åºå·çš„èŠ‚ç‚¹(ä½¿ç”¨-eè¡¨ç¤º)</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create -e /sanguo/wuguo &quot;zhouyu&quot;</span></span>
<span class="line"><span>Created /sanguo/wuguo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)åˆ›å»ºçŸ­æš‚çš„å¸¦åºå·çš„èŠ‚ç‚¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create -e -s /sanguo/wuguo &quot;zhouyu&quot;</span></span>
<span class="line"><span>Created /sanguo/wuguo0000000001</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(3)åœ¨å½“å‰å®¢æˆ·ç«¯æ˜¯èƒ½æŸ¥çœ‹åˆ°çš„</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ ls /sanguo</span></span>
<span class="line"><span>[wuguo, wuguo0000000001, shuguo]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(4)é€€å‡ºå½“å‰å®¢æˆ·ç«¯ç„¶åå†é‡å¯å®¢æˆ·ç«¯</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$ quit </span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ bin/zkCli.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(5)å†æ¬¡æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çŸ­æš‚èŠ‚ç‚¹å·²ç»åˆ é™¤</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ls /sanguo</span></span>
<span class="line"><span>[shuguo]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>5)ä¿®æ”¹èŠ‚ç‚¹æ•°æ®å€¼</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set /sanguo/weiguo &quot;simayi&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-2-4-ç›‘å¬å™¨åŸç†" tabindex="-1"><a class="header-anchor" href="#_3-2-4-ç›‘å¬å™¨åŸç†"><span>3.2.4 ç›‘å¬å™¨åŸç†</span></a></h4><p>å®¢æˆ·ç«¯æ³¨å†Œç›‘å¬å®ƒå…³å¿ƒçš„ç›®å½•èŠ‚ç‚¹ï¼Œå½“ç›®å½•èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–(æ•°æ®æ”¹å˜ã€èŠ‚ç‚¹åˆ é™¤ã€å­ç›® å½•èŠ‚ç‚¹å¢åŠ åˆ é™¤)æ—¶ï¼ŒZooKeeper ä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚ç›‘å¬æœºåˆ¶ä¿è¯ ZooKeeper ä¿å­˜çš„ä»»ä½•çš„æ•° æ®çš„ä»»ä½•æ”¹å˜éƒ½èƒ½å¿«é€Ÿçš„å“åº”åˆ°ç›‘å¬äº†è¯¥èŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºã€‚</p><p>ç›‘å¬å™¨åŸç†</p><figure><img src="https://mouday.github.io/img/2024/06/08/6uvu4bl.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>1ã€ç›‘å¬åŸç†è¯¦è§£</p><p>1)é¦–å…ˆè¦æœ‰ä¸€ä¸ªmain()çº¿ç¨‹</p><p>2)åœ¨mainçº¿ç¨‹ä¸­åˆ›å»ºZookeeperå®¢æˆ·ç«¯ï¼Œè¿™æ—¶å°±ä¼šåˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè´Ÿè´£ç½‘ç»œè¿æ¥é€šä¿¡(connet)ï¼Œä¸€ä¸ªè´Ÿè´£ç›‘å¬(listener)ã€‚</p><p>3)é€šè¿‡connectçº¿ç¨‹å°†æ³¨å†Œçš„ç›‘å¬äº‹ä»¶å‘é€ç»™Zookeeperã€‚</p><p>4)åœ¨Zookeeperçš„æ³¨å†Œç›‘å¬å™¨åˆ—è¡¨ä¸­å°†æ³¨å†Œçš„ç›‘å¬äº‹ä»¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</p><p>5)Zookeeperç›‘å¬åˆ°æœ‰æ•°æ®æˆ–è·¯å¾„å˜åŒ–ï¼Œå°±ä¼šå°†è¿™ä¸ªæ¶ˆæ¯å‘é€ç»™listenerçº¿ç¨‹ã€‚</p><p>6)listenerçº¿ç¨‹å†…éƒ¨è°ƒç”¨äº†process()æ–¹æ³•ã€‚</p><p>2ã€å¸¸è§çš„ç›‘å¬</p><p>1)ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>get path [watch]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2)ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ls path [watch]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1)èŠ‚ç‚¹çš„å€¼å˜åŒ–ç›‘å¬</p><p>(1)åœ¨ hadoop104 ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/sanguo èŠ‚ç‚¹æ•°æ®å˜åŒ–</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 26] get -w /sanguo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)åœ¨ hadoop103 ä¸»æœºä¸Šä¿®æ”¹/sanguo èŠ‚ç‚¹çš„æ•°æ®</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 1] set /sanguo &quot;xisi&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(3)è§‚å¯Ÿ hadoop104 ä¸»æœºæ”¶åˆ°æ•°æ®å˜åŒ–çš„ç›‘å¬</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>WATCHER::</span></span>
<span class="line"><span>WatchedEvent state:SyncConnected type:NodeDataChanged path:/sanguo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„:åœ¨hadoop103å†å¤šæ¬¡ä¿®æ”¹/sanguoçš„å€¼ï¼Œhadoop104ä¸Šä¸ä¼šå†æ”¶åˆ°ç›‘å¬ã€‚å› ä¸º<strong>æ³¨å†Œ ä¸€æ¬¡ï¼Œåªèƒ½ç›‘å¬ä¸€æ¬¡</strong>ã€‚æƒ³å†æ¬¡ç›‘å¬ï¼Œéœ€è¦å†æ¬¡æ³¨å†Œã€‚</p><p>2)èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–ç›‘å¬(è·¯å¾„å˜åŒ–)</p><p>(1)åœ¨ hadoop104 ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/sanguo èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 1] ls -w /sanguo</span></span>
<span class="line"><span>[shuguo, weiguo]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)åœ¨ hadoop103 ä¸»æœº/sanguo èŠ‚ç‚¹ä¸Šåˆ›å»ºå­èŠ‚ç‚¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 2] create /sanguo/jin &quot;simayi&quot;</span></span>
<span class="line"><span>Created /sanguo/jin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(3)è§‚å¯Ÿ hadoop104 ä¸»æœºæ”¶åˆ°å­èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>WATCHER::</span></span>
<span class="line"><span>WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/sanguo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„:èŠ‚ç‚¹çš„è·¯å¾„å˜åŒ–ï¼Œä¹Ÿæ˜¯æ³¨å†Œä¸€æ¬¡ï¼Œç”Ÿæ•ˆä¸€æ¬¡ã€‚æƒ³å¤šæ¬¡ç”Ÿæ•ˆï¼Œå°±éœ€è¦å¤šæ¬¡æ³¨å†Œã€‚</p><h4 id="_3-2-5-èŠ‚ç‚¹åˆ é™¤ä¸æŸ¥çœ‹" tabindex="-1"><a class="header-anchor" href="#_3-2-5-èŠ‚ç‚¹åˆ é™¤ä¸æŸ¥çœ‹"><span>3.2.5 èŠ‚ç‚¹åˆ é™¤ä¸æŸ¥çœ‹</span></a></h4><p>1)åˆ é™¤èŠ‚ç‚¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 4] delete /sanguo/jin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2)é€’å½’åˆ é™¤èŠ‚ç‚¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 15] deleteall /sanguo/shuguo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3)æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 17] stat /sanguo </span></span>
<span class="line"><span>cZxid = 0x100000003</span></span>
<span class="line"><span>ctime = Wed Aug 29 00:03:23 CST 2018</span></span>
<span class="line"><span>mZxid = 0x100000011</span></span>
<span class="line"><span>mtime = Wed Aug 29 00:21:23 CST 2018 pZxid = 0x100000014</span></span>
<span class="line"><span>cversion = 9</span></span>
<span class="line"><span>dataVersion = 1</span></span>
<span class="line"><span>aclVersion = 0</span></span>
<span class="line"><span>ephemeralOwner = 0x0</span></span>
<span class="line"><span>dataLength = 4</span></span>
<span class="line"><span>numChildren = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-å®¢æˆ·ç«¯-api-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_3-3-å®¢æˆ·ç«¯-api-æ“ä½œ"><span>3.3 å®¢æˆ·ç«¯ API æ“ä½œ</span></a></h3><p>å‰æ:ä¿è¯ hadoop102ã€hadoop103ã€hadoop104 æœåŠ¡å™¨ä¸Š Zookeeper é›†ç¾¤æœåŠ¡ç«¯å¯åŠ¨ã€‚</p><h4 id="_3-3-1-idea-ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#_3-3-1-idea-ç¯å¢ƒæ­å»º"><span>3.3.1 IDEA ç¯å¢ƒæ­å»º</span></a></h4><p>1)åˆ›å»ºä¸€ä¸ªå·¥ç¨‹:zookeeper</p><p>2)æ·»åŠ pomæ–‡ä»¶</p><p>xml</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&lt;dependencies&gt;</span></span>
<span class="line"><span>   &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;junit&lt;/groupId&gt; </span></span>
<span class="line"><span>        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span></span>
<span class="line"><span>        &lt;version&gt;RELEASE&lt;/version&gt;</span></span>
<span class="line"><span>   &lt;/dependency&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span></span>
<span class="line"><span>        &lt;version&gt;2.8.2&lt;/version&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span></span>
<span class="line"><span>        &lt;version&gt;3.5.7&lt;/version&gt;</span></span>
<span class="line"><span>   &lt;/dependency&gt;</span></span>
<span class="line"><span>&lt;/dependencies&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3)æ‹·è´log4j.propertiesæ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•</p><p>éœ€è¦åœ¨é¡¹ç›®çš„ src/main/resources ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸ºâ€œlog4j.propertiesâ€ï¼Œåœ¨æ–‡ä»¶ä¸­å¡«å…¥ã€‚</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>log4j.rootLogger=INFO, stdout</span></span>
<span class="line"><span>log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span></span>
<span class="line"><span>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span></span>
<span class="line"><span>log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n</span></span>
<span class="line"><span>log4j.appender.logfile=org.apache.log4j.FileAppender</span></span>
<span class="line"><span>log4j.appender.logfile.File=target/spring.log</span></span>
<span class="line"><span>log4j.appender.logfile.layout=org.apache.log4j.PatternLayout</span></span>
<span class="line"><span>log4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4)åˆ›å»ºåŒ…åcom.atguigu.zk</p><p>5)åˆ›å»ºç±»åç§°zkClient</p><h4 id="_3-3-2-åˆ›å»º-zookeeper-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_3-3-2-åˆ›å»º-zookeeper-å®¢æˆ·ç«¯"><span>3.3.2 åˆ›å»º ZooKeeper å®¢æˆ·ç«¯</span></a></h4><p>java</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ³¨æ„ï¼šé€—å·å·¦å³ä¸èƒ½æœ‰ç©ºæ ¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> connectString </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sessionTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Before</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        zkClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(connectString, sessionTimeout, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Watcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WatchedEvent</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> watchedEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-3-åˆ›å»ºå­èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_3-3-3-åˆ›å»ºå­èŠ‚ç‚¹"><span>3.3.3 åˆ›å»ºå­èŠ‚ç‚¹</span></a></h4><p>java</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å‚æ•° 1:è¦åˆ›å»ºçš„èŠ‚ç‚¹çš„è·¯å¾„; </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å‚æ•° 2:èŠ‚ç‚¹æ•°æ® ; </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å‚æ•° 3:èŠ‚ç‚¹æƒé™ ; </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å‚æ•° 4:èŠ‚ç‚¹çš„ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> nodeCreated</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/atguigu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ss.avi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ZooDefs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Ids</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">OPEN_ACL_UNSAFE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CreateMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PERSISTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•:åœ¨ hadoop102 çš„ zk å®¢æˆ·ç«¯ä¸ŠæŸ¥çœ‹åˆ›å»ºèŠ‚ç‚¹æƒ…å†µ</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 16] get -s /atguigu shuaige</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-4-è·å–å­èŠ‚ç‚¹å¹¶ç›‘å¬èŠ‚ç‚¹å˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-3-4-è·å–å­èŠ‚ç‚¹å¹¶ç›‘å¬èŠ‚ç‚¹å˜åŒ–"><span>3.3.4 è·å–å­èŠ‚ç‚¹å¹¶ç›‘å¬èŠ‚ç‚¹å˜åŒ–</span></a></h4><p>java</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> children) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(child);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å»¶æ—¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MAX_VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(1)åœ¨ IDEA æ§åˆ¶å°ä¸Šçœ‹åˆ°å¦‚ä¸‹èŠ‚ç‚¹:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>zookeeper</span></span>
<span class="line"><span>sanguo</span></span>
<span class="line"><span>atguigu</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)åœ¨ hadoop102 çš„å®¢æˆ·ç«¯ä¸Šåˆ›å»ºå†åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹/atguigu1ï¼Œè§‚å¯Ÿ IDEA æ§åˆ¶å°</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 3] create /atguigu1 &quot;atguigu1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(3)åœ¨ hadoop102 çš„å®¢æˆ·ç«¯ä¸Šåˆ é™¤èŠ‚ç‚¹/atguigu1ï¼Œè§‚å¯Ÿ IDEA æ§åˆ¶å°</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 4] delete /atguigu1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-5-åˆ¤æ–­-znode-æ˜¯å¦å­˜åœ¨" tabindex="-1"><a class="header-anchor" href="#_3-3-5-åˆ¤æ–­-znode-æ˜¯å¦å­˜åœ¨"><span>3.3.5 åˆ¤æ–­ Znode æ˜¯å¦å­˜åœ¨</span></a></h4><p>java</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> exist</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Stat</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stat</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exists</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/atguigu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(stat</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;not exist &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;exist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæ•´ä»£ç </p><p>java</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.atguigu.zk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.apache.zookeeper.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.apache.zookeeper.data.Stat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.Before</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.Test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.io.IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ³¨æ„ï¼šé€—å·å·¦å³ä¸èƒ½æœ‰ç©ºæ ¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> connectString </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sessionTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Before</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        zkClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(connectString, sessionTimeout, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Watcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WatchedEvent</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> watchedEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;-------------------------------&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    children </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> children) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(child);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;-------------------------------&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">KeeperException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> nodeCreated</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/atguigu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ss.avi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ZooDefs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Ids</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">OPEN_ACL_UNSAFE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CreateMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PERSISTENT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> children) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(child);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å»¶æ—¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MAX_VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> exist</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Stat</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stat</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zkClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exists</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/atguigu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(stat</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;not exist &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;exist&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-4-å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹"><span>3.4 å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹</span></a></h3><p>å†™æµç¨‹ä¹‹å†™å…¥è¯·æ±‚ç›´æ¥å‘é€ç»™LeaderèŠ‚ç‚¹</p><figure><img src="https://mouday.github.io/img/2024/06/09/m9o0gbe.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å†™æµç¨‹ä¹‹å†™å…¥è¯·æ±‚å‘é€ç»™followerèŠ‚ç‚¹</p><figure><img src="https://mouday.github.io/img/2024/06/09/mce61ce.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="ç¬¬-4-ç« -æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¬¬-4-ç« -æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹"><span>ç¬¬ 4 ç«  æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹</span></a></h2><h3 id="_4-1-éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#_4-1-éœ€æ±‚"><span>4.1 éœ€æ±‚</span></a></h3><p>æŸåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šå°ï¼Œå¯ä»¥åŠ¨æ€ä¸Šä¸‹çº¿ï¼Œä»»æ„ä¸€å°å®¢æˆ·ç«¯éƒ½èƒ½å®æ—¶æ„ŸçŸ¥ åˆ°ä¸»èŠ‚ç‚¹æœåŠ¡å™¨çš„ä¸Šä¸‹çº¿ã€‚</p><h3 id="_4-2-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-2-éœ€æ±‚åˆ†æ"><span>4.2 éœ€æ±‚åˆ†æ</span></a></h3><p>æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ï¼šå®¢æˆ·ç«¯èƒ½å®æ—¶æ´å¯Ÿåˆ°æœåŠ¡å™¨ä¸Šä¸‹çº¿çš„å˜åŒ–</p><figure><img src="https://mouday.github.io/img/2024/06/09/h39xdwk.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="_4-3-å…·ä½“å®ç°" tabindex="-1"><a class="header-anchor" href="#_4-3-å…·ä½“å®ç°"><span>4.3 å…·ä½“å®ç°</span></a></h3><p>(1)å…ˆåœ¨é›†ç¾¤ä¸Šåˆ›å»º/servers èŠ‚ç‚¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 10] create /servers &quot;servers&quot;</span></span>
<span class="line"><span>Created /servers</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)åœ¨ Idea ä¸­åˆ›å»ºåŒ…å: com.atguigu.zkcase1</p><p>(3)æœåŠ¡å™¨ç«¯å‘ Zookeeper æ³¨å†Œä»£ç </p><p>java</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.atguigu.case1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.apache.zookeeper.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.io.IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> DistributeServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> connectString </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sessionTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> zk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DistributeServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DistributeServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 1 è·å–zkè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 2 æ³¨å†ŒæœåŠ¡å™¨åˆ°zké›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">regist</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 3 å¯åŠ¨ä¸šåŠ¡é€»è¾‘ï¼ˆç¡è§‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">business</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä¸šåŠ¡åŠŸèƒ½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> business</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MAX_VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ³¨å†ŒæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> regist</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> create</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/servers/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> hostname, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ZooDefs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Ids</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">OPEN_ACL_UNSAFE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CreateMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">EPHEMERAL_SEQUENTIAL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(hostname </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; is online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆ›å»ºåˆ° zk çš„å®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        zk </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(connectString, sessionTimeout, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Watcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WatchedEvent</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> watchedEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(4)å®¢æˆ·ç«¯ä»£ç </p><p>java</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.atguigu.case1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.apache.zookeeper.KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.apache.zookeeper.WatchedEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.apache.zookeeper.Watcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.apache.zookeeper.ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.io.IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> DistributeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> connectString </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sessionTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> zk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DistributeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DistributeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 1 è·å–zkè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 2 ç›‘å¬/serversä¸‹é¢å­èŠ‚ç‚¹çš„å¢åŠ å’Œåˆ é™¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getServerList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 3 ä¸šåŠ¡é€»è¾‘ï¼ˆç¡è§‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        client</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">business</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> business</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MAX_VALUE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è·å–æœåŠ¡å™¨åˆ—è¡¨ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getServerList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> KeeperException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 1è·å–æœåŠ¡å™¨å­èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹çˆ¶èŠ‚ç‚¹è¿›è¡Œç›‘å¬,ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueä»£è¡¨èµ°getConnect()æ–¹æ³•,ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¿æ¥ç›‘å¬æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getChildren</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/servers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 2å­˜å‚¨æœåŠ¡å™¨ä¿¡æ¯åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">servers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 3éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œè·å–èŠ‚ç‚¹ä¸­çš„ä¸»æœºåç§°ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> children) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/servers/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> child, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            servers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(data));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 4æ‰“å°æœåŠ¡å™¨åˆ—è¡¨ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(servers);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        zk </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ZooKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(connectString, sessionTimeout, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Watcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WatchedEvent</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> watchedEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                    getServerList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">KeeperException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-4-æµ‹è¯•"><span>4.4 æµ‹è¯•</span></a></h3><p>1)åœ¨ Linux å‘½ä»¤è¡Œä¸Šæ“ä½œå¢åŠ å‡å°‘æœåŠ¡å™¨</p><p>(1)å¯åŠ¨ DistributeClient å®¢æˆ·ç«¯</p><p>(2)åœ¨ hadoop102 ä¸Š zk çš„å®¢æˆ·ç«¯/servers ç›®å½•ä¸Šåˆ›å»ºä¸´æ—¶å¸¦åºå·èŠ‚ç‚¹</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 1] create -e -s /servers/hadoop102 &quot;hadoop102&quot;</span></span>
<span class="line"><span>[zk: localhost:2181(CONNECTED) 2] create -e -s /servers/hadoop103 &quot;hadoop103&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>(3)è§‚å¯Ÿ Idea æ§åˆ¶å°å˜åŒ–</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[hadoop102, hadoop103]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(4)æ‰§è¡Œåˆ é™¤æ“ä½œ</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[zk: localhost:2181(CONNECTED) 8] delete /servers/hadoop1020000000000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(5)è§‚å¯Ÿ Idea æ§åˆ¶å°å˜åŒ–</p><p>bash</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[hadoop103]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2)åœ¨ Idea ä¸Šæ“ä½œå¢åŠ å‡å°‘æœåŠ¡å™¨</p><p>(1)å¯åŠ¨ DistributeClient å®¢æˆ·ç«¯(å¦‚æœå·²ç»å¯åŠ¨è¿‡ï¼Œä¸éœ€è¦é‡å¯)</p><p>(2)å¯åŠ¨ DistributeServer æœåŠ¡</p><p>1ç‚¹å‡» Edit Configurations...</p><p>2åœ¨å¼¹å‡ºçš„çª—å£ä¸­(Program arguments)è¾“å…¥æƒ³å¯åŠ¨çš„ä¸»æœºï¼Œä¾‹å¦‚ï¼Œhadoop102</p><p>3å›åˆ° DistributeServer çš„ main æ–¹æ³•ï¼Œå³é”®ï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­ç‚¹å‡» Run â€œDistributeServer.main()â€</p><p>4è§‚å¯Ÿ DistributeServer æ§åˆ¶å°ï¼Œæç¤º hadoop102 is working</p><p>5è§‚å¯Ÿ DistributeClient æ§åˆ¶å°ï¼Œæç¤º hadoop102 å·²ç»ä¸Šçº¿</p><h2 id="ç¬¬-5-ç« -zookeeper-åˆ†å¸ƒå¼é”æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¬¬-5-ç« -zookeeper-åˆ†å¸ƒå¼é”æ¡ˆä¾‹"><span>ç¬¬ 5 ç«  ZooKeeper åˆ†å¸ƒå¼é”æ¡ˆä¾‹</span></a></h2><p>ä»€ä¹ˆå«åšåˆ†å¸ƒå¼é”å‘¢?</p><p>æ¯”å¦‚è¯´&quot;è¿›ç¨‹ 1&quot;åœ¨ä½¿ç”¨è¯¥èµ„æºçš„æ—¶å€™ï¼Œä¼šå…ˆå»è·å¾—é”ï¼Œ&quot;è¿›ç¨‹ 1&quot;è·å¾—é”ä»¥åä¼šå¯¹è¯¥èµ„æºä¿æŒç‹¬å ï¼Œè¿™æ ·å…¶ä»–è¿›ç¨‹å°±æ— æ³•è®¿é—®è¯¥èµ„æºï¼Œ&quot;è¿›ç¨‹ 1&quot;ç”¨å®Œè¯¥èµ„æºä»¥åå°±å°†é”é‡Šæ”¾æ‰ï¼Œè®©å…¶ ä»–è¿›ç¨‹æ¥è·å¾—é”ï¼Œé‚£ä¹ˆé€šè¿‡è¿™ä¸ªé”æœºåˆ¶ï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªè¿›ç¨‹èƒ½å¤Ÿæœ‰åºçš„ è®¿é—®è¯¥ä¸´ç•Œèµ„æºã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠè¿™ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è¿™ä¸ªé”å«ä½œåˆ†å¸ƒå¼é”ã€‚</p><figure><img src="https://mouday.github.io/img/2024/06/09/g88v78b.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="_5-1-åŸç”Ÿ-zookeeper-å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_5-1-åŸç”Ÿ-zookeeper-å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹"><span>5.1 åŸç”Ÿ Zookeeper å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹</span></a></h3><p>1)åˆ†å¸ƒå¼é”å®ç°</p><p>java</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>package com.atguigu.case2;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import org.apache.zookeeper.*;</span></span>
<span class="line"><span>import org.apache.zookeeper.data.Stat;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.io.IOException;</span></span>
<span class="line"><span>import java.util.Collections;</span></span>
<span class="line"><span>import java.util.List;</span></span>
<span class="line"><span>import java.util.concurrent.CountDownLatch;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public class DistributedLock {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    private final String connectString = &quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;;</span></span>
<span class="line"><span>    private final int sessionTimeout = 2000;</span></span>
<span class="line"><span>    private final ZooKeeper zk;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    private CountDownLatch connectLatch = new CountDownLatch(1);</span></span>
<span class="line"><span>    private CountDownLatch waitLatch = new CountDownLatch(1);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    private String waitPath;</span></span>
<span class="line"><span>    private String currentMode;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public DistributedLock() throws IOException, InterruptedException, KeeperException {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // è·å–è¿æ¥</span></span>
<span class="line"><span>        zk = new ZooKeeper(connectString, sessionTimeout, new Watcher() {</span></span>
<span class="line"><span>            @Override</span></span>
<span class="line"><span>            public void process(WatchedEvent watchedEvent) {</span></span>
<span class="line"><span>                // connectLatch  å¦‚æœè¿æ¥ä¸Šzk  å¯ä»¥é‡Šæ”¾</span></span>
<span class="line"><span>                if (watchedEvent.getState() == Event.KeeperState.SyncConnected){</span></span>
<span class="line"><span>                    connectLatch.countDown();</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                // waitLatch  éœ€è¦é‡Šæ”¾</span></span>
<span class="line"><span>                if (watchedEvent.getType()== Event.EventType.NodeDeleted &amp;&amp; watchedEvent.getPath().equals(waitPath)){</span></span>
<span class="line"><span>                    waitLatch.countDown();</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // ç­‰å¾…zkæ­£å¸¸è¿æ¥åï¼Œå¾€ä¸‹èµ°ç¨‹åº</span></span>
<span class="line"><span>        connectLatch.await();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ¤æ–­æ ¹èŠ‚ç‚¹/locksæ˜¯å¦å­˜åœ¨</span></span>
<span class="line"><span>        Stat stat = zk.exists(&quot;/locks&quot;, false);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if (stat == null) {</span></span>
<span class="line"><span>            // åˆ›å»ºä¸€ä¸‹æ ¹èŠ‚ç‚¹</span></span>
<span class="line"><span>            zk.create(&quot;/locks&quot;, &quot;locks&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å¯¹zkåŠ é”</span></span>
<span class="line"><span>    public void zklock() {</span></span>
<span class="line"><span>        // åˆ›å»ºå¯¹åº”çš„ä¸´æ—¶å¸¦åºå·èŠ‚ç‚¹</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            currentMode = zk.create(&quot;/locks/&quot; + &quot;seq-&quot;, null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            // waitä¸€å°ä¼š, è®©ç»“æœæ›´æ¸…æ™°ä¸€äº›</span></span>
<span class="line"><span>            Thread.sleep(10);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            // åˆ¤æ–­åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯æœ€å°çš„åºå·èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯è·å–åˆ°é”ï¼›å¦‚æœä¸æ˜¯ï¼Œç›‘å¬ä»–åºå·å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            List&lt;String&gt; children = zk.getChildren(&quot;/locks&quot;, false);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            // å¦‚æœchildren åªæœ‰ä¸€ä¸ªå€¼ï¼Œé‚£å°±ç›´æ¥è·å–é”ï¼› å¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦åˆ¤æ–­ï¼Œè°æœ€å°</span></span>
<span class="line"><span>            if (children.size() == 1) {</span></span>
<span class="line"><span>                return;</span></span>
<span class="line"><span>            } else {</span></span>
<span class="line"><span>                Collections.sort(children);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                // è·å–èŠ‚ç‚¹åç§° seq-00000000</span></span>
<span class="line"><span>                String thisNode = currentMode.substring(&quot;/locks/&quot;.length());</span></span>
<span class="line"><span>                // é€šè¿‡seq-00000000è·å–è¯¥èŠ‚ç‚¹åœ¨childrené›†åˆçš„ä½ç½®</span></span>
<span class="line"><span>                int index = children.indexOf(thisNode);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                // åˆ¤æ–­</span></span>
<span class="line"><span>                if (index == -1) {</span></span>
<span class="line"><span>                    System.out.println(&quot;æ•°æ®å¼‚å¸¸&quot;);</span></span>
<span class="line"><span>                } else if (index == 0) {</span></span>
<span class="line"><span>                    // å°±ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥è·å–é”äº†</span></span>
<span class="line"><span>                    return;</span></span>
<span class="line"><span>                } else {</span></span>
<span class="line"><span>                    // éœ€è¦ç›‘å¬  ä»–å‰ä¸€ä¸ªèŠ‚ç‚¹å˜åŒ–</span></span>
<span class="line"><span>                    waitPath = &quot;/locks/&quot; + children.get(index - 1);</span></span>
<span class="line"><span>                    zk.getData(waitPath,true,new Stat());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    // ç­‰å¾…ç›‘å¬</span></span>
<span class="line"><span>                    waitLatch.await();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    return;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>        } catch (KeeperException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        } catch (InterruptedException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // è§£é”</span></span>
<span class="line"><span>    public void unZkLock() {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ é™¤èŠ‚ç‚¹</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            zk.delete(this.currentMode,-1);</span></span>
<span class="line"><span>        } catch (InterruptedException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        } catch (KeeperException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2)åˆ†å¸ƒå¼é”æµ‹è¯•</p><p>java</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>package com.atguigu.case2;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import org.apache.zookeeper.KeeperException;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.io.IOException;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public class DistributedLockTest {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public static void main(String[] args) throws InterruptedException, IOException, KeeperException {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>       final  DistributedLock lock1 = new DistributedLock();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        final  DistributedLock lock2 = new DistributedLock();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>       new Thread(new Runnable() {</span></span>
<span class="line"><span>           @Override</span></span>
<span class="line"><span>           public void run() {</span></span>
<span class="line"><span>               try {</span></span>
<span class="line"><span>                   lock1.zklock();</span></span>
<span class="line"><span>                   System.out.println(&quot;çº¿ç¨‹1 å¯åŠ¨ï¼Œè·å–åˆ°é”&quot;);</span></span>
<span class="line"><span>                   Thread.sleep(5 * 1000);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                   lock1.unZkLock();</span></span>
<span class="line"><span>                   System.out.println(&quot;çº¿ç¨‹1 é‡Šæ”¾é”&quot;);</span></span>
<span class="line"><span>               } catch (InterruptedException e) {</span></span>
<span class="line"><span>                   e.printStackTrace();</span></span>
<span class="line"><span>               }</span></span>
<span class="line"><span>           }</span></span>
<span class="line"><span>       }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        new Thread(new Runnable() {</span></span>
<span class="line"><span>            @Override</span></span>
<span class="line"><span>            public void run() {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                try {</span></span>
<span class="line"><span>                    lock2.zklock();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹2 å¯åŠ¨ï¼Œè·å–åˆ°é”&quot;);</span></span>
<span class="line"><span>                    Thread.sleep(5 * 1000);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    lock2.unZkLock();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹2 é‡Šæ”¾é”&quot;);</span></span>
<span class="line"><span>                } catch (InterruptedException e) {</span></span>
<span class="line"><span>                    e.printStackTrace();</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(1)åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹</p><p>(2)è§‚å¯Ÿæ§åˆ¶å°å˜åŒ–:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>çº¿ç¨‹1è·å–é”</span></span>
<span class="line"><span>çº¿ç¨‹1é‡Šæ”¾é” </span></span>
<span class="line"><span>çº¿ç¨‹2è·å–é” </span></span>
<span class="line"><span>çº¿ç¨‹2é‡Šæ”¾é”</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-curator-æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_5-2-curator-æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹"><span>5.2 Curator æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹</span></a></h3><p>1)åŸç”Ÿçš„ Java API å¼€å‘å­˜åœ¨çš„é—®é¢˜</p><p>(1)ä¼šè¯è¿æ¥æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦è‡ªå·±å»å¤„ç†ã€‚æ¯”å¦‚ä½¿ç”¨ CountDownLatch</p><p>(2)Watch éœ€è¦é‡å¤æ³¨å†Œï¼Œä¸ç„¶å°±ä¸èƒ½ç”Ÿæ•ˆ</p><p>(3)å¼€å‘çš„å¤æ‚æ€§è¿˜æ˜¯æ¯”è¾ƒé«˜çš„</p><p>(4)ä¸æ”¯æŒå¤šèŠ‚ç‚¹åˆ é™¤å’Œåˆ›å»ºã€‚éœ€è¦è‡ªå·±å»é€’å½’</p><p>2)Curator æ˜¯ä¸€ä¸ªä¸“é—¨è§£å†³åˆ†å¸ƒå¼é”çš„æ¡†æ¶ï¼Œè§£å†³äº†åŸç”Ÿ Java API å¼€å‘åˆ†å¸ƒå¼é‡åˆ°çš„é—®é¢˜ã€‚</p><p>è¯¦æƒ…è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£:https://curator.apache.org/index.html</p><p>3)Curator æ¡ˆä¾‹å®æ“</p><p>(1)æ·»åŠ ä¾èµ–</p><p>xml</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;4.3.0&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span>
<span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;4.3.0&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span>
<span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;curator-client&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;4.3.0&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)ä»£ç å®ç°</p><p>java</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>package com.atguigu.case3;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import org.apache.curator.framework.CuratorFramework;</span></span>
<span class="line"><span>import org.apache.curator.framework.CuratorFrameworkFactory;</span></span>
<span class="line"><span>import org.apache.curator.framework.recipes.locks.InterProcessMutex;</span></span>
<span class="line"><span>import org.apache.curator.retry.ExponentialBackoffRetry;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public class CuratorLockTest {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public static void main(String[] args) {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ›å»ºåˆ†å¸ƒå¼é”1</span></span>
<span class="line"><span>        InterProcessMutex lock1 = new InterProcessMutex(getCuratorFramework(), &quot;/locks&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ›å»ºåˆ†å¸ƒå¼é”2</span></span>
<span class="line"><span>        InterProcessMutex lock2 = new InterProcessMutex(getCuratorFramework(), &quot;/locks&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        new Thread(new Runnable() {</span></span>
<span class="line"><span>            @Override</span></span>
<span class="line"><span>            public void run() {</span></span>
<span class="line"><span>                try {</span></span>
<span class="line"><span>                    lock1.acquire();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹1 è·å–åˆ°é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    lock1.acquire();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹1 å†æ¬¡è·å–åˆ°é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    Thread.sleep(5 * 1000);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    lock1.release();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹1 é‡Šæ”¾é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    lock1.release();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹1  å†æ¬¡é‡Šæ”¾é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                } catch (Exception e) {</span></span>
<span class="line"><span>                    e.printStackTrace();</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        new Thread(new Runnable() {</span></span>
<span class="line"><span>            @Override</span></span>
<span class="line"><span>            public void run() {</span></span>
<span class="line"><span>                try {</span></span>
<span class="line"><span>                    lock2.acquire();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹2 è·å–åˆ°é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    lock2.acquire();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹2 å†æ¬¡è·å–åˆ°é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    Thread.sleep(5 * 1000);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    lock2.release();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹2 é‡Šæ”¾é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    lock2.release();</span></span>
<span class="line"><span>                    System.out.println(&quot;çº¿ç¨‹2  å†æ¬¡é‡Šæ”¾é”&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                } catch (Exception e) {</span></span>
<span class="line"><span>                    e.printStackTrace();</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }).start();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    private static CuratorFramework getCuratorFramework() {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        ExponentialBackoffRetry policy = new ExponentialBackoffRetry(3000, 3);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        CuratorFramework client = CuratorFrameworkFactory.builder().connectString(&quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;)</span></span>
<span class="line"><span>                .connectionTimeoutMs(2000)</span></span>
<span class="line"><span>                .sessionTimeoutMs(2000)</span></span>
<span class="line"><span>                .retryPolicy(policy).build();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // å¯åŠ¨å®¢æˆ·ç«¯</span></span>
<span class="line"><span>        client.start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        System.out.println(&quot;zookeeper å¯åŠ¨æˆåŠŸ&quot;);</span></span>
<span class="line"><span>        return client;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2)è§‚å¯Ÿæ§åˆ¶å°å˜åŒ–:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>çº¿ç¨‹1è·å–é”</span></span>
<span class="line"><span>çº¿ç¨‹ 1 å†æ¬¡è·å–é” </span></span>
<span class="line"><span>çº¿ç¨‹1é‡Šæ”¾é”</span></span>
<span class="line"><span>çº¿ç¨‹ 1 å†æ¬¡é‡Šæ”¾é” </span></span>
<span class="line"><span>çº¿ç¨‹2è·å–é” </span></span>
<span class="line"><span>çº¿ç¨‹ 2 å†æ¬¡è·å–é” </span></span>
<span class="line"><span>çº¿ç¨‹2é‡Šæ”¾é” </span></span>
<span class="line"><span>çº¿ç¨‹ 2 å†æ¬¡é‡Šæ”¾é”</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬-6-ç« -ä¼ä¸šé¢è¯•çœŸé¢˜-é¢è¯•é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç¬¬-6-ç« -ä¼ä¸šé¢è¯•çœŸé¢˜-é¢è¯•é‡ç‚¹"><span>ç¬¬ 6 ç«  ä¼ä¸šé¢è¯•çœŸé¢˜(é¢è¯•é‡ç‚¹)</span></a></h2><h3 id="_6-1-é€‰ä¸¾æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_6-1-é€‰ä¸¾æœºåˆ¶"><span>6.1 é€‰ä¸¾æœºåˆ¶</span></a></h3><p>åŠæ•°æœºåˆ¶ï¼Œè¶…è¿‡åŠæ•°çš„æŠ•ç¥¨é€šè¿‡ï¼Œå³é€šè¿‡ã€‚</p><p>(1)ç¬¬ä¸€æ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™:</p><p>æŠ•ç¥¨è¿‡åŠæ•°æ—¶ï¼ŒæœåŠ¡å™¨ id å¤§çš„èƒœå‡º</p><p>(2)ç¬¬äºŒæ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™:</p><ol><li>EPOCH å¤§çš„ç›´æ¥èƒœå‡º</li><li>EPOCH ç›¸åŒï¼Œäº‹åŠ¡ id å¤§çš„èƒœå‡º</li><li>äº‹åŠ¡ id ç›¸åŒï¼ŒæœåŠ¡å™¨ id å¤§çš„èƒœå‡º</li></ol><h3 id="_6-2-ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘-zk-åˆé€‚" tabindex="-1"><a class="header-anchor" href="#_6-2-ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘-zk-åˆé€‚"><span>6.2 ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘ zk åˆé€‚?</span></a></h3><p>å®‰è£…å¥‡æ•°å°ã€‚</p><p>ç”Ÿäº§ç»éªŒ:</p><ul><li>10å°æœåŠ¡å™¨:3å°zk;</li><li>20å°æœåŠ¡å™¨:5å°zk;</li><li>100å°æœåŠ¡å™¨:11å°zk;</li><li>200å°æœåŠ¡å™¨:11å°zk</li></ul><p>æœåŠ¡å™¨å°æ•°å¤š:å¥½å¤„ï¼Œæé«˜å¯é æ€§;åå¤„:æé«˜é€šä¿¡å»¶æ—¶</p><h3 id="_6-3-å¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_6-3-å¸¸ç”¨å‘½ä»¤"><span>6.3 å¸¸ç”¨å‘½ä»¤</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>lsã€getã€createã€delete</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/skxndbzu/JackChenBlogs/edit/main/src/posts/å¾®æœåŠ¡æ¶æ„/zookeeper.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 615880048@qq.com">é™ˆé“­é¹¤</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/Dubbo.html" aria-label="Dubbo"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>Dubbo</div></a><a class="route-link auto-link next" href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/2.html" aria-label="é¦™è•‰ 2"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">é¦™è•‰ 2<span class="font-icon icon iconfont icon-pen-to-square" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">åƒé‡Œä¹‹è¡Œ å§‹äºè¶³ä¸‹</div><div class="vp-copyright">Copyright Â© 2024 Jack-Chen </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-1Q7c3pAr.js" defer></script>
  </body>
</html>
