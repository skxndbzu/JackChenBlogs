<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/posts/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ.html"><meta property="og:site_name" content="éº»èŠ±çš„å°ç«™"><meta property="og:title" content="RocketMQ"><meta property="og:description" content="ç¬¬1ç«  RocketMQæ¦‚è¿° ä¸€ã€MQæ¦‚è¿° 1 ã€MQç®€ä»‹ MQï¼ŒMessage Queueï¼Œæ˜¯ä¸€ç§æä¾›æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡çš„ä¸­é—´ä»¶ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ˜¯ä¸€å¥—æä¾›äº†æ¶ˆæ¯ç”Ÿäº§ã€å­˜å‚¨ã€æ¶ˆè´¹å…¨è¿‡ç¨‹APIçš„è½¯ä»¶ç³»ç»Ÿã€‚æ¶ˆæ¯å³æ•°æ®ã€‚ä¸€èˆ¬æ¶ˆæ¯çš„ä½“é‡ä¸ä¼šå¾ˆå¤§ã€‚ 2 ã€MQç”¨é€” ä»ç½‘ä¸Šå¯ä»¥æŸ¥çœ‹åˆ°å¾ˆå¤šçš„å…³äºMQç”¨é€”çš„å™è¿°ï¼Œä½†æ€»ç»“èµ·æ¥å…¶å®å°±ä»¥ä¸‹ä¸‰ç‚¹ã€‚ é™æµå‰Šå³° MQå¯ä»¥å°†ç³»ç»Ÿçš„è¶…é‡..."><meta property="og:type" content="article"><meta property="og:image" content="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208101908.png "QQæˆªå›¾20201229183512.png""><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-23T09:26:56.000Z"><meta property="article:author" content="Jack-Chen"><meta property="article:tag" content="æ¶ˆæ¯ä¸­é—´ä»·"><meta property="article:tag" content="é˜Ÿåˆ—"><meta property="article:published_time" content="2023-01-13T00:00:00.000Z"><meta property="article:modified_time" content="2024-10-23T09:26:56.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"RocketMQ","image":["https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208101908.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208102000.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208103522.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208103828.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208104018.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208104611.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723145759086.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208105007.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723145838778.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723150206184.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723150335797.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208110713.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208110738.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208110807.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208110821.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208110900.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208110924.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111000.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111020.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111255.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111351.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111536.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111646.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111700.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111724.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111755.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208111822.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208113559.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208113758.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208121758.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208122057.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208122113.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208122608.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208123848.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208124241.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208124258.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208133814.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208134157.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208134355.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208134415.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208134454.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208134538.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208135939.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208135949.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208140054.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208140159.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208140740.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208141005.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208141053.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208141202.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208141304.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208142527.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208142630.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208142708.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208142814.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208142905.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208143050.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208143107.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208143837.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208143940.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208144842.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208145933.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208150004.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208150023.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208152040.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208152144.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208152224.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208152417.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208153410.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208153523.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208153545.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208153635.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208154429.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208154545.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208155046.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208155359.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208160513.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208160544.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208163646.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208163740.png \"QQæˆªå›¾20201229183512.png\"","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQ%E6%88%AA%E5%9B%BE20220208163826.png \"QQæˆªå›¾20201229183512.png\""],"datePublished":"2023-01-13T00:00:00.000Z","dateModified":"2024-10-23T09:26:56.000Z","author":[{"@type":"Person","name":"Jack-Chen","url":"https://chemnminghe.top"}]}</script><title>RocketMQ | éº»èŠ±çš„å°ç«™</title><meta name="description" content="ç¬¬1ç«  RocketMQæ¦‚è¿° ä¸€ã€MQæ¦‚è¿° 1 ã€MQç®€ä»‹ MQï¼ŒMessage Queueï¼Œæ˜¯ä¸€ç§æä¾›æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡çš„ä¸­é—´ä»¶ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ˜¯ä¸€å¥—æä¾›äº†æ¶ˆæ¯ç”Ÿäº§ã€å­˜å‚¨ã€æ¶ˆè´¹å…¨è¿‡ç¨‹APIçš„è½¯ä»¶ç³»ç»Ÿã€‚æ¶ˆæ¯å³æ•°æ®ã€‚ä¸€èˆ¬æ¶ˆæ¯çš„ä½“é‡ä¸ä¼šå¾ˆå¤§ã€‚ 2 ã€MQç”¨é€” ä»ç½‘ä¸Šå¯ä»¥æŸ¥çœ‹åˆ°å¾ˆå¤šçš„å…³äºMQç”¨é€”çš„å™è¿°ï¼Œä½†æ€»ç»“èµ·æ¥å…¶å®å°±ä»¥ä¸‹ä¸‰ç‚¹ã€‚ é™æµå‰Šå³° MQå¯ä»¥å°†ç³»ç»Ÿçš„è¶…é‡...">
    <link rel="preload" href="/assets/style-Tnuk6l9P.css" as="style"><link rel="stylesheet" href="/assets/style-Tnuk6l9P.css">
    <link rel="modulepreload" href="/assets/app-DIfhtWs6.js"><link rel="modulepreload" href="/assets/RocketMQ.html-BAuZ_aD6.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-BgP89GEm.js" as="script"><link rel="prefetch" href="/assets/intro.html-CPWWm5tV.js" as="script"><link rel="prefetch" href="/assets/index.html-BA-u3-gv.js" as="script"><link rel="prefetch" href="/assets/index.html-Bol0S3pn.js" as="script"><link rel="prefetch" href="/assets/page.html-x4dXdqAN.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬ä¸­ç§‘è½¯.html-DHFGv8yR.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬é‘«ä¸‡å®¶ç§‘æŠ€.html-u5vx102K.js" as="script"><link rel="prefetch" href="/assets/å—äº¬ä¸­ç§‘è½¯.html-C6TE6oaE.js" as="script"><link rel="prefetch" href="/assets/å¤©æ´¥å‡½æ•°è§†ç•Œ.html-2X2NRn8p.js" as="script"><link rel="prefetch" href="/assets/å®‰ç¡•ä¿¡æ¯(ä¸œåŒ—éƒ¨).html-DOrjfiPl.js" as="script"><link rel="prefetch" href="/assets/ç”˜è‚ƒä¸­å·¥å›½é™….html-BdJV_m_K.js" as="script"><link rel="prefetch" href="/assets/index.html-gkwVZdrS.js" as="script"><link rel="prefetch" href="/assets/index.html-Vy74TJN-.js" as="script"><link rel="prefetch" href="/assets/disable.html-CA5NysMK.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-DSbR6TuP.js" as="script"><link rel="prefetch" href="/assets/layout.html-B4dmFmmh.js" as="script"><link rel="prefetch" href="/assets/markdown.html-BBwVi36R.js" as="script"><link rel="prefetch" href="/assets/page.html-OobTV-f3.js" as="script"><link rel="prefetch" href="/assets/JUC.html-BHpYvfHw.js" as="script"><link rel="prefetch" href="/assets/JVM.html-DZgVmp8E.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-CvjX1POc.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-BT6QmX-_.js" as="script"><link rel="prefetch" href="/assets/vue.html-Ci3MA_Om.js" as="script"><link rel="prefetch" href="/assets/Spring.html-CyMda6Qo.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-CluIqpAj.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-D3GtcybD.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-BKmdvv7Z.js" as="script"><link rel="prefetch" href="/assets/Docker.html-CUNKwefM.js" as="script"><link rel="prefetch" href="/assets/Git.html-Bmbtl1q1.js" as="script"><link rel="prefetch" href="/assets/Gradle.html-BTPQr1vT.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-Bg_ymiFO.js" as="script"><link rel="prefetch" href="/assets/maven.html-D_WyUCcD.js" as="script"><link rel="prefetch" href="/assets/2.html-CS_iaREK.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-Ca7DOMVf.js" as="script"><link rel="prefetch" href="/assets/zookeeper.html-CvJn1tJb.js" as="script"><link rel="prefetch" href="/assets/2.html-BVulAVnq.js" as="script"><link rel="prefetch" href="/assets/3.html-B03q_hZ-.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®ä»‹ç».html-DeuErqKt.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-DCbI_GoL.js" as="script"><link rel="prefetch" href="/assets/elasticsearch.html-jhB4NAER.js" as="script"><link rel="prefetch" href="/assets/1.html-Ci-Tvw3x.js" as="script"><link rel="prefetch" href="/assets/2.html-BIs7LkMa.js" as="script"><link rel="prefetch" href="/assets/3.html-C1D4G5_R.js" as="script"><link rel="prefetch" href="/assets/Linux.html-DwEay6n4.js" as="script"><link rel="prefetch" href="/assets/æ“ä½œç³»ç»Ÿ.html-DaSFcgWt.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œ.html-y7dGXoqn.js" as="script"><link rel="prefetch" href="/assets/1.html-CbN1mFqp.js" as="script"><link rel="prefetch" href="/assets/2.html-Dk-01vu6.js" as="script"><link rel="prefetch" href="/assets/3.html-DhLuB-p_.js" as="script"><link rel="prefetch" href="/assets/1.html-DeOWN7YD.js" as="script"><link rel="prefetch" href="/assets/2.html-DeFt3gdO.js" as="script"><link rel="prefetch" href="/assets/3.html-Ct1V3wd4.js" as="script"><link rel="prefetch" href="/assets/1.html-CQAXiEM4.js" as="script"><link rel="prefetch" href="/assets/2.html-C03wKpcS.js" as="script"><link rel="prefetch" href="/assets/3.html-Bngdzyj3.js" as="script"><link rel="prefetch" href="/assets/åŸç†ç¯‡.html-DMRXZTa_.js" as="script"><link rel="prefetch" href="/assets/åŸºç¡€ç¯‡.html-Dvt7cNO6.js" as="script"><link rel="prefetch" href="/assets/å®æˆ˜ç¯‡.html-D5EwZVB-.js" as="script"><link rel="prefetch" href="/assets/é«˜çº§ç¯‡.html-CgD-zEHA.js" as="script"><link rel="prefetch" href="/assets/404.html-DFzzT_i8.js" as="script"><link rel="prefetch" href="/assets/index.html-C-xdobwP.js" as="script"><link rel="prefetch" href="/assets/index.html-DCmayMQl.js" as="script"><link rel="prefetch" href="/assets/index.html-VG2F-U3H.js" as="script"><link rel="prefetch" href="/assets/index.html-C2yKnQO3.js" as="script"><link rel="prefetch" href="/assets/index.html-Cws6HWu0.js" as="script"><link rel="prefetch" href="/assets/index.html-rXRxMsNV.js" as="script"><link rel="prefetch" href="/assets/index.html-BaMr3vcO.js" as="script"><link rel="prefetch" href="/assets/index.html-Pv843Qyw.js" as="script"><link rel="prefetch" href="/assets/index.html-P3kTIYgl.js" as="script"><link rel="prefetch" href="/assets/index.html-DMsMD_PV.js" as="script"><link rel="prefetch" href="/assets/index.html-CcqTzGAW.js" as="script"><link rel="prefetch" href="/assets/index.html-DQsEwVPy.js" as="script"><link rel="prefetch" href="/assets/index.html-D4wq5ZY2.js" as="script"><link rel="prefetch" href="/assets/index.html-BesxCHi-.js" as="script"><link rel="prefetch" href="/assets/index.html-BnSRXvrW.js" as="script"><link rel="prefetch" href="/assets/index.html-CfwSJVFL.js" as="script"><link rel="prefetch" href="/assets/index.html-D1QgKrmV.js" as="script"><link rel="prefetch" href="/assets/index.html-CAV-UFUk.js" as="script"><link rel="prefetch" href="/assets/index.html-CjDfU9di.js" as="script"><link rel="prefetch" href="/assets/index.html-CM0ZUiuJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DzyTfdoH.js" as="script"><link rel="prefetch" href="/assets/index.html-TIhcFXT_.js" as="script"><link rel="prefetch" href="/assets/index.html-BOzB57bl.js" as="script"><link rel="prefetch" href="/assets/index.html-DaGgjI41.js" as="script"><link rel="prefetch" href="/assets/index.html-B933fmFx.js" as="script"><link rel="prefetch" href="/assets/index.html-DcbVHb3D.js" as="script"><link rel="prefetch" href="/assets/index.html-DHLlk-XS.js" as="script"><link rel="prefetch" href="/assets/index.html-COmpcD73.js" as="script"><link rel="prefetch" href="/assets/index.html-Cr8SfhjB.js" as="script"><link rel="prefetch" href="/assets/index.html-CeKg0Nsg.js" as="script"><link rel="prefetch" href="/assets/index.html-DWzxQWjc.js" as="script"><link rel="prefetch" href="/assets/index.html-NUj_gb-E.js" as="script"><link rel="prefetch" href="/assets/index.html-CWLjm0O_.js" as="script"><link rel="prefetch" href="/assets/index.html-DOvOYDNg.js" as="script"><link rel="prefetch" href="/assets/index.html-shGaeKUA.js" as="script"><link rel="prefetch" href="/assets/index.html-DhU8SUds.js" as="script"><link rel="prefetch" href="/assets/index.html-DmydSMDK.js" as="script"><link rel="prefetch" href="/assets/index.html-BSD6X9pF.js" as="script"><link rel="prefetch" href="/assets/index.html-r42KVPAJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BCAx-Y0X.js" as="script"><link rel="prefetch" href="/assets/index.html-DwwQZoVJ.js" as="script"><link rel="prefetch" href="/assets/index.html-C-uND38j.js" as="script"><link rel="prefetch" href="/assets/index.html-DgqwFQpR.js" as="script"><link rel="prefetch" href="/assets/index.html-CpE6jW68.js" as="script"><link rel="prefetch" href="/assets/index.html-DxPx4yj5.js" as="script"><link rel="prefetch" href="/assets/index.html-Bw5wrmnE.js" as="script"><link rel="prefetch" href="/assets/index.html-CbSVz722.js" as="script"><link rel="prefetch" href="/assets/index.html-CrO8KDkI.js" as="script"><link rel="prefetch" href="/assets/index.html-BFlDdxD8.js" as="script"><link rel="prefetch" href="/assets/index.html-w_F-geF8.js" as="script"><link rel="prefetch" href="/assets/index.html-CS1lFCkF.js" as="script"><link rel="prefetch" href="/assets/index.html-DiOU94xp.js" as="script"><link rel="prefetch" href="/assets/index.html-DhjS7dgm.js" as="script"><link rel="prefetch" href="/assets/index.html-D5D7spBM.js" as="script"><link rel="prefetch" href="/assets/index.html-aaL0x_OW.js" as="script"><link rel="prefetch" href="/assets/index.html-DHQAEaMa.js" as="script"><link rel="prefetch" href="/assets/index.html-CCjn8ryi.js" as="script"><link rel="prefetch" href="/assets/index.html-Bge6CkDE.js" as="script"><link rel="prefetch" href="/assets/index.html-CO1h2KW0.js" as="script"><link rel="prefetch" href="/assets/index.html-CxwOAkC4.js" as="script"><link rel="prefetch" href="/assets/index.html-DWKl_5a1.js" as="script"><link rel="prefetch" href="/assets/index.html-C4uU5xaE.js" as="script"><link rel="prefetch" href="/assets/index.html-DuhZnQYG.js" as="script"><link rel="prefetch" href="/assets/index.html-DzaWOHPr.js" as="script"><link rel="prefetch" href="/assets/index.html-B7p3HRCB.js" as="script"><link rel="prefetch" href="/assets/index.html-DQXgCKRB.js" as="script"><link rel="prefetch" href="/assets/index.html-CTvCW5j3.js" as="script"><link rel="prefetch" href="/assets/index.html-DaRXsMWH.js" as="script"><link rel="prefetch" href="/assets/index.html-VuztasKy.js" as="script"><link rel="prefetch" href="/assets/index.html-Cpmmd5xl.js" as="script"><link rel="prefetch" href="/assets/index.html-OilKZJWm.js" as="script"><link rel="prefetch" href="/assets/index.html-B9n9ZyXS.js" as="script"><link rel="prefetch" href="/assets/index.html-DLitEf6W.js" as="script"><link rel="prefetch" href="/assets/index.html-CbGOUiKq.js" as="script"><link rel="prefetch" href="/assets/index.html-D_bm0ppb.js" as="script"><link rel="prefetch" href="/assets/index.html-CXGDhy1J.js" as="script"><link rel="prefetch" href="/assets/index.html-B4IghD3l.js" as="script"><link rel="prefetch" href="/assets/index.html-BktKm8Pn.js" as="script"><link rel="prefetch" href="/assets/index.html-BKwpivH6.js" as="script"><link rel="prefetch" href="/assets/index.html-fk5dpyDB.js" as="script"><link rel="prefetch" href="/assets/index.html-C26JoPVH.js" as="script"><link rel="prefetch" href="/assets/index.html-CLzTlDHD.js" as="script"><link rel="prefetch" href="/assets/index.html-CjSRGckL.js" as="script"><link rel="prefetch" href="/assets/index.html-AEU_-rzO.js" as="script"><link rel="prefetch" href="/assets/index.html-Ay6N8muh.js" as="script"><link rel="prefetch" href="/assets/index.html-CNllM5L3.js" as="script"><link rel="prefetch" href="/assets/index.html-CzqMPKN7.js" as="script"><link rel="prefetch" href="/assets/index.html-BcHx_roQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CZSgyJo8.js" as="script"><link rel="prefetch" href="/assets/index.html-DL9Mqed8.js" as="script"><link rel="prefetch" href="/assets/index.html-LZgZhvlG.js" as="script"><link rel="prefetch" href="/assets/index.html-CyGGcb14.js" as="script"><link rel="prefetch" href="/assets/index.html-Bf4y2ks7.js" as="script"><link rel="prefetch" href="/assets/index.html-DNJX5V-9.js" as="script"><link rel="prefetch" href="/assets/index.html-DmyiUwkd.js" as="script"><link rel="prefetch" href="/assets/index.html-mIbvu8iR.js" as="script"><link rel="prefetch" href="/assets/index.html-CcHu3ZcB.js" as="script"><link rel="prefetch" href="/assets/index.html-D0LwP2z4.js" as="script"><link rel="prefetch" href="/assets/index.html-qEijYiNd.js" as="script"><link rel="prefetch" href="/assets/index.html-Br7rtkdU.js" as="script"><link rel="prefetch" href="/assets/index.html-D15NdAHh.js" as="script"><link rel="prefetch" href="/assets/index.html-BbCvs1_t.js" as="script"><link rel="prefetch" href="/assets/index.html-fW74kQNn.js" as="script"><link rel="prefetch" href="/assets/index.html-D7CjTrbk.js" as="script"><link rel="prefetch" href="/assets/index.html-CarNeXu0.js" as="script"><link rel="prefetch" href="/assets/index.html-Bu3xfHig.js" as="script"><link rel="prefetch" href="/assets/index.html-CygwTM_W.js" as="script"><link rel="prefetch" href="/assets/index.html-B0x_2-S_.js" as="script"><link rel="prefetch" href="/assets/index.html-CxCJcdFZ.js" as="script"><link rel="prefetch" href="/assets/index.html-Dn-xRXj0.js" as="script"><link rel="prefetch" href="/assets/index.html-CKSPNmVq.js" as="script"><link rel="prefetch" href="/assets/index.html-BKfQvD_q.js" as="script"><link rel="prefetch" href="/assets/index.html-D8Uo8i2P.js" as="script"><link rel="prefetch" href="/assets/index.html-D4DMQJTw.js" as="script"><link rel="prefetch" href="/assets/index.html-DcG632Zt.js" as="script"><link rel="prefetch" href="/assets/index.html-Uyaq7VLa.js" as="script"><link rel="prefetch" href="/assets/index.html-CCVEncXE.js" as="script"><link rel="prefetch" href="/assets/index.html-CQL0T_CS.js" as="script"><link rel="prefetch" href="/assets/index.html-Cw5s4HgM.js" as="script"><link rel="prefetch" href="/assets/index.html-DKPt4Fb5.js" as="script"><link rel="prefetch" href="/assets/index.html-C4nyuruX.js" as="script"><link rel="prefetch" href="/assets/index.html-D-S2LYAy.js" as="script"><link rel="prefetch" href="/assets/index.html-BtRtLOnq.js" as="script"><link rel="prefetch" href="/assets/index.html-Dq-hoqlh.js" as="script"><link rel="prefetch" href="/assets/index.html-BhVFFR2x.js" as="script"><link rel="prefetch" href="/assets/index.html-xTYYhsZN.js" as="script"><link rel="prefetch" href="/assets/index.html-77DKiDBw.js" as="script"><link rel="prefetch" href="/assets/index.html-BTgY_dB3.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/touxiang/vue-color-avatar3.png" alt><!----><span class="vp-site-name hide-in-pad">éº»èŠ±çš„å°ç«™</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon iconfont icon-xuexibiji" style=""></span><!--]-->å­¦ä¹ ç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interviewExperience/" aria-label="é¢è¯•ä¸“æ "><!--[--><span class="font-icon icon iconfont icon-flow-interview" style=""></span><!--]-->é¢è¯•ä¸“æ <!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/softwareTutorial/" aria-label="è½¯ä»¶æ•™ç¨‹"><!--[--><span class="font-icon icon iconfont icon-ruanjianjiaocheng1" style=""></span><!--]-->è½¯ä»¶æ•™ç¨‹<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/aboutMe/" aria-label="å…³äºæˆ‘"><!--[--><span class="font-icon icon iconfont icon-guanyuzuozhe" style=""></span><!--]-->å…³äºæˆ‘<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/skxndbzu/JackChenBlogs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-meiribikan" style=""></span><span class="vp-sidebar-title">å¿…çœ‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-zhenrenmianshi" style=""></span><span class="vp-sidebar-title">é¢è¯•ä¸“æ </span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-application--web" style=""></span><span class="vp-sidebar-title">è®¡ç®—æœºåŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-xitongsheji" style=""></span><span class="vp-sidebar-title">ç³»ç»Ÿè®¾è®¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-jurassic_data" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-kaifagongju" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/developmentTool/" aria-label="å¼€å‘å·¥å…·"><!---->å¼€å‘å·¥å…·<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¸¸ç”¨æ¡†æ¶"><!---->å¸¸ç”¨æ¡†æ¶<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¾®æœåŠ¡æ¶æ„"><!---->å¾®æœåŠ¡æ¶æ„<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å‰ç«¯"><!---->å‰ç«¯<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ¶ˆæ¯ä¸­é—´ä»¶"><!---->æ¶ˆæ¯ä¸­é—´ä»¶<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ.html" aria-label="RocketMQ"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->RocketMQ<!----></a></li></ul></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="ä»‹ç»é¡µ"><!--[--><span class="font-icon icon iconfont icon-fenxiangdingqijieshao" style=""></span><!--]-->ä»‹ç»é¡µ<!----></a></li><li><a class="auto-link external-link vp-sidebar-link" href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" aria-label="å¹»ç¯ç‰‡" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon iconfont icon-huandengpian-04" style=""></span><!--]-->å¹»ç¯ç‰‡<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>RocketMQ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://chemnminghe.top" target="_blank" rel="noopener noreferrer">Jack-Chen</a></span><span property="author" content="Jack-Chen"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-13T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 126 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT126M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color4 clickable" role="navigation">RocketMQ</span><!--]--><meta property="articleSection" content="RocketMQ"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color6 clickable" role="navigation">æ¶ˆæ¯ä¸­é—´ä»·</span><span class="page-tag-item color3 clickable" role="navigation">é˜Ÿåˆ—</span><!--]--><meta property="keywords" content="æ¶ˆæ¯ä¸­é—´ä»·,é˜Ÿåˆ—"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸€ã€mqæ¦‚è¿°">ä¸€ã€MQæ¦‚è¿°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ã€mqç®€ä»‹">1 ã€MQç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ã€mqç”¨é€”">2 ã€MQç”¨é€”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ã€å¸¸è§mqäº§å“">3 ã€å¸¸è§MQäº§å“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ã€mqå¸¸è§åè®®">4 ã€MQå¸¸è§åè®®</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äºŒã€rocketmqæ¦‚è¿°">äºŒã€RocketMQæ¦‚è¿°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ã€rocketmqç®€ä»‹">1 ã€RocketMQç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ã€rocketmqå‘å±•å†ç¨‹">2 ã€RocketMQå‘å±•å†ç¨‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µ">ä¸€ã€åŸºæœ¬æ¦‚å¿µ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ¶ˆæ¯-message">1 æ¶ˆæ¯ï¼ˆMessageï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä¸»é¢˜-topic">2 ä¸»é¢˜ï¼ˆTopicï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æ ‡ç­¾-tag">3 æ ‡ç­¾ï¼ˆTagï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-é˜Ÿåˆ—-queue">4 é˜Ÿåˆ—ï¼ˆQueueï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-æ¶ˆæ¯æ ‡è¯†-messageid-key">5 æ¶ˆæ¯æ ‡è¯†ï¼ˆMessageId/Keyï¼‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äºŒã€ç³»ç»Ÿæ¶æ„">äºŒã€ç³»ç»Ÿæ¶æ„</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-producer">1 Producer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-consumer">2 Consumer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-name-server">3 Name Server</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-broker">4 Broker</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-å·¥ä½œæµç¨‹">5 å·¥ä½œæµç¨‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸‰ã€å•æœºå®‰è£…ä¸å¯åŠ¨">ä¸‰ã€å•æœºå®‰è£…ä¸å¯åŠ¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å‡†å¤‡å·¥ä½œ">1 å‡†å¤‡å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ã€ä¿®æ”¹åˆå§‹å†…å­˜">2 ã€ä¿®æ”¹åˆå§‹å†…å­˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ã€å¯åŠ¨">3 ã€å¯åŠ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ã€å‘é€-æ¥æ”¶æ¶ˆæ¯æµ‹è¯•">4 ã€å‘é€/æ¥æ”¶æ¶ˆæ¯æµ‹è¯•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-ã€å…³é—­server">5 ã€å…³é—­Server</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å››ã€-æ§åˆ¶å°çš„å®‰è£…ä¸å¯åŠ¨">å››ã€ æ§åˆ¶å°çš„å®‰è£…ä¸å¯åŠ¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä¸‹è½½">1 ä¸‹è½½</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä¿®æ”¹é…ç½®">2 ä¿®æ”¹é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æ·»åŠ ä¾èµ–">3 æ·»åŠ ä¾èµ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-æ‰“åŒ…">4 æ‰“åŒ…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-å¯åŠ¨">5 å¯åŠ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-è®¿é—®">6 è®¿é—®</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº”ã€é›†ç¾¤æ­å»ºç†è®º">äº”ã€é›†ç¾¤æ­å»ºç†è®º</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ•°æ®å¤åˆ¶ä¸åˆ·ç›˜ç­–ç•¥">1 æ•°æ®å¤åˆ¶ä¸åˆ·ç›˜ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-brokeré›†ç¾¤æ¨¡å¼">2 Brokeré›†ç¾¤æ¨¡å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…­ã€ç£ç›˜é˜µåˆ—raid-è¡¥å……">å…­ã€ç£ç›˜é˜µåˆ—RAIDï¼ˆè¡¥å……ï¼‰</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-raidå†å²">1 RAIDå†å²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-raidç­‰çº§">2 RAIDç­‰çº§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å…³é”®æŠ€æœ¯">3 å…³é”®æŠ€æœ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-raidåˆ†ç±»">4 RAIDåˆ†ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-å¸¸è§raidç­‰çº§è¯¦è§£">5 å¸¸è§RAIDç­‰çº§è¯¦è§£</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸ƒã€é›†ç¾¤æ­å»ºå®è·µ">ä¸ƒã€é›†ç¾¤æ­å»ºå®è·µ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-é›†ç¾¤æ¶æ„">1 é›†ç¾¤æ¶æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å…‹éš†ç”Ÿæˆrocketmqos1">2 å…‹éš†ç”ŸæˆrocketmqOS1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä¿®æ”¹rocketmqos1é…ç½®æ–‡ä»¶">3 ä¿®æ”¹rocketmqOS1é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-å…‹éš†ç”Ÿæˆrocketmqos2">4 å…‹éš†ç”ŸæˆrocketmqOS2</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-ä¿®æ”¹rocketmqos2é…ç½®æ–‡ä»¶">5 ä¿®æ”¹rocketmqOS2é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-å¯åŠ¨æœåŠ¡å™¨">6 å¯åŠ¨æœåŠ¡å™¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…«ã€mqadminå‘½ä»¤">å…«ã€mqadminå‘½ä»¤</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä¿®æ”¹bin-tools-sh">1 ä¿®æ”¹bin/tools.sh</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-è¿è¡Œmqadmin">2 è¿è¡Œmqadmin</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-è¯¥å‘½ä»¤çš„å®˜ç½‘è¯¦è§£">3 è¯¥å‘½ä»¤çš„å®˜ç½‘è¯¦è§£</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸€ã€æ¶ˆæ¯çš„ç”Ÿäº§">ä¸€ã€æ¶ˆæ¯çš„ç”Ÿäº§</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ¶ˆæ¯çš„ç”Ÿäº§è¿‡ç¨‹">1 æ¶ˆæ¯çš„ç”Ÿäº§è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-queueé€‰æ‹©ç®—æ³•">2 Queueé€‰æ‹©ç®—æ³•</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äºŒã€æ¶ˆæ¯çš„å­˜å‚¨">äºŒã€æ¶ˆæ¯çš„å­˜å‚¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-commitlogæ–‡ä»¶">1 commitlogæ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-consumequeue">2 consumequeue</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å¯¹æ–‡ä»¶çš„è¯»å†™">3 å¯¹æ–‡ä»¶çš„è¯»å†™</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ä¸kafkaçš„å¯¹æ¯”">4 ä¸Kafkaçš„å¯¹æ¯”</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸‰ã€indexfile">ä¸‰ã€indexFile</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ç´¢å¼•æ¡ç›®ç»“æ„">1 ç´¢å¼•æ¡ç›®ç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-indexfileçš„åˆ›å»º">2 indexFileçš„åˆ›å»º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æŸ¥è¯¢æµç¨‹">3 æŸ¥è¯¢æµç¨‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å››ã€æ¶ˆæ¯çš„æ¶ˆè´¹">å››ã€æ¶ˆæ¯çš„æ¶ˆè´¹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è·å–æ¶ˆè´¹ç±»å‹">1 è·å–æ¶ˆè´¹ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-æ¶ˆè´¹æ¨¡å¼">2 æ¶ˆè´¹æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-rebalanceæœºåˆ¶">3 Rebalanceæœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-queueåˆ†é…ç®—æ³•">4 Queueåˆ†é…ç®—æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-è‡³å°‘ä¸€æ¬¡åŸåˆ™">5 è‡³å°‘ä¸€æ¬¡åŸåˆ™</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº”ã€è®¢é˜…å…³ç³»çš„ä¸€è‡´æ€§">äº”ã€è®¢é˜…å…³ç³»çš„ä¸€è‡´æ€§</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ­£ç¡®è®¢é˜…å…³ç³»">1 æ­£ç¡®è®¢é˜…å…³ç³»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-é”™è¯¯è®¢é˜…å…³ç³»">2 é”™è¯¯è®¢é˜…å…³ç³»</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…­ã€offsetç®¡ç†">å…­ã€offsetç®¡ç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-offsetæœ¬åœ°ç®¡ç†æ¨¡å¼">1 offsetæœ¬åœ°ç®¡ç†æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-offsetè¿œç¨‹ç®¡ç†æ¨¡å¼">2 offsetè¿œç¨‹ç®¡ç†æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-offsetç”¨é€”">3 offsetç”¨é€”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-é‡è¯•é˜Ÿåˆ—">4 é‡è¯•é˜Ÿåˆ—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-offsetçš„åŒæ­¥æäº¤ä¸å¼‚æ­¥æäº¤">5 offsetçš„åŒæ­¥æäº¤ä¸å¼‚æ­¥æäº¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸ƒã€æ¶ˆè´¹å¹‚ç­‰">ä¸ƒã€æ¶ˆè´¹å¹‚ç­‰</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯æ¶ˆè´¹å¹‚ç­‰">1 ä»€ä¹ˆæ˜¯æ¶ˆè´¹å¹‚ç­‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-æ¶ˆæ¯é‡å¤çš„åœºæ™¯åˆ†æ">2 æ¶ˆæ¯é‡å¤çš„åœºæ™¯åˆ†æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-é€šç”¨è§£å†³æ–¹æ¡ˆ">3 é€šç”¨è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-æ¶ˆè´¹å¹‚ç­‰çš„å®ç°">4 æ¶ˆè´¹å¹‚ç­‰çš„å®ç°</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…«ã€æ¶ˆæ¯å †ç§¯ä¸æ¶ˆè´¹å»¶è¿Ÿ">å…«ã€æ¶ˆæ¯å †ç§¯ä¸æ¶ˆè´¹å»¶è¿Ÿ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ¦‚å¿µ">1 æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-äº§ç”ŸåŸå› åˆ†æ">2 äº§ç”ŸåŸå› åˆ†æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æ¶ˆè´¹è€—æ—¶">3 æ¶ˆè´¹è€—æ—¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-æ¶ˆè´¹å¹¶å‘åº¦">4 æ¶ˆè´¹å¹¶å‘åº¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-å•æœºçº¿ç¨‹æ•°è®¡ç®—">5 å•æœºçº¿ç¨‹æ•°è®¡ç®—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-å¦‚ä½•é¿å…">6 å¦‚ä½•é¿å…</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¹ã€æ¶ˆæ¯çš„æ¸…ç†">ä¹ã€æ¶ˆæ¯çš„æ¸…ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸€ã€æ™®é€šæ¶ˆæ¯">ä¸€ã€æ™®é€šæ¶ˆæ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ¶ˆæ¯å‘é€åˆ†ç±»">1 æ¶ˆæ¯å‘é€åˆ†ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä»£ç ä¸¾ä¾‹">2 ä»£ç ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äºŒã€é¡ºåºæ¶ˆæ¯">äºŒã€é¡ºåºæ¶ˆæ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯é¡ºåºæ¶ˆæ¯">1 ä»€ä¹ˆæ˜¯é¡ºåºæ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä¸ºä»€ä¹ˆéœ€è¦é¡ºåºæ¶ˆæ¯">2 ä¸ºä»€ä¹ˆéœ€è¦é¡ºåºæ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æœ‰åºæ€§åˆ†ç±»">3 æœ‰åºæ€§åˆ†ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ä»£ç ä¸¾ä¾‹">4 ä»£ç ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸‰ã€å»¶æ—¶æ¶ˆæ¯">ä¸‰ã€å»¶æ—¶æ¶ˆæ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯å»¶æ—¶æ¶ˆæ¯">1 ä»€ä¹ˆæ˜¯å»¶æ—¶æ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å»¶æ—¶ç­‰çº§">2 å»¶æ—¶ç­‰çº§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å»¶æ—¶æ¶ˆæ¯å®ç°åŸç†">3 å»¶æ—¶æ¶ˆæ¯å®ç°åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ä»£ç ä¸¾ä¾‹-1">4 ä»£ç ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å››ã€äº‹åŠ¡æ¶ˆæ¯">å››ã€äº‹åŠ¡æ¶ˆæ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-é—®é¢˜å¼•å…¥">1 é—®é¢˜å¼•å…¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-è§£å†³æ€è·¯">2 è§£å†³æ€è·¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-åŸºç¡€">3 åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-xaæ¨¡å¼ä¸‰å‰‘å®¢">4 XAæ¨¡å¼ä¸‰å‰‘å®¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-xaæ¨¡å¼æ¶æ„">5 XAæ¨¡å¼æ¶æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-æ³¨æ„">6 æ³¨æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-ä»£ç ä¸¾ä¾‹">7 ä»£ç ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº”ã€æ‰¹é‡æ¶ˆæ¯">äº”ã€æ‰¹é‡æ¶ˆæ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æ‰¹é‡å‘é€æ¶ˆæ¯">1 æ‰¹é‡å‘é€æ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯">2 æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä»£ç ä¸¾ä¾‹">3 ä»£ç ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…­ã€æ¶ˆæ¯è¿‡æ»¤">å…­ã€æ¶ˆæ¯è¿‡æ»¤</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-tagè¿‡æ»¤">1 Tagè¿‡æ»¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-sqlè¿‡æ»¤">2 SQLè¿‡æ»¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä»£ç ä¸¾ä¾‹-1">3 ä»£ç ä¸¾ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸ƒã€æ¶ˆæ¯å‘é€é‡è¯•æœºåˆ¶">ä¸ƒã€æ¶ˆæ¯å‘é€é‡è¯•æœºåˆ¶</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è¯´æ˜">1 è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åŒæ­¥å‘é€å¤±è´¥ç­–ç•¥">2 åŒæ­¥å‘é€å¤±è´¥ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å¼‚æ­¥å‘é€å¤±è´¥ç­–ç•¥">3 å¼‚æ­¥å‘é€å¤±è´¥ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-æ¶ˆæ¯åˆ·ç›˜å¤±è´¥ç­–ç•¥">4 æ¶ˆæ¯åˆ·ç›˜å¤±è´¥ç­–ç•¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…«ã€æ¶ˆæ¯æ¶ˆè´¹é‡è¯•æœºåˆ¶">å…«ã€æ¶ˆæ¯æ¶ˆè´¹é‡è¯•æœºåˆ¶</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-é¡ºåºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•">1 é¡ºåºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-æ— åºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•">2 æ— åºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æ¶ˆè´¹é‡è¯•æ¬¡æ•°ä¸é—´éš”">3 æ¶ˆè´¹é‡è¯•æ¬¡æ•°ä¸é—´éš”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-é‡è¯•é˜Ÿåˆ—-1">4 é‡è¯•é˜Ÿåˆ—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-æ¶ˆè´¹é‡è¯•é…ç½®æ–¹å¼">5 æ¶ˆè´¹é‡è¯•é…ç½®æ–¹å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-æ¶ˆè´¹ä¸é‡è¯•é…ç½®æ–¹å¼">6 æ¶ˆè´¹ä¸é‡è¯•é…ç½®æ–¹å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¹ã€æ­»ä¿¡é˜Ÿåˆ—">ä¹ã€æ­»ä¿¡é˜Ÿåˆ—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—">1 ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-æ­»ä¿¡é˜Ÿåˆ—çš„ç‰¹å¾">2 æ­»ä¿¡é˜Ÿåˆ—çš„ç‰¹å¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æ­»ä¿¡æ¶ˆæ¯çš„å¤„ç†">3 æ­»ä¿¡æ¶ˆæ¯çš„å¤„ç†</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="ç¬¬1ç« -rocketmqæ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ç¬¬1ç« -rocketmqæ¦‚è¿°"><span>ç¬¬1ç«  RocketMQæ¦‚è¿°</span></a></h1><h2 id="ä¸€ã€mqæ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€mqæ¦‚è¿°"><span>ä¸€ã€MQæ¦‚è¿°</span></a></h2><h3 id="_1-ã€mqç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1-ã€mqç®€ä»‹"><span>1 ã€MQç®€ä»‹</span></a></h3><p>MQï¼ŒMessage Queueï¼Œæ˜¯ä¸€ç§æä¾›æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡çš„ä¸­é—´ä»¶ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ˜¯ä¸€å¥—æä¾›äº†æ¶ˆæ¯ç”Ÿäº§ã€å­˜å‚¨ã€æ¶ˆè´¹å…¨è¿‡ç¨‹APIçš„è½¯ä»¶ç³»ç»Ÿã€‚æ¶ˆæ¯å³æ•°æ®ã€‚ä¸€èˆ¬æ¶ˆæ¯çš„ä½“é‡ä¸ä¼šå¾ˆå¤§ã€‚</p><h3 id="_2-ã€mqç”¨é€”" tabindex="-1"><a class="header-anchor" href="#_2-ã€mqç”¨é€”"><span>2 ã€MQç”¨é€”</span></a></h3><p>ä»ç½‘ä¸Šå¯ä»¥æŸ¥çœ‹åˆ°å¾ˆå¤šçš„å…³äºMQç”¨é€”çš„å™è¿°ï¼Œä½†æ€»ç»“èµ·æ¥å…¶å®å°±ä»¥ä¸‹ä¸‰ç‚¹ã€‚</p><ul><li><p>é™æµå‰Šå³°</p><ul><li>MQå¯ä»¥å°†ç³»ç»Ÿçš„è¶…é‡è¯·æ±‚æš‚å­˜å…¶ä¸­ï¼Œä»¥ä¾¿ç³»ç»ŸåæœŸå¯ä»¥æ…¢æ…¢è¿›è¡Œå¤„ç†ï¼Œä»è€Œé¿å…äº†è¯·æ±‚çš„ä¸¢å¤±æˆ–ç³»ç»Ÿè¢«å‹å®ã€‚ <img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208101908.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" title="QQæˆªå›¾20201229183512.png" loading="lazy"></li></ul></li><li><p>å¼‚æ­¥è§£è€¦</p><ul><li>ä¸Šæ¸¸ç³»ç»Ÿå¯¹ä¸‹æ¸¸ç³»ç»Ÿçš„è°ƒç”¨è‹¥ä¸ºåŒæ­¥è°ƒç”¨ï¼Œåˆ™ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„ååé‡ä¸å¹¶å‘åº¦ï¼Œä¸”ç³»ç»Ÿè€¦åˆåº¦å¤ªé«˜ã€‚è€Œå¼‚æ­¥è°ƒç”¨åˆ™ä¼šè§£å†³è¿™äº›é—®é¢˜ã€‚æ‰€ä»¥ä¸¤å±‚ä¹‹é—´è‹¥è¦å®ç°ç”±åŒæ­¥åˆ°å¼‚æ­¥çš„è½¬åŒ–ï¼Œä¸€èˆ¬æ€§åšæ³•å°±æ˜¯ï¼Œåœ¨è¿™ä¸¤å±‚é—´æ·»åŠ ä¸€ä¸ªMQå±‚ã€‚</li></ul></li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208102000.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><ul><li>æ•°æ®æ”¶é›† <ul><li>åˆ†å¸ƒå¼ç³»ç»Ÿä¼šäº§ç”Ÿæµ·é‡çº§æ•°æ®æµï¼Œå¦‚ï¼šä¸šåŠ¡æ—¥å¿—ã€ç›‘æ§æ•°æ®ã€ç”¨æˆ·è¡Œä¸ºç­‰ã€‚é’ˆå¯¹è¿™äº›æ•°æ®æµè¿›è¡Œå®æ—¶æˆ–æ‰¹é‡é‡‡é›†æ±‡æ€»ï¼Œç„¶åå¯¹è¿™äº›æ•°æ®æµè¿›è¡Œå¤§æ•°æ®åˆ†æï¼Œè¿™æ˜¯å½“å‰äº’è”ç½‘å¹³å°çš„å¿…å¤‡æŠ€æœ¯ã€‚é€šè¿‡MQå®Œæˆæ­¤ç±»æ•°æ®æ”¶é›†æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</li></ul></li></ul><h3 id="_3-ã€å¸¸è§mqäº§å“" tabindex="-1"><a class="header-anchor" href="#_3-ã€å¸¸è§mqäº§å“"><span>3 ã€å¸¸è§MQäº§å“</span></a></h3><ul><li><p>ActiveMQ</p><ul><li>ActiveMQæ˜¯ä½¿ç”¨Javaè¯­è¨€å¼€å‘ä¸€æ¬¾MQäº§å“ã€‚æ—©æœŸå¾ˆå¤šå…¬å¸ä¸é¡¹ç›®ä¸­éƒ½åœ¨ä½¿ç”¨ã€‚ä½†ç°åœ¨çš„ç¤¾åŒºæ´»è·ƒåº¦å·²ç»å¾ˆä½ã€‚ç°åœ¨çš„é¡¹ç›®ä¸­å·²ç»å¾ˆå°‘ä½¿ç”¨äº†ã€‚</li></ul></li><li><p>RabbitMQ</p><ul><li>RabbitMQæ˜¯ä½¿ç”¨ErLangè¯­è¨€å¼€å‘çš„ä¸€æ¬¾MQäº§å“ã€‚å…¶ååé‡è¾ƒKafkaä¸RocketMQè¦ä½ï¼Œä¸”ç”±äºå…¶ä¸æ˜¯Javaè¯­è¨€å¼€å‘ï¼Œæ‰€ä»¥å…¬å¸å†…éƒ¨å¯¹å…¶å®ç°å®šåˆ¶åŒ–å¼€å‘éš¾åº¦è¾ƒå¤§ã€‚</li></ul></li><li><p>Kafka</p><ul><li>Kafkaæ˜¯ä½¿ç”¨Scala/Javaè¯­è¨€å¼€å‘çš„ä¸€æ¬¾MQäº§å“ã€‚å…¶æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯é«˜ååç‡ï¼Œå¸¸ç”¨äºå¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ã€‚å…¶æ²¡æœ‰éµå¾ªä»»ä½•å¸¸è§çš„MQåè®®ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªç ”åè®®ã€‚å¯¹äºSpring CloudNetÃ§ixï¼Œå…¶ä»…æ”¯æŒRabbitMQä¸Kafkaã€‚</li></ul></li><li><p>RocketMQ</p><ul><li>RocketMQæ˜¯ä½¿ç”¨Javaè¯­è¨€å¼€å‘çš„ä¸€æ¬¾MQäº§å“ã€‚ç»è¿‡æ•°å¹´é˜¿é‡ŒåŒ 11 çš„è€ƒéªŒï¼Œæ€§èƒ½ä¸ç¨³å®šæ€§éå¸¸é«˜ã€‚å…¶æ²¡æœ‰éµå¾ªä»»ä½•å¸¸è§çš„MQåè®®ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªç ”åè®®ã€‚å¯¹äºSpring Cloud Alibabaï¼Œå…¶æ”¯æŒRabbitMQã€Kafkaï¼Œä½†æå€¡ä½¿ç”¨RocketMQã€‚</li></ul></li></ul><h4 id="å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#å¯¹æ¯”"><span>å¯¹æ¯”</span></a></h4><table><thead><tr><th>å…³é”®è¯</th><th style="text-align:center;">ROCKETMQ</th><th style="text-align:center;">KAFKA</th><th style="text-align:center;">RABBITMQ</th><th style="text-align:center;">ACTIVEMQ</th></tr></thead><tbody><tr><td>å¼€å‘è¯­è¨€</td><td style="text-align:center;">Java</td><td style="text-align:center;">Java</td><td style="text-align:center;">ErLang</td><td style="text-align:center;">Java</td></tr><tr><td>å•æœºååé‡</td><td style="text-align:center;">10 ä¸‡çº§ï¼Œæ”¯æ’‘é«˜åå</td><td style="text-align:center;">10 ä¸‡çº§ä»¥ä¸Šï¼Œç”šè‡³æœ‰æ–‡çŒ®ç§°ï¼Œå¯ä»¥è¾¾åˆ°å•æœºç™¾ä¸‡çº§TPSã€‚</td><td style="text-align:center;">ä¸‡çº§ï¼ŒåŒActiveMQ</td><td style="text-align:center;">ä¸‡çº§ï¼Œç›¸å¯¹å…¶ä»–MQè¾ƒä½</td></tr><tr><td>Topic</td><td style="text-align:center;">topic å¯ä»¥è¾¾åˆ°å‡ ç™¾/å‡ åƒçš„çº§åˆ«ï¼Œååé‡ä¼šæœ‰è¾ƒå°å¹…åº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ RocketMQ çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œå¯ä»¥æ”¯æ’‘å¤§é‡çš„ topic</td><td style="text-align:center;">topicä»å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶å€™ï¼Œååé‡ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œæ‰€ä»¥è¯·ä¸è¦ç»™Kafkaè®¾è®¡è¿‡å¤šçš„topicï¼Œéœ€è¦æ›´å¤šçš„æœºå™¨èµ„æºæ”¯æ’‘å¤§è§„æ¨¡çš„ topic</td><td style="text-align:center;">topic æ•°é‡å¢å¤šï¼Œååé‡ä¼šä¸‹é™</td><td style="text-align:center;">topic æ•°é‡å¢å¤šï¼Œååé‡ä¼šä¸‹é™</td></tr><tr><td>æ¶æ„</td><td style="text-align:center;">åˆ†å¸ƒå¼æ¶æ„</td><td style="text-align:center;">åˆ†å¸ƒå¼æ¶æ„</td><td style="text-align:center;">ä¸»ä»æ¶æ„</td><td style="text-align:center;">ä¸»ä»æ¶æ„</td></tr><tr><td>æ¶ˆæ¯å»¶è¿Ÿ</td><td style="text-align:center;">æ¯«ç§’çº§</td><td style="text-align:center;">æ¯«ç§’ä»¥å†…</td><td style="text-align:center;">å¾®ç§’çº§</td><td style="text-align:center;">æ¯«ç§’çº§</td></tr><tr><td>åè®®æ”¯æŒ</td><td style="text-align:center;">è‡ªå®šä¹‰</td><td style="text-align:center;">è‡ªå®šä¹‰åè®®ï¼Œç¤¾åŒºå°è£…äº†httpåè®®æ”¯æŒ</td><td style="text-align:center;">SMTP/STOMP/XMPP/AMQP</td><td style="text-align:center;">OpenWire/STOMPREST/XMPP/AMQP</td></tr></tbody></table><h3 id="_4-ã€mqå¸¸è§åè®®" tabindex="-1"><a class="header-anchor" href="#_4-ã€mqå¸¸è§åè®®"><span>4 ã€MQå¸¸è§åè®®</span></a></h3><h5 id="ä¸€èˆ¬æƒ…å†µä¸‹mqçš„å®ç°æ˜¯è¦éµå¾ªä¸€äº›å¸¸è§„æ€§åè®®çš„ã€‚å¸¸è§çš„åè®®å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#ä¸€èˆ¬æƒ…å†µä¸‹mqçš„å®ç°æ˜¯è¦éµå¾ªä¸€äº›å¸¸è§„æ€§åè®®çš„ã€‚å¸¸è§çš„åè®®å¦‚ä¸‹"><span>ä¸€èˆ¬æƒ…å†µä¸‹MQçš„å®ç°æ˜¯è¦éµå¾ªä¸€äº›å¸¸è§„æ€§åè®®çš„ã€‚å¸¸è§çš„åè®®å¦‚ä¸‹ï¼š</span></a></h5><h6 id="jms" tabindex="-1"><a class="header-anchor" href="#jms"><span>JMS</span></a></h6><blockquote><p>JMSï¼ŒJava Messaging Serviceï¼ˆJavaæ¶ˆæ¯æœåŠ¡ï¼‰ã€‚æ˜¯Javaå¹³å°ä¸Šæœ‰å…³MOMï¼ˆMessage OrientedMiddlewareï¼Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ PO/OO/AOï¼‰çš„æŠ€æœ¯è§„èŒƒï¼Œå®ƒä¾¿äºæ¶ˆæ¯ç³»ç»Ÿä¸­çš„Javaåº”ç”¨ç¨‹åºè¿›è¡Œæ¶ˆæ¯äº¤æ¢ï¼Œå¹¶ä¸”é€šè¿‡æä¾›æ ‡å‡†çš„äº§ç”Ÿã€å‘é€ã€æ¥æ”¶æ¶ˆæ¯çš„æ¥å£ï¼Œç®€åŒ–ä¼ä¸šåº”ç”¨çš„å¼€å‘ã€‚ActiveMQæ˜¯è¯¥åè®®çš„å…¸å‹å®ç°ã€‚</p></blockquote><h6 id="stomp" tabindex="-1"><a class="header-anchor" href="#stomp"><span>STOMP</span></a></h6><blockquote><p>STOMPï¼ŒStreaming Text Orientated Message Protocolï¼ˆé¢å‘æµæ–‡æœ¬çš„æ¶ˆæ¯åè®®ï¼‰ï¼Œæ˜¯ä¸€ç§MOMè®¾è®¡çš„ç®€å•æ–‡æœ¬åè®®ã€‚STOMPæä¾›ä¸€ä¸ªå¯äº’æ“ä½œçš„è¿æ¥æ ¼å¼ï¼Œå…è®¸å®¢æˆ·ç«¯ä¸ä»»æ„STOMPæ¶ˆæ¯ä»£ç†ï¼ˆBrokerï¼‰è¿›è¡Œäº¤äº’ã€‚ActiveMQæ˜¯è¯¥åè®®çš„å…¸å‹å®ç°ï¼ŒRabbitMQé€šè¿‡æ’ä»¶å¯ä»¥æ”¯æŒè¯¥åè®®ã€‚</p></blockquote><h6 id="amqp" tabindex="-1"><a class="header-anchor" href="#amqp"><span>AMQP</span></a></h6><blockquote><p>AMQPï¼ŒAdvanced Message Queuing Protocolï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ï¼Œä¸€ä¸ªæä¾›ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡çš„åº”ç”¨å±‚æ ‡å‡†ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œæ˜¯ä¸€ç§MOMè®¾è®¡ã€‚åŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯ä¸æ¶ˆæ¯ä¸­é—´ä»¶å¯ä¼ é€’æ¶ˆæ¯ï¼Œå¹¶ä¸å—å®¢æˆ·ç«¯/ä¸­é—´ä»¶ä¸åŒäº§å“ï¼Œä¸åŒå¼€å‘è¯­è¨€ç­‰æ¡ä»¶çš„é™åˆ¶ã€‚ RabbitMQæ˜¯è¯¥åè®®çš„å…¸å‹å®ç°ã€‚</p></blockquote><h6 id="mqtt" tabindex="-1"><a class="header-anchor" href="#mqtt"><span>MQTT</span></a></h6><blockquote><p>MQTTï¼ŒMessage Queuing Telemetry Transportï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰ï¼Œæ˜¯IBMå¼€å‘çš„ä¸€ä¸ªå³æ—¶é€šè®¯åè®®ï¼Œæ˜¯ä¸€ç§äºŒè¿›åˆ¶åè®®ï¼Œä¸»è¦ç”¨äºæœåŠ¡å™¨å’Œä½åŠŸè€—IoTï¼ˆç‰©è”ç½‘ï¼‰è®¾å¤‡é—´çš„é€šä¿¡ã€‚è¯¥åè®®æ”¯æŒæ‰€æœ‰å¹³å°ï¼Œå‡ ä¹å¯ä»¥æŠŠæ‰€æœ‰è”ç½‘ç‰©å“å’Œå¤–éƒ¨è¿æ¥èµ·æ¥ï¼Œè¢«ç”¨æ¥å½“åšä¼ æ„Ÿå™¨å’Œè‡´åŠ¨å™¨çš„é€šä¿¡åè®®ã€‚ RabbitMQé€šè¿‡æ’ä»¶å¯ä»¥æ”¯æŒè¯¥åè®®ã€‚</p></blockquote><h2 id="äºŒã€rocketmqæ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#äºŒã€rocketmqæ¦‚è¿°"><span>äºŒã€RocketMQæ¦‚è¿°</span></a></h2><h3 id="_1-ã€rocketmqç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1-ã€rocketmqç®€ä»‹"><span>1 ã€RocketMQç®€ä»‹</span></a></h3><blockquote><p>RocketMQæ˜¯ä¸€ä¸ªç»Ÿä¸€æ¶ˆæ¯å¼•æ“ã€è½»é‡çº§æ•°æ®å¤„ç†å¹³å°ã€‚RocketMQæ˜¯ä¸€æ¬¾é˜¿é‡Œå·´å·´å¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ 2016 å¹´ 11 æœˆ 28 æ—¥ï¼Œé˜¿é‡Œå·´å·´å‘ Apache è½¯ä»¶åŸºé‡‘ä¼šæèµ RocketMQï¼Œæˆä¸º Apache å­µåŒ–é¡¹ç›®ã€‚ 2017 å¹´ 9 æœˆ 25 æ—¥ï¼ŒApache å®£å¸ƒ RocketMQå­µåŒ–æˆä¸º Apache é¡¶çº§é¡¹ç›®ï¼ˆTLP ï¼‰ï¼Œæˆä¸ºå›½å†…é¦–ä¸ªäº’è”ç½‘ä¸­é—´ä»¶åœ¨ Apache ä¸Šçš„é¡¶çº§é¡¹ç›®ã€‚</p></blockquote><p>å®˜ç½‘åœ°å€ï¼šhttp://rocketmq.apache.org</p><h3 id="_2-ã€rocketmqå‘å±•å†ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-ã€rocketmqå‘å±•å†ç¨‹"><span>2 ã€RocketMQå‘å±•å†ç¨‹</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208103522.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><ul><li>2007 å¹´ï¼Œé˜¿é‡Œå¼€å§‹äº”å½©çŸ³é¡¹ç›®ï¼ŒNotifyä½œä¸ºé¡¹ç›®ä¸­äº¤æ˜“æ ¸å¿ƒæ¶ˆæ¯æµè½¬ç³»ç»Ÿï¼Œåº”è¿è€Œç”Ÿã€‚Notifyç³»ç»Ÿæ˜¯RocketMQçš„é›å½¢ã€‚</li><li>2010 å¹´ï¼ŒB2Bå¤§è§„æ¨¡ä½¿ç”¨ActiveMQä½œä¸ºé˜¿é‡Œçš„æ¶ˆæ¯å†…æ ¸ã€‚é˜¿é‡Œæ€¥éœ€ä¸€ä¸ªå…·æœ‰æµ·é‡å †ç§¯èƒ½åŠ›çš„æ¶ˆæ¯ç³»ç»Ÿã€‚</li><li>2011 å¹´åˆï¼ŒKafkaå¼€æºã€‚æ·˜å®ä¸­é—´ä»¶å›¢é˜Ÿåœ¨å¯¹Kafkaè¿›è¡Œäº†æ·±å…¥ç ”ç©¶åï¼Œå¼€å‘äº†ä¸€æ¬¾æ–°çš„MQï¼ŒMetaQã€‚</li><li>2012 å¹´ï¼ŒMetaQå‘å±•åˆ°äº†v3.0ç‰ˆæœ¬ï¼Œåœ¨å®ƒåŸºç¡€ä¸Šè¿›è¡Œäº†è¿›ä¸€æ­¥çš„æŠ½è±¡ï¼Œå½¢æˆäº†RocketMQï¼Œç„¶åå°±å°†å…¶è¿›è¡Œäº†å¼€æºã€‚</li><li>2015 å¹´ï¼Œé˜¿é‡Œåœ¨RocketMQçš„åŸºç¡€ä¸Šï¼Œåˆæ¨å‡ºäº†ä¸€æ¬¾ä¸“é—¨é’ˆå¯¹é˜¿é‡Œäº‘ä¸Šç”¨æˆ·çš„æ¶ˆæ¯ç³»ç»ŸAliware MQã€‚</li><li>2016 å¹´åŒåä¸€ï¼ŒRocketMQæ‰¿è½½äº†ä¸‡äº¿çº§æ¶ˆæ¯çš„æµè½¬ï¼Œè·¨è¶Šäº†ä¸€ä¸ªæ–°çš„é‡Œç¨‹ç¢‘ã€‚ 11 æœˆ 28 æ—¥ï¼Œé˜¿é‡Œå·´å·´å‘ Apache è½¯ä»¶åŸºé‡‘ä¼šæèµ  RocketMQï¼Œæˆä¸º Apache å­µåŒ–é¡¹ç›®ã€‚</li><li>2017 å¹´ 9 æœˆ 25 æ—¥ï¼ŒApache å®£å¸ƒ RocketMQå­µåŒ–æˆä¸º Apache é¡¶çº§é¡¹ç›®ï¼ˆTLP ï¼‰ï¼Œæˆä¸ºå›½å†…é¦–ä¸ªäº’è”ç½‘ä¸­é—´ä»¶åœ¨ Apache ä¸Šçš„é¡¶çº§é¡¹ç›®ã€‚</li></ul><h1 id="ç¬¬-2-ç« -rocketmqçš„å®‰è£…ä¸å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#ç¬¬-2-ç« -rocketmqçš„å®‰è£…ä¸å¯åŠ¨"><span>ç¬¬ 2 ç«  RocketMQçš„å®‰è£…ä¸å¯åŠ¨</span></a></h1><h2 id="ä¸€ã€åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µ"><span>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</span></a></h2><h3 id="_1-æ¶ˆæ¯-message" tabindex="-1"><a class="header-anchor" href="#_1-æ¶ˆæ¯-message"><span>1 æ¶ˆæ¯ï¼ˆMessageï¼‰</span></a></h3><blockquote><p>æ¶ˆæ¯æ˜¯æŒ‡ï¼Œæ¶ˆæ¯ç³»ç»Ÿæ‰€ä¼ è¾“ä¿¡æ¯çš„ç‰©ç†è½½ä½“ï¼Œç”Ÿäº§å’Œæ¶ˆè´¹æ•°æ®çš„æœ€å°å•ä½ï¼Œæ¯æ¡æ¶ˆæ¯å¿…é¡»å±äºä¸€ä¸ªä¸»é¢˜ã€‚</p></blockquote><h3 id="_2-ä¸»é¢˜-topic" tabindex="-1"><a class="header-anchor" href="#_2-ä¸»é¢˜-topic"><span>2 ä¸»é¢˜ï¼ˆTopicï¼‰</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208103828.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>Topicè¡¨ç¤ºä¸€ç±»æ¶ˆæ¯çš„é›†åˆï¼Œæ¯ä¸ªä¸»é¢˜åŒ…å«è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯åªèƒ½å±äºä¸€ä¸ªä¸»é¢˜ï¼Œæ˜¯RocketMQè¿›è¡Œæ¶ˆæ¯è®¢é˜…çš„åŸºæœ¬å•ä½ã€‚ topic:message 1:n message:topic 1:1</p><p>ä¸€ä¸ªç”Ÿäº§è€…å¯ä»¥åŒæ—¶å‘é€å¤šç§Topicçš„æ¶ˆæ¯ï¼›è€Œä¸€ä¸ªæ¶ˆè´¹è€…åªå¯¹æŸç§ç‰¹å®šçš„Topicæ„Ÿå…´è¶£ï¼Œå³åªå¯ä»¥è®¢é˜… å’Œæ¶ˆè´¹ä¸€ç§Topicçš„æ¶ˆæ¯ã€‚ producer:topic 1:n consumer:topic 1:1</p><h3 id="_3-æ ‡ç­¾-tag" tabindex="-1"><a class="header-anchor" href="#_3-æ ‡ç­¾-tag"><span>3 æ ‡ç­¾ï¼ˆTagï¼‰</span></a></h3><blockquote><p>ä¸ºæ¶ˆæ¯è®¾ç½®çš„æ ‡ç­¾ï¼Œç”¨äºåŒä¸€ä¸»é¢˜ä¸‹åŒºåˆ†ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚æ¥è‡ªåŒä¸€ä¸šåŠ¡å•å…ƒçš„æ¶ˆæ¯ï¼Œå¯ä»¥æ ¹æ®ä¸åŒä¸šåŠ¡ç›®çš„åœ¨åŒä¸€ä¸»é¢˜ä¸‹è®¾ç½®ä¸åŒæ ‡ç­¾ã€‚æ ‡ç­¾èƒ½å¤Ÿæœ‰æ•ˆåœ°ä¿æŒä»£ç çš„æ¸…æ™°åº¦å’Œè¿è´¯æ€§ï¼Œå¹¶ä¼˜åŒ–RocketMQæä¾›çš„æŸ¥è¯¢ç³»ç»Ÿã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®Tagå®ç°å¯¹ä¸åŒå­ä¸»é¢˜çš„ä¸åŒæ¶ˆè´¹é€»è¾‘ï¼Œå®ç°æ›´å¥½çš„æ‰©å±•æ€§ã€‚</p></blockquote><p>Topicæ˜¯æ¶ˆæ¯çš„ä¸€çº§åˆ†ç±»ï¼ŒTagæ˜¯æ¶ˆæ¯çš„äºŒçº§åˆ†ç±»ã€‚</p><ul><li>Topicï¼šè´§ç‰© <ul><li>tag=ä¸Šæµ·</li><li>tag=æ±Ÿè‹</li><li>tag=æµ™æ±Ÿ</li></ul></li></ul><h4 id="æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹è€…"><span>------- æ¶ˆè´¹è€… -----</span></a></h4><ul><li>topic=è´§ç‰© tag = ä¸Šæµ·</li><li>topic=è´§ç‰© tag = ä¸Šæµ·|æµ™æ±Ÿ</li><li>topic=è´§ç‰© tag = *</li></ul><h3 id="_4-é˜Ÿåˆ—-queue" tabindex="-1"><a class="header-anchor" href="#_4-é˜Ÿåˆ—-queue"><span>4 é˜Ÿåˆ—ï¼ˆQueueï¼‰</span></a></h3><p>å­˜å‚¨æ¶ˆæ¯çš„ç‰©ç†å®ä½“ã€‚ä¸€ä¸ªTopicä¸­å¯ä»¥åŒ…å«å¤šä¸ªQueueï¼Œæ¯ä¸ªQueueä¸­å­˜æ”¾çš„å°±æ˜¯è¯¥Topicçš„æ¶ˆæ¯ã€‚ä¸€ä¸ªTopicçš„Queueä¹Ÿè¢«ç§°ä¸ºä¸€ä¸ªTopicä¸­æ¶ˆæ¯çš„åˆ†åŒºï¼ˆPartitionï¼‰ã€‚</p><p>ä¸€ä¸ªTopicçš„Queueä¸­çš„æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚ä¸€ä¸ªQueueä¸­çš„æ¶ˆæ¯ä¸å…è®¸åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208104018.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>åœ¨å­¦ä¹ å‚è€ƒå…¶å®ƒç›¸å…³èµ„æ–™æ—¶ï¼Œè¿˜ä¼šçœ‹åˆ°ä¸€ä¸ªæ¦‚å¿µï¼šåˆ†ç‰‡ï¼ˆShardingï¼‰ã€‚åˆ†ç‰‡ä¸åŒäºåˆ†åŒºã€‚åœ¨RocketMQä¸­ï¼Œåˆ†ç‰‡æŒ‡çš„æ˜¯å­˜æ”¾ç›¸åº”Topicçš„Brokerã€‚æ¯ä¸ªåˆ†ç‰‡ä¸­ä¼šåˆ›å»ºå‡ºç›¸åº”æ•°é‡çš„åˆ†åŒºï¼Œå³Queueï¼Œæ¯ä¸ªQueueçš„å¤§å°éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208104611.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_5-æ¶ˆæ¯æ ‡è¯†-messageid-key" tabindex="-1"><a class="header-anchor" href="#_5-æ¶ˆæ¯æ ‡è¯†-messageid-key"><span>5 æ¶ˆæ¯æ ‡è¯†ï¼ˆMessageId/Keyï¼‰</span></a></h3><p>RocketMQä¸­æ¯ä¸ªæ¶ˆæ¯æ‹¥æœ‰å”¯ä¸€çš„MessageIdï¼Œä¸”å¯ä»¥æºå¸¦å…·æœ‰ä¸šåŠ¡æ ‡è¯†çš„Keyï¼Œä»¥æ–¹ä¾¿å¯¹æ¶ˆæ¯çš„æŸ¥è¯¢ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMessageIdæœ‰ä¸¤ä¸ªï¼šåœ¨ç”Ÿäº§è€…send()æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªMessageIdï¼ˆmsgId)ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾Brokeråï¼ŒBrokerä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªMessageId(offsetMsgId)ã€‚msgIdã€offsetMsgIdä¸keyéƒ½ç§°ä¸ºæ¶ˆæ¯æ ‡è¯†ã€‚</p><ul><li>msgIdï¼šç”±producerç«¯ç”Ÿæˆï¼Œå…¶ç”Ÿæˆè§„åˆ™ä¸ºï¼šproducerIp + è¿›ç¨‹pid + MessageClientIDSetterç±»çš„ClassLoaderçš„hashCode +å½“å‰æ—¶é—´ + AutomicIntegerè‡ªå¢è®¡æ•°å™¨</li><li>offsetMsgIdï¼šç”±brokerç«¯ç”Ÿæˆï¼Œå…¶ç”Ÿæˆè§„åˆ™ä¸ºï¼šbrokerIp + ç‰©ç†åˆ†åŒºçš„offsetï¼ˆQueueä¸­çš„åç§»é‡ï¼‰</li><li>keyï¼šç”±ç”¨æˆ·æŒ‡å®šçš„ä¸šåŠ¡ç›¸å…³çš„å”¯ä¸€æ ‡è¯†</li></ul><h2 id="äºŒã€ç³»ç»Ÿæ¶æ„" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç³»ç»Ÿæ¶æ„"><span>äºŒã€ç³»ç»Ÿæ¶æ„</span></a></h2><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723145759086.png" alt="image-20240723145759086" tabindex="0" loading="lazy"><figcaption>image-20240723145759086</figcaption></figure><p>RocketMQæ¶æ„ä¸Šä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†æ„æˆï¼š</p><h3 id="_1-producer" tabindex="-1"><a class="header-anchor" href="#_1-producer"><span>1 Producer</span></a></h3><p>æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œè´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ã€‚Produceré€šè¿‡MQçš„è´Ÿè½½å‡è¡¡æ¨¡å—é€‰æ‹©ç›¸åº”çš„Brokeré›†ç¾¤é˜Ÿåˆ—è¿›è¡Œæ¶ˆæ¯æŠ•é€’ï¼ŒæŠ•é€’çš„è¿‡ç¨‹æ”¯æŒå¿«é€Ÿå¤±è´¥å¹¶ä¸”ä½å»¶è¿Ÿã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œä¸šåŠ¡ç³»ç»Ÿäº§ç”Ÿçš„æ—¥å¿—å†™å…¥åˆ°MQçš„è¿‡ç¨‹ï¼Œå°±æ˜¯æ¶ˆæ¯ç”Ÿäº§çš„è¿‡ç¨‹</p></blockquote><blockquote><p>å†å¦‚ï¼Œç”µå•†å¹³å°ä¸­ç”¨æˆ·æäº¤çš„ç§’æ€è¯·æ±‚å†™å…¥åˆ°MQçš„è¿‡ç¨‹ï¼Œå°±æ˜¯æ¶ˆæ¯ç”Ÿäº§çš„è¿‡ç¨‹</p></blockquote><p>RocketMQä¸­çš„æ¶ˆæ¯ç”Ÿäº§è€…éƒ½æ˜¯ä»¥ç”Ÿäº§è€…ç»„ï¼ˆProducer Groupï¼‰çš„å½¢å¼å‡ºç°çš„ã€‚ç”Ÿäº§è€…ç»„æ˜¯åŒä¸€ç±»ç”Ÿäº§è€…çš„é›†åˆï¼Œè¿™ç±»Producerå‘é€ç›¸åŒTopicç±»å‹çš„æ¶ˆæ¯ã€‚ä¸€ä¸ªç”Ÿäº§è€…ç»„å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªä¸»é¢˜çš„æ¶ˆæ¯ã€‚</p><h3 id="_2-consumer" tabindex="-1"><a class="header-anchor" href="#_2-consumer"><span>2 Consumer</span></a></h3><p>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œè´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ã€‚ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ä¼šä»BrokeræœåŠ¡å™¨ä¸­è·å–åˆ°æ¶ˆæ¯ï¼Œå¹¶å¯¹æ¶ˆæ¯è¿›è¡Œç›¸å…³ä¸šåŠ¡å¤„ç†ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼ŒQoSç³»ç»Ÿä»MQä¸­è¯»å–æ—¥å¿—ï¼Œå¹¶å¯¹æ—¥å¿—è¿›è¡Œè§£æå¤„ç†çš„è¿‡ç¨‹å°±æ˜¯æ¶ˆæ¯æ¶ˆè´¹çš„è¿‡ç¨‹ã€‚</p></blockquote><blockquote><p>å†å¦‚ï¼Œç”µå•†å¹³å°çš„ä¸šåŠ¡ç³»ç»Ÿä»MQä¸­è¯»å–åˆ°ç§’æ€è¯·æ±‚ï¼Œå¹¶å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†çš„è¿‡ç¨‹å°±æ˜¯æ¶ˆæ¯æ¶ˆè´¹çš„è¿‡ç¨‹ã€‚</p></blockquote><p>RocketMQä¸­çš„æ¶ˆæ¯æ¶ˆè´¹è€…éƒ½æ˜¯ä»¥æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰çš„å½¢å¼å‡ºç°çš„ã€‚æ¶ˆè´¹è€…ç»„æ˜¯åŒä¸€ç±»æ¶ˆè´¹è€…çš„é›†åˆï¼Œè¿™ç±»Consumeræ¶ˆè´¹çš„æ˜¯åŒä¸€ä¸ªTopicç±»å‹çš„æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…ç»„ä½¿å¾—åœ¨æ¶ˆæ¯æ¶ˆè´¹æ–¹é¢ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼ˆå°†ä¸€ä¸ªTopicä¸­çš„ä¸åŒçš„Queueå¹³å‡åˆ†é…ç»™åŒä¸€ä¸ªConsumer Groupçš„ä¸åŒçš„Consumerï¼Œæ³¨æ„ï¼Œå¹¶ä¸æ˜¯å°†æ¶ˆæ¯è´Ÿè½½å‡è¡¡ï¼‰å’Œå®¹é”™ï¼ˆä¸€ä¸ªConsmeræŒ‚äº†ï¼Œè¯¥Consumer Groupä¸­çš„å…¶å®ƒConsumerå¯ä»¥æ¥ç€æ¶ˆè´¹åŸConsumeræ¶ˆè´¹çš„Queueï¼‰çš„ç›®æ ‡å˜å¾—éå¸¸å®¹æ˜“ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208105007.png" alt="" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>æ¶ˆè´¹è€…ç»„ä¸­Consumerçš„æ•°é‡åº”è¯¥å°äºç­‰äºè®¢é˜…Topicçš„Queueæ•°é‡ã€‚å¦‚æœè¶…å‡ºQueueæ•°é‡ï¼Œåˆ™å¤šå‡ºçš„Consumerå°†ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723145838778.png" alt="image-20240723145838778" tabindex="0" loading="lazy"><figcaption>image-20240723145838778</figcaption></figure><p>ä¸è¿‡ï¼Œä¸€ä¸ªTopicç±»å‹çš„æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…ç»„åŒæ—¶æ¶ˆè´¹ã€‚</p><blockquote><p>æ³¨æ„ï¼Œ</p></blockquote><ul><li>1 ï¼‰æ¶ˆè´¹è€…ç»„åªèƒ½æ¶ˆè´¹ä¸€ä¸ªTopicçš„æ¶ˆæ¯ï¼Œä¸èƒ½åŒæ—¶æ¶ˆè´¹å¤šä¸ªTopicæ¶ˆæ¯</li><li>2 ï¼‰ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…å¿…é¡»è®¢é˜…å®Œå…¨ç›¸åŒçš„Topic</li></ul><h3 id="_3-name-server" tabindex="-1"><a class="header-anchor" href="#_3-name-server"><span>3 Name Server</span></a></h3><h4 id="åŠŸèƒ½ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½ä»‹ç»"><span>åŠŸèƒ½ä»‹ç»</span></a></h4><p>NameServeræ˜¯ä¸€ä¸ªBrokerä¸Topicè·¯ç”±çš„æ³¨å†Œä¸­å¿ƒï¼Œæ”¯æŒBrokerçš„åŠ¨æ€æ³¨å†Œä¸å‘ç°ã€‚</p><p>RocketMQçš„æ€æƒ³æ¥è‡ªäºKafkaï¼Œè€ŒKafkaæ˜¯ä¾èµ–äº†Zookeeperçš„ã€‚æ‰€ä»¥ï¼Œåœ¨RocketMQçš„æ—©æœŸç‰ˆæœ¬ï¼Œå³åœ¨MetaQ v1.0ä¸v2.0ç‰ˆæœ¬ä¸­ï¼Œä¹Ÿæ˜¯ä¾èµ–äºZookeeperçš„ã€‚ä»MetaQ v3.0ï¼Œå³RocketMQå¼€å§‹å»æ‰äº†Zookeeperä¾èµ–ï¼Œä½¿ç”¨äº†è‡ªå·±çš„NameServerã€‚</p><h4 id="ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªåŠŸèƒ½"><span>ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªåŠŸèƒ½ï¼š</span></a></h4><ul><li><code>Brokerç®¡ç†ï¼š</code>æ¥å—Brokeré›†ç¾¤çš„æ³¨å†Œä¿¡æ¯å¹¶ä¸”ä¿å­˜ä¸‹æ¥ä½œä¸ºè·¯ç”±ä¿¡æ¯çš„åŸºæœ¬æ•°æ®ï¼›æä¾›å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œæ£€æŸ¥Brokeræ˜¯å¦è¿˜å­˜æ´»ã€‚</li><li><code>è·¯ç”±ä¿¡æ¯ç®¡ç†ï¼š</code>æ¯ä¸ªNameServerä¸­éƒ½ä¿å­˜ç€Brokeré›†ç¾¤çš„æ•´ä¸ªè·¯ç”±ä¿¡æ¯å’Œç”¨äºå®¢æˆ·ç«¯æŸ¥è¯¢çš„é˜Ÿåˆ—ä¿¡æ¯ã€‚Producerå’ŒConumseré€šè¿‡NameServerå¯ä»¥è·å–æ•´ä¸ªBrokeré›†ç¾¤çš„è·¯ç”±ä¿¡æ¯ï¼Œä»è€Œè¿›è¡Œæ¶ˆæ¯çš„æŠ•é€’å’Œæ¶ˆè´¹ã€‚</li></ul><h4 id="è·¯ç”±æ³¨å†Œ" tabindex="-1"><a class="header-anchor" href="#è·¯ç”±æ³¨å†Œ"><span>è·¯ç”±æ³¨å†Œ</span></a></h4><p>NameServeré€šå¸¸ä¹Ÿæ˜¯ä»¥é›†ç¾¤çš„æ–¹å¼éƒ¨ç½²ï¼Œä¸è¿‡ï¼ŒNameServeræ˜¯æ— çŠ¶æ€çš„ï¼Œå³NameServeré›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹é—´æ˜¯æ— å·®å¼‚çš„ï¼Œå„èŠ‚ç‚¹é—´ç›¸äº’ä¸è¿›è¡Œä¿¡æ¯é€šè®¯ã€‚é‚£å„èŠ‚ç‚¹ä¸­çš„æ•°æ®æ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥çš„å‘¢ï¼Ÿåœ¨BrokerèŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œè½®è¯¢NameServeråˆ—è¡¨ï¼Œä¸æ¯ä¸ªNameServerèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå‘èµ·æ³¨å†Œè¯·æ±‚ã€‚åœ¨NameServerå†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªBrokeråˆ—è¡¨ï¼Œç”¨æ¥åŠ¨æ€å­˜å‚¨Brokerçš„ä¿¡æ¯ã€‚</p><blockquote><p>æ³¨æ„ï¼Œè¿™æ˜¯ä¸å…¶å®ƒåƒzkã€Eurekaã€Nacosç­‰æ³¨å†Œä¸­å¿ƒä¸åŒçš„åœ°æ–¹ã€‚ è¿™ç§NameServerçš„æ— çŠ¶æ€æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šNameServeré›†ç¾¤æ­å»ºç®€å•ï¼Œæ‰©å®¹ç®€å•ã€‚ ç¼ºç‚¹ï¼šå¯¹äºBrokerï¼Œå¿…é¡»æ˜ç¡®æŒ‡å‡ºæ‰€æœ‰NameServeråœ°å€ã€‚å¦åˆ™æœªæŒ‡å‡ºçš„å°†ä¸ä¼šå»æ³¨å†Œã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼ŒNameServerå¹¶ä¸èƒ½éšä¾¿æ‰©å®¹ã€‚å› ä¸ºï¼Œè‹¥Brokerä¸é‡æ–°é…ç½®ï¼Œæ–°å¢çš„NameServerå¯¹äºBrokeræ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œå…¶ä¸ä¼šå‘è¿™ä¸ªNameServerè¿›è¡Œæ³¨å†Œã€‚</p></blockquote><p>BrokerèŠ‚ç‚¹ä¸ºäº†è¯æ˜è‡ªå·±æ˜¯æ´»ç€çš„ï¼Œä¸ºäº†ç»´æŠ¤ä¸NameServeré—´çš„é•¿è¿æ¥ï¼Œä¼šå°†æœ€æ–°çš„ä¿¡æ¯ä»¥å¿ƒè·³åŒ…çš„æ–¹å¼ä¸ŠæŠ¥ç»™NameServerï¼Œæ¯ 30 ç§’å‘é€ä¸€æ¬¡å¿ƒè·³ã€‚å¿ƒè·³åŒ…ä¸­åŒ…å« BrokerIdã€Brokeråœ°å€(IP+Port)ã€Brokeråç§°ã€Brokeræ‰€å±é›†ç¾¤åç§°ç­‰ç­‰ã€‚NameServeråœ¨æ¥æ”¶åˆ°å¿ƒè·³åŒ…åï¼Œä¼šæ›´æ–°å¿ƒè·³æ—¶é—´æˆ³ï¼Œè®°å½•è¿™ä¸ªBrokerçš„æœ€æ–°å­˜æ´»æ—¶é—´ã€‚</p><h4 id="è·¯ç”±å‰”é™¤" tabindex="-1"><a class="header-anchor" href="#è·¯ç”±å‰”é™¤"><span>è·¯ç”±å‰”é™¤</span></a></h4><p>ç”±äºBrokerå…³æœºã€å®•æœºæˆ–ç½‘ç»œæŠ–åŠ¨ç­‰åŸå› ï¼ŒNameServeræ²¡æœ‰æ”¶åˆ°Brokerçš„å¿ƒè·³ï¼ŒNameServerå¯èƒ½ä¼šå°†å…¶ä»Brokeråˆ—è¡¨ä¸­å‰”é™¤ã€‚</p><p>NameServerä¸­æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš” 10 ç§’å°±ä¼šæ‰«æä¸€æ¬¡Brokerè¡¨ï¼ŒæŸ¥çœ‹æ¯ä¸€ä¸ªBrokerçš„æœ€æ–°å¿ƒè·³æ—¶é—´æˆ³è·ç¦»å½“å‰æ—¶é—´æ˜¯å¦è¶…è¿‡ 120 ç§’ï¼Œå¦‚æœè¶…è¿‡ï¼Œåˆ™ä¼šåˆ¤å®šBrokerå¤±æ•ˆï¼Œç„¶åå°†å…¶ä»Brokeråˆ—è¡¨ä¸­å‰”é™¤ã€‚</p><blockquote><p>æ‰©å±•ï¼šå¯¹äºRocketMQæ—¥å¸¸è¿ç»´å·¥ä½œï¼Œä¾‹å¦‚Brokerå‡çº§ï¼Œéœ€è¦åœæ‰Brokerçš„å·¥ä½œã€‚OPéœ€è¦æ€ä¹ˆåšï¼Ÿ OPéœ€è¦å°†Brokerçš„è¯»å†™æƒé™ç¦æ‰ã€‚ä¸€æ—¦client(Consumeræˆ–Producer)å‘brokerå‘é€è¯·æ±‚ï¼Œéƒ½ä¼šæ”¶åˆ°brokerçš„NO_PERMISSIONå“åº”ï¼Œç„¶åclientä¼šè¿›è¡Œå¯¹å…¶å®ƒBrokerçš„é‡è¯•ã€‚ å½“OPè§‚å¯Ÿåˆ°è¿™ä¸ªBrokeræ²¡æœ‰æµé‡åï¼Œå†å…³é—­å®ƒï¼Œå®ç°Brokerä»NameServerçš„ç§»é™¤ã€‚ OPï¼šè¿ç»´å·¥ç¨‹å¸ˆ SREï¼šSite Reliability Engineerï¼Œç°åœºå¯é æ€§å·¥ç¨‹å¸ˆ</p></blockquote><h4 id="è·¯ç”±å‘ç°" tabindex="-1"><a class="header-anchor" href="#è·¯ç”±å‘ç°"><span>è·¯ç”±å‘ç°</span></a></h4><p>RocketMQçš„è·¯ç”±å‘ç°é‡‡ç”¨çš„æ˜¯Pullæ¨¡å‹ã€‚å½“Topicè·¯ç”±ä¿¡æ¯å‡ºç°å˜åŒ–æ—¶ï¼ŒNameServerä¸ä¼šä¸»åŠ¨æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯å®¢æˆ·ç«¯å®šæ—¶æ‹‰å–ä¸»é¢˜æœ€æ–°çš„è·¯ç”±ã€‚é»˜è®¤å®¢æˆ·ç«¯æ¯ 30 ç§’ä¼šæ‹‰å–ä¸€æ¬¡æœ€æ–°çš„è·¯ç”±ã€‚</p><blockquote><p>æ‰©å±•ï¼š 1 ï¼‰Pushæ¨¡å‹ï¼šæ¨é€æ¨¡å‹ã€‚å…¶å®æ—¶æ€§è¾ƒå¥½ï¼Œæ˜¯ä¸€ä¸ªâ€œå‘å¸ƒ-è®¢é˜…â€æ¨¡å‹ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªé•¿è¿æ¥ã€‚è€Œé•¿è¿æ¥çš„ç»´æŠ¤æ˜¯éœ€è¦èµ„æºæˆæœ¬çš„ã€‚è¯¥æ¨¡å‹é€‚åˆäºçš„åœºæ™¯ï¼š</p><ul><li><p>å®æ—¶æ€§è¦æ±‚è¾ƒé«˜</p></li><li><p>Clientæ•°é‡ä¸å¤šï¼ŒServeræ•°æ®å˜åŒ–è¾ƒé¢‘ç¹ 2 ï¼‰Pullæ¨¡å‹ï¼šæ‹‰å–æ¨¡å‹ã€‚å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå®æ—¶æ€§è¾ƒå·®ã€‚</p><p>3 ï¼‰Long Pollingæ¨¡å‹ï¼šé•¿è½®è¯¢æ¨¡å‹ã€‚å…¶æ˜¯å¯¹Pushä¸Pullæ¨¡å‹çš„æ•´åˆï¼Œå……åˆ†åˆ©ç”¨äº†è¿™ä¸¤ç§æ¨¡å‹çš„ä¼˜åŠ¿ï¼Œå±è”½äº†å®ƒä»¬çš„åŠ£åŠ¿ã€‚</p></li></ul></blockquote><h4 id="å®¢æˆ·ç«¯nameserveré€‰æ‹©ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯nameserveré€‰æ‹©ç­–ç•¥"><span>å®¢æˆ·ç«¯NameServeré€‰æ‹©ç­–ç•¥</span></a></h4><blockquote><p>è¿™é‡Œçš„å®¢æˆ·ç«¯æŒ‡çš„æ˜¯Producerä¸Consumer</p></blockquote><p>å®¢æˆ·ç«¯åœ¨é…ç½®æ—¶å¿…é¡»è¦å†™ä¸ŠNameServeré›†ç¾¤çš„åœ°å€ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åˆ°åº•è¿æ¥çš„æ˜¯å“ªä¸ªNameServerèŠ‚ç‚¹å‘¢ï¼Ÿå®¢æˆ·ç«¯é¦–å…ˆä¼šç”Ÿäº§ä¸€ä¸ªéšæœºæ•°ï¼Œç„¶åå†ä¸NameServerèŠ‚ç‚¹æ•°é‡å–æ¨¡ï¼Œæ­¤æ—¶å¾—åˆ°çš„å°±æ˜¯æ‰€è¦è¿æ¥çš„èŠ‚ç‚¹ç´¢å¼•ï¼Œç„¶åå°±ä¼šè¿›è¡Œè¿æ¥ã€‚å¦‚æœè¿æ¥å¤±è´¥ï¼Œåˆ™ä¼šé‡‡ç”¨round-robinç­–ç•¥ï¼Œé€ä¸ªå°è¯•ç€å»è¿æ¥å…¶å®ƒèŠ‚ç‚¹ã€‚</p><p>é¦–å…ˆé‡‡ç”¨çš„æ˜¯<code>éšæœºç­–ç•¥</code>è¿›è¡Œçš„é€‰æ‹©ï¼Œå¤±è´¥åé‡‡ç”¨çš„æ˜¯<code>è½®è¯¢ç­–ç•¥</code>ã€‚</p><blockquote><p>æ‰©å±•ï¼šZookeeper Clientæ˜¯å¦‚ä½•é€‰æ‹©Zookeeper Serverçš„ï¼Ÿ ç®€å•æ¥è¯´å°±æ˜¯ï¼Œç»è¿‡ä¸¤æ¬¡ShufÃ¦eï¼Œç„¶åé€‰æ‹©ç¬¬ä¸€å°Zookeeper Serverã€‚ è¯¦ç»†è¯´å°±æ˜¯ï¼Œå°†é…ç½®æ–‡ä»¶ä¸­çš„zk serveråœ°å€è¿›è¡Œç¬¬ä¸€æ¬¡shufÃ¦eï¼Œç„¶åéšæœºé€‰æ‹©ä¸€ä¸ªã€‚è¿™ä¸ªé€‰æ‹©å‡ºçš„ä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ªhostnameã€‚ç„¶åè·å–åˆ°è¯¥hostnameå¯¹åº”çš„æ‰€æœ‰ipï¼Œå†å¯¹è¿™äº›ipè¿›è¡Œç¬¬äºŒæ¬¡shufÃ¦eï¼Œä»shufÃ¦eè¿‡çš„ç»“æœä¸­å–ç¬¬ä¸€ä¸ªserveråœ°å€è¿›è¡Œè¿æ¥ã€‚</p></blockquote><h3 id="_4-broker" tabindex="-1"><a class="header-anchor" href="#_4-broker"><span>4 Broker</span></a></h3><h4 id="åŠŸèƒ½ä»‹ç»-1" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½ä»‹ç»-1"><span>åŠŸèƒ½ä»‹ç»</span></a></h4><p>Brokerå……å½“ç€æ¶ˆæ¯ä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€è½¬å‘æ¶ˆæ¯ã€‚Brokeråœ¨RocketMQç³»ç»Ÿä¸­è´Ÿè´£æ¥æ”¶å¹¶å­˜å‚¨ä»ç”Ÿäº§è€…å‘é€æ¥çš„æ¶ˆæ¯ï¼ŒåŒæ—¶ä¸ºæ¶ˆè´¹è€…çš„æ‹‰å–è¯·æ±‚ä½œå‡†å¤‡ã€‚BrokeråŒæ—¶ä¹Ÿå­˜å‚¨ç€æ¶ˆæ¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬æ¶ˆè´¹è€…ç»„æ¶ˆè´¹è¿›åº¦åç§»offsetã€ä¸»é¢˜ã€é˜Ÿåˆ—ç­‰ã€‚</p><blockquote><p>Kafka 0.8ç‰ˆæœ¬ä¹‹åï¼Œoffsetæ˜¯å­˜æ”¾åœ¨Brokerä¸­çš„ï¼Œä¹‹å‰ç‰ˆæœ¬æ˜¯å­˜æ”¾åœ¨Zookeeperä¸­çš„ã€‚</p></blockquote><h4 id="æ¨¡å—æ„æˆ" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—æ„æˆ"><span>æ¨¡å—æ„æˆ</span></a></h4><p>ä¸‹å›¾ä¸ºBroker Serverçš„åŠŸèƒ½æ¨¡å—ç¤ºæ„å›¾ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723150206184.png" alt="image-20240723150206184" tabindex="0" loading="lazy"><figcaption>image-20240723150206184</figcaption></figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208110201.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" title="QQæˆªå›¾20201229183512.png" style="zoom:200%;"><p><code>Remoting Module</code>ï¼šæ•´ä¸ªBrokerçš„å®ä½“ï¼Œè´Ÿè´£å¤„ç†æ¥è‡ªclientsç«¯çš„è¯·æ±‚ã€‚è€Œè¿™ä¸ªBrokerå®ä½“åˆ™ç”±ä»¥ä¸‹æ¨¡å—æ„æˆã€‚</p><p><code>Client Managerï¼š</code>å®¢æˆ·ç«¯ç®¡ç†å™¨ã€‚è´Ÿè´£æ¥æ”¶ã€è§£æå®¢æˆ·ç«¯(Producer/Consumer)è¯·æ±‚ï¼Œç®¡ç†å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼Œç»´æŠ¤Consumerçš„Topicè®¢é˜…ä¿¡æ¯</p><p><code>Store Serviceï¼š</code>å­˜å‚¨æœåŠ¡ã€‚æä¾›æ–¹ä¾¿ç®€å•çš„APIæ¥å£ï¼Œå¤„ç†æ¶ˆæ¯å­˜å‚¨åˆ°ç‰©ç†ç¡¬ç›˜å’Œæ¶ˆæ¯æŸ¥è¯¢åŠŸèƒ½ã€‚</p><p><code>HA Serviceï¼š</code>é«˜å¯ç”¨æœåŠ¡ï¼Œæä¾›Master Broker å’Œ Slave Brokerä¹‹é—´çš„æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚</p><p><code>Index Serviceï¼š</code>ç´¢å¼•æœåŠ¡ã€‚æ ¹æ®ç‰¹å®šçš„Message keyï¼Œå¯¹æŠ•é€’åˆ°Brokerçš„æ¶ˆæ¯è¿›è¡Œç´¢å¼•æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿæä¾›æ ¹æ®Message Keyå¯¹æ¶ˆæ¯è¿›è¡Œå¿«é€ŸæŸ¥è¯¢çš„åŠŸèƒ½ã€‚</p><h4 id="é›†ç¾¤éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤éƒ¨ç½²"><span>é›†ç¾¤éƒ¨ç½²</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/image-20240723150335797.png" alt="image-20240723150335797" tabindex="0" loading="lazy"><figcaption>image-20240723150335797</figcaption></figure><p>ä¸ºäº†å¢å¼ºBrokeræ€§èƒ½ä¸ååé‡ï¼ŒBrokerä¸€èˆ¬éƒ½æ˜¯ä»¥é›†ç¾¤å½¢å¼å‡ºç°çš„ã€‚å„é›†ç¾¤èŠ‚ç‚¹ä¸­å¯èƒ½å­˜æ”¾ç€ç›¸åŒTopicçš„ä¸åŒQueueã€‚ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæŸBrokerèŠ‚ç‚¹å®•æœºï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±å‘¢ï¼Ÿå…¶è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå°†æ¯ä¸ªBrokeré›†ç¾¤èŠ‚ç‚¹è¿›è¡Œæ¨ªå‘æ‰©å±•ï¼Œå³å°†BrokerèŠ‚ç‚¹å†å»ºä¸ºä¸€ä¸ªHAé›†ç¾¤ï¼Œè§£å†³å•ç‚¹é—®é¢˜ã€‚</p><p>BrokerèŠ‚ç‚¹é›†ç¾¤æ˜¯ä¸€ä¸ªä¸»ä»é›†ç¾¤ï¼Œå³é›†ç¾¤ä¸­å…·æœ‰Masterä¸Slaveä¸¤ç§è§’è‰²ã€‚Masterè´Ÿè´£å¤„ç†è¯»å†™æ“ä½œè¯·æ±‚ï¼ŒSlaveè´Ÿè´£å¯¹Masterä¸­çš„æ•°æ®è¿›è¡Œå¤‡ä»½ã€‚å½“MasteræŒ‚æ‰äº†ï¼ŒSlaveåˆ™ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºMasterå»å·¥ä½œã€‚æ‰€ä»¥è¿™ä¸ªBrokeré›†ç¾¤æ˜¯ä¸»å¤‡é›†ç¾¤ã€‚ä¸€ä¸ªMasterå¯ä»¥åŒ…å«å¤šä¸ªSlaveï¼Œä½†ä¸€ä¸ªSlaveåªèƒ½éš¶å±äºä¸€ä¸ªMasterã€‚Masterä¸Slave çš„å¯¹åº”å…³ç³»æ˜¯é€šè¿‡æŒ‡å®šç›¸åŒçš„BrokerNameã€ä¸åŒçš„BrokerId æ¥ç¡®å®šçš„ã€‚BrokerIdä¸º 0 è¡¨ç¤ºMasterï¼Œé 0 è¡¨ç¤ºSlaveã€‚æ¯ä¸ªBrokerä¸NameServeré›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†ŒTopicä¿¡æ¯åˆ°æ‰€æœ‰NameServerã€‚</p><h3 id="_5-å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-å·¥ä½œæµç¨‹"><span>5 å·¥ä½œæµç¨‹</span></a></h3><h4 id="å…·ä½“æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å…·ä½“æµç¨‹"><span>å…·ä½“æµç¨‹</span></a></h4><ul><li><p>1 ï¼‰å¯åŠ¨NameServerï¼ŒNameServerå¯åŠ¨åå¼€å§‹ç›‘å¬ç«¯å£ï¼Œç­‰å¾…Brokerã€Producerã€Consumerè¿æ¥ã€‚</p></li><li><p>2 ï¼‰å¯åŠ¨Brokeræ—¶ï¼ŒBrokerä¼šä¸æ‰€æœ‰çš„NameServerå»ºç«‹å¹¶ä¿æŒé•¿è¿æ¥ï¼Œç„¶åæ¯ 30 ç§’å‘NameServerå®šæ—¶å‘é€å¿ƒè·³åŒ…ã€‚</p></li><li><p>3 ï¼‰å‘é€æ¶ˆæ¯å‰ï¼Œå¯ä»¥å…ˆåˆ›å»ºTopicï¼Œåˆ›å»ºTopicæ—¶éœ€è¦æŒ‡å®šè¯¥Topicè¦å­˜å‚¨åœ¨å“ªäº›Brokerä¸Šï¼Œå½“ç„¶ï¼Œåœ¨åˆ›å»ºTopicæ—¶ä¹Ÿä¼šå°†Topicä¸Brokerçš„å…³ç³»å†™å…¥åˆ°NameServerä¸­ã€‚ä¸è¿‡ï¼Œè¿™æ­¥æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå¯ä»¥åœ¨å‘é€æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºTopicã€‚</p></li><li><p>4 ï¼‰Producerå‘é€æ¶ˆæ¯ï¼Œå¯åŠ¨æ—¶å…ˆè·ŸNameServeré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€å°å»ºç«‹é•¿è¿æ¥ï¼Œå¹¶ä»NameServerä¸­è·å–è·¯ç”±ä¿¡æ¯ï¼Œå³å½“å‰å‘é€çš„Topicæ¶ˆæ¯çš„Queueä¸Brokerçš„åœ°å€ï¼ˆIP+Portï¼‰çš„æ˜ å°„å…³ç³»ã€‚ç„¶åæ ¹æ®ç®—æ³•ç­–ç•¥ä»é˜Ÿé€‰æ‹©ä¸€ä¸ªQueueï¼Œä¸é˜Ÿåˆ—æ‰€åœ¨çš„Brokerå»ºç«‹é•¿è¿æ¥ä»è€Œå‘Brokerå‘æ¶ˆæ¯ã€‚å½“ç„¶ï¼Œåœ¨è·å–åˆ°è·¯ç”±ä¿¡æ¯åï¼ŒProducerä¼šé¦–å…ˆå°†è·¯ç”±ä¿¡æ¯ç¼“å­˜åˆ°æœ¬åœ°ï¼Œå†æ¯ 30 ç§’ä»NameServeræ›´æ–°ä¸€æ¬¡è·¯ç”±ä¿¡æ¯ã€‚</p></li><li><p>5 ï¼‰Consumerè·ŸProducerç±»ä¼¼ï¼Œè·Ÿå…¶ä¸­ä¸€å°NameServerå»ºç«‹é•¿è¿æ¥ï¼Œè·å–å…¶æ‰€è®¢é˜…Topicçš„è·¯ç”±ä¿¡æ¯ï¼Œç„¶åæ ¹æ®ç®—æ³•ç­–ç•¥ä»è·¯ç”±ä¿¡æ¯ä¸­è·å–åˆ°å…¶æ‰€è¦æ¶ˆè´¹çš„Queueï¼Œç„¶åç›´æ¥è·ŸBrokerå»ºç«‹é•¿è¿æ¥ï¼Œå¼€å§‹æ¶ˆè´¹å…¶ä¸­çš„æ¶ˆæ¯ã€‚Consumeråœ¨è·å–åˆ°è·¯ç”±ä¿¡æ¯åï¼ŒåŒæ ·ä¹Ÿä¼šæ¯ 30 ç§’ä»NameServeræ›´æ–°ä¸€æ¬¡è·¯ç”±ä¿¡æ¯ã€‚ä¸è¿‡ä¸åŒäºProducerçš„æ˜¯ï¼ŒConsumerè¿˜ä¼šå‘Brokerå‘é€å¿ƒè·³ï¼Œä»¥ç¡®ä¿Brokerçš„å­˜æ´»çŠ¶æ€ã€‚</p></li></ul><h4 id="topicçš„åˆ›å»ºæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#topicçš„åˆ›å»ºæ¨¡å¼"><span>Topicçš„åˆ›å»ºæ¨¡å¼</span></a></h4><p>æ‰‹åŠ¨åˆ›å»ºTopicæ—¶ï¼Œæœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li>é›†ç¾¤æ¨¡å¼ï¼šè¯¥æ¨¡å¼ä¸‹åˆ›å»ºçš„Topicåœ¨è¯¥é›†ç¾¤ä¸­ï¼Œæ‰€æœ‰Brokerä¸­çš„Queueæ•°é‡æ˜¯ç›¸åŒçš„ã€‚</li><li>Brokeræ¨¡å¼ï¼šè¯¥æ¨¡å¼ä¸‹åˆ›å»ºçš„Topicåœ¨è¯¥é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªBrokerä¸­çš„Queueæ•°é‡å¯ä»¥ä¸åŒã€‚</li></ul><p>è‡ªåŠ¨åˆ›å»ºTopicæ—¶ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯Brokeræ¨¡å¼ï¼Œä¼šä¸ºæ¯ä¸ªBrokeré»˜è®¤åˆ›å»º 4 ä¸ªQueueã€‚</p><h4 id="è¯»-å†™é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#è¯»-å†™é˜Ÿåˆ—"><span>è¯»/å†™é˜Ÿåˆ—</span></a></h4><p>ä»ç‰©ç†ä¸Šæ¥è®²ï¼Œè¯»/å†™é˜Ÿåˆ—æ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚æ‰€ä»¥ï¼Œä¸å­˜åœ¨è¯»/å†™é˜Ÿåˆ—æ•°æ®åŒæ­¥é—®é¢˜ã€‚è¯»/å†™é˜Ÿåˆ—æ˜¯é€»è¾‘ä¸Šè¿›è¡ŒåŒºåˆ†çš„æ¦‚å¿µã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯»/å†™é˜Ÿåˆ—æ•°é‡æ˜¯ç›¸åŒçš„ã€‚</p><p>ä¾‹å¦‚ï¼Œåˆ›å»ºTopicæ—¶è®¾ç½®çš„å†™é˜Ÿåˆ—æ•°é‡ä¸º 8 ï¼Œè¯»é˜Ÿåˆ—æ•°é‡ä¸º 4 ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šåˆ›å»º 8 ä¸ªQueueï¼Œåˆ†åˆ«æ˜¯0 1 2 3 4 5 6 7ã€‚Producerä¼šå°†æ¶ˆæ¯å†™å…¥åˆ°è¿™ 8 ä¸ªé˜Ÿåˆ—ï¼Œä½†Consumeråªä¼šæ¶ˆè´¹0 1 2 3è¿™ 4 ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œ4 5 6 7 ä¸­çš„æ¶ˆæ¯æ˜¯ä¸ä¼šè¢«æ¶ˆè´¹åˆ°çš„ã€‚</p><p>å†å¦‚ï¼Œåˆ›å»ºTopicæ—¶è®¾ç½®çš„å†™é˜Ÿåˆ—æ•°é‡ä¸º 4 ï¼Œè¯»é˜Ÿåˆ—æ•°é‡ä¸º 8 ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šåˆ›å»º 8 ä¸ªQueueï¼Œåˆ†åˆ«æ˜¯0 1 2 3 4 5 6 7ã€‚Producerä¼šå°†æ¶ˆæ¯å†™å…¥åˆ°0 1 2 3 è¿™ 4 ä¸ªé˜Ÿåˆ—ï¼Œä½†Consumeråªä¼šæ¶ˆè´¹0 1 2 3 4 5 6 7è¿™ 8 ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œä½†æ˜¯4 5 6 7ä¸­æ˜¯æ²¡æœ‰æ¶ˆæ¯çš„ã€‚æ­¤æ—¶å‡è®¾Consumer Groupä¸­åŒ…å«ä¸¤ä¸ªConsumerï¼ŒConsumer1æ¶ˆè´¹0 1 2 3ï¼Œè€ŒConsumer2æ¶ˆè´¹4 5 6 7ã€‚ä½†å®é™…æƒ…å†µæ˜¯ï¼ŒConsumer2æ˜¯æ²¡æœ‰æ¶ˆæ¯å¯æ¶ˆè´¹çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¯»/å†™é˜Ÿåˆ—æ•°é‡è®¾ç½®ä¸åŒæ—¶ï¼Œæ€»æ˜¯æœ‰é—®é¢˜çš„ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡å‘¢ï¼Ÿ</p><p>å…¶è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†ï¼Œæ–¹ä¾¿Topicçš„Queueçš„ç¼©å®¹ã€‚</p><p>ä¾‹å¦‚ï¼ŒåŸæ¥åˆ›å»ºçš„Topicä¸­åŒ…å« 16 ä¸ªQueueï¼Œå¦‚ä½•èƒ½å¤Ÿä½¿å…¶Queueç¼©å®¹ä¸º 8 ä¸ªï¼Œè¿˜ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Ÿå¯ä»¥åŠ¨æ€ä¿®æ”¹å†™é˜Ÿåˆ—æ•°é‡ä¸º 8 ï¼Œè¯»é˜Ÿåˆ—æ•°é‡ä¸å˜ã€‚æ­¤æ—¶æ–°çš„æ¶ˆæ¯åªèƒ½å†™å…¥åˆ°å‰ 8 ä¸ªé˜Ÿåˆ—ï¼Œè€Œæ¶ˆè´¹éƒ½æ¶ˆè´¹çš„å´æ˜¯16 ä¸ªé˜Ÿåˆ—ä¸­çš„æ•°æ®ã€‚å½“å‘ç°å 8 ä¸ªQueueä¸­çš„æ¶ˆæ¯æ¶ˆè´¹å®Œæ¯•åï¼Œå°±å¯ä»¥å†å°†è¯»é˜Ÿåˆ—æ•°é‡åŠ¨æ€è®¾ç½®ä¸º 8 ã€‚æ•´ä¸ªç¼©å®¹è¿‡ç¨‹ï¼Œæ²¡æœ‰ä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚</p><p>permç”¨äºè®¾ç½®å¯¹å½“å‰åˆ›å»ºTopicçš„æ“ä½œæƒé™ï¼š 2 è¡¨ç¤ºåªå†™ï¼Œ 4 è¡¨ç¤ºåªè¯»ï¼Œ 6 è¡¨ç¤ºè¯»å†™ã€‚</p><h2 id="ä¸‰ã€å•æœºå®‰è£…ä¸å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å•æœºå®‰è£…ä¸å¯åŠ¨"><span>ä¸‰ã€å•æœºå®‰è£…ä¸å¯åŠ¨</span></a></h2><h3 id="_1-å‡†å¤‡å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#_1-å‡†å¤‡å·¥ä½œ"><span>1 å‡†å¤‡å·¥ä½œ</span></a></h3><h4 id="è½¯ç¡¬ä»¶éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#è½¯ç¡¬ä»¶éœ€æ±‚"><span>è½¯ç¡¬ä»¶éœ€æ±‚</span></a></h4><h4 id="ç³»ç»Ÿè¦æ±‚æ˜¯-64-ä½çš„-jdkè¦æ±‚æ˜¯1-8åŠå…¶ä»¥ä¸Šç‰ˆæœ¬çš„ã€‚" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿè¦æ±‚æ˜¯-64-ä½çš„-jdkè¦æ±‚æ˜¯1-8åŠå…¶ä»¥ä¸Šç‰ˆæœ¬çš„ã€‚"><span>ç³»ç»Ÿè¦æ±‚æ˜¯ 64 ä½çš„ï¼ŒJDKè¦æ±‚æ˜¯1.8åŠå…¶ä»¥ä¸Šç‰ˆæœ¬çš„ã€‚</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208110713.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>ä¸‹è½½RocketMQå®‰è£…åŒ…</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208110738.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>å°†ä¸‹è½½çš„å®‰è£…åŒ…ä¸Šä¼ åˆ°Linuxã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208110807.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>è§£å‹ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208110821.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_2-ã€ä¿®æ”¹åˆå§‹å†…å­˜" tabindex="-1"><a class="header-anchor" href="#_2-ã€ä¿®æ”¹åˆå§‹å†…å­˜"><span>2 ã€ä¿®æ”¹åˆå§‹å†…å­˜</span></a></h3><p>ä¿®æ”¹runserver.sh</p><p>ä½¿ç”¨vimå‘½ä»¤æ‰“å¼€bin/runserver.shæ–‡ä»¶ã€‚ç°å°†è¿™äº›å€¼ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208110900.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>ä¿®æ”¹runbroker.sh</p><p>ä½¿ç”¨vimå‘½ä»¤æ‰“å¼€bin/runbroker.shæ–‡ä»¶ã€‚ç°å°†è¿™äº›å€¼ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208110924.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_3-ã€å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_3-ã€å¯åŠ¨"><span>3 ã€å¯åŠ¨</span></a></h3><p>å¯åŠ¨NameServer</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqnamesrv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/logs/rocketmqlogs/namesrv.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111000.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p><code>å¦‚æœå‡ºç°mqå¯åŠ¨æŠ¥é”™ERROR: Please set the JAVA_HOME variable in your environment, We need java(x64)! !!</code></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/jdk1.8.0_191/bin/javac</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/bin/javac</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  /usr/local/jdk1.8.0_191/bin/jar</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/bin/jar</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/jdk1.8.0_191/bin/java</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /bin/java</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨broker</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqbroker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost:9876</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/logs/rocketmqlogs/broker.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111020.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_4-ã€å‘é€-æ¥æ”¶æ¶ˆæ¯æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-ã€å‘é€-æ¥æ”¶æ¶ˆæ¯æµ‹è¯•"><span>4 ã€å‘é€/æ¥æ”¶æ¶ˆæ¯æµ‹è¯•</span></a></h3><h4 id="å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å‘é€æ¶ˆæ¯"><span>å‘é€æ¶ˆæ¯</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NAMESRV_ADDR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">9876</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/tools.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> org.apache.rocketmq.example.quickstart.Producer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ¥æ”¶æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æ¥æ”¶æ¶ˆæ¯"><span>æ¥æ”¶æ¶ˆæ¯</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/tools.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> org.apache.rocketmq.example.quickstart.Consumer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-ã€å…³é—­server" tabindex="-1"><a class="header-anchor" href="#_5-ã€å…³é—­server"><span>5 ã€å…³é—­Server</span></a></h3><p>æ— è®ºæ˜¯å…³é—­name serverè¿˜æ˜¯brokerï¼Œéƒ½æ˜¯ä½¿ç”¨bin/mqshutdownå‘½ä»¤ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@mqOS rocketmq]# sh bin/mqshutdown broker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mqbroker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1740</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> running...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Send</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> shutdown</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> request</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mqbroker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1740</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">OK</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@mqOS rocketmq]# sh bin/mqshutdown namesrv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mqnamesrv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1692</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> running...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Send</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> shutdown</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> request</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mqnamesrv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1692</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">OK</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[2]+ é€€å‡º 143 nohup sh bin/mqbroker -n localhost:9876</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å››ã€-æ§åˆ¶å°çš„å®‰è£…ä¸å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#å››ã€-æ§åˆ¶å°çš„å®‰è£…ä¸å¯åŠ¨"><span>å››ã€ æ§åˆ¶å°çš„å®‰è£…ä¸å¯åŠ¨</span></a></h2><p>RocketMQæœ‰ä¸€ä¸ªå¯è§†åŒ–çš„dashboardï¼Œé€šè¿‡è¯¥æ§åˆ¶å°å¯ä»¥ç›´è§‚çš„æŸ¥çœ‹åˆ°å¾ˆå¤šæ•°æ®ã€‚</p><h3 id="_1-ä¸‹è½½" tabindex="-1"><a class="header-anchor" href="#_1-ä¸‹è½½"><span>1 ä¸‹è½½</span></a></h3><p>ä¸‹è½½åœ°å€ï¼šhttps://github.com/apache/rocketmq-externals/releases</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111255.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_2-ä¿®æ”¹é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-ä¿®æ”¹é…ç½®"><span>2 ä¿®æ”¹é…ç½®</span></a></h3><p>ä¿®æ”¹å…¶src/main/resourcesä¸­çš„application.propertiesé…ç½®æ–‡ä»¶ã€‚</p><ul><li>åŸæ¥çš„ç«¯å£å·ä¸º 8080 ï¼Œä¿®æ”¹ä¸ºä¸€ä¸ªä¸å¸¸ç”¨çš„</li><li>æŒ‡å®šRocketMQçš„name serveråœ°å€</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111351.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_3-æ·»åŠ ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_3-æ·»åŠ ä¾èµ–"><span>3 æ·»åŠ ä¾èµ–</span></a></h3><p>åœ¨è§£å‹ç›®å½•rocketmq-consoleçš„pom.xmlä¸­æ·»åŠ å¦‚ä¸‹JAXBä¾èµ–ã€‚</p><blockquote><p>JAXBï¼ŒJava Architechture for Xml Bindingï¼Œç”¨äºXMLç»‘å®šçš„JavaæŠ€æœ¯ï¼Œæ˜¯ä¸€ä¸ªä¸šç•Œæ ‡å‡†ï¼Œæ˜¯ä¸€é¡¹å¯ä»¥æ ¹æ®XML Schemaç”ŸæˆJavaç±»çš„æŠ€æœ¯ã€‚</p></blockquote><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;javax.xml.bind&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;jaxb-api&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;2.3.0&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;com.sun.xml.bind&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;jaxb-impl&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;2.3.0&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;com.sun.xml.bind&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;jaxb-core&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;2.3.0&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;javax.activation&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;activation&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;1.1.1&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-æ‰“åŒ…" tabindex="-1"><a class="header-anchor" href="#_4-æ‰“åŒ…"><span>4 æ‰“åŒ…</span></a></h3><p>åœ¨rocketmq-consoleç›®å½•ä¸‹è¿è¡Œmavençš„æ‰“åŒ…å‘½ä»¤ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111536.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111646.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_5-å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_5-å¯åŠ¨"><span>5 å¯åŠ¨</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111700.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_6-è®¿é—®" tabindex="-1"><a class="header-anchor" href="#_6-è®¿é—®"><span>6 è®¿é—®</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111724.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h2 id="äº”ã€é›†ç¾¤æ­å»ºç†è®º" tabindex="-1"><a class="header-anchor" href="#äº”ã€é›†ç¾¤æ­å»ºç†è®º"><span>äº”ã€é›†ç¾¤æ­å»ºç†è®º</span></a></h2><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111755.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_1-æ•°æ®å¤åˆ¶ä¸åˆ·ç›˜ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_1-æ•°æ®å¤åˆ¶ä¸åˆ·ç›˜ç­–ç•¥"><span>1 æ•°æ®å¤åˆ¶ä¸åˆ·ç›˜ç­–ç•¥</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208111822.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="å¤åˆ¶ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶ç­–ç•¥"><span>å¤åˆ¶ç­–ç•¥</span></a></h4><p>å¤åˆ¶ç­–ç•¥æ˜¯Brokerçš„Masterä¸Slaveé—´çš„æ•°æ®åŒæ­¥æ–¹å¼ã€‚åˆ†ä¸ºåŒæ­¥å¤åˆ¶ä¸å¼‚æ­¥å¤åˆ¶ï¼š</p><ul><li>åŒæ­¥å¤åˆ¶ï¼šæ¶ˆæ¯å†™å…¥masteråï¼Œmasterä¼šç­‰å¾…slaveåŒæ­¥æ•°æ®æˆåŠŸåæ‰å‘producerè¿”å›æˆåŠŸACK</li><li>å¼‚æ­¥å¤åˆ¶ï¼šæ¶ˆæ¯å†™å…¥masteråï¼Œmasterç«‹å³å‘producerè¿”å›æˆåŠŸACKï¼Œæ— éœ€ç­‰å¾…slaveåŒæ­¥æ•°æ®æˆåŠŸ</li></ul><blockquote><p>å¼‚æ­¥å¤åˆ¶ç­–ç•¥ä¼šé™ä½ç³»ç»Ÿçš„å†™å…¥å»¶è¿Ÿï¼ŒRTå˜å°ï¼Œæé«˜äº†ç³»ç»Ÿçš„ååé‡</p></blockquote><h4 id="åˆ·ç›˜ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#åˆ·ç›˜ç­–ç•¥"><span>åˆ·ç›˜ç­–ç•¥</span></a></h4><p>åˆ·ç›˜ç­–ç•¥æŒ‡çš„æ˜¯brokerä¸­æ¶ˆæ¯çš„è½ç›˜æ–¹å¼ï¼Œå³æ¶ˆæ¯å‘é€åˆ°brokerå†…å­˜åæ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ–¹å¼ã€‚åˆ†ä¸ºåŒæ­¥åˆ·ç›˜ä¸å¼‚æ­¥åˆ·ç›˜.</p><ul><li>åŒæ­¥åˆ·ç›˜ï¼šå½“æ¶ˆæ¯æŒä¹…åŒ–åˆ°brokerçš„ç£ç›˜åæ‰ç®—æ˜¯æ¶ˆæ¯å†™å…¥æˆåŠŸã€‚</li><li>å¼‚æ­¥åˆ·ç›˜ï¼šå½“æ¶ˆæ¯å†™å…¥åˆ°brokerçš„å†…å­˜åå³è¡¨ç¤ºæ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œæ— éœ€ç­‰å¾…æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li></ul><blockquote><p>1 ï¼‰å¼‚æ­¥åˆ·ç›˜ç­–ç•¥ä¼šé™ä½ç³»ç»Ÿçš„å†™å…¥å»¶è¿Ÿï¼ŒRTå˜å°ï¼Œæé«˜äº†ç³»ç»Ÿçš„ååé‡ 2 ï¼‰æ¶ˆæ¯å†™å…¥åˆ°Brokerçš„å†…å­˜ï¼Œä¸€èˆ¬æ˜¯å†™å…¥åˆ°äº†PageCache 3 ï¼‰å¯¹äºå¼‚æ­¥ åˆ·ç›˜ç­–ç•¥ï¼Œæ¶ˆæ¯ä¼šå†™å…¥åˆ°PageCacheåç«‹å³è¿”å›æˆåŠŸACKã€‚ä½†å¹¶ä¸ä¼šç«‹å³åšè½ç›˜æ“ä½œï¼Œè€Œæ˜¯å½“PageCacheåˆ°è¾¾ä¸€å®šé‡æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œè½ç›˜ã€‚</p></blockquote><h3 id="_2-brokeré›†ç¾¤æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-brokeré›†ç¾¤æ¨¡å¼"><span>2 Brokeré›†ç¾¤æ¨¡å¼</span></a></h3><p>æ ¹æ®Brokeré›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹é—´å…³ç³»çš„ä¸åŒï¼ŒBrokeré›†ç¾¤å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p><h4 id="å•master" tabindex="-1"><a class="header-anchor" href="#å•master"><span>å•Master</span></a></h4><p>åªæœ‰ä¸€ä¸ªbrokerï¼ˆå…¶æœ¬è´¨ä¸Šå°±ä¸èƒ½ç§°ä¸ºé›†ç¾¤ï¼‰ã€‚è¿™ç§æ–¹å¼ä¹Ÿåªèƒ½æ˜¯åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹ä¸èƒ½ä½¿ç”¨ï¼Œå› ä¸ºå­˜åœ¨å•ç‚¹é—®é¢˜ã€‚</p><h4 id="å¤šmaster" tabindex="-1"><a class="header-anchor" href="#å¤šmaster"><span>å¤šMaster</span></a></h4><p>brokeré›†ç¾¤ä»…ç”±å¤šä¸ªmasteræ„æˆï¼Œä¸å­˜åœ¨Slaveã€‚åŒä¸€Topicçš„å„ä¸ªQueueä¼šå¹³å‡åˆ†å¸ƒåœ¨å„ä¸ªmasterèŠ‚ç‚¹ä¸Šã€‚</p><ul><li>ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œå•ä¸ªMasterå®•æœºæˆ–é‡å¯ç»´æŠ¤å¯¹åº”ç”¨æ— å½±å“ï¼Œåœ¨ç£ç›˜é…ç½®ä¸ºRAID10æ—¶ï¼Œå³ä½¿æœºå™¨å®•æœºä¸å¯æ¢å¤æƒ…å†µä¸‹ï¼Œç”±äºRAID10ç£ç›˜éå¸¸å¯é ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢ï¼ˆå¼‚æ­¥åˆ·ç›˜ä¸¢å¤±å°‘é‡æ¶ˆæ¯ï¼ŒåŒæ­¥åˆ·ç›˜ä¸€æ¡ä¸ä¸¢ï¼‰ï¼Œæ€§èƒ½æœ€é«˜ï¼›</li><li>ç¼ºç‚¹ï¼šå•å°æœºå™¨å®•æœºæœŸé—´ï¼Œè¿™å°æœºå™¨ä¸Šæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨æœºå™¨æ¢å¤ä¹‹å‰ä¸å¯è®¢é˜…ï¼ˆä¸å¯æ¶ˆè´¹ï¼‰ï¼Œæ¶ˆæ¯å®æ—¶æ€§ä¼šå—åˆ°å½±å“ã€‚</li></ul><blockquote><p>ä»¥ä¸Šä¼˜ç‚¹çš„å‰ææ˜¯ï¼Œè¿™äº›Masteréƒ½é…ç½®äº†RAIDç£ç›˜é˜µåˆ—ã€‚å¦‚æœæ²¡æœ‰é…ç½®ï¼Œä¸€æ—¦å‡ºç°æŸMasterå®•æœºï¼Œåˆ™ä¼šå‘ç”Ÿå¤§é‡æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚</p></blockquote><h4 id="å¤šmasterå¤šslaveæ¨¡å¼-å¼‚æ­¥å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#å¤šmasterå¤šslaveæ¨¡å¼-å¼‚æ­¥å¤åˆ¶"><span>å¤šMasterå¤šSlaveæ¨¡å¼-å¼‚æ­¥å¤åˆ¶</span></a></h4><p>brokeré›†ç¾¤ç”±å¤šä¸ªmasteræ„æˆï¼Œæ¯ä¸ªmasteråˆé…ç½®äº†å¤šä¸ªslaveï¼ˆåœ¨é…ç½®äº†RAIDç£ç›˜é˜µåˆ—çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªmasterä¸€èˆ¬é…ç½®ä¸€ä¸ªslaveå³å¯ï¼‰ã€‚masterä¸slaveçš„å…³ç³»æ˜¯ä¸»å¤‡å…³ç³»ï¼Œå³masterè´Ÿè´£å¤„ç†æ¶ˆæ¯çš„è¯»å†™è¯·æ±‚ï¼Œè€Œslaveä»…è´Ÿè´£æ¶ˆæ¯çš„å¤‡ä»½ä¸masterå®•æœºåçš„è§’è‰²åˆ‡æ¢ã€‚</p><p>å¼‚æ­¥å¤åˆ¶å³å‰é¢æ‰€è®²çš„<code>å¤åˆ¶ç­–ç•¥</code>ä¸­çš„<code>å¼‚æ­¥å¤åˆ¶ç­–ç•¥</code>ï¼Œå³æ¶ˆæ¯å†™å…¥masteræˆåŠŸåï¼Œmasterç«‹å³å‘producerè¿”å›æˆåŠŸACKï¼Œæ— éœ€ç­‰å¾…slaveåŒæ­¥æ•°æ®æˆåŠŸã€‚</p><p>è¯¥æ¨¡å¼çš„æœ€å¤§ç‰¹ç‚¹ä¹‹ä¸€æ˜¯ï¼Œå½“masterå®•æœºåslaveèƒ½å¤Ÿ<code>è‡ªåŠ¨åˆ‡æ¢</code>ä¸ºmasterã€‚ä¸è¿‡ç”±äºslaveä»masterçš„åŒæ­¥å…·æœ‰çŸ­æš‚çš„å»¶è¿Ÿï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œæ‰€ä»¥å½“masterå®•æœºåï¼Œè¿™ç§å¼‚æ­¥å¤åˆ¶æ–¹å¼å¯èƒ½ä¼šå­˜åœ¨å°‘é‡æ¶ˆæ¯çš„ä¸¢å¤±é—®é¢˜ã€‚</p><blockquote><p>Slaveä»MasteråŒæ­¥çš„å»¶è¿Ÿè¶ŠçŸ­ï¼Œå…¶å¯èƒ½ä¸¢å¤±çš„æ¶ˆæ¯å°±è¶Šå°‘ å¯¹äºMasterçš„RAIDç£ç›˜é˜µåˆ—ï¼Œè‹¥ä½¿ç”¨çš„ä¹Ÿæ˜¯å¼‚æ­¥å¤åˆ¶ç­–ç•¥ï¼ŒåŒæ ·ä¹Ÿå­˜åœ¨å»¶è¿Ÿé—®é¢˜ï¼ŒåŒæ ·ä¹Ÿå¯èƒ½ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚ä½†RAIDé˜µåˆ—çš„ç§˜è¯€æ˜¯å¾®ç§’çº§çš„ï¼ˆå› ä¸ºæ˜¯ç”±ç¡¬ç›˜æ”¯æŒçš„ï¼‰ï¼Œæ‰€ä»¥å…¶ä¸¢å¤±çš„æ•°æ®é‡ä¼šæ›´å°‘ã€‚</p></blockquote><h4 id="å¤šmasterå¤šslaveæ¨¡å¼-åŒæ­¥åŒå†™" tabindex="-1"><a class="header-anchor" href="#å¤šmasterå¤šslaveæ¨¡å¼-åŒæ­¥åŒå†™"><span>å¤šMasterå¤šSlaveæ¨¡å¼-åŒæ­¥åŒå†™</span></a></h4><p>è¯¥æ¨¡å¼æ˜¯<code>å¤šMasterå¤šSlaveæ¨¡å¼</code>çš„<code>åŒæ­¥å¤åˆ¶</code>å®ç°ã€‚æ‰€è°“<code>åŒæ­¥åŒå†™</code>ï¼ŒæŒ‡çš„æ˜¯æ¶ˆæ¯å†™å…¥masteræˆåŠŸåï¼Œmasterä¼šç­‰å¾…slaveåŒæ­¥æ•°æ®æˆåŠŸåæ‰å‘producerè¿”å›æˆåŠŸACKï¼Œå³masterä¸slaveéƒ½è¦å†™å…¥æˆåŠŸåæ‰ä¼šè¿”å›æˆåŠŸACKï¼Œä¹Ÿå³<code>åŒå†™</code>ã€‚è¯¥æ¨¡å¼ä¸<code>å¼‚æ­¥å¤åˆ¶æ¨¡å¼ç›¸æ¯”</code>ï¼Œä¼˜ç‚¹æ˜¯æ¶ˆæ¯çš„å®‰å…¨æ€§æ›´é«˜ï¼Œä¸å­˜åœ¨æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚ä½†å•ä¸ªæ¶ˆæ¯çš„RTç•¥é«˜ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½è¦ç•¥ä½ï¼ˆå¤§çº¦ä½10%ï¼‰ã€‚</p><p>è¯¥æ¨¡å¼å­˜åœ¨ä¸€ä¸ªå¤§çš„é—®é¢˜ï¼šå¯¹äºç›®å‰çš„ç‰ˆæœ¬ï¼ŒMasterå®•æœºåï¼ŒSlave<code>ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢</code>åˆ°Masterã€‚</p><h4 id="æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#æœ€ä½³å®è·µ"><span>æœ€ä½³å®è·µ</span></a></h4><p>ä¸€èˆ¬ä¼šä¸ºMasteré…ç½®RAID10ç£ç›˜é˜µåˆ—ï¼Œç„¶åå†ä¸ºå…¶é…ç½®ä¸€ä¸ªSlaveã€‚å³åˆ©ç”¨äº†RAID10ç£ç›˜é˜µåˆ—çš„é«˜æ•ˆã€å®‰å…¨æ€§ï¼Œåˆè§£å†³äº†å¯èƒ½ä¼šå½±å“è®¢é˜…çš„é—®é¢˜ã€‚</p><blockquote><p>1 ï¼‰RAIDç£ç›˜é˜µåˆ—çš„æ•ˆç‡è¦é«˜äºMaster-Slaveé›†ç¾¤ã€‚å› ä¸ºRAIDæ˜¯ç¡¬ä»¶æ”¯æŒçš„ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œæ‰€ä»¥RAIDé˜µåˆ—çš„æ­å»ºæˆæœ¬è¾ƒé«˜ã€‚ 2 ï¼‰å¤šMaster+RAIDé˜µåˆ—ï¼Œä¸å¤šMasterå¤šSlaveé›†ç¾¤çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ 1.å¤šMaster+RAIDé˜µåˆ—ï¼Œå…¶ä»…ä»…å¯ä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œå³ä¸å½±å“æ¶ˆæ¯å†™å…¥ï¼Œä½†å…¶å¯èƒ½ä¼šå½±å“åˆ°æ¶ˆæ¯çš„è®¢é˜…ã€‚ä½†å…¶æ‰§è¡Œæ•ˆç‡è¦è¿œé«˜äº<code>å¤šMasterå¤šSlaveé›†ç¾¤</code> 2.å¤šMasterå¤šSlaveé›†ç¾¤ï¼Œå…¶ä¸ä»…å¯ä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šå½±å“æ¶ˆæ¯å†™å…¥ã€‚å…¶è¿è¡Œæ•ˆç‡è¦ä½äº<code>å¤šMaster+RAIDé˜µåˆ—</code></p></blockquote><h2 id="å…­ã€ç£ç›˜é˜µåˆ—raid-è¡¥å……" tabindex="-1"><a class="header-anchor" href="#å…­ã€ç£ç›˜é˜µåˆ—raid-è¡¥å……"><span>å…­ã€ç£ç›˜é˜µåˆ—RAIDï¼ˆè¡¥å……ï¼‰</span></a></h2><h3 id="_1-raidå†å²" tabindex="-1"><a class="header-anchor" href="#_1-raidå†å²"><span>1 RAIDå†å²</span></a></h3><p>1988 å¹´ç¾å›½åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„ D. A. Patterson æ•™æˆç­‰é¦–æ¬¡åœ¨è®ºæ–‡ â€œA Case of Redundant Array of Inexpensive Disksâ€ ä¸­æå‡ºäº† RAID æ¦‚å¿µ ï¼Œå³<code>å»‰ä»·å†—ä½™ç£ç›˜é˜µåˆ—</code>ï¼ˆ Redundant Array of Inexpensive Disks ï¼‰ã€‚ç”±äºå½“æ—¶å¤§å®¹é‡ç£ç›˜æ¯”è¾ƒæ˜‚è´µï¼Œ RAID çš„åŸºæœ¬æ€æƒ³æ˜¯å°†å¤šä¸ªå®¹é‡è¾ƒå°ã€ç›¸å¯¹å»‰ä»·çš„ç£ç›˜è¿›è¡Œæœ‰æœºç»„åˆï¼Œä»è€Œä»¥è¾ƒä½çš„æˆæœ¬è·å¾—ä¸æ˜‚è´µå¤§å®¹é‡ç£ç›˜ç›¸å½“çš„å®¹é‡ã€æ€§èƒ½ã€å¯é æ€§ã€‚éšç€ç£ç›˜æˆæœ¬å’Œä»·æ ¼çš„ä¸æ–­é™ä½ï¼Œ â€œå»‰ä»·â€ å·²ç»æ¯«æ— æ„ä¹‰ã€‚å› æ­¤ï¼Œ RAID å’¨è¯¢å§”å‘˜ä¼šï¼ˆ RAID Advisory Board, RAB ï¼‰å†³å®šç”¨â€œ ç‹¬ç«‹ â€ æ›¿ä»£ â€œ å»‰ä»· â€ ï¼Œäºæ—¶ RAID å˜æˆäº†<code>ç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ—</code>ï¼ˆ Redundant Array of Independent Disks ï¼‰ã€‚ä½†è¿™ä»…ä»…æ˜¯åç§°çš„å˜åŒ–ï¼Œå®è´¨å†…å®¹æ²¡æœ‰æ”¹å˜ã€‚</p><p>å†…å­˜ï¼š32m 6.4Gï¼ˆIBM 10.1Gï¼‰</p><h3 id="_2-raidç­‰çº§" tabindex="-1"><a class="header-anchor" href="#_2-raidç­‰çº§"><span>2 RAIDç­‰çº§</span></a></h3><p>RAID è¿™ç§è®¾è®¡æ€æƒ³å¾ˆå¿«è¢«ä¸šç•Œæ¥çº³ï¼Œ RAID æŠ€æœ¯ä½œä¸ºé«˜æ€§èƒ½ã€é«˜å¯é çš„å­˜å‚¨æŠ€æœ¯ï¼Œå¾—åˆ°äº†éå¸¸å¹¿æ³›çš„åº”ç”¨ã€‚ RAID ä¸»è¦åˆ©ç”¨é•œåƒã€æ•°æ®æ¡å¸¦å’Œæ•°æ®æ ¡éªŒä¸‰ç§æŠ€æœ¯æ¥è·å–é«˜æ€§èƒ½ã€å¯é æ€§ã€å®¹é”™èƒ½åŠ›å’Œæ‰©å±•æ€§ï¼Œæ ¹æ®å¯¹è¿™ä¸‰ç§æŠ€æœ¯çš„ä½¿ç”¨ç­–ç•¥å’Œç»„åˆæ¶æ„ï¼Œå¯ä»¥æŠŠ RAID åˆ†ä¸ºä¸åŒçš„ç­‰çº§ï¼Œä»¥æ»¡è¶³ä¸åŒæ•°æ®åº”ç”¨çš„éœ€æ±‚ã€‚</p><p>D. A. Patterson ç­‰çš„è®ºæ–‡ä¸­å®šä¹‰äº† RAID0 ~ RAID6 åŸå§‹ RAID ç­‰çº§ã€‚éšåå­˜å‚¨å‚å•†åˆä¸æ–­æ¨å‡º RAID7ã€ RAID10ã€RAID01 ã€ RAID50 ã€ RAID53 ã€ RAID100 ç­‰ RAID ç­‰çº§ï¼Œä½†è¿™äº›å¹¶æ— ç»Ÿä¸€çš„æ ‡å‡†ã€‚ç›®å‰ä¸šç•Œä¸å­¦æœ¯ç•Œå…¬è®¤çš„æ ‡å‡†æ˜¯ RAID0 ~ RAID6 ï¼Œè€Œåœ¨å®é™…åº”ç”¨é¢†åŸŸä¸­ä½¿ç”¨æœ€å¤šçš„ RAID ç­‰çº§æ˜¯ RAID0 ã€RAID1 ã€ RAID3 ã€ RAID5 ã€ RAID6 å’Œ RAID10ã€‚</p><p>RAID æ¯ä¸€ä¸ªç­‰çº§ä»£è¡¨ä¸€ç§å®ç°æ–¹æ³•å’ŒæŠ€æœ¯ï¼Œç­‰çº§ä¹‹é—´å¹¶æ— é«˜ä½ä¹‹åˆ†ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”å½“æ ¹æ®ç”¨æˆ·çš„æ•°æ®åº”ç”¨ç‰¹ç‚¹ï¼Œç»¼åˆè€ƒè™‘å¯ç”¨æ€§ã€æ€§èƒ½å’Œæˆæœ¬æ¥é€‰æ‹©åˆé€‚çš„ RAID ç­‰çº§ï¼Œä»¥åŠå…·ä½“çš„å®ç°æ–¹å¼ã€‚</p><h3 id="_3-å…³é”®æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#_3-å…³é”®æŠ€æœ¯"><span>3 å…³é”®æŠ€æœ¯</span></a></h3><h4 id="é•œåƒæŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#é•œåƒæŠ€æœ¯"><span>é•œåƒæŠ€æœ¯</span></a></h4><p>é•œåƒæŠ€æœ¯æ˜¯ä¸€ç§å†—ä½™æŠ€æœ¯ï¼Œä¸ºç£ç›˜æä¾›æ•°æ®å¤‡ä»½åŠŸèƒ½ï¼Œé˜²æ­¢ç£ç›˜å‘ç”Ÿæ•…éšœè€Œé€ æˆæ•°æ®ä¸¢å¤±ã€‚å¯¹äº RAIDè€Œè¨€ï¼Œé‡‡ç”¨é•œåƒæŠ€æœ¯æœ€å…¸å‹åœ°çš„ç”¨æ³•å°±æ˜¯ï¼ŒåŒæ—¶åœ¨ç£ç›˜é˜µåˆ—ä¸­äº§ç”Ÿä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”åˆ†å¸ƒåœ¨ä¸¤ä¸ªä¸åŒçš„ç£ç›˜ä¸Šã€‚é•œåƒæä¾›äº†å®Œå…¨çš„æ•°æ®å†—ä½™èƒ½åŠ›ï¼Œå½“ä¸€ä¸ªæ•°æ®å‰¯æœ¬å¤±æ•ˆä¸å¯ç”¨æ—¶ï¼Œå¤–éƒ¨ç³»ç»Ÿä»å¯æ­£å¸¸è®¿é—®å¦ä¸€å‰¯æœ¬ï¼Œä¸ä¼šå¯¹åº”ç”¨ç³»ç»Ÿè¿è¡Œå’Œæ€§èƒ½äº§ç”Ÿå½±å“ã€‚è€Œä¸”ï¼Œé•œåƒä¸éœ€è¦é¢å¤–çš„è®¡ç®—å’Œæ ¡éªŒï¼Œæ•…éšœä¿®å¤éå¸¸å¿«ï¼Œç›´æ¥å¤åˆ¶å³å¯ã€‚é•œåƒæŠ€æœ¯å¯ä»¥ä»å¤šä¸ªå‰¯æœ¬è¿›è¡Œå¹¶å‘è¯»å–æ•°æ®ï¼Œæä¾›æ›´é«˜çš„è¯» I/O æ€§èƒ½ï¼Œä½†ä¸èƒ½å¹¶è¡Œå†™æ•°æ®ï¼Œå†™å¤šä¸ªå‰¯æœ¬é€šå¸¸ä¼šå¯¼è‡´ä¸€å®šçš„ I/O æ€§èƒ½ä¸‹é™ã€‚</p><p>é•œåƒæŠ€æœ¯æä¾›äº†éå¸¸é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œå…¶ä»£ä»·ä¹Ÿæ˜¯éå¸¸æ˜‚è´µçš„ï¼Œéœ€è¦è‡³å°‘åŒå€çš„å­˜å‚¨ç©ºé—´ã€‚é«˜æˆæœ¬é™åˆ¶äº†é•œåƒçš„å¹¿æ³›åº”ç”¨ï¼Œä¸»è¦åº”ç”¨äºè‡³å…³é‡è¦çš„æ•°æ®ä¿æŠ¤ï¼Œè¿™ç§åœºåˆä¸‹çš„æ•°æ®ä¸¢å¤±å¯èƒ½ä¼šé€ æˆéå¸¸å·¨å¤§çš„æŸå¤±ã€‚</p><h4 id="æ•°æ®æ¡å¸¦æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æ¡å¸¦æŠ€æœ¯"><span>æ•°æ®æ¡å¸¦æŠ€æœ¯</span></a></h4><p>æ•°æ®æ¡å¸¦åŒ–æŠ€æœ¯æ˜¯ä¸€ç§è‡ªåŠ¨å°† I/Oæ“ä½œè´Ÿè½½å‡è¡¡åˆ°å¤šä¸ªç‰©ç†ç£ç›˜ä¸Šçš„æŠ€æœ¯ã€‚æ›´å…·ä½“åœ°è¯´å°±æ˜¯ï¼Œå°†ä¸€å—è¿ç»­çš„æ•°æ®åˆ†æˆå¾ˆå¤šå°éƒ¨åˆ†å¹¶æŠŠå®ƒä»¬åˆ†åˆ«å­˜å‚¨åˆ°ä¸åŒç£ç›˜ä¸Šã€‚è¿™å°±èƒ½ä½¿å¤šä¸ªè¿›ç¨‹å¯ä»¥å¹¶å‘è®¿é—®æ•°æ®çš„å¤šä¸ªä¸åŒéƒ¨åˆ†ï¼Œä»è€Œè·å¾—æœ€å¤§ç¨‹åº¦ä¸Šçš„ I/O å¹¶è¡Œèƒ½åŠ›ï¼Œæå¤§åœ°æå‡æ€§èƒ½ã€‚</p><h4 id="æ•°æ®æ ¡éªŒæŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æ ¡éªŒæŠ€æœ¯"><span>æ•°æ®æ ¡éªŒæŠ€æœ¯</span></a></h4><p>æ•°æ®æ ¡éªŒæŠ€æœ¯æ˜¯æŒ‡ï¼Œ RAID è¦åœ¨å†™å…¥æ•°æ®çš„åŒæ—¶è¿›è¡Œæ ¡éªŒè®¡ç®—ï¼Œå¹¶å°†å¾—åˆ°çš„æ ¡éªŒæ•°æ®å­˜å‚¨åœ¨ RAID æˆå‘˜ç£ç›˜ä¸­ã€‚æ ¡éªŒæ•°æ®å¯ä»¥é›†ä¸­ä¿å­˜åœ¨æŸä¸ªç£ç›˜æˆ–åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªä¸åŒç£ç›˜ä¸­ã€‚å½“å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®å‡ºé”™æ—¶ï¼Œå°±å¯ä»¥å¯¹å‰©ä½™æ•°æ®å’Œæ ¡éªŒæ•°æ®è¿›è¡Œåæ ¡éªŒè®¡ç®—é‡å»ºä¸¢å¤±çš„æ•°æ®ã€‚</p><p>æ•°æ®æ ¡éªŒæŠ€æœ¯ç›¸å¯¹äºé•œåƒæŠ€æœ¯çš„ä¼˜åŠ¿åœ¨äºèŠ‚çœå¤§é‡å¼€é”€ï¼Œä½†ç”±äºæ¯æ¬¡æ•°æ®è¯»å†™éƒ½è¦è¿›è¡Œå¤§é‡çš„æ ¡éªŒè¿ç®—ï¼Œå¯¹è®¡ç®—æœºçš„è¿ç®—é€Ÿåº¦è¦æ±‚å¾ˆé«˜ï¼Œä¸”å¿…é¡»ä½¿ç”¨ç¡¬ä»¶ RAID æ§åˆ¶å™¨ã€‚åœ¨æ•°æ®é‡å»ºæ¢å¤æ–¹é¢ï¼Œæ£€éªŒæŠ€æœ¯æ¯”é•œåƒæŠ€æœ¯å¤æ‚å¾—å¤šä¸”æ…¢å¾—å¤šã€‚</p><h3 id="_4-raidåˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#_4-raidåˆ†ç±»"><span>4 RAIDåˆ†ç±»</span></a></h3><p>ä»å®ç°è§’åº¦çœ‹ï¼Œ RAID ä¸»è¦åˆ†ä¸ºè½¯ RAIDã€ç¡¬ RAID ä»¥åŠæ··åˆ RAID ä¸‰ç§ã€‚</p><h4 id="è½¯-raid" tabindex="-1"><a class="header-anchor" href="#è½¯-raid"><span>è½¯ RAID</span></a></h4><p>æ‰€æœ‰åŠŸèƒ½å‡æœ‰æ“ä½œç³»ç»Ÿå’Œ CPU æ¥å®Œæˆï¼Œæ²¡æœ‰ç‹¬ç«‹çš„ RAID æ§åˆ¶å¤„ç†èŠ¯ç‰‡å’Œ I/O å¤„ç†èŠ¯ç‰‡ï¼Œæ•ˆç‡è‡ªç„¶æœ€ä½ã€‚</p><h4 id="ç¡¬-raid" tabindex="-1"><a class="header-anchor" href="#ç¡¬-raid"><span>ç¡¬ RAID</span></a></h4><p>é…å¤‡äº†ä¸“é—¨çš„ RAID æ§åˆ¶å¤„ç†èŠ¯ç‰‡å’Œ I/O å¤„ç†èŠ¯ç‰‡ä»¥åŠé˜µåˆ—ç¼“å†²ï¼Œä¸å ç”¨ CPU èµ„æºã€‚æ•ˆç‡å¾ˆé«˜ï¼Œä½†æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚</p><h4 id="æ··åˆ-raid" tabindex="-1"><a class="header-anchor" href="#æ··åˆ-raid"><span>æ··åˆ RAID</span></a></h4><p>å…·å¤‡ RAID æ§åˆ¶å¤„ç†èŠ¯ç‰‡ï¼Œä½†æ²¡æœ‰ä¸“é—¨çš„I/O å¤„ç†èŠ¯ç‰‡ï¼Œéœ€è¦ CPU å’Œé©±åŠ¨ç¨‹åºæ¥å®Œæˆã€‚æ€§èƒ½å’Œæˆæœ¬åœ¨è½¯RAID å’Œç¡¬ RAID ä¹‹é—´ã€‚</p><h3 id="_5-å¸¸è§raidç­‰çº§è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_5-å¸¸è§raidç­‰çº§è¯¦è§£"><span>5 å¸¸è§RAIDç­‰çº§è¯¦è§£</span></a></h3><h4 id="jbod" tabindex="-1"><a class="header-anchor" href="#jbod"><span>JBOD</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208113559.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>JBOD ï¼ŒJust a Bunch of Disksï¼Œç£ç›˜ç°‡ã€‚è¡¨ç¤ºä¸€ä¸ªæ²¡æœ‰æ§åˆ¶è½¯ä»¶æä¾›åè°ƒæ§åˆ¶çš„ç£ç›˜é›†åˆï¼Œè¿™æ˜¯ RAIDåŒºåˆ«ä¸ JBOD çš„ä¸»è¦å› ç´ ã€‚ JBOD å°†å¤šä¸ªç‰©ç†ç£ç›˜ä¸²è”èµ·æ¥ï¼Œæä¾›ä¸€ä¸ªå·¨å¤§çš„é€»è¾‘ç£ç›˜ã€‚</p><p>JBOD çš„æ•°æ®å­˜æ”¾æœºåˆ¶æ˜¯ç”±ç¬¬ä¸€å—ç£ç›˜å¼€å§‹æŒ‰é¡ºåºå¾€åå­˜å‚¨ï¼Œå½“å‰ç£ç›˜å­˜å‚¨ç©ºé—´ç”¨å®Œåï¼Œå†ä¾æ¬¡å¾€åé¢çš„ç£ç›˜å­˜å‚¨æ•°æ®ã€‚ JBOD å­˜å‚¨æ€§èƒ½å®Œå…¨ç­‰åŒäºå•å—ç£ç›˜ï¼Œè€Œä¸”ä¹Ÿä¸æä¾›æ•°æ®å®‰å…¨ä¿æŠ¤ã€‚</p><blockquote><p>å…¶åªæ˜¯ç®€å•æä¾›ä¸€ç§æ‰©å±•å­˜å‚¨ç©ºé—´çš„æœºåˆ¶ï¼ŒJBODå¯ç”¨å­˜å‚¨å®¹é‡ç­‰äºæ‰€æœ‰æˆå‘˜ç£ç›˜çš„å­˜å‚¨ç©ºé—´ä¹‹å’Œ</p></blockquote><p>JBOD å¸¸æŒ‡ç£ç›˜æŸœï¼Œè€Œä¸è®ºå…¶æ˜¯å¦æä¾› RAID åŠŸèƒ½ã€‚ä¸è¿‡ï¼ŒJBODå¹¶éå®˜æ–¹æœ¯è¯­ï¼Œå®˜æ–¹ç§°ä¸ºSpanningã€‚</p><h4 id="raid0" tabindex="-1"><a class="header-anchor" href="#raid0"><span>RAID0</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208113758.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>RAID0 æ˜¯ä¸€ç§ç®€å•çš„ã€æ— æ•°æ®æ ¡éªŒçš„<code>æ•°æ®æ¡å¸¦åŒ–æŠ€æœ¯</code>ã€‚å®é™…ä¸Šä¸æ˜¯ä¸€ç§çœŸæ­£çš„ RAID ï¼Œå› ä¸ºå®ƒå¹¶ä¸æä¾›ä»»ä½•å½¢å¼çš„å†—ä½™ç­–ç•¥ã€‚ RAID0 å°†æ‰€åœ¨ç£ç›˜æ¡å¸¦åŒ–åç»„æˆå¤§å®¹é‡çš„å­˜å‚¨ç©ºé—´ï¼Œå°†æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨æ‰€æœ‰ç£ç›˜ä¸­ï¼Œä»¥ç‹¬ç«‹è®¿é—®æ–¹å¼å®ç°å¤šå—ç£ç›˜çš„å¹¶è¯»è®¿é—®ã€‚</p><p>ç†è®ºä¸Šè®²ï¼Œä¸€ä¸ªç”± n å—ç£ç›˜ç»„æˆçš„ RAID0 ï¼Œå®ƒçš„è¯»å†™æ€§èƒ½æ˜¯å•ä¸ªç£ç›˜æ€§èƒ½çš„ n å€ï¼Œä½†ç”±äºæ€»çº¿å¸¦å®½ç­‰å¤šç§å› ç´ çš„é™åˆ¶ï¼Œå®é™…çš„æ€§èƒ½æå‡ä½äºç†è®ºå€¼ã€‚ç”±äºå¯ä»¥å¹¶å‘æ‰§è¡Œ I/O æ“ä½œï¼Œæ€»çº¿å¸¦å®½å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚å†åŠ ä¸Šä¸éœ€è¦è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œ<code>RAID0 çš„æ€§èƒ½åœ¨æ‰€æœ‰ RAID ç­‰çº§ä¸­æ˜¯æœ€é«˜çš„</code>ã€‚</p><p>RAID0 å…·æœ‰ä½æˆæœ¬ã€é«˜è¯»å†™æ€§èƒ½ã€ 100% çš„é«˜å­˜å‚¨ç©ºé—´åˆ©ç”¨ç‡ç­‰ä¼˜ç‚¹ï¼Œä½†æ˜¯å®ƒä¸æä¾›æ•°æ®å†—ä½™ä¿æŠ¤ï¼Œä¸€æ—¦æ•°æ®æŸåï¼Œå°†æ— æ³•æ¢å¤ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼šå¯¹æ•°æ®çš„é¡ºåºè¯»å†™è¦æ±‚ä¸é«˜ï¼Œå¯¹æ•°æ®çš„å®‰å…¨æ€§å’Œå¯é æ€§è¦æ±‚ä¸é«˜ï¼Œä½†å¯¹ç³»ç»Ÿæ€§èƒ½è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚</p><blockquote><p>RAID0ä¸JBODç›¸åŒç‚¹ï¼š 1 ï¼‰å­˜å‚¨å®¹é‡ï¼šéƒ½æ˜¯æˆå‘˜ç£ç›˜å®¹é‡æ€»å’Œ 2 ï¼‰ç£ç›˜åˆ©ç”¨ç‡ï¼Œéƒ½æ˜¯100%ï¼Œå³éƒ½æ²¡æœ‰åšä»»ä½•çš„æ•°æ®å†—ä½™å¤‡ä»½ RAID0ä¸JBODä¸åŒç‚¹ï¼š 1 ï¼‰JBODï¼šæ•°æ®æ˜¯é¡ºåºå­˜æ”¾çš„ï¼Œä¸€ä¸ªç£ç›˜å­˜æ»¡åæ‰ä¼šå¼€å§‹å­˜æ”¾åˆ°ä¸‹ä¸€ä¸ªç£ç›˜ 2 ï¼‰RAIDï¼šå„ä¸ªç£ç›˜ä¸­çš„æ•°æ®å†™å…¥æ˜¯å¹¶è¡Œçš„ï¼Œæ˜¯é€šè¿‡æ•°æ®æ¡å¸¦æŠ€æœ¯å†™å…¥çš„ã€‚å…¶è¯»å†™æ€§èƒ½æ˜¯JBODçš„nå€</p></blockquote><h4 id="raid1" tabindex="-1"><a class="header-anchor" href="#raid1"><span>RAID1</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208121758.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>RAID1 å°±æ˜¯ä¸€ç§<code>é•œåƒæŠ€æœ¯</code>ï¼Œå®ƒå°†æ•°æ®å®Œå…¨ä¸€è‡´åœ°åˆ†åˆ«å†™åˆ°å·¥ä½œç£ç›˜å’Œé•œåƒç£ç›˜ï¼Œå®ƒçš„ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡ä¸º 50% ã€‚ RAID1 åœ¨æ•°æ®å†™å…¥æ—¶ï¼Œå“åº”æ—¶é—´ä¼šæœ‰æ‰€å½±å“ï¼Œä½†æ˜¯è¯»æ•°æ®çš„æ—¶å€™æ²¡æœ‰å½±å“ã€‚ RAID1 æä¾›äº†æœ€ä½³çš„æ•°æ®ä¿æŠ¤ï¼Œä¸€æ—¦å·¥ä½œç£ç›˜å‘ç”Ÿæ•…éšœï¼Œç³»ç»Ÿå°†è‡ªåŠ¨åˆ‡æ¢åˆ°é•œåƒç£ç›˜ï¼Œä¸ä¼šå½±å“ä½¿ç”¨ã€‚</p><p>RAID1æ˜¯ä¸ºäº†å¢å¼ºæ•°æ®å®‰å…¨æ€§ä½¿ä¸¤å—ç£ç›˜æ•°æ®å‘ˆç°å®Œå…¨é•œåƒï¼Œä»è€Œè¾¾åˆ°å®‰å…¨æ€§å¥½ã€æŠ€æœ¯ç®€å•ã€ç®¡ç†æ–¹ä¾¿ã€‚ RAID1 æ‹¥æœ‰å®Œå…¨å®¹é”™çš„èƒ½åŠ›ï¼Œä½†å®ç°æˆæœ¬é«˜ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼šå¯¹é¡ºåºè¯»å†™æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œæˆ–å¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</p><h4 id="raid10" tabindex="-1"><a class="header-anchor" href="#raid10"><span>RAID10</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208122057.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>RAID10æ˜¯ä¸€ä¸ªRAID1ä¸RAID0çš„ç»„åˆä½“ï¼Œæ‰€ä»¥å®ƒç»§æ‰¿äº†RAID0çš„å¿«é€Ÿå’ŒRAID1çš„å®‰å…¨ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå…ˆåšæ¡å¸¦ï¼Œå†åšé•œåƒã€‚å‘å³å°†è¿›æ¥çš„æ•°æ®å…ˆåˆ†æ•£åˆ°ä¸åŒçš„ç£ç›˜ï¼Œå†å°†ç£ç›˜ä¸­çš„æ•°æ®åšé•œåƒã€‚</p><h4 id="raid01" tabindex="-1"><a class="header-anchor" href="#raid01"><span>RAID01</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208122113.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>RAID01æ˜¯ä¸€ä¸ªRAID0ä¸RAID1çš„ç»„åˆä½“ï¼Œæ‰€ä»¥å®ƒç»§æ‰¿äº†RAID0çš„å¿«é€Ÿå’ŒRAID1çš„å®‰å…¨ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå…ˆåšé•œåƒå†åšæ¡å¸¦ã€‚å³å°†è¿›æ¥çš„æ•°æ®å…ˆåšé•œåƒï¼Œå†å°†é•œåƒæ•°æ®å†™å…¥åˆ°ä¸ä¹‹å‰æ•°æ®ä¸åŒçš„ç£ç›˜ï¼Œå³å†åšæ¡å¸¦ã€‚</p><blockquote><p>RAID10è¦æ¯”RAID01çš„å®¹é”™ç‡å†é«˜ï¼Œæ‰€ä»¥ç”Ÿäº§ç¯å¢ƒä¸‹ä¸€èˆ¬æ˜¯ä¸ä½¿ç”¨RAID01çš„ã€‚</p></blockquote><h4 id="åºå·-ä¸»æœºå-ip-ip-åŠŸèƒ½-brokerè§’è‰²" tabindex="-1"><a class="header-anchor" href="#åºå·-ä¸»æœºå-ip-ip-åŠŸèƒ½-brokerè§’è‰²"><span>åºå· ä¸»æœºå/IP IP åŠŸèƒ½ BROKERè§’è‰²</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>1 rocketmqOS1 192.168.59.164 NameServer + Broker Master1 + Slave2</span></span>
<span class="line"><span>2 rocketmqOS2 192.168.59.165 NameServer + Broker Master2 + Slave1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸ƒã€é›†ç¾¤æ­å»ºå®è·µ" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€é›†ç¾¤æ­å»ºå®è·µ"><span>ä¸ƒã€é›†ç¾¤æ­å»ºå®è·µ</span></a></h2><h3 id="_1-é›†ç¾¤æ¶æ„" tabindex="-1"><a class="header-anchor" href="#_1-é›†ç¾¤æ¶æ„"><span>1 é›†ç¾¤æ¶æ„</span></a></h3><p>è¿™é‡Œè¦æ­å»ºä¸€ä¸ªåŒä¸»åŒä»å¼‚æ­¥å¤åˆ¶çš„Brokeré›†ç¾¤ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸¤å°ä¸»æœºæ¥å®Œæˆé›†ç¾¤çš„æ­å»ºã€‚è¿™ä¸¤å°ä¸»æœºçš„åŠŸèƒ½ä¸brokerè§’è‰²åˆ†é…å¦‚ä¸‹è¡¨ã€‚</p><table><thead><tr><th>åºå·</th><th style="text-align:center;">ä¸»æœºå/IP</th><th style="text-align:right;">IP</th><th style="text-align:right;">åŠŸèƒ½</th><th style="text-align:right;">BROKERè§’è‰²</th></tr></thead><tbody><tr><td>1</td><td style="text-align:center;">rocketmqOS1</td><td style="text-align:right;">192.168.59.164</td><td style="text-align:right;">NameServer + Broker</td><td style="text-align:right;">Master1 + Slave2</td></tr><tr><td>2</td><td style="text-align:center;">rocketmqOS1</td><td style="text-align:right;">192.168.59.165</td><td style="text-align:right;">NameServer + Broker</td><td style="text-align:right;">Master2 + Slave1</td></tr></tbody></table><h3 id="_2-å…‹éš†ç”Ÿæˆrocketmqos1" tabindex="-1"><a class="header-anchor" href="#_2-å…‹éš†ç”Ÿæˆrocketmqos1"><span>2 å…‹éš†ç”ŸæˆrocketmqOS1</span></a></h3><p>å…‹éš†rocketmqOSä¸»æœºï¼Œå¹¶ä¿®æ”¹é…ç½®ã€‚æŒ‡å®šä¸»æœºåä¸ºrocketmqOS1ã€‚</p><h3 id="_3-ä¿®æ”¹rocketmqos1é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-ä¿®æ”¹rocketmqos1é…ç½®æ–‡ä»¶"><span>3 ä¿®æ”¹rocketmqOS1é…ç½®æ–‡ä»¶</span></a></h3><h4 id="é…ç½®æ–‡ä»¶ä½ç½®" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ–‡ä»¶ä½ç½®"><span>é…ç½®æ–‡ä»¶ä½ç½®</span></a></h4><p>è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶åœ¨rocketMQè§£å‹ç›®å½•çš„conf/2m-2s-asyncç›®å½•ä¸­ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208122608.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="ä¿®æ”¹broker-a-properties" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹broker-a-properties"><span>ä¿®æ”¹broker-a.properties</span></a></h4><p>å°†è¯¥é…ç½®æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šæ•´ä¸ªbrokeré›†ç¾¤çš„åç§°ï¼Œæˆ–è€…è¯´æ˜¯RocketMQé›†ç¾¤çš„åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerClusterName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šmaster-slaveé›†ç¾¤çš„åç§°ã€‚ä¸€ä¸ªRocketMQé›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªmaster-slaveé›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">broker-a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># masterçš„brokerIdä¸º 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šåˆ é™¤æ¶ˆæ¯å­˜å‚¨è¿‡æœŸæ–‡ä»¶çš„æ—¶é—´ä¸ºå‡Œæ™¨ 4 ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deleteWhen</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> 04</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šæœªå‘ç”Ÿæ›´æ–°çš„æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶çš„ä¿ç•™æ—¶é•¿ä¸º 48 å°æ—¶ï¼Œ 48 å°æ—¶åè¿‡æœŸï¼Œå°†ä¼šè¢«åˆ é™¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileReservedTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> 48</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šå½“å‰brokerä¸ºå¼‚æ­¥å¤åˆ¶master</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerRole</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ASYNC_MASTER</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šåˆ·ç›˜ç­–ç•¥ä¸ºå¼‚æ­¥åˆ·ç›˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flushDiskType</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ASYNC_FLUSH</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šName Serverçš„åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">namesrvAddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.59.164:9876</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.59.165:9876</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¿®æ”¹broker-b-s-properties" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹broker-b-s-properties"><span>ä¿®æ”¹broker-b-s.properties</span></a></h4><p>å°†è¯¥é…ç½®æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><h4 id="å…¶å®ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#å…¶å®ƒé…ç½®"><span>å…¶å®ƒé…ç½®</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerClusterName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">DefaultCluster</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šè¿™æ˜¯å¦å¤–ä¸€ä¸ªmaster-slaveé›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">broker-b</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># slaveçš„brokerIdä¸ºé 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deleteWhen</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">04</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileReservedTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">48</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šå½“å‰brokerä¸ºslave</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerRole</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">SLAVE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flushDiskType</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ASYNC_FLUSH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">namesrvAddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.59.164:9876</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.59.165:9876</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šBrokerå¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£ï¼Œå³Brokerä¸producerä¸consumeré€šä¿¡çš„ç«¯å£ã€‚é»˜è®¤10911 ã€‚ç”±äºå½“å‰ä¸»æœºåŒæ—¶å……å½“ç€master1ä¸slave2ï¼Œè€Œå‰é¢çš„master1ä½¿ç”¨çš„æ˜¯é»˜è®¤ç«¯å£ã€‚è¿™é‡Œéœ€è¦å°†è¿™ä¸¤ä¸ªç«¯å£åŠ ä»¥åŒºåˆ†ï¼Œä»¥åŒºåˆ†å‡ºmaster1ä¸slave2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listenPort</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> 11911</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æŒ‡å®šæ¶ˆæ¯å­˜å‚¨ç›¸å…³çš„è·¯å¾„ã€‚é»˜è®¤è·¯å¾„ä¸º~/storeç›®å½•ã€‚ç”±äºå½“å‰ä¸»æœºåŒæ—¶å……å½“ç€master1ä¸slave2ï¼Œmaster1ä½¿ç”¨çš„æ˜¯é»˜è®¤è·¯å¾„ï¼Œè¿™é‡Œå°±éœ€è¦å†æŒ‡å®šä¸€ä¸ªä¸åŒè·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathRootDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathCommitLog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/commitlog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathConsumeQueue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/consumequeue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storeCheckpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/checkpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">abortFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/abort</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é™¤äº†ä»¥ä¸Šé…ç½®å¤–-è¿™äº›é…ç½®æ–‡ä»¶ä¸­è¿˜å¯ä»¥è®¾ç½®å…¶å®ƒå±æ€§ã€‚" tabindex="-1"><a class="header-anchor" href="#é™¤äº†ä»¥ä¸Šé…ç½®å¤–-è¿™äº›é…ç½®æ–‡ä»¶ä¸­è¿˜å¯ä»¥è®¾ç½®å…¶å®ƒå±æ€§ã€‚"><span>é™¤äº†ä»¥ä¸Šé…ç½®å¤–ï¼Œè¿™äº›é…ç½®æ–‡ä»¶ä¸­è¿˜å¯ä»¥è®¾ç½®å…¶å®ƒå±æ€§ã€‚</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šæ•´ä¸ªbrokeré›†ç¾¤çš„åç§°ï¼Œæˆ–è€…è¯´æ˜¯RocketMQé›†ç¾¤çš„åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerClusterName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">rocket-MS</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šmaster-slaveé›†ç¾¤çš„åç§°ã€‚ä¸€ä¸ªRocketMQé›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªmaster-slaveé›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">broker-a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">namesrvAddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nameserver1:9876</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nameserver2:9876</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#é»˜è®¤ä¸ºæ–°å»ºTopicæ‰€åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">defaultTopicQueueNums</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">4</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä¸­å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">autoCreateTopicEnable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä¸­å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">autoCreateSubscriptionGroup</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#Brokerå¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£ï¼Œå³Brokerä¸producerä¸consumeré€šä¿¡çš„ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listenPort</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">10911</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#HAé«˜å¯ç”¨ç›‘å¬ç«¯å£ï¼Œå³Masterä¸Slaveé—´é€šä¿¡çš„ç«¯å£ï¼Œé»˜è®¤å€¼ä¸ºlistenPort+1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">haListenPort</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">10912</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šåˆ é™¤æ¶ˆæ¯å­˜å‚¨è¿‡æœŸæ–‡ä»¶çš„æ—¶é—´ä¸ºå‡Œæ™¨ 4 ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deleteWhen</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">04</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šæœªå‘ç”Ÿæ›´æ–°çš„æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶çš„ä¿ç•™æ—¶é•¿ä¸º 48 å°æ—¶ï¼Œ 48 å°æ—¶åè¿‡æœŸï¼Œå°†ä¼šè¢«åˆ é™¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileReservedTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">48</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šcommitLogç›®å½•ä¸­æ¯ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œé»˜è®¤1G</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">mapedFileSizeCommitLog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1073741824</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šConsumeQueueçš„æ¯ä¸ªTopicçš„æ¯ä¸ªQueueæ–‡ä»¶ä¸­å¯ä»¥å­˜æ”¾çš„æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤30wæ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">mapedFileSizeConsumeQueue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">300000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#åœ¨æ¸…é™¤è¿‡æœŸæ–‡ä»¶æ—¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶è¢«å…¶ä»–çº¿ç¨‹æ‰€å ç”¨ï¼ˆå¼•ç”¨æ•°å¤§äº 0 ï¼Œæ¯”å¦‚è¯»å–æ¶ˆæ¯ï¼‰ï¼Œæ­¤æ—¶ä¼šé˜»æ­¢æ­¤æ¬¡åˆ é™¤ä»»åŠ¡ï¼ŒåŒæ—¶åœ¨ç¬¬ä¸€æ¬¡è¯•å›¾åˆ é™¤è¯¥æ–‡ä»¶æ—¶è®°å½•å½“å‰æ—¶é—´æˆ³ã€‚è¯¥å±æ€§åˆ™è¡¨ç¤ºä»ç¬¬ä¸€æ¬¡æ‹’ç»åˆ é™¤åå¼€å§‹è®¡æ—¶ï¼Œè¯¥æ–‡ä»¶æœ€å¤šå¯ä»¥ä¿ç•™çš„æ—¶é•¿ã€‚åœ¨æ­¤æ—¶é—´å†…è‹¥å¼•ç”¨æ•°ä»ä¸ä¸º 0 ï¼Œåˆ™åˆ é™¤ä»ä¼šè¢«æ‹’ç»ã€‚ä¸è¿‡æ—¶é—´åˆ°åï¼Œæ–‡ä»¶å°†è¢«å¼ºåˆ¶åˆ é™¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destroyMapedFileIntervalForcibly</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">120000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šcommitlogã€consumequeueæ‰€åœ¨ç£ç›˜åˆ†åŒºçš„æœ€å¤§ä½¿ç”¨ç‡ï¼Œè¶…è¿‡è¯¥å€¼ï¼Œåˆ™éœ€ç«‹å³æ¸…é™¤è¿‡æœŸæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">diskMaxUsedSpaceRatio</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">88</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šstoreç›®å½•çš„è·¯å¾„ï¼Œé»˜è®¤åœ¨å½“å‰ç”¨æˆ·ä¸»ç›®å½•ä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathRootDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/local/rocketmq-all-4.5.0/store</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#commitLogç›®å½•è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathCommitLog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/local/rocketmq-all-4.5.0/store/commitlog</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#consumeueueç›®å½•è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathConsumeQueue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/local/rocketmq-all-4.5.0/store/consumequeue</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#indexç›®å½•è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/local/rocketmq-all-4.5.0/store/index</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#checkpointæ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storeCheckpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/local/rocketmq-all-4.5.0/store/checkpoint</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#abortæ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">abortFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/local/rocketmq-all-4.5.0/store/abort</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æŒ‡å®šæ¶ˆæ¯çš„æœ€å¤§å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">maxMessageSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> 65536</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#Brokerçš„è§’è‰²</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># - SYNC_MASTER åŒæ­¥åŒå†™Master</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># - SLAVE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerRole</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">SYNC_MASTER</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#åˆ·ç›˜ç­–ç•¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flushDiskType</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">SYNC_FLUSH</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sendMessageThreadPoolNums</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">128</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pullMessageThreadPoolNums</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">128</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerIP1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.3.105</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-å…‹éš†ç”Ÿæˆrocketmqos2" tabindex="-1"><a class="header-anchor" href="#_4-å…‹éš†ç”Ÿæˆrocketmqos2"><span>4 å…‹éš†ç”ŸæˆrocketmqOS2</span></a></h3><p>å…‹éš†rocketmqOS1ä¸»æœºï¼Œå¹¶ä¿®æ”¹é…ç½®ã€‚æŒ‡å®šä¸»æœºåä¸ºrocketmqOS2ã€‚</p><h3 id="_5-ä¿®æ”¹rocketmqos2é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_5-ä¿®æ”¹rocketmqos2é…ç½®æ–‡ä»¶"><span>5 ä¿®æ”¹rocketmqOS2é…ç½®æ–‡ä»¶</span></a></h3><p>å¯¹äºrocketmqOS2ä¸»æœºï¼ŒåŒæ ·éœ€è¦ä¿®æ”¹rocketMQè§£å‹ç›®å½•çš„confç›®å½•çš„å­ç›®å½•2m-2s-asyncä¸­çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚</p><h4 id="ä¿®æ”¹broker-b-properties" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹broker-b-properties"><span>ä¿®æ”¹broker-b.properties</span></a></h4><p>å°†è¯¥é…ç½®æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerClusterName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">DefaultCluster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">broker-b</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deleteWhen</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">04</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileReservedTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">48</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerRole</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ASYNC_MASTER</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flushDiskType</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ASYNC_FLUSH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">namesrvAddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.59.164:9876</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.59.165:9876</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹broker-a-s.properties</p><h4 id="å°†è¯¥é…ç½®æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#å°†è¯¥é…ç½®æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹"><span>å°†è¯¥é…ç½®æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerClusterName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">DefaultCluster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">broker-a</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deleteWhen</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">04</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileReservedTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">48</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">brokerRole</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">SLAVE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flushDiskType</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ASYNC_FLUSH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">namesrvAddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.59.164:9876</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.59.165:9876</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listenPort</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">11911</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathRootDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathCommitLog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/commitlog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathConsumeQueue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/consumequeue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storePathIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/index</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">storeCheckpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/checkpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">abortFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">~/store-s/abort</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-å¯åŠ¨æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_6-å¯åŠ¨æœåŠ¡å™¨"><span>6 å¯åŠ¨æœåŠ¡å™¨</span></a></h3><h4 id="å¯åŠ¨nameserveré›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨nameserveré›†ç¾¤"><span>å¯åŠ¨NameServeré›†ç¾¤</span></a></h4><p>åˆ†åˆ«å¯åŠ¨rocketmqOS1ä¸rocketmqOS2ä¸¤ä¸ªä¸»æœºä¸­çš„NameServerã€‚å¯åŠ¨å‘½ä»¤å®Œå…¨ç›¸åŒã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqnamesrv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/logs/rocketmqlogs/namesrv.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯åŠ¨ä¸¤ä¸ªmaster" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨ä¸¤ä¸ªmaster"><span>å¯åŠ¨ä¸¤ä¸ªMaster</span></a></h4><p>åˆ†åˆ«å¯åŠ¨rocketmqOS1ä¸rocketmqOS2ä¸¤ä¸ªä¸»æœºä¸­çš„broker masterã€‚æ³¨æ„ï¼Œå®ƒä»¬æŒ‡å®šæ‰€è¦åŠ è½½çš„é…ç½®æ–‡ä»¶æ˜¯ä¸åŒçš„ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqbroker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> conf/2m-2s-async/broker-a.properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/logs/rocketmqlogs/broker.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqbroker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> conf/2m-2s-async/broker-b.properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/logs/rocketmqlogs/broker.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯åŠ¨ä¸¤ä¸ªslave" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨ä¸¤ä¸ªslave"><span>å¯åŠ¨ä¸¤ä¸ªSlave</span></a></h4><p>åˆ†åˆ«å¯åŠ¨rocketmqOS1ä¸rocketmqOS2ä¸¤ä¸ªä¸»æœºä¸­çš„broker slaveã€‚æ³¨æ„ï¼Œå®ƒä»¬æŒ‡å®šæ‰€è¦åŠ è½½çš„é…ç½®æ–‡ä»¶æ˜¯ä¸åŒçš„ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqbroker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> conf/2m-2s-async/broker-b-s.properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/logs/rocketmqlogs/broker.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqbroker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> conf/2m-2s-async/broker-a-s.properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/logs/rocketmqlogs/broker.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…«ã€mqadminå‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å…«ã€mqadminå‘½ä»¤"><span>å…«ã€mqadminå‘½ä»¤</span></a></h2><p>åœ¨mqè§£å‹ç›®å½•çš„binç›®å½•ä¸‹æœ‰ä¸€ä¸ªmqadminå‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ˜¯ä¸€ä¸ªè¿ç»´æŒ‡ä»¤ï¼Œç”¨äºå¯¹mqçš„ä¸»é¢˜ï¼Œé›†ç¾¤ï¼Œbroker ç­‰ä¿¡æ¯è¿›è¡Œç®¡ç†ã€‚</p><h3 id="_1-ä¿®æ”¹bin-tools-sh" tabindex="-1"><a class="header-anchor" href="#_1-ä¿®æ”¹bin-tools-sh"><span>1 ä¿®æ”¹bin/tools.sh</span></a></h3><p>åœ¨è¿è¡Œmqadminå‘½ä»¤ä¹‹å‰ï¼Œå…ˆè¦ä¿®æ”¹mqè§£å‹ç›®å½•ä¸‹bin/tools.shé…ç½®çš„JDKçš„extç›®å½•ä½ç½®ã€‚æœ¬æœºçš„extç›®å½•åœ¨<code>/usr/java/jdk1.8.0_161/jre/lib/ext</code>ã€‚</p><p>ä½¿ç”¨vimå‘½ä»¤æ‰“å¼€tools.shæ–‡ä»¶ï¼Œå¹¶åœ¨JAVA_OPTé…ç½®çš„-Djava.ext.dirsè¿™ä¸€è¡Œçš„åé¢æ·»åŠ extçš„è·¯å¾„ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208123848.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_OPT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_OPT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">} -server -Xms1g -Xmx1g -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=128m&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_OPT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_OPT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">} -Djava.ext.dirs=${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">BASE_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}/lib:${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}/jre/lib/ext:${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}/lib/ext:/usr/java/jdk1.8.0_161/jre/lib/ext&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_OPT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">JAVA_OPT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">} -cp ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CLASSPATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-è¿è¡Œmqadmin" tabindex="-1"><a class="header-anchor" href="#_2-è¿è¡Œmqadmin"><span>2 è¿è¡Œmqadmin</span></a></h3><p>ç›´æ¥è¿è¡Œè¯¥å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å…¶å¯ä»¥æ·»åŠ çš„commandsã€‚é€šè¿‡è¿™äº›commandså¯ä»¥å®Œæˆå¾ˆå¤šçš„åŠŸèƒ½ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@mqOS rocketmq-all-4.8.0-bin-release]# ./bin/mqadmin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> most</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> commonly</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> used</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mqadmin</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> commands</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> are:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">updateTopic</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Update</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> topic</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">deleteTopic</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Delete</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> topic</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> broker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NameServer.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">updateSubGroup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Update</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> subscription</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> group</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">deleteSubGroup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Delete</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> subscription</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> broker.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">updateBrokerConfig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Update</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> broker&#39;s config</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">updateTopicPerm Update topic perm</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">topicRoute Examine topic route info</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">topicStatus Examine topic Status info</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">topicClusterList get cluster info for topic</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">brokerStatus Fetch broker runtime status data</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">queryMsgById Query Message by Id</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">queryMsgByKey Query Message by Key</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">queryMsgByUniqueKey Query Message by Unique key</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">queryMsgByOffset Query Message by offset</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">QueryMsgTraceById query a message trace</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">printMsg Print Message Detail</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">printMsgByQueue Print Message Detail</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">sendMsgStatus send msg to broker.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">brokerConsumeStats Fetch broker consume stats data</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">producerConnection Query producer&#39;s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> socket</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> connection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clientversion</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">consumerConnection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Query</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> consumer&#39;s socket connection, client version and subscription</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">consumerProgress Query consumers&#39;s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> progress,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> speed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">consumerStatus</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Query</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> consumer&#39;s internal data structure</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cloneGroupOffset clone offset from other group.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">clusterList List all of clusters</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">topicList Fetch all topic list from name server</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">updateKvConfig Create or update KV config.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">deleteKvConfig Delete KV config.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">wipeWritePerm Wipe write perm of broker in all name server</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">resetOffsetByTime Reset consumer offset by timestamp(without client restart).</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">updateOrderConf Create or update or delete order conf</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cleanExpiredCQ Clean expired ConsumeQueue on broker.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cleanUnusedTopic Clean unused topic on broker.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">startMonitoring Start Monitoring</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">statsAll Topic and Consumer tps stats</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">allocateMQ Allocate MQ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">checkMsgSendRT check message send response time</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">clusterRT List All clusters Message Send RT</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">getNamesrvConfig Get configs of name server.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">updateNamesrvConfig Update configs of name server.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">getBrokerConfig Get broker config by cluster or special broker!</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">queryCq Query cq command.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">sendMessage Send a message</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">consumeMessage Consume message</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">updateAclConfig Update acl config yaml file in broker</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">deleteAccessConfig Delete Acl Config Account in broker</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">clusterAclConfigVersion List all of acl config version information in cluster</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">updateGlobalWhiteAddr Update global white address for acl Config File in broker</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">getAccessConfigSubCommand List all of acl config information in cluster</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-è¯¥å‘½ä»¤çš„å®˜ç½‘è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_3-è¯¥å‘½ä»¤çš„å®˜ç½‘è¯¦è§£"><span>3 è¯¥å‘½ä»¤çš„å®˜ç½‘è¯¦è§£</span></a></h3><h4 id="è¯¥å‘½ä»¤åœ¨å®˜ç½‘ä¸­æœ‰è¯¦ç»†çš„ç”¨æ³•è§£é‡Šã€‚" tabindex="-1"><a class="header-anchor" href="#è¯¥å‘½ä»¤åœ¨å®˜ç½‘ä¸­æœ‰è¯¦ç»†çš„ç”¨æ³•è§£é‡Šã€‚"><span>è¯¥å‘½ä»¤åœ¨å®˜ç½‘ä¸­æœ‰è¯¦ç»†çš„ç”¨æ³•è§£é‡Šã€‚</span></a></h4><p>https://github.com/apache/rocketmq/blob/master/docs/cn/operation.md</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208124241.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208124258.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h1 id="ç¬¬-3-ç« -rocketmqå·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#ç¬¬-3-ç« -rocketmqå·¥ä½œåŸç†"><span>ç¬¬ 3 ç«  RocketMQå·¥ä½œåŸç†</span></a></h1><h2 id="ä¸€ã€æ¶ˆæ¯çš„ç”Ÿäº§" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ¶ˆæ¯çš„ç”Ÿäº§"><span>ä¸€ã€æ¶ˆæ¯çš„ç”Ÿäº§</span></a></h2><h3 id="_1-æ¶ˆæ¯çš„ç”Ÿäº§è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_1-æ¶ˆæ¯çš„ç”Ÿäº§è¿‡ç¨‹"><span>1 æ¶ˆæ¯çš„ç”Ÿäº§è¿‡ç¨‹</span></a></h3><p>Producerå¯ä»¥å°†æ¶ˆæ¯å†™å…¥åˆ°æŸBrokerä¸­çš„æŸQueueä¸­ï¼Œå…¶ç»å†äº†å¦‚ä¸‹è¿‡ç¨‹ï¼š</p><ul><li>Producerå‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œä¼šå…ˆå‘NameServerå‘å‡ºè·å–æ¶ˆæ¯Topicçš„è·¯ç”±ä¿¡æ¯çš„è¯·æ±‚</li><li>NameServerè¿”å›è¯¥Topicçš„è·¯ç”±è¡¨åŠBrokeråˆ—è¡¨</li><li>Produceræ ¹æ®ä»£ç ä¸­æŒ‡å®šçš„Queueé€‰æ‹©ç­–ç•¥ï¼Œä»Queueåˆ—è¡¨ä¸­é€‰å‡ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨äºåç»­å­˜å‚¨æ¶ˆæ¯</li><li>Produerå¯¹æ¶ˆæ¯åšä¸€äº›ç‰¹æ®Šå¤„ç†ï¼Œä¾‹å¦‚ï¼Œæ¶ˆæ¯æœ¬èº«è¶…è¿‡4Mï¼Œåˆ™ä¼šå¯¹å…¶è¿›è¡Œå‹ç¼©</li><li>Producerå‘é€‰æ‹©å‡ºçš„Queueæ‰€åœ¨çš„Brokerå‘å‡ºRPCè¯·æ±‚ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°é€‰æ‹©å‡ºçš„Queue</li></ul><blockquote><p>è·¯ç”±è¡¨ï¼šå®é™…æ˜¯ä¸€ä¸ªMapï¼Œkeyä¸ºTopicåç§°ï¼Œvalueæ˜¯ä¸€ä¸ªQueueDataå®ä¾‹åˆ—è¡¨ã€‚QueueDataå¹¶ä¸æ˜¯ä¸€ä¸ªQueueå¯¹åº”ä¸€ä¸ªQueueDataï¼Œè€Œæ˜¯ä¸€ä¸ªBrokerä¸­è¯¥Topicçš„æ‰€æœ‰Queueå¯¹åº”ä¸€ä¸ªQueueDataã€‚å³ï¼Œåªè¦æ¶‰åŠåˆ°è¯¥Topicçš„Brokerï¼Œä¸€ä¸ªBrokerå¯¹åº”ä¸€ä¸ªQueueDataã€‚QueueDataä¸­åŒ…å«brokerNameã€‚ç®€å•æ¥è¯´ï¼Œè·¯ç”±è¡¨çš„keyä¸ºTopicåç§°ï¼Œvalueåˆ™ä¸ºæ‰€æœ‰æ¶‰åŠè¯¥Topicçš„BrokerNameåˆ—è¡¨ã€‚</p></blockquote><blockquote><p>Brokeråˆ—è¡¨ï¼šå…¶å®é™…ä¹Ÿæ˜¯ä¸€ä¸ªMapã€‚keyä¸ºbrokerNameï¼Œvalueä¸ºBrokerDataã€‚ä¸€ä¸ªBrokerå¯¹åº”ä¸€ä¸ªBrokerDataå®ä¾‹ï¼Œå¯¹å—ï¼Ÿä¸å¯¹ã€‚ä¸€å¥—brokerNameåç§°ç›¸åŒçš„Master-Slaveå°é›†ç¾¤å¯¹åº”ä¸€ä¸ªBrokerDataã€‚BrokerDataä¸­åŒ…å«brokerNameåŠä¸€ä¸ªmapã€‚è¯¥mapçš„keyä¸ºbrokerIdï¼Œvalueä¸ºè¯¥brokerå¯¹åº”çš„åœ°å€ã€‚brokerIdä¸º 0 è¡¨ç¤ºè¯¥brokerä¸ºMasterï¼Œé 0 è¡¨ç¤ºSlaveã€‚</p></blockquote><h3 id="_2-queueé€‰æ‹©ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#_2-queueé€‰æ‹©ç®—æ³•"><span>2 Queueé€‰æ‹©ç®—æ³•</span></a></h3><p>å¯¹äºæ— åºæ¶ˆæ¯ï¼Œå…¶Queueé€‰æ‹©ç®—æ³•ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯æŠ•é€’ç®—æ³•ï¼Œå¸¸è§çš„æœ‰ä¸¤ç§ï¼š</p><h4 id="è½®è¯¢ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#è½®è¯¢ç®—æ³•"><span>è½®è¯¢ç®—æ³•</span></a></h4><p>é»˜è®¤é€‰æ‹©ç®—æ³•ã€‚è¯¥ç®—æ³•ä¿è¯äº†æ¯ä¸ªQueueä¸­å¯ä»¥å‡åŒ€çš„è·å–åˆ°æ¶ˆæ¯ã€‚</p><blockquote><p>è¯¥ç®—æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šç”±äºæŸäº›åŸå› ï¼Œåœ¨æŸäº›Brokerä¸Šçš„Queueå¯èƒ½æŠ•é€’å»¶è¿Ÿè¾ƒä¸¥é‡ã€‚ä»è€Œå¯¼è‡´Producerçš„ç¼“å­˜é˜Ÿåˆ—ä¸­å‡ºç°è¾ƒå¤§çš„æ¶ˆæ¯ç§¯å‹ï¼Œå½±å“æ¶ˆæ¯çš„æŠ•é€’æ€§èƒ½ã€‚</p></blockquote><h4 id="æœ€å°æŠ•é€’å»¶è¿Ÿç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æœ€å°æŠ•é€’å»¶è¿Ÿç®—æ³•"><span>æœ€å°æŠ•é€’å»¶è¿Ÿç®—æ³•</span></a></h4><p>è¯¥ç®—æ³•ä¼šç»Ÿè®¡æ¯æ¬¡æ¶ˆæ¯æŠ•é€’çš„æ—¶é—´å»¶è¿Ÿï¼Œç„¶åæ ¹æ®ç»Ÿè®¡å‡ºçš„ç»“æœå°†æ¶ˆæ¯æŠ•é€’åˆ°æ—¶é—´å»¶è¿Ÿæœ€å°çš„Queueã€‚å¦‚æœå»¶è¿Ÿç›¸åŒï¼Œåˆ™é‡‡ç”¨è½®è¯¢ç®—æ³•æŠ•é€’ã€‚è¯¥ç®—æ³•å¯ä»¥æœ‰æ•ˆæå‡æ¶ˆæ¯çš„æŠ•é€’æ€§èƒ½ã€‚</p><blockquote><p>è¯¥ç®—æ³•ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæ¶ˆæ¯åœ¨Queueä¸Šçš„åˆ†é…ä¸å‡åŒ€ã€‚æŠ•é€’å»¶è¿Ÿå°çš„Queueå…¶å¯èƒ½ä¼šå­˜åœ¨å¤§é‡çš„æ¶ˆæ¯ã€‚è€Œå¯¹è¯¥Queueçš„æ¶ˆè´¹è€…å‹åŠ›ä¼šå¢å¤§ï¼Œé™ä½æ¶ˆæ¯çš„æ¶ˆè´¹èƒ½åŠ›ï¼Œå¯èƒ½ä¼šå¯¼è‡´MQä¸­æ¶ˆæ¯çš„å †ç§¯ã€‚</p></blockquote><h2 id="äºŒã€æ¶ˆæ¯çš„å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ¶ˆæ¯çš„å­˜å‚¨"><span>äºŒã€æ¶ˆæ¯çš„å­˜å‚¨</span></a></h2><p>RocketMQä¸­çš„æ¶ˆæ¯å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¿™äº›ç›¸å…³æ–‡ä»¶é»˜è®¤åœ¨å½“å‰ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„storeç›®å½•ä¸­ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208133814.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><ul><li>abortï¼šè¯¥æ–‡ä»¶åœ¨Brokerå¯åŠ¨åä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ­£å¸¸å…³é—­Brokerï¼Œè¯¥æ–‡ä»¶ä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚è‹¥åœ¨æ²¡æœ‰å¯åŠ¨Brokerçš„æƒ…å†µä¸‹ï¼Œå‘ç°è¿™ä¸ªæ–‡ä»¶æ˜¯å­˜åœ¨çš„ï¼Œåˆ™è¯´æ˜ä¹‹å‰Brokerçš„å…³é—­æ˜¯éæ­£å¸¸å…³é—­ã€‚</li><li>checkpointï¼šå…¶ä¸­å­˜å‚¨ç€commitlogã€consumequeueã€indexæ–‡ä»¶çš„æœ€ååˆ·ç›˜æ—¶é—´æˆ³</li><li>commitlogï¼šå…¶ä¸­å­˜æ”¾ç€commitlogæ–‡ä»¶ï¼Œè€Œæ¶ˆæ¯æ˜¯å†™åœ¨commitlogæ–‡ä»¶ä¸­çš„</li><li>conÃ¦gï¼šå­˜æ”¾ç€Brokerè¿è¡ŒæœŸé—´çš„ä¸€äº›é…ç½®æ•°æ®</li><li>consumequeueï¼šå…¶ä¸­å­˜æ”¾ç€consumequeueæ–‡ä»¶ï¼Œé˜Ÿåˆ—å°±å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸­</li><li>indexï¼šå…¶ä¸­å­˜æ”¾ç€æ¶ˆæ¯ç´¢å¼•æ–‡ä»¶indexFile</li><li>lockï¼šè¿è¡ŒæœŸé—´ä½¿ç”¨åˆ°çš„å…¨å±€èµ„æºé”</li></ul><h3 id="_1-commitlogæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-commitlogæ–‡ä»¶"><span>1 commitlogæ–‡ä»¶</span></a></h3><blockquote><p>è¯´æ˜ï¼šåœ¨å¾ˆå¤šèµ„æ–™ä¸­commitlogç›®å½•ä¸­çš„æ–‡ä»¶ç®€å•å°±ç§°ä¸ºcommitlogæ–‡ä»¶ã€‚ä½†åœ¨æºç ä¸­ï¼Œè¯¥æ–‡ä»¶è¢«å‘½åä¸ºmappedFileã€‚</p></blockquote><h4 id="ç›®å½•ä¸æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç›®å½•ä¸æ–‡ä»¶"><span>ç›®å½•ä¸æ–‡ä»¶</span></a></h4><p>commitlogç›®å½•ä¸­å­˜æ”¾ç€å¾ˆå¤šçš„mappedFileæ–‡ä»¶ï¼Œå½“å‰Brokerä¸­çš„æ‰€æœ‰æ¶ˆæ¯éƒ½æ˜¯è½ç›˜åˆ°è¿™äº›mappedFileæ–‡ä»¶ä¸­çš„ã€‚mappedFileæ–‡ä»¶å¤§å°ä¸º1Gï¼ˆå°äºç­‰äº1Gï¼‰ï¼Œæ–‡ä»¶åç”± 20 ä½åè¿›åˆ¶æ•°æ„æˆï¼Œè¡¨ç¤ºå½“å‰æ–‡ä»¶çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„èµ·å§‹ä½ç§»åç§»é‡ã€‚</p><blockquote><p>ç¬¬ä¸€ä¸ªæ–‡ä»¶åä¸€å®šæ˜¯ 20 ä½ 0 æ„æˆçš„ã€‚å› ä¸ºç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„åç§»é‡commitlog offsetä¸º 0 å½“ç¬¬ä¸€ä¸ªæ–‡ä»¶æ”¾æ»¡æ—¶ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆç¬¬äºŒä¸ªæ–‡ä»¶ç»§ç»­å­˜æ”¾æ¶ˆæ¯ã€‚å‡è®¾ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤§å°æ˜¯ 1073741820 å­—èŠ‚ï¼ˆ1G = 1073741824å­—èŠ‚ï¼‰ï¼Œåˆ™ç¬¬äºŒä¸ªæ–‡ä»¶åå°±æ˜¯ 00000000001073741824 ã€‚ ä»¥æ­¤ç±»æ¨ï¼Œç¬¬nä¸ªæ–‡ä»¶ååº”è¯¥æ˜¯å‰n-1ä¸ªæ–‡ä»¶å¤§å°ä¹‹å’Œã€‚ ä¸€ä¸ªBrokerä¸­æ‰€æœ‰mappedFileæ–‡ä»¶çš„commitlog offsetæ˜¯è¿ç»­çš„</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªBrokerä¸­ä»…åŒ…å«ä¸€ä¸ªcommitlogç›®å½•ï¼Œæ‰€æœ‰çš„mappedFileæ–‡ä»¶éƒ½æ˜¯å­˜æ”¾åœ¨è¯¥ç›®å½•ä¸­çš„ã€‚å³æ— è®ºå½“å‰Brokerä¸­å­˜æ”¾ç€å¤šå°‘Topicçš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯éƒ½æ˜¯è¢«é¡ºåºå†™å…¥åˆ°äº†mappedFileæ–‡ä»¶ä¸­çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æ¶ˆæ¯åœ¨Brokerä¸­å­˜æ”¾æ—¶å¹¶æ²¡æœ‰è¢«æŒ‰ç…§Topicè¿›è¡Œåˆ†ç±»å­˜æ”¾ã€‚</p><blockquote><p>mappedFileæ–‡ä»¶æ˜¯é¡ºåºè¯»å†™çš„æ–‡ä»¶ï¼Œæ‰€æœ‰å…¶è®¿é—®æ•ˆç‡å¾ˆé«˜ æ— è®ºæ˜¯SSDç£ç›˜è¿˜æ˜¯SATAç£ç›˜ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œé¡ºåºå­˜å–æ•ˆç‡éƒ½ä¼šé«˜äºéšæœºå­˜å–ã€‚</p></blockquote><h4 id="æ¶ˆæ¯å•å…ƒ" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯å•å…ƒ"><span>æ¶ˆæ¯å•å…ƒ</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208134157.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>mappedFileæ–‡ä»¶å†…å®¹ç”±ä¸€ä¸ªä¸ªçš„<code>æ¶ˆæ¯å•å…ƒ</code>æ„æˆã€‚æ¯ä¸ªæ¶ˆæ¯å•å…ƒä¸­åŒ…å«æ¶ˆæ¯æ€»é•¿åº¦MsgLenã€æ¶ˆæ¯çš„ç‰©ç†ä½ç½®physicalOffsetã€æ¶ˆæ¯ä½“å†…å®¹Bodyã€æ¶ˆæ¯ä½“é•¿åº¦BodyLengthã€æ¶ˆæ¯ä¸»é¢˜Topicã€Topicé•¿åº¦ TopicLengthã€æ¶ˆæ¯ç”Ÿäº§è€…BornHostã€æ¶ˆæ¯å‘é€æ—¶é—´æˆ³BornTimestampã€æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—QueueIdã€æ¶ˆæ¯åœ¨Queueä¸­å­˜å‚¨çš„åç§»é‡QueueOffsetç­‰è¿‘ 20 ä½™é¡¹æ¶ˆæ¯ç›¸å…³å±æ€§ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„åˆ°ï¼Œæ¶ˆæ¯å•å…ƒä¸­æ˜¯åŒ…å«Queueç›¸å…³å± æ€§çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨åç»­çš„å­¦ä¹ ä¸­ï¼Œå°±éœ€è¦ååˆ†ç•™æ„commitlogä¸queueé—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ ä¸€ä¸ªmappedFileæ–‡ä»¶ä¸­ç¬¬m+1ä¸ªæ¶ˆæ¯å•å…ƒçš„commitlog offsetåç§»é‡ L(m+1) = L(m) + MsgLen(m) (m &gt;= 0)</p></blockquote><h3 id="_2-consumequeue" tabindex="-1"><a class="header-anchor" href="#_2-consumequeue"><span>2 consumequeue</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208134355.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="ç›®å½•ä¸æ–‡ä»¶-1" tabindex="-1"><a class="header-anchor" href="#ç›®å½•ä¸æ–‡ä»¶-1"><span>ç›®å½•ä¸æ–‡ä»¶</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208134415.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¼šä¸ºæ¯ä¸ªTopicåœ¨~/store/consumequeueä¸­åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç›®å½•åä¸ºTopicåç§°ã€‚åœ¨è¯¥Topicç›®å½•ä¸‹ï¼Œä¼šå†ä¸ºæ¯ä¸ªè¯¥Topicçš„Queueå»ºç«‹ä¸€ä¸ªç›®å½•ï¼Œç›®å½•åä¸ºqueueIdã€‚æ¯ä¸ªç›®å½•ä¸­å­˜æ”¾ç€è‹¥å¹²consumequeueæ–‡ä»¶ï¼Œconsumequeueæ–‡ä»¶æ˜¯commitlogçš„ç´¢å¼•æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®consumequeueå®šä½åˆ°å…·ä½“çš„æ¶ˆæ¯ã€‚</p><p>consumequeueæ–‡ä»¶åä¹Ÿç”± 20 ä½æ•°å­—æ„æˆï¼Œè¡¨ç¤ºå½“å‰æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç´¢å¼•æ¡ç›®çš„èµ·å§‹ä½ç§»åç§»é‡ã€‚ä¸mappedFileæ–‡ä»¶åä¸åŒçš„æ˜¯ï¼Œå…¶åç»­æ–‡ä»¶åæ˜¯å›ºå®šçš„ã€‚å› ä¸ºconsumequeueæ–‡ä»¶å¤§å°æ˜¯å›ºå®šä¸å˜çš„ã€‚</p><h4 id="ç´¢å¼•æ¡ç›®" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•æ¡ç›®"><span>ç´¢å¼•æ¡ç›®</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208134454.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>æ¯ä¸ªconsumequeueæ–‡ä»¶å¯ä»¥åŒ…å«30wä¸ªç´¢å¼•æ¡ç›®ï¼Œæ¯ä¸ªç´¢å¼•æ¡ç›®åŒ…å«äº†ä¸‰ä¸ªæ¶ˆæ¯é‡è¦å±æ€§ï¼šæ¶ˆæ¯åœ¨mappedFileæ–‡ä»¶ä¸­çš„åç§»é‡CommitLog Offsetã€æ¶ˆæ¯é•¿åº¦ã€æ¶ˆæ¯Tagçš„hashcodeå€¼ã€‚è¿™ä¸‰ä¸ªå±æ€§å  20ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„30w * 20å­—èŠ‚ã€‚</p><blockquote><p>ä¸€ä¸ªconsumequeueæ–‡ä»¶ä¸­æ‰€æœ‰æ¶ˆæ¯çš„Topicä¸€å®šæ˜¯ç›¸åŒçš„ã€‚ä½†æ¯æ¡æ¶ˆæ¯çš„Tagå¯èƒ½æ˜¯ä¸åŒçš„ã€‚</p></blockquote><h3 id="_3-å¯¹æ–‡ä»¶çš„è¯»å†™" tabindex="-1"><a class="header-anchor" href="#_3-å¯¹æ–‡ä»¶çš„è¯»å†™"><span>3 å¯¹æ–‡ä»¶çš„è¯»å†™</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208134538.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="æ¶ˆæ¯å†™å…¥" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯å†™å…¥"><span>æ¶ˆæ¯å†™å…¥</span></a></h4><p>ä¸€æ¡æ¶ˆæ¯è¿›å…¥åˆ°Brokeråç»å†äº†ä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹æ‰æœ€ç»ˆè¢«æŒä¹…åŒ–ã€‚</p><ul><li>Brokeræ ¹æ®queueIdï¼Œè·å–åˆ°è¯¥æ¶ˆæ¯å¯¹åº”ç´¢å¼•æ¡ç›®è¦åœ¨consumequeueç›®å½•ä¸­çš„å†™å…¥åç§»é‡ï¼Œå³QueueOffset</li><li>å°†queueIdã€queueOffsetç­‰æ•°æ®ï¼Œä¸æ¶ˆæ¯ä¸€èµ·å°è£…ä¸ºæ¶ˆæ¯å•å…ƒ</li><li>å°†æ¶ˆæ¯å•å…ƒå†™å…¥åˆ°commitlog</li><li>åŒæ—¶ï¼Œå½¢æˆæ¶ˆæ¯ç´¢å¼•æ¡ç›®</li><li>å°†æ¶ˆæ¯ç´¢å¼•æ¡ç›®åˆ†å‘åˆ°ç›¸åº”çš„consumequeue</li></ul><h4 id="æ¶ˆæ¯æ‹‰å–" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯æ‹‰å–"><span>æ¶ˆæ¯æ‹‰å–</span></a></h4><ul><li>å½“Consumeræ¥æ‹‰å–æ¶ˆæ¯æ—¶ä¼šç»å†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š <ul><li>Consumerè·å–åˆ°å…¶è¦æ¶ˆè´¹æ¶ˆæ¯æ‰€åœ¨Queueçš„æ¶ˆè´¹åç§»é‡offsetï¼Œè®¡ç®—å‡ºå…¶è¦æ¶ˆè´¹æ¶ˆæ¯çš„æ¶ˆæ¯offset</li></ul></li></ul><blockquote><p>æ¶ˆè´¹offsetå³æ¶ˆè´¹è¿›åº¦ï¼Œconsumerå¯¹æŸä¸ªQueueçš„æ¶ˆè´¹offsetï¼Œå³æ¶ˆè´¹åˆ°äº†è¯¥Queueçš„ç¬¬å‡ æ¡æ¶ˆæ¯ æ¶ˆæ¯offset = æ¶ˆè´¹offset + 1</p></blockquote><ul><li>Consumerå‘Brokerå‘é€æ‹‰å–è¯·æ±‚ï¼Œå…¶ä¸­ä¼šåŒ…å«å…¶è¦æ‹‰å–æ¶ˆæ¯çš„Queueã€æ¶ˆæ¯offsetåŠæ¶ˆæ¯Tagã€‚</li><li>Brokerè®¡ç®—åœ¨è¯¥consumequeueä¸­çš„queueOffsetã€‚</li></ul><blockquote><p>queueOffset = æ¶ˆæ¯offset * 20å­—èŠ‚</p></blockquote><ul><li>ä»è¯¥queueOffsetå¤„å¼€å§‹å‘åæŸ¥æ‰¾ç¬¬ä¸€ä¸ªæŒ‡å®šTagçš„ç´¢å¼•æ¡ç›®ã€‚</li><li>è§£æè¯¥ç´¢å¼•æ¡ç›®çš„å‰ 8 ä¸ªå­—èŠ‚ï¼Œå³å¯å®šä½åˆ°è¯¥æ¶ˆæ¯åœ¨commitlogä¸­çš„commitlog offset</li><li>ä»å¯¹åº”commitlog offsetä¸­è¯»å–æ¶ˆæ¯å•å…ƒï¼Œå¹¶å‘é€ç»™Consumer</li></ul><h4 id="æ€§èƒ½æå‡" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½æå‡"><span>æ€§èƒ½æå‡</span></a></h4><p>RocketMQä¸­ï¼Œæ— è®ºæ˜¯æ¶ˆæ¯æœ¬èº«è¿˜æ˜¯æ¶ˆæ¯ç´¢å¼•ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ã€‚å…¶ä¸ä¼šå½±å“æ¶ˆæ¯çš„æ¶ˆè´¹å—ï¼Ÿå½“ç„¶ä¸ä¼šã€‚å…¶å®RocketMQçš„æ€§èƒ½åœ¨ç›®å‰çš„MQäº§å“ä¸­æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚å› ä¸ºç³»ç»Ÿé€šè¿‡ä¸€ç³»åˆ—ç›¸å…³æœºåˆ¶å¤§å¤§æå‡äº†æ€§èƒ½ã€‚</p><p>é¦–å…ˆï¼ŒRocketMQå¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œæ˜¯é€šè¿‡<code>mmapé›¶æ‹·è´</code>è¿›è¡Œçš„ï¼Œå°†å¯¹æ–‡ä»¶çš„æ“ä½œè½¬åŒ–ä¸ºç›´æ¥å¯¹å†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œä»è€Œæå¤§åœ°æé«˜äº†æ–‡ä»¶çš„è¯»å†™æ•ˆç‡ã€‚</p><p>å…¶æ¬¡ï¼Œconsumequeueä¸­çš„æ•°æ®æ˜¯é¡ºåºå­˜æ”¾çš„ï¼Œè¿˜å¼•å…¥äº†<code>PageCacheçš„é¢„è¯»å–æœºåˆ¶</code>ï¼Œä½¿å¾—å¯¹consumequeueæ–‡ä»¶çš„è¯»å–å‡ ä¹æ¥è¿‘äºå†…å­˜è¯»å–ï¼Œå³ä½¿åœ¨æœ‰æ¶ˆæ¯å †ç§¯æƒ…å†µä¸‹ä¹Ÿä¸ä¼šå½±å“æ€§èƒ½ã€‚</p><blockquote><p>PageCacheæœºåˆ¶ï¼Œé¡µç¼“å­˜æœºåˆ¶ï¼Œæ˜¯OSå¯¹æ–‡ä»¶çš„ç¼“å­˜æœºåˆ¶ï¼Œç”¨äºåŠ é€Ÿå¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç¨‹åºå¯¹æ–‡ä»¶è¿›è¡Œé¡ºåºè¯»å†™çš„é€Ÿåº¦å‡ ä¹æ¥è¿‘äºå†…å­˜è¯»å†™é€Ÿåº¦ï¼Œä¸»è¦åŸå› æ˜¯ç”±äºOSä½¿ç”¨PageCacheæœºåˆ¶å¯¹è¯»å†™è®¿é—®æ“ä½œè¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œå°†ä¸€éƒ¨åˆ†çš„å†…å­˜ç”¨ä½œPageCacheã€‚ 1)å†™æ“ä½œï¼šOSä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°PageCacheä¸­ï¼Œéšåä¼šä»¥å¼‚æ­¥æ–¹å¼ç”±pdÃ¦ushï¼ˆpage dirty Ã¦ush)å†…æ ¸çº¿ç¨‹å°†Cacheä¸­çš„æ•°æ®åˆ·ç›˜åˆ°ç‰©ç†ç£ç›˜ 2)è¯»æ“ä½œï¼šè‹¥ç”¨æˆ·è¦è¯»å–æ•°æ®ï¼Œå…¶é¦–å…ˆä¼šä»PageCacheä¸­è¯»å–ï¼Œè‹¥æ²¡æœ‰å‘½ä¸­ï¼Œåˆ™OSåœ¨ä»ç‰©ç†ç£ç›˜ä¸ŠåŠ è½½è¯¥æ•°æ®åˆ°PageCacheçš„åŒæ—¶ï¼Œä¹Ÿä¼šé¡ºåº å¯¹å…¶ç›¸é‚»æ•°æ®å—ä¸­çš„æ•°æ®è¿›è¡Œé¢„è¯»å–ã€‚</p></blockquote><p>RocketMQä¸­å¯èƒ½ä¼šå½±å“æ€§èƒ½çš„æ˜¯å¯¹commitlogæ–‡ä»¶çš„è¯»å–ã€‚å› ä¸ºå¯¹commitlogæ–‡ä»¶æ¥è¯´ï¼Œè¯»å–æ¶ˆæ¯æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„éšæœºè®¿é—®ï¼Œè€Œéšæœºè®¿é—®ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚ä¸è¿‡ï¼Œå¦‚æœé€‰æ‹©åˆé€‚çš„ç³»ç»ŸIOè°ƒåº¦ç®—æ³•ï¼Œæ¯”å¦‚è®¾ç½®è°ƒåº¦ç®—æ³•ä¸ºDeadlineï¼ˆé‡‡ç”¨SSDå›ºæ€ç¡¬ç›˜çš„è¯ï¼‰ï¼Œéšæœºè¯»çš„æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€æå‡ã€‚</p><h3 id="_4-ä¸kafkaçš„å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_4-ä¸kafkaçš„å¯¹æ¯”"><span>4 ä¸Kafkaçš„å¯¹æ¯”</span></a></h3><p>RocketMQçš„å¾ˆå¤šæ€æƒ³æ¥æºäºKafkaï¼Œå…¶ä¸­commitlogä¸consumequeueå°±æ˜¯ã€‚</p><p>RocketMQä¸­çš„commitlogç›®å½•ä¸consumequeueçš„ç»“åˆå°±ç±»ä¼¼äºKafkaä¸­çš„partitionåˆ†åŒºç›®å½•ã€‚mappedFileæ–‡ä»¶å°±ç±»ä¼¼äºKafkaä¸­çš„segmentæ®µã€‚</p><blockquote><p>Kafkaä¸­çš„Topicçš„æ¶ˆæ¯è¢«åˆ†å‰²ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚partitionæ˜¯ä¸€ä¸ªç‰©ç†æ¦‚å¿µï¼Œå¯¹åº”åˆ°ç³»ç»Ÿä¸Šå°±æ˜¯topicç›®å½•ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªç›®å½•ã€‚æ¯ä¸ªpartitionä¸­åŒ…å«çš„æ–‡ä»¶ç§°ä¸ºsegmentï¼Œæ˜¯å…·ä½“å­˜æ”¾æ¶ˆæ¯çš„æ–‡ä»¶ã€‚ Kafkaä¸­æ¶ˆæ¯å­˜æ”¾çš„ç›®å½•ç»“æ„æ˜¯ï¼štopicç›®å½•ä¸‹æœ‰partitionç›®å½•ï¼Œpartitionç›®å½•ä¸‹æœ‰segmentæ–‡ä»¶ Kafkaä¸­æ²¡æœ‰äºŒçº§åˆ†ç±»æ ‡ç­¾Tagè¿™ä¸ªæ¦‚å¿µ Kafkaä¸­æ— éœ€ç´¢å¼•æ–‡ä»¶ã€‚å› ä¸ºç”Ÿäº§è€…æ˜¯å°†æ¶ˆæ¯ç›´æ¥å†™åœ¨äº†partitionä¸­çš„ï¼Œæ¶ˆè´¹è€…ä¹Ÿæ˜¯ç›´æ¥ä»partitionä¸­è¯»å–æ•°æ®çš„</p></blockquote><h2 id="ä¸‰ã€indexfile" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€indexfile"><span>ä¸‰ã€indexFile</span></a></h2><p>é™¤äº†é€šè¿‡é€šå¸¸çš„æŒ‡å®šTopicè¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹å¤–ï¼ŒRocketMQè¿˜æä¾›äº†æ ¹æ®keyè¿›è¡Œæ¶ˆæ¯æŸ¥è¯¢çš„åŠŸèƒ½ã€‚è¯¥æŸ¥è¯¢æ˜¯é€šè¿‡storeç›®å½•ä¸­çš„indexå­ç›®å½•ä¸­çš„indexFileè¿›è¡Œç´¢å¼•å®ç°çš„å¿«é€ŸæŸ¥è¯¢ã€‚å½“ç„¶ï¼Œè¿™ä¸ªindexFileä¸­çš„ç´¢å¼•æ•°æ®æ˜¯åœ¨<code>åŒ…å«äº†keyçš„æ¶ˆæ¯</code>è¢«å‘é€åˆ°Brokeræ—¶å†™å…¥çš„ã€‚å¦‚æœæ¶ˆæ¯ä¸­æ²¡æœ‰åŒ…å«keyï¼Œåˆ™ä¸ä¼šå†™å…¥ã€‚</p><h3 id="_1-ç´¢å¼•æ¡ç›®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-ç´¢å¼•æ¡ç›®ç»“æ„"><span>1 ç´¢å¼•æ¡ç›®ç»“æ„</span></a></h3><p>æ¯ä¸ªBrokerä¸­ä¼šåŒ…å«ä¸€ç»„indexFileï¼Œæ¯ä¸ªindexFileéƒ½æ˜¯ä»¥ä¸€ä¸ª<code>æ—¶é—´æˆ³</code>å‘½åçš„ï¼ˆè¿™ä¸ªindexFileè¢«åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ï¼‰ã€‚æ¯ä¸ªindexFileæ–‡ä»¶ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼šindexHeaderï¼Œslotsæ§½ä½ï¼Œindexesç´¢å¼•æ•°æ®ã€‚æ¯ä¸ª indexFileæ–‡ä»¶ä¸­åŒ…å«500wä¸ªslotæ§½ã€‚è€Œæ¯ä¸ªslotæ§½åˆå¯èƒ½ä¼šæŒ‚è½½å¾ˆå¤šçš„indexç´¢å¼•å•å…ƒã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208135939.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>indexHeaderå›ºå®š 40 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­å­˜æ”¾ç€å¦‚ä¸‹æ•°æ®ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208135949.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><ul><li>beginTimestampï¼šè¯¥indexFileä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯çš„å­˜å‚¨æ—¶é—´</li><li>endTimestampï¼šè¯¥indexFileä¸­æœ€åä¸€æ¡æ¶ˆæ¯å­˜å‚¨æ—¶é—´</li><li>beginPhyoffsetï¼šè¯¥indexFileä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯åœ¨commitlogä¸­çš„åç§»é‡commitlog offset</li><li>endPhyoffsetï¼šè¯¥indexFileä¸­æœ€åä¸€æ¡æ¶ˆæ¯åœ¨commitlogä¸­çš„åç§»é‡commitlog offset</li><li>hashSlotCountï¼šå·²ç»å¡«å……æœ‰indexçš„slotæ•°é‡ï¼ˆå¹¶ä¸æ˜¯æ¯ä¸ªslotæ§½ä¸‹éƒ½æŒ‚è½½æœ‰indexç´¢å¼•å•å…ƒï¼Œè¿™é‡Œç»Ÿè®¡çš„æ˜¯æ‰€æœ‰æŒ‚è½½äº†indexç´¢å¼•å•å…ƒçš„slotæ§½çš„æ•°é‡ï¼‰</li><li>indexCountï¼šè¯¥indexFileä¸­åŒ…å«çš„ç´¢å¼•å•å…ƒä¸ªæ•°ï¼ˆç»Ÿè®¡å‡ºå½“å‰indexFileä¸­æ‰€æœ‰slotæ§½ä¸‹æŒ‚è½½çš„æ‰€æœ‰indexç´¢å¼•å•å…ƒçš„æ•°é‡ä¹‹å’Œï¼‰</li></ul><p>indexFileä¸­æœ€å¤æ‚çš„æ˜¯Slotsä¸Indexesé—´çš„å…³ç³»ã€‚åœ¨å®é™…å­˜å‚¨æ—¶ï¼ŒIndexesæ˜¯åœ¨Slotsåé¢çš„ï¼Œä½†ä¸ºäº†ä¾¿äºç†è§£ï¼Œå°†å®ƒä»¬çš„å…³ç³»å±•ç¤ºä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208140054.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p><code>keyçš„hashå€¼ % 500w</code>çš„ç»“æœå³ä¸ºslotæ§½ä½ï¼Œç„¶åå°†è¯¥slotå€¼ä¿®æ”¹ä¸ºè¯¥indexç´¢å¼•å•å…ƒçš„indexNoï¼Œæ ¹æ®è¿™ä¸ªindexNoå¯ä»¥è®¡ç®—å‡ºè¯¥indexå•å…ƒåœ¨indexFileä¸­çš„ä½ç½®ã€‚ä¸è¿‡ï¼Œè¯¥å–æ¨¡ç»“æœçš„é‡å¤ç‡æ˜¯å¾ˆé«˜çš„ï¼Œä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œåœ¨æ¯ä¸ªindexç´¢å¼•å•å…ƒä¸­å¢åŠ äº†preIndexNoï¼Œç”¨äºæŒ‡å®šè¯¥slotä¸­å½“å‰indexç´¢å¼•å•å…ƒçš„å‰ä¸€ä¸ªindexç´¢å¼•å•å…ƒã€‚è€Œslotä¸­å§‹ç»ˆå­˜æ”¾çš„æ˜¯å…¶ä¸‹æœ€æ–°çš„indexç´¢å¼•å•å…ƒçš„indexNoï¼Œè¿™æ ·çš„è¯ï¼Œåªè¦æ‰¾åˆ°äº†slotå°±å¯ä»¥æ‰¾åˆ°å…¶æœ€æ–°çš„indexç´¢å¼•å•å…ƒï¼Œè€Œé€šè¿‡è¿™ä¸ªindexç´¢å¼•å•å…ƒå°±å¯ä»¥æ‰¾åˆ°å…¶ä¹‹å‰çš„æ‰€æœ‰indexç´¢å¼•å•å…ƒã€‚</p><blockquote><p>indexNoæ˜¯ä¸€ä¸ªåœ¨indexFileä¸­çš„æµæ°´å·ï¼Œä» 0 å¼€å§‹ä¾æ¬¡é€’å¢ã€‚å³åœ¨ä¸€ä¸ªindexFileä¸­æ‰€æœ‰indexNoæ˜¯ä»¥æ­¤é€’å¢çš„ã€‚indexNoåœ¨indexç´¢å¼•å•å…ƒä¸­æ˜¯æ²¡æœ‰ä½“ç°çš„ï¼Œå…¶æ˜¯é€šè¿‡indexesä¸­ä¾æ¬¡æ•°å‡ºæ¥çš„ã€‚</p></blockquote><p>indexç´¢å¼•å•å…ƒé»˜å†™ 20 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­å­˜æ”¾ç€ä»¥ä¸‹å››ä¸ªå±æ€§ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208140159.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><ul><li>keyHashï¼šæ¶ˆæ¯ä¸­æŒ‡å®šçš„ä¸šåŠ¡keyçš„hashå€¼</li><li>phyOffsetï¼šå½“å‰keyå¯¹åº”çš„æ¶ˆæ¯åœ¨commitlogä¸­çš„åç§»é‡commitlog offset</li><li>timeDiffï¼šå½“å‰keyå¯¹åº”æ¶ˆæ¯çš„å­˜å‚¨æ—¶é—´ä¸å½“å‰indexFileåˆ›å»ºæ—¶é—´çš„æ—¶é—´å·®</li><li>preIndexNoï¼šå½“å‰slotä¸‹å½“å‰indexç´¢å¼•å•å…ƒçš„å‰ä¸€ä¸ªindexç´¢å¼•å•å…ƒçš„indexNo</li></ul><h3 id="_2-indexfileçš„åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#_2-indexfileçš„åˆ›å»º"><span>2 indexFileçš„åˆ›å»º</span></a></h3><p>indexFileçš„æ–‡ä»¶åä¸ºå½“å‰æ–‡ä»¶è¢«åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚è¿™ä¸ªæ—¶é—´æˆ³æœ‰ä»€ä¹ˆç”¨å¤„å‘¢ï¼Ÿ</p><p>æ ¹æ®ä¸šåŠ¡keyè¿›è¡ŒæŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢æ¡ä»¶é™¤äº†keyä¹‹å¤–ï¼Œè¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æŸ¥è¯¢çš„æ—¶é—´æˆ³ï¼Œè¡¨ç¤ºè¦æŸ¥è¯¢ä¸å¤§äºè¯¥æ—¶é—´æˆ³çš„æœ€æ–°çš„æ¶ˆæ¯ï¼Œå³æŸ¥è¯¢æŒ‡å®šæ—¶é—´æˆ³ä¹‹å‰å­˜å‚¨çš„æœ€æ–°æ¶ˆæ¯ã€‚è¿™ä¸ªæ—¶é—´æˆ³æ–‡ä»¶åå¯ä»¥ç®€åŒ–æŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚å…·ä½“åé¢ä¼šè¯¦ç»†è®²è§£ã€‚</p><p>indexFileæ–‡ä»¶æ˜¯ä½•æ—¶åˆ›å»ºçš„ï¼Ÿå…¶åˆ›å»ºçš„æ¡ä»¶ï¼ˆæ—¶æœºï¼‰æœ‰ä¸¤ä¸ªï¼š</p><ul><li>å½“ç¬¬ä¸€æ¡å¸¦keyçš„æ¶ˆæ¯å‘é€æ¥åï¼Œç³»ç»Ÿå‘ç°æ²¡æœ‰indexFileï¼Œæ­¤æ—¶ä¼šåˆ›å»ºç¬¬ä¸€ä¸ªindexFileæ–‡ä»¶</li><li>å½“ä¸€ä¸ªindexFileä¸­æŒ‚è½½çš„indexç´¢å¼•å•å…ƒæ•°é‡è¶…å‡º2000wä¸ªæ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„indexFileã€‚å½“å¸¦keyçš„æ¶ˆæ¯å‘é€åˆ°æ¥åï¼Œç³»ç»Ÿä¼šæ‰¾åˆ°æœ€æ–°çš„indexFileï¼Œå¹¶ä»å…¶indexHeaderçš„æœ€å 4 å­—èŠ‚ä¸­è¯»å–åˆ°indexCountã€‚è‹¥indexCount &gt;= 2000wæ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„indexFileã€‚</li></ul><blockquote><p>ç”±äºå¯ä»¥æ¨ç®—å‡ºï¼Œä¸€ä¸ªindexFileçš„æœ€å¤§å¤§å°æ˜¯ï¼š(40 + 500w * 4 + 2000w * 20)å­—èŠ‚</p></blockquote><h3 id="_3-æŸ¥è¯¢æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-æŸ¥è¯¢æµç¨‹"><span>3 æŸ¥è¯¢æµç¨‹</span></a></h3><p>å½“æ¶ˆè´¹è€…é€šè¿‡ä¸šåŠ¡keyæ¥æŸ¥è¯¢ç›¸åº”çš„æ¶ˆæ¯æ—¶ï¼Œå…¶éœ€è¦ç»è¿‡ä¸€ä¸ªç›¸å¯¹è¾ƒå¤æ‚çš„æŸ¥è¯¢æµç¨‹ã€‚ä¸è¿‡ï¼Œåœ¨åˆ†ææŸ¥è¯¢æµç¨‹ä¹‹å‰ï¼Œé¦–å…ˆè¦æ¸…æ¥šå‡ ä¸ªå®šä½è®¡ç®—å¼å­ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">è®¡ç®—æŒ‡å®šæ¶ˆæ¯keyçš„slotæ§½ä½åºå·ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">slotæ§½ä½åºå·</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> keyçš„hash</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> %</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 500w</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (å¼å­1)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">è®¡ç®—æ§½ä½åºå·ä¸ºnçš„slotåœ¨indexFileä¸­çš„èµ·å§‹ä½ç½®ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">slot(n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)ä½ç½® = 40 + (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 4 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">å¼å­2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">è®¡ç®—indexNoä¸ºmçš„indexåœ¨indexFileä¸­çš„ä½ç½®ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">index(m</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)ä½ç½® = 40 + 500w </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 4 + (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 20 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">å¼å­3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>40 ä¸ºindexFileä¸­indexHeaderçš„å­—èŠ‚æ•° 500w * 4 æ˜¯æ‰€æœ‰slotsæ‰€å çš„å­—èŠ‚æ•°</p></blockquote><h4 id="å…·ä½“æŸ¥è¯¢æµç¨‹å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#å…·ä½“æŸ¥è¯¢æµç¨‹å¦‚ä¸‹"><span>å…·ä½“æŸ¥è¯¢æµç¨‹å¦‚ä¸‹ï¼š</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208140740.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h2 id="å››ã€æ¶ˆæ¯çš„æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#å››ã€æ¶ˆæ¯çš„æ¶ˆè´¹"><span>å››ã€æ¶ˆæ¯çš„æ¶ˆè´¹</span></a></h2><p>æ¶ˆè´¹è€…ä»Brokerä¸­è·å–æ¶ˆæ¯çš„æ–¹å¼æœ‰ä¸¤ç§ï¼špullæ‹‰å–æ–¹å¼å’Œpushæ¨åŠ¨æ–¹å¼ã€‚æ¶ˆè´¹è€…ç»„å¯¹äºæ¶ˆæ¯æ¶ˆè´¹çš„æ¨¡å¼åˆåˆ†ä¸ºä¸¤ç§ï¼šé›†ç¾¤æ¶ˆè´¹Clusteringå’Œå¹¿æ’­æ¶ˆè´¹Broadcastingã€‚</p><h3 id="_1-è·å–æ¶ˆè´¹ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_1-è·å–æ¶ˆè´¹ç±»å‹"><span>1 è·å–æ¶ˆè´¹ç±»å‹</span></a></h3><h4 id="æ‹‰å–å¼æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#æ‹‰å–å¼æ¶ˆè´¹"><span>æ‹‰å–å¼æ¶ˆè´¹</span></a></h4><p>Consumerä¸»åŠ¨ä»Brokerä¸­æ‹‰å–æ¶ˆæ¯ï¼Œä¸»åŠ¨æƒç”±Consumeræ§åˆ¶ã€‚ä¸€æ—¦è·å–äº†æ‰¹é‡æ¶ˆæ¯ï¼Œå°±ä¼šå¯åŠ¨æ¶ˆè´¹è¿‡ç¨‹ã€‚ä¸è¿‡ï¼Œè¯¥æ–¹å¼çš„å®æ—¶æ€§è¾ƒå¼±ï¼Œå³Brokerä¸­æœ‰äº†æ–°çš„æ¶ˆæ¯æ—¶æ¶ˆè´¹è€…å¹¶ä¸èƒ½åŠæ—¶å‘ç°å¹¶æ¶ˆè´¹ã€‚</p><blockquote><p>ç”±äºæ‹‰å–æ—¶é—´é—´éš”æ˜¯ç”±ç”¨æˆ·æŒ‡å®šçš„ï¼Œæ‰€ä»¥åœ¨è®¾ç½®è¯¥é—´éš”æ—¶éœ€è¦æ³¨æ„å¹³ç¨³ï¼šé—´éš”å¤ªçŸ­ï¼Œç©ºè¯·æ±‚æ¯”ä¾‹ä¼šå¢åŠ ï¼›é—´éš”å¤ªé•¿ï¼Œæ¶ˆæ¯çš„å®æ—¶æ€§å¤ªå·®</p></blockquote><h4 id="æ¨é€å¼æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#æ¨é€å¼æ¶ˆè´¹"><span>æ¨é€å¼æ¶ˆè´¹</span></a></h4><p>è¯¥æ¨¡å¼ä¸‹Brokeræ”¶åˆ°æ•°æ®åä¼šä¸»åŠ¨æ¨é€ç»™Consumerã€‚è¯¥è·å–æ–¹å¼ä¸€èˆ¬å®æ—¶æ€§è¾ƒé«˜ã€‚</p><p>è¯¥è·å–æ–¹å¼æ˜¯å…¸å‹çš„<code>å‘å¸ƒ-è®¢é˜…</code>æ¨¡å¼ï¼Œå³Consumerå‘å…¶å…³è”çš„Queueæ³¨å†Œäº†ç›‘å¬å™¨ï¼Œä¸€æ—¦å‘ç°æœ‰æ–°çš„æ¶ˆæ¯åˆ°æ¥å°±ä¼šè§¦å‘å›è°ƒçš„æ‰§è¡Œï¼Œå›è°ƒæ–¹æ³•æ˜¯Consumerå»Queueä¸­æ‹‰å–æ¶ˆæ¯ã€‚è€Œè¿™äº›éƒ½æ˜¯åŸºäºConsumerä¸Brokeré—´çš„é•¿è¿æ¥çš„ã€‚é•¿è¿æ¥çš„ç»´æŠ¤æ˜¯éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºçš„ã€‚</p><h4 id="å¯¹æ¯”-1" tabindex="-1"><a class="header-anchor" href="#å¯¹æ¯”-1"><span>å¯¹æ¯”</span></a></h4><ul><li>pullï¼šéœ€è¦åº”ç”¨å»å®ç°å¯¹å…³è”Queueçš„éå†ï¼Œå®æ—¶æ€§å·®ï¼›ä½†ä¾¿äºåº”ç”¨æ§åˆ¶æ¶ˆæ¯çš„æ‹‰å–</li><li>pushï¼šå°è£…äº†å¯¹å…³è”Queueçš„éå†ï¼Œå®æ—¶æ€§å¼ºï¼Œä½†ä¼šå ç”¨è¾ƒå¤šçš„ç³»ç»Ÿèµ„æº</li></ul><h3 id="_2-æ¶ˆè´¹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-æ¶ˆè´¹æ¨¡å¼"><span>2 æ¶ˆè´¹æ¨¡å¼</span></a></h3><h4 id="å¹¿æ’­æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#å¹¿æ’­æ¶ˆè´¹"><span>å¹¿æ’­æ¶ˆè´¹</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208141005.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒConsumer Groupçš„æ¯ä¸ªConsumerå®ä¾‹éƒ½æ¥æ”¶åŒä¸€ä¸ªTopicçš„å…¨é‡æ¶ˆæ¯ã€‚å³æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«å‘é€åˆ°Consumer Groupä¸­çš„æ¯ä¸ªConsumerã€‚</p><h4 id="é›†ç¾¤æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤æ¶ˆè´¹"><span>é›†ç¾¤æ¶ˆè´¹</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208141053.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒConsumer Groupçš„æ¯ä¸ªConsumerå®ä¾‹<code>å¹³å‡åˆ†æ‘Š</code>åŒä¸€ä¸ªTopicçš„æ¶ˆæ¯ã€‚å³æ¯æ¡æ¶ˆæ¯åªä¼šè¢«å‘é€åˆ°Consumer Groupä¸­çš„<code>æŸä¸ª</code>Consumerã€‚</p><h4 id="æ¶ˆæ¯è¿›åº¦ä¿å­˜" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯è¿›åº¦ä¿å­˜"><span>æ¶ˆæ¯è¿›åº¦ä¿å­˜</span></a></h4><ul><li>å¹¿æ’­æ¨¡å¼ï¼šæ¶ˆè´¹è¿›åº¦ä¿å­˜åœ¨consumerç«¯ã€‚å› ä¸ºå¹¿æ’­æ¨¡å¼ä¸‹consumer groupä¸­æ¯ä¸ªconsumeréƒ½ä¼šæ¶ˆè´¹æ‰€æœ‰æ¶ˆæ¯ï¼Œä½†å®ƒä»¬çš„æ¶ˆè´¹è¿›åº¦æ˜¯ä¸åŒã€‚æ‰€ä»¥consumerå„è‡ªä¿å­˜å„è‡ªçš„æ¶ˆè´¹è¿›åº¦ã€‚</li><li>é›†ç¾¤æ¨¡å¼ï¼šæ¶ˆè´¹è¿›åº¦ä¿å­˜åœ¨brokerä¸­ã€‚consumer groupä¸­çš„æ‰€æœ‰consumerå…±åŒæ¶ˆè´¹åŒä¸€ä¸ªTopicä¸­çš„æ¶ˆæ¯ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚æ¶ˆè´¹è¿›åº¦ä¼šå‚ä¸åˆ°äº†æ¶ˆè´¹çš„è´Ÿè½½å‡è¡¡ä¸­ï¼Œæ•…æ¶ˆè´¹è¿›åº¦æ˜¯éœ€è¦å…±äº«çš„ã€‚ä¸‹å›¾æ˜¯brokerä¸­å­˜æ”¾çš„å„ä¸ªTopicçš„å„ä¸ªQueueçš„æ¶ˆè´¹è¿›åº¦ã€‚</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208141202.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_3-rebalanceæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_3-rebalanceæœºåˆ¶"><span>3 Rebalanceæœºåˆ¶</span></a></h3><p>Rebalanceæœºåˆ¶è®¨è®ºçš„å‰ææ˜¯ï¼šé›†ç¾¤æ¶ˆè´¹ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯rebalance" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯rebalance"><span>ä»€ä¹ˆæ˜¯Rebalance</span></a></h4><p>Rebalanceå³å†å‡è¡¡ï¼ŒæŒ‡çš„æ˜¯ï¼Œå°†ä¸€ä¸ªTopicä¸‹çš„å¤šä¸ªQueueåœ¨åŒä¸€ä¸ªConsumer Groupä¸­çš„å¤šä¸ªConsumeré—´è¿›è¡Œé‡æ–°åˆ†é…çš„è¿‡ç¨‹ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208141304.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>Rebalanceæœºåˆ¶çš„æœ¬æ„æ˜¯ä¸ºäº†æå‡æ¶ˆæ¯çš„å¹¶è¡Œæ¶ˆè´¹èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªTopicä¸‹ 5 ä¸ªé˜Ÿåˆ—ï¼Œåœ¨åªæœ‰ 1 ä¸ªæ¶ˆè´¹è€…çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¶ˆè´¹è€…å°†è´Ÿè´£æ¶ˆè´¹è¿™ 5 ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬å¢åŠ ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»™å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†é… 2 ä¸ªé˜Ÿåˆ—ï¼Œç»™å¦ä¸€ä¸ªåˆ†é… 3 ä¸ªé˜Ÿåˆ—ï¼Œä»è€Œæå‡æ¶ˆæ¯çš„å¹¶è¡Œæ¶ˆè´¹èƒ½åŠ›ã€‚</p><h4 id="rebalanceé™åˆ¶" tabindex="-1"><a class="header-anchor" href="#rebalanceé™åˆ¶"><span>Rebalanceé™åˆ¶</span></a></h4><p>ç”±äºä¸€ä¸ªé˜Ÿåˆ—æœ€å¤šåˆ†é…ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå› æ­¤å½“æŸä¸ªæ¶ˆè´¹è€…ç»„ä¸‹çš„æ¶ˆè´¹è€…å®ä¾‹æ•°é‡å¤§äºé˜Ÿåˆ—çš„æ•°é‡æ—¶ï¼Œå¤šä½™çš„æ¶ˆè´¹è€…å®ä¾‹å°†åˆ†é…ä¸åˆ°ä»»ä½•é˜Ÿåˆ—ã€‚</p><h4 id="rebalanceå±å®³" tabindex="-1"><a class="header-anchor" href="#rebalanceå±å®³"><span>Rebalanceå±å®³</span></a></h4><p>Rebalanceçš„åœ¨æå‡æ¶ˆè´¹èƒ½åŠ›çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š</p><p><code>æ¶ˆè´¹æš‚åœï¼š</code>åœ¨åªæœ‰ä¸€ä¸ªConsumeræ—¶ï¼Œå…¶è´Ÿè´£æ¶ˆè´¹æ‰€æœ‰é˜Ÿåˆ—ï¼›åœ¨æ–°å¢äº†ä¸€ä¸ªConsumeråä¼šè§¦å‘Rebalanceçš„å‘ç”Ÿã€‚æ­¤æ—¶åŸConsumerå°±éœ€è¦æš‚åœéƒ¨åˆ†é˜Ÿåˆ—çš„æ¶ˆè´¹ï¼Œç­‰åˆ°è¿™äº›é˜Ÿåˆ—åˆ†é…ç»™æ–°çš„Consumeråï¼Œè¿™äº›æš‚åœæ¶ˆè´¹çš„é˜Ÿåˆ—æ‰èƒ½ç»§ç»­è¢«æ¶ˆè´¹ã€‚</p><p><code>æ¶ˆè´¹é‡å¤ï¼š</code>Consumer åœ¨æ¶ˆè´¹æ–°åˆ†é…ç»™è‡ªå·±çš„é˜Ÿåˆ—æ—¶ï¼Œå¿…é¡»æ¥ç€ä¹‹å‰Consumer æäº¤çš„æ¶ˆè´¹è¿›åº¦çš„offsetç»§ç»­æ¶ˆè´¹ã€‚ç„¶è€Œé»˜è®¤æƒ…å†µä¸‹ï¼Œoffsetæ˜¯å¼‚æ­¥æäº¤çš„ï¼Œè¿™ä¸ªå¼‚æ­¥æ€§å¯¼è‡´æäº¤åˆ°Brokerçš„offsetä¸Consumerå®é™…æ¶ˆè´¹çš„æ¶ˆæ¯å¹¶ä¸ä¸€è‡´ã€‚è¿™ä¸ªä¸ä¸€è‡´çš„å·®å€¼å°±æ˜¯å¯èƒ½ä¼šé‡å¤æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚</p><blockquote><p>åŒæ­¥æäº¤ï¼šconsumeræäº¤äº†å…¶æ¶ˆè´¹å®Œæ¯•çš„ä¸€æ‰¹æ¶ˆæ¯çš„offsetç»™brokeråï¼Œéœ€è¦ç­‰å¾…brokerçš„æˆåŠŸACKã€‚å½“æ”¶åˆ°ACKåï¼Œconsumeræ‰ä¼šç»§ç»­è·å–å¹¶æ¶ˆè´¹ä¸‹ä¸€æ‰¹æ¶ˆæ¯ã€‚åœ¨ç­‰å¾…ACKæœŸé—´ï¼Œconsumeræ˜¯é˜»å¡çš„ã€‚ å¼‚æ­¥æäº¤ï¼šconsumeræäº¤äº†å…¶æ¶ˆè´¹å®Œæ¯•çš„ä¸€æ‰¹æ¶ˆæ¯çš„offsetç»™brokeråï¼Œä¸éœ€è¦ç­‰å¾…brokerçš„æˆåŠŸACKã€‚consumerå¯ä»¥ç›´æ¥è·å–å¹¶æ¶ˆè´¹ä¸‹ä¸€æ‰¹æ¶ˆæ¯ã€‚ å¯¹äºä¸€æ¬¡æ€§è¯»å–æ¶ˆæ¯çš„æ•°é‡ï¼Œéœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯é€‰æ‹©ä¸€ä¸ªç›¸å¯¹å‡è¡¡çš„æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å› ä¸ºæ•°é‡è¿‡å¤§ï¼Œç³»ç»Ÿæ€§èƒ½æå‡äº†ï¼Œä½†äº§ç”Ÿé‡å¤æ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡å¯èƒ½ä¼šå¢åŠ ï¼›æ•°é‡è¿‡å°ï¼Œç³»ç»Ÿæ€§èƒ½ä¼šä¸‹é™ï¼Œä½†è¢«é‡å¤æ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡å¯èƒ½ä¼šå‡å°‘ã€‚</p></blockquote><p><code>æ¶ˆè´¹çªåˆºï¼š</code>ç”±äºRebalanceå¯èƒ½å¯¼è‡´é‡å¤æ¶ˆè´¹ï¼Œå¦‚æœéœ€è¦é‡å¤æ¶ˆè´¹çš„æ¶ˆæ¯è¿‡å¤šï¼Œæˆ–è€…å› ä¸ºRebalanceæš‚åœæ—¶é—´è¿‡é•¿ä»è€Œå¯¼è‡´ç§¯å‹äº†éƒ¨åˆ†æ¶ˆæ¯ã€‚é‚£ä¹ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´åœ¨Rebalanceç»“æŸä¹‹åç¬é—´éœ€è¦æ¶ˆè´¹å¾ˆå¤šæ¶ˆæ¯ã€‚</p><h4 id="rebalanceäº§ç”Ÿçš„åŸå› " tabindex="-1"><a class="header-anchor" href="#rebalanceäº§ç”Ÿçš„åŸå› "><span>Rebalanceäº§ç”Ÿçš„åŸå› </span></a></h4><p>å¯¼è‡´Rebalanceäº§ç”Ÿçš„åŸå› ï¼Œæ— éå°±ä¸¤ä¸ªï¼šæ¶ˆè´¹è€…æ‰€è®¢é˜…Topicçš„Queueæ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œæˆ–æ¶ˆè´¹è€…ç»„ä¸­æ¶ˆè´¹è€…çš„æ•°é‡å‘ç”Ÿå˜åŒ–ã€‚</p><blockquote><p>1 ï¼‰Queueæ•°é‡å‘ç”Ÿå˜åŒ–çš„åœºæ™¯ï¼š Brokeræ‰©å®¹æˆ–ç¼©å®¹ Brokerå‡çº§è¿ç»´ Brokerä¸NameServeré—´çš„ç½‘ç»œå¼‚å¸¸ Queueæ‰©å®¹æˆ–ç¼©å®¹ 2 ï¼‰æ¶ˆè´¹è€…æ•°é‡å‘ç”Ÿå˜åŒ–çš„åœºæ™¯ï¼š Consumer Groupæ‰©å®¹æˆ–ç¼©å®¹ Consumerå‡çº§è¿ç»´ Consumerä¸NameServeré—´ç½‘ç»œå¼‚å¸¸</p></blockquote><h4 id="rebalanceè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#rebalanceè¿‡ç¨‹"><span>Rebalanceè¿‡ç¨‹</span></a></h4><p>åœ¨Brokerä¸­ç»´æŠ¤ç€å¤šä¸ªMapé›†åˆï¼Œè¿™äº›é›†åˆä¸­åŠ¨æ€å­˜æ”¾ç€å½“å‰Topicä¸­Queueçš„ä¿¡æ¯ã€Consumer Groupä¸­Consumerå®ä¾‹çš„ä¿¡æ¯ã€‚ä¸€æ—¦å‘ç°æ¶ˆè´¹è€…æ‰€è®¢é˜…çš„Queueæ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œæˆ–æ¶ˆè´¹è€…ç»„ä¸­æ¶ˆè´¹è€…çš„æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œç«‹å³å‘Consumer Groupä¸­çš„æ¯ä¸ªå®ä¾‹å‘å‡ºRebalanceé€šçŸ¥ã€‚</p><blockquote><p>TopicConÃ¥gManagerï¼škeyæ˜¯topicåç§°ï¼Œvalueæ˜¯TopicConÃ¥gã€‚TopicConÃ¥gä¸­ç»´æŠ¤ç€è¯¥Topicä¸­æ‰€æœ‰Queueçš„æ•°æ®ã€‚ ConsumerManagerï¼škeyæ˜¯Consumser Group Idï¼Œvalueæ˜¯ConsumerGroupInfoã€‚ ConsumerGroupInfoä¸­ç»´æŠ¤ç€è¯¥Groupä¸­æ‰€æœ‰Consumerå®ä¾‹æ•°æ®ã€‚ ConsumerOffsetManagerï¼škeyä¸º<code>Topicä¸è®¢é˜…è¯¥Topicçš„Groupçš„ç»„åˆ,å³topic@group</code>ï¼Œvalueæ˜¯ä¸€ä¸ªå†…å±‚Mapã€‚å†…å±‚Mapçš„keyä¸ºQueueIdï¼Œå†…å±‚Mapçš„valueä¸ºè¯¥Queueçš„æ¶ˆè´¹è¿›åº¦offsetã€‚</p></blockquote><p>Consumerå®ä¾‹åœ¨æ¥æ”¶åˆ°é€šçŸ¥åä¼šé‡‡ç”¨Queueåˆ†é…ç®—æ³•è‡ªå·±è·å–åˆ°ç›¸åº”çš„Queueï¼Œå³ç”±Consumerå®ä¾‹è‡ªä¸»è¿›è¡ŒRebalanceã€‚</p><h4 id="ä¸kafkaå¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#ä¸kafkaå¯¹æ¯”"><span>ä¸Kafkaå¯¹æ¯”</span></a></h4><p>åœ¨Kafkaä¸­ï¼Œä¸€æ—¦å‘ç°å‡ºç°äº†Rebalanceæ¡ä»¶ï¼ŒBrokerä¼šè°ƒç”¨Group Coordinatoræ¥å®ŒæˆRebalanceã€‚Coordinatoræ˜¯Brokerä¸­çš„ä¸€ä¸ªè¿›ç¨‹ã€‚Coordinatorä¼šåœ¨Consumer Groupä¸­é€‰å‡ºä¸€ä¸ªGroup Leaderã€‚ç”±è¿™ä¸ªLeaderæ ¹æ®è‡ªå·±æœ¬èº«ç»„æƒ…å†µå®ŒæˆPartitionåˆ†åŒºçš„å†åˆ†é…ã€‚è¿™ä¸ªå†åˆ†é…ç»“æœä¼šä¸ŠæŠ¥ç»™Coordinatorï¼Œå¹¶ç”±CoordinatoråŒæ­¥ç»™Groupä¸­çš„æ‰€æœ‰Consumerå®ä¾‹ã€‚</p><p>Kafkaä¸­çš„Rebalanceæ˜¯ç”±Consumer Leaderå®Œæˆçš„ã€‚è€ŒRocketMQä¸­çš„Rebalanceæ˜¯ç”±æ¯ä¸ªConsumerè‡ªèº«å®Œæˆçš„ï¼ŒGroupä¸­ä¸å­˜åœ¨Leaderã€‚</p><h3 id="_4-queueåˆ†é…ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#_4-queueåˆ†é…ç®—æ³•"><span>4 Queueåˆ†é…ç®—æ³•</span></a></h3><p>ä¸€ä¸ªTopicä¸­çš„Queueåªèƒ½ç”±Consumer Groupä¸­çš„ä¸€ä¸ªConsumerè¿›è¡Œæ¶ˆè´¹ï¼Œè€Œä¸€ä¸ªConsumerå¯ä»¥åŒæ—¶æ¶ˆè´¹å¤šä¸ªQueueä¸­çš„æ¶ˆæ¯ã€‚é‚£ä¹ˆQueueä¸Consumeré—´çš„é…å¯¹å…³ç³»æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Œå³Queueè¦åˆ†é…ç»™å“ªä¸ªConsumerè¿›è¡Œæ¶ˆè´¹ï¼Œä¹Ÿæ˜¯æœ‰ç®—æ³•ç­–ç•¥çš„ã€‚å¸¸è§çš„æœ‰å››ç§ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥æ˜¯é€šè¿‡åœ¨åˆ›å»ºConsumeræ—¶çš„æ„é€ å™¨ä¼ è¿›å»çš„ã€‚</p><h4 id="å¹³å‡åˆ†é…ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å¹³å‡åˆ†é…ç­–ç•¥"><span>å¹³å‡åˆ†é…ç­–ç•¥</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208142527.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>è¯¥ç®—æ³•æ˜¯è¦æ ¹æ®<code>avg = QueueCount / ConsumerCount</code>çš„è®¡ç®—ç»“æœè¿›è¡Œåˆ†é…çš„ã€‚å¦‚æœèƒ½å¤Ÿæ•´é™¤ï¼Œåˆ™æŒ‰é¡ºåºå°†avgä¸ªQueueé€ä¸ªåˆ†é…Consumerï¼›å¦‚æœä¸èƒ½æ•´é™¤ï¼Œåˆ™å°†å¤šä½™å‡ºçš„QueueæŒ‰ç…§Consumeré¡ºåºé€ä¸ªåˆ†é…ã€‚</p><blockquote><p>è¯¥ç®—æ³•å³ï¼Œå…ˆè®¡ç®—å¥½æ¯ä¸ªConsumeråº”è¯¥åˆ†å¾—å‡  ä¸ªQueueï¼Œç„¶åå†ä¾æ¬¡å°†è¿™äº›æ•°é‡çš„Queueé€ä¸ªåˆ†é…ä¸ªConsumerã€‚</p></blockquote><h4 id="ç¯å½¢å¹³å‡ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ç¯å½¢å¹³å‡ç­–ç•¥"><span>ç¯å½¢å¹³å‡ç­–ç•¥</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208142630.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>ç¯å½¢å¹³å‡ç®—æ³•æ˜¯æŒ‡ï¼Œæ ¹æ®æ¶ˆè´¹è€…çš„é¡ºåºï¼Œä¾æ¬¡åœ¨ç”±queueé˜Ÿåˆ—ç»„æˆçš„ç¯å½¢å›¾ä¸­é€ä¸ªåˆ†é…ã€‚</p><blockquote><p>è¯¥ç®—æ³•ä¸ç”¨äº‹å…ˆè®¡ç®—æ¯ä¸ªConsumeréœ€è¦åˆ†é…å‡  ä¸ªQueueï¼Œç›´æ¥ä¸€ä¸ªä¸€ä¸ªåˆ†å³å¯ã€‚</p></blockquote><h4 id="ä¸€è‡´æ€§hashç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ä¸€è‡´æ€§hashç­–ç•¥"><span>ä¸€è‡´æ€§hashç­–ç•¥</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208142708.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>è¯¥ç®—æ³•ä¼šå°†consumerçš„hashå€¼ä½œä¸ºNodeèŠ‚ç‚¹å­˜æ”¾åˆ°hashç¯ä¸Šï¼Œç„¶åå°†queueçš„hashå€¼ä¹Ÿæ”¾åˆ°hashç¯ä¸Šï¼Œé€šè¿‡é¡ºæ—¶é’ˆæ–¹å‘ï¼Œè·ç¦»queueæœ€è¿‘çš„é‚£ä¸ªconsumerå°±æ˜¯è¯¥queueè¦åˆ†é…çš„consumerã€‚</p><blockquote><p>è¯¥ç®—æ³•å­˜åœ¨çš„é—®é¢˜ï¼šåˆ†é…ä¸å‡ã€‚</p></blockquote><h4 id="åŒæœºæˆ¿ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#åŒæœºæˆ¿ç­–ç•¥"><span>åŒæœºæˆ¿ç­–ç•¥</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208142814.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>è¯¥ç®—æ³•ä¼šæ ¹æ®queueçš„éƒ¨ç½²æœºæˆ¿ä½ç½®å’Œconsumerçš„ä½ç½®ï¼Œè¿‡æ»¤å‡ºå½“å‰consumerç›¸åŒæœºæˆ¿çš„queueã€‚ç„¶åæŒ‰ç…§å¹³å‡åˆ†é…ç­–ç•¥æˆ–ç¯å½¢å¹³å‡ç­–ç•¥å¯¹åŒæœºæˆ¿queueè¿›è¡Œåˆ†é…ã€‚å¦‚æœæ²¡æœ‰åŒæœºæˆ¿queueï¼Œåˆ™æŒ‰ç…§å¹³å‡åˆ†é…ç­–ç•¥æˆ–ç¯å½¢å¹³å‡ç­–ç•¥å¯¹æ‰€æœ‰queueè¿›è¡Œåˆ†é…ã€‚</p><h4 id="å¯¹æ¯”-2" tabindex="-1"><a class="header-anchor" href="#å¯¹æ¯”-2"><span>å¯¹æ¯”</span></a></h4><p>ä¸€è‡´æ€§hashç®—æ³•å­˜åœ¨çš„é—®é¢˜ï¼š</p><p>ä¸¤ç§å¹³å‡åˆ†é…ç­–ç•¥çš„åˆ†é…æ•ˆç‡è¾ƒé«˜ï¼Œä¸€è‡´æ€§hashç­–ç•¥çš„è¾ƒä½ã€‚å› ä¸ºä¸€è‡´æ€§hashç®—æ³•è¾ƒå¤æ‚ã€‚å¦å¤–ï¼Œä¸€è‡´æ€§hashç­–ç•¥åˆ†é…çš„ç»“æœä¹Ÿå¾ˆå¤§å¯èƒ½ä¸Šå­˜åœ¨ä¸å¹³å‡çš„æƒ…å†µã€‚</p><p>ä¸€è‡´æ€§hashç®—æ³•å­˜åœ¨çš„æ„ä¹‰ï¼š</p><p>å…¶å¯ä»¥æœ‰æ•ˆå‡å°‘ç”±äºæ¶ˆè´¹è€…ç»„æ‰©å®¹æˆ–ç¼©å®¹æ‰€å¸¦æ¥çš„å¤§é‡çš„Rebalanceã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208142905.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>ä¸€è‡´æ€§hashç®—æ³•çš„åº”ç”¨åœºæ™¯ï¼š</p><p>Consumeræ•°é‡å˜åŒ–è¾ƒé¢‘ç¹çš„åœºæ™¯ã€‚</p><h3 id="_5-è‡³å°‘ä¸€æ¬¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#_5-è‡³å°‘ä¸€æ¬¡åŸåˆ™"><span>5 è‡³å°‘ä¸€æ¬¡åŸåˆ™</span></a></h3><p>RocketMQæœ‰ä¸€ä¸ªåŸåˆ™ï¼šæ¯æ¡æ¶ˆæ¯å¿…é¡»è¦è¢«<code>æˆåŠŸæ¶ˆè´¹</code>ä¸€æ¬¡ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯æˆåŠŸæ¶ˆè´¹å‘¢ï¼ŸConsumeråœ¨æ¶ˆè´¹å®Œæ¶ˆæ¯åä¼šå‘å…¶<code>æ¶ˆè´¹è¿›åº¦è®°å½•å™¨</code>æäº¤å…¶æ¶ˆè´¹æ¶ˆæ¯çš„offsetï¼Œoffsetè¢«æˆåŠŸè®°å½•åˆ°è®°å½•å™¨ä¸­ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆè´¹å°±è¢«æˆåŠŸæ¶ˆè´¹äº†ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯æ¶ˆè´¹è¿›åº¦è®°å½•å™¨ï¼Ÿ å¯¹äºå¹¿æ’­æ¶ˆè´¹æ¨¡å¼æ¥è¯´ï¼ŒConsumeræœ¬èº«å°±æ˜¯æ¶ˆè´¹è¿›åº¦è®°å½•å™¨ã€‚ å¯¹äºé›†ç¾¤æ¶ˆè´¹æ¨¡å¼æ¥è¯´ï¼ŒBrokeræ˜¯æ¶ˆè´¹è¿›åº¦è®°å½•å™¨ã€‚</p></blockquote><h2 id="äº”ã€è®¢é˜…å…³ç³»çš„ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#äº”ã€è®¢é˜…å…³ç³»çš„ä¸€è‡´æ€§"><span>äº”ã€è®¢é˜…å…³ç³»çš„ä¸€è‡´æ€§</span></a></h2><p>è®¢é˜…å…³ç³»çš„ä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼ˆGroup IDç›¸åŒï¼‰ä¸‹æ‰€æœ‰Consumerå®ä¾‹æ‰€è®¢é˜…çš„Topicä¸TagåŠå¯¹æ¶ˆæ¯çš„å¤„ç†é€»è¾‘å¿…é¡»å®Œå…¨ä¸€è‡´ã€‚å¦åˆ™ï¼Œæ¶ˆæ¯æ¶ˆè´¹çš„é€»è¾‘å°±ä¼šæ··ä¹±ï¼Œç”šè‡³å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚</p><h3 id="_1-æ­£ç¡®è®¢é˜…å…³ç³»" tabindex="-1"><a class="header-anchor" href="#_1-æ­£ç¡®è®¢é˜…å…³ç³»"><span>1 æ­£ç¡®è®¢é˜…å…³ç³»</span></a></h3><p>å¤šä¸ªæ¶ˆè´¹è€…ç»„è®¢é˜…äº†å¤šä¸ªTopicï¼Œå¹¶ä¸”æ¯ä¸ªæ¶ˆè´¹è€…ç»„é‡Œçš„å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹çš„è®¢é˜…å…³ç³»ä¿æŒäº†ä¸€è‡´ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208143050.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_2-é”™è¯¯è®¢é˜…å…³ç³»" tabindex="-1"><a class="header-anchor" href="#_2-é”™è¯¯è®¢é˜…å…³ç³»"><span>2 é”™è¯¯è®¢é˜…å…³ç³»</span></a></h3><p>ä¸€ä¸ªæ¶ˆè´¹è€…ç»„è®¢é˜…äº†å¤šä¸ªTopicï¼Œä½†æ˜¯è¯¥æ¶ˆè´¹è€…ç»„é‡Œçš„å¤šä¸ªConsumerå®ä¾‹çš„è®¢é˜…å…³ç³»å¹¶æ²¡æœ‰ä¿æŒä¸€è‡´ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208143107.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="è®¢é˜…äº†ä¸åŒtopic" tabindex="-1"><a class="header-anchor" href="#è®¢é˜…äº†ä¸åŒtopic"><span>è®¢é˜…äº†ä¸åŒTopic</span></a></h4><p>è¯¥ä¾‹ä¸­çš„é”™è¯¯åœ¨äºï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸¤ä¸ªConsumerå®ä¾‹è®¢é˜…äº†ä¸åŒçš„Topicã€‚</p><p>Consumerå®ä¾‹1-1ï¼šï¼ˆè®¢é˜…äº†topicä¸ºjodie_test_Aï¼Œtagä¸ºæ‰€æœ‰çš„æ¶ˆæ¯ï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PropertyKeyConst</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GROUP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GID_jodie_test_1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ONSFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(properties);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jodie_test_A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMsgID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CommitMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Consumerå®ä¾‹1-2ï¼šï¼ˆè®¢é˜…äº†topicä¸ºjodie_test_Bï¼Œtagä¸ºæ‰€æœ‰çš„æ¶ˆæ¯ï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PropertyKeyConst</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GROUP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GID_jodie_test_1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ONSFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(properties);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jodie_test_B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMsgID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CommitMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è®¢é˜…äº†ä¸åŒtag" tabindex="-1"><a class="header-anchor" href="#è®¢é˜…äº†ä¸åŒtag"><span>è®¢é˜…äº†ä¸åŒTag</span></a></h4><p>è¯¥ä¾‹ä¸­çš„é”™è¯¯åœ¨äºï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸¤ä¸ªConsumerè®¢é˜…äº†ç›¸åŒTopicçš„ä¸åŒTagã€‚</p><p>Consumerå®ä¾‹2-1ï¼šï¼ˆè®¢é˜…äº†topicä¸ºjodie_test_Aï¼Œtagä¸ºTagAçš„æ¶ˆæ¯ï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PropertyKeyConst</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GROUP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GID_jodie_test_2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ONSFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(properties);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jodie_test_A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TagA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMsgID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CommitMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Consumerå®ä¾‹2-2ï¼šï¼ˆè®¢é˜…äº†topicä¸ºjodie_test_Aï¼Œtagä¸ºæ‰€æœ‰çš„æ¶ˆæ¯ï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PropertyKeyConst</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GROUP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GID_jodie_test_2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ONSFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(properties);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jodie_test_A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMsgID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CommitMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è®¢é˜…äº†ä¸åŒæ•°é‡çš„topic" tabindex="-1"><a class="header-anchor" href="#è®¢é˜…äº†ä¸åŒæ•°é‡çš„topic"><span>è®¢é˜…äº†ä¸åŒæ•°é‡çš„Topic</span></a></h4><p>è¯¥ä¾‹ä¸­çš„é”™è¯¯åœ¨äºï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸¤ä¸ªConsumerè®¢é˜…äº†ä¸åŒæ•°é‡çš„Topicã€‚</p><p>Consumerå®ä¾‹3-1ï¼šï¼ˆè¯¥Consumerè®¢é˜…äº†ä¸¤ä¸ªTopicï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PropertyKeyConst</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GROUP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GID_jodie_test_3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ONSFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(properties);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jodie_test_A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TagA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMsgID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CommitMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jodie_test_B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TagB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMsgID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CommitMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Consumerå®ä¾‹3-2ï¼šï¼ˆè¯¥Consumerè®¢é˜…äº†ä¸€ä¸ªTopicï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PropertyKeyConst</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GROUP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;GID_jodie_test_3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ONSFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(properties);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jodie_test_A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TagB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMsgID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Action</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CommitMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…­ã€offsetç®¡ç†" tabindex="-1"><a class="header-anchor" href="#å…­ã€offsetç®¡ç†"><span>å…­ã€offsetç®¡ç†</span></a></h2><blockquote><p>è¿™é‡Œçš„offsetæŒ‡çš„æ˜¯Consumerçš„æ¶ˆè´¹è¿›åº¦offsetã€‚</p></blockquote><p>æ¶ˆè´¹è¿›åº¦offsetæ˜¯ç”¨æ¥è®°å½•æ¯ä¸ªQueueçš„ä¸åŒæ¶ˆè´¹ç»„çš„æ¶ˆè´¹è¿›åº¦çš„ã€‚æ ¹æ®æ¶ˆè´¹è¿›åº¦è®°å½•å™¨çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼šæœ¬åœ°æ¨¡å¼å’Œè¿œç¨‹æ¨¡å¼ã€‚</p><h3 id="_1-offsetæœ¬åœ°ç®¡ç†æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_1-offsetæœ¬åœ°ç®¡ç†æ¨¡å¼"><span>1 offsetæœ¬åœ°ç®¡ç†æ¨¡å¼</span></a></h3><p>å½“æ¶ˆè´¹æ¨¡å¼ä¸º<code>å¹¿æ’­æ¶ˆè´¹</code>æ—¶ï¼Œoffsetä½¿ç”¨æœ¬åœ°æ¨¡å¼å­˜å‚¨ã€‚å› ä¸ºæ¯æ¡æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ç®¡ç†è‡ªå·±çš„æ¶ˆè´¹è¿›åº¦ï¼Œå„ä¸ªæ¶ˆè´¹è€…ä¹‹é—´ä¸å­˜åœ¨æ¶ˆè´¹è¿›åº¦çš„äº¤é›†ã€‚</p><p>Consumeråœ¨å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹offsetç›¸å…³æ•°æ®ä»¥jsonçš„å½¢å¼æŒä¹…åŒ–åˆ°Consumeræœ¬åœ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æ–‡ä»¶è·¯å¾„ä¸ºå½“å‰ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„<code>.rocketmq_offsets/${clientId}/${group}/Offsets.json</code>ã€‚å…¶ä¸­${clientId}ä¸ºå½“å‰æ¶ˆè´¹è€…idï¼Œé»˜è®¤ä¸ºip@DEFAULTï¼›${group}ä¸ºæ¶ˆè´¹è€…ç»„åç§°ã€‚</p><h3 id="_2-offsetè¿œç¨‹ç®¡ç†æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-offsetè¿œç¨‹ç®¡ç†æ¨¡å¼"><span>2 offsetè¿œç¨‹ç®¡ç†æ¨¡å¼</span></a></h3><p>å½“æ¶ˆè´¹æ¨¡å¼ä¸º<code>é›†ç¾¤æ¶ˆè´¹</code>æ—¶ï¼Œoffsetä½¿ç”¨è¿œç¨‹æ¨¡å¼ç®¡ç†ã€‚å› ä¸ºæ‰€æœ‰Cosnumerå®ä¾‹å¯¹æ¶ˆæ¯é‡‡ç”¨çš„æ˜¯å‡è¡¡æ¶ˆè´¹ï¼Œæ‰€æœ‰Consumerå…±äº«Queueçš„æ¶ˆè´¹è¿›åº¦ã€‚</p><p>Consumeråœ¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹offsetç›¸å…³æ•°æ®ä»¥jsonçš„å½¢å¼æŒä¹…åŒ–åˆ°Brokerç£ç›˜æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶è·¯å¾„ä¸ºå½“å‰ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„<code>store/config/consumerOffset.json</code>ã€‚</p><p>Brokerå¯åŠ¨æ—¶ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶å†™å…¥åˆ°ä¸€ä¸ªåŒå±‚Mapï¼ˆConsumerOffsetManagerï¼‰ã€‚å¤–å±‚mapçš„keyä¸ºtopic@groupï¼Œvalueä¸ºå†…å±‚mapã€‚å†…å±‚mapçš„keyä¸ºqueueIdï¼Œvalueä¸ºoffsetã€‚å½“å‘ç”ŸRebalanceæ—¶ï¼Œæ–°çš„Consumerä¼šä»è¯¥Mapä¸­è·å–åˆ°ç›¸åº”çš„æ•°æ®æ¥ç»§ç»­æ¶ˆè´¹ã€‚</p><p>é›†ç¾¤æ¨¡å¼ä¸‹offseté‡‡ç”¨è¿œç¨‹ç®¡ç†æ¨¡å¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯Rebalanceæœºåˆ¶ã€‚</p><h3 id="_3-offsetç”¨é€”" tabindex="-1"><a class="header-anchor" href="#_3-offsetç”¨é€”"><span>3 offsetç”¨é€”</span></a></h3><p>æ¶ˆè´¹è€…æ˜¯å¦‚ä½•ä»æœ€å¼€å§‹æŒç»­æ¶ˆè´¹æ¶ˆæ¯çš„ï¼Ÿæ¶ˆè´¹è€…è¦æ¶ˆè´¹çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„èµ·å§‹ä½ç½®æ˜¯ç”¨æˆ·è‡ªå·±é€šè¿‡consumer.setConsumeFromWhere()æ–¹æ³•æŒ‡å®šçš„ã€‚</p><p>åœ¨Consumerå¯åŠ¨åï¼Œå…¶è¦æ¶ˆè´¹çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„èµ·å§‹ä½ç½®å¸¸ç”¨çš„æœ‰ä¸‰ç§ï¼Œè¿™ä¸‰ç§ä½ç½®å¯ä»¥é€šè¿‡æšä¸¾ç±»å‹å¸¸é‡è®¾ç½®ã€‚è¿™ä¸ªæšä¸¾ç±»å‹ä¸ºConsumeFromWhereã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208143837.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><blockquote><p>CONSUME_FROM_LAST_OFFSETï¼šä»queueçš„å½“å‰æœ€åä¸€æ¡æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ CONSUME_FROM_FIRST_OFFSETï¼šä»queueçš„ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ CONSUME_FROM_TIMESTAMPï¼šä»æŒ‡å®šçš„å…· ä½“æ—¶é—´æˆ³ä½ç½®çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ã€‚è¿™ä¸ªå…·ä½“æ—¶é—´æˆ³æ˜¯é€šè¿‡å¦å¤–ä¸€ä¸ªè¯­å¥æŒ‡å®šçš„ ã€‚ consumer.setConsumeTimestamp(â€œ20210701080000â€) yyyyMMddHHmmss</p></blockquote><p>å½“æ¶ˆè´¹å®Œä¸€æ‰¹æ¶ˆæ¯åï¼ŒConsumerä¼šæäº¤å…¶æ¶ˆè´¹è¿›åº¦offsetç»™Brokerï¼ŒBrokeråœ¨æ”¶åˆ°æ¶ˆè´¹è¿›åº¦åä¼šå°†å…¶æ›´æ–°åˆ°é‚£ä¸ªåŒå±‚Mapï¼ˆConsumerOffsetManagerï¼‰åŠconsumerOffset.jsonæ–‡ä»¶ä¸­ï¼Œç„¶åå‘è¯¥Consumerè¿›è¡ŒACKï¼Œè€ŒACKå†…å®¹ä¸­åŒ…å«ä¸‰é¡¹æ•°æ®ï¼šå½“å‰æ¶ˆè´¹é˜Ÿåˆ—çš„æœ€å°offsetï¼ˆminOffsetï¼‰ã€æœ€å¤§offsetï¼ˆmaxOffsetï¼‰ã€åŠä¸‹æ¬¡æ¶ˆè´¹çš„èµ·å§‹offsetï¼ˆnextBeginOffsetï¼‰ã€‚</p><h3 id="_4-é‡è¯•é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_4-é‡è¯•é˜Ÿåˆ—"><span>4 é‡è¯•é˜Ÿåˆ—</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208143940.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>å½“rocketMQå¯¹æ¶ˆæ¯çš„æ¶ˆè´¹å‡ºç°å¼‚å¸¸æ—¶ï¼Œä¼šå°†å‘ç”Ÿå¼‚å¸¸çš„æ¶ˆæ¯çš„offsetæäº¤åˆ°Brokerä¸­çš„é‡è¯•é˜Ÿåˆ—ã€‚ç³»ç»Ÿåœ¨å‘ç”Ÿæ¶ˆæ¯æ¶ˆè´¹å¼‚å¸¸æ—¶ä¼šä¸ºå½“å‰çš„topic@groupåˆ›å»ºä¸€ä¸ªé‡è¯•é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»¥%RETRY%å¼€å¤´ï¼Œåˆ°è¾¾é‡è¯•æ—¶é—´åè¿›è¡Œæ¶ˆè´¹é‡è¯•ã€‚</p><h3 id="_5-offsetçš„åŒæ­¥æäº¤ä¸å¼‚æ­¥æäº¤" tabindex="-1"><a class="header-anchor" href="#_5-offsetçš„åŒæ­¥æäº¤ä¸å¼‚æ­¥æäº¤"><span>5 offsetçš„åŒæ­¥æäº¤ä¸å¼‚æ­¥æäº¤</span></a></h3><p>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼ŒConsumeræ¶ˆè´¹å®Œæ¶ˆæ¯åä¼šå‘Brokeræäº¤æ¶ˆè´¹è¿›åº¦offsetï¼Œå…¶æäº¤æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼š</p><p><code>åŒæ­¥æäº¤</code>ï¼šæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹å®Œä¸€æ‰¹æ¶ˆæ¯åä¼šå‘brokeræäº¤è¿™äº›æ¶ˆæ¯çš„offsetï¼Œç„¶åç­‰å¾…brokerçš„æˆåŠŸå“åº”ã€‚è‹¥åœ¨ç­‰å¾…è¶…æ—¶ä¹‹å‰æ”¶åˆ°äº†æˆåŠŸå“åº”ï¼Œåˆ™ç»§ç»­è¯»å–ä¸‹ä¸€æ‰¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼ˆä»ACKä¸­è·å–nextBeginOffsetï¼‰ã€‚è‹¥æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œåˆ™ä¼šé‡æ–°æäº¤ï¼Œç›´åˆ°è·å–åˆ°å“åº”ã€‚è€Œåœ¨è¿™ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…æ˜¯é˜»å¡çš„ã€‚å…¶ä¸¥é‡å½±å“äº†æ¶ˆè´¹è€…çš„ååé‡ã€‚</p><p><code>å¼‚æ­¥æäº¤</code>ï¼šæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹å®Œä¸€æ‰¹æ¶ˆæ¯åå‘brokeræäº¤offsetï¼Œä½†æ— éœ€ç­‰å¾…Brokerçš„æˆåŠŸå“åº”ï¼Œå¯ä»¥ç»§ç»­è¯»å–å¹¶æ¶ˆè´¹ä¸‹ä¸€æ‰¹æ¶ˆæ¯ã€‚è¿™ç§æ–¹å¼å¢åŠ äº†æ¶ˆè´¹è€…çš„ååé‡ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œbrokeråœ¨æ”¶åˆ°æäº¤çš„offsetåï¼Œè¿˜æ˜¯ä¼šå‘æ¶ˆè´¹è€…è¿›è¡Œå“åº”çš„ã€‚å¯èƒ½è¿˜æ²¡æœ‰æ”¶åˆ°ACKï¼Œæ­¤æ—¶Consumerä¼šä»Brokerä¸­ç›´æ¥è·å–nextBeginOffsetã€‚</p><h2 id="ä¸ƒã€æ¶ˆè´¹å¹‚ç­‰" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ¶ˆè´¹å¹‚ç­‰"><span>ä¸ƒã€æ¶ˆè´¹å¹‚ç­‰</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯æ¶ˆè´¹å¹‚ç­‰" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯æ¶ˆè´¹å¹‚ç­‰"><span>1 ä»€ä¹ˆæ˜¯æ¶ˆè´¹å¹‚ç­‰</span></a></h3><p>å½“å‡ºç°æ¶ˆè´¹è€…å¯¹æŸæ¡æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„æƒ…å†µæ—¶ï¼Œé‡å¤æ¶ˆè´¹çš„ç»“æœä¸æ¶ˆè´¹ä¸€æ¬¡çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”å¤šæ¬¡æ¶ˆè´¹å¹¶æœªå¯¹ä¸šåŠ¡ç³»ç»Ÿäº§ç”Ÿä»»ä½•è´Ÿé¢å½±å“ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆè´¹è¿‡ç¨‹å°±æ˜¯æ¶ˆè´¹å¹‚ç­‰çš„ã€‚</p><blockquote><p>å¹‚ç­‰ï¼šè‹¥æŸæ“ä½œæ‰§è¡Œå¤šæ¬¡ä¸æ‰§è¡Œä¸€æ¬¡å¯¹ç³»ç»Ÿäº§ç”Ÿçš„å½±å“æ˜¯ç›¸åŒçš„ï¼Œåˆ™ç§°è¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</p></blockquote><p>åœ¨äº’è”ç½‘åº”ç”¨ä¸­ï¼Œå°¤å…¶åœ¨ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°é‡å¤å‘é€æˆ–é‡å¤æ¶ˆè´¹ã€‚å¦‚æœé‡å¤çš„æ¶ˆæ¯å¯èƒ½ä¼šå½±å“ä¸šåŠ¡å¤„ç†ï¼Œé‚£ä¹ˆå°±åº”è¯¥å¯¹æ¶ˆæ¯åšå¹‚ç­‰å¤„ç†ã€‚</p><h3 id="_2-æ¶ˆæ¯é‡å¤çš„åœºæ™¯åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-æ¶ˆæ¯é‡å¤çš„åœºæ™¯åˆ†æ"><span>2 æ¶ˆæ¯é‡å¤çš„åœºæ™¯åˆ†æ</span></a></h3><p>ä»€ä¹ˆæƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹å‘¢ï¼Ÿæœ€å¸¸è§çš„æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><h4 id="å‘é€æ—¶æ¶ˆæ¯é‡å¤" tabindex="-1"><a class="header-anchor" href="#å‘é€æ—¶æ¶ˆæ¯é‡å¤"><span>å‘é€æ—¶æ¶ˆæ¯é‡å¤</span></a></h4><p>å½“ä¸€æ¡æ¶ˆæ¯å·²è¢«æˆåŠŸå‘é€åˆ°Brokerå¹¶å®ŒæˆæŒä¹…åŒ–ï¼Œæ­¤æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­ï¼Œä»è€Œå¯¼è‡´Brokerå¯¹Produceråº”ç­”å¤±è´¥ã€‚ å¦‚æœæ­¤æ—¶Produceræ„è¯†åˆ°æ¶ˆæ¯å‘é€å¤±è´¥å¹¶å°è¯•å†æ¬¡å‘é€æ¶ˆæ¯ï¼Œæ­¤æ—¶Brokerä¸­å°±å¯èƒ½ä¼šå‡ºç°ä¸¤æ¡å†…å®¹ç›¸åŒå¹¶ä¸”Message IDä¹Ÿç›¸åŒçš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆåç»­Consumerå°±ä¸€å®šä¼šæ¶ˆè´¹ä¸¤æ¬¡è¯¥æ¶ˆæ¯ã€‚</p><h4 id="æ¶ˆè´¹æ—¶æ¶ˆæ¯é‡å¤" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹æ—¶æ¶ˆæ¯é‡å¤"><span>æ¶ˆè´¹æ—¶æ¶ˆæ¯é‡å¤</span></a></h4><p>æ¶ˆæ¯å·²æŠ•é€’åˆ°Consumerå¹¶å®Œæˆä¸šåŠ¡å¤„ç†ï¼Œå½“Consumerç»™Brokeråé¦ˆåº”ç­”æ—¶ç½‘ç»œé—ªæ–­ï¼ŒBrokeræ²¡æœ‰æ¥æ”¶åˆ°æ¶ˆè´¹æˆåŠŸå“åº”ã€‚ä¸ºäº†ä¿è¯æ¶ˆæ¯<code>è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡</code>çš„åŸåˆ™ï¼ŒBrokerå°†åœ¨ç½‘ç»œæ¢å¤åå†æ¬¡å°è¯•æŠ•é€’ä¹‹å‰å·²è¢«å¤„ç†è¿‡çš„æ¶ˆæ¯ã€‚æ­¤æ—¶æ¶ˆè´¹è€…å°±ä¼šæ”¶åˆ°ä¸ä¹‹å‰å¤„ç†è¿‡çš„å†…å®¹ç›¸åŒã€Message IDä¹Ÿç›¸åŒçš„æ¶ˆæ¯ã€‚</p><h4 id="rebalanceæ—¶æ¶ˆæ¯é‡å¤" tabindex="-1"><a class="header-anchor" href="#rebalanceæ—¶æ¶ˆæ¯é‡å¤"><span>Rebalanceæ—¶æ¶ˆæ¯é‡å¤</span></a></h4><p>å½“Consumer Groupä¸­çš„Consumeræ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ–å…¶è®¢é˜…çš„Topicçš„Queueæ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘Rebalanceï¼Œæ­¤æ—¶Consumerå¯èƒ½ä¼šæ”¶åˆ°æ›¾ç»è¢«æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ã€‚</p><h3 id="_3-é€šç”¨è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_3-é€šç”¨è§£å†³æ–¹æ¡ˆ"><span>3 é€šç”¨è§£å†³æ–¹æ¡ˆ</span></a></h3><h4 id="ä¸¤è¦ç´ " tabindex="-1"><a class="header-anchor" href="#ä¸¤è¦ç´ "><span>ä¸¤è¦ç´ </span></a></h4><p>å¹‚ç­‰è§£å†³æ–¹æ¡ˆçš„è®¾è®¡ä¸­æ¶‰åŠåˆ°ä¸¤é¡¹è¦ç´ ï¼šå¹‚ç­‰ä»¤ç‰Œï¼Œä¸å”¯ä¸€æ€§å¤„ç†ã€‚åªè¦å……åˆ†åˆ©ç”¨å¥½è¿™ä¸¤è¦ç´ ï¼Œå°±å¯ä»¥è®¾è®¡å‡ºå¥½çš„å¹‚ç­‰è§£å†³æ–¹æ¡ˆã€‚</p><ul><li>å¹‚ç­‰ä»¤ç‰Œï¼šæ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸¤è€…ä¸­çš„æ—¢å®šåè®®ï¼Œé€šå¸¸æŒ‡å…·å¤‡å”¯ä¸€ä¸šåŠ¡æ ‡è¯†çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œè®¢å•å·ã€æµæ°´å·ã€‚ä¸€èˆ¬ç”±Produceréšç€æ¶ˆæ¯ä¸€åŒå‘é€æ¥çš„ã€‚</li><li>å”¯ä¸€æ€§å¤„ç†ï¼šæœåŠ¡ç«¯é€šè¿‡é‡‡ç”¨ä¸€å®šçš„ç®—æ³•ç­–ç•¥ï¼Œä¿è¯åŒä¸€ä¸ªä¸šåŠ¡é€»è¾‘ä¸ä¼šè¢«é‡å¤æ‰§è¡ŒæˆåŠŸå¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œå¯¹åŒä¸€ç¬”è®¢å•çš„å¤šæ¬¡æ”¯ä»˜æ“ä½œï¼Œåªä¼šæˆåŠŸä¸€æ¬¡ã€‚</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ"><span>è§£å†³æ–¹æ¡ˆ</span></a></h4><p>å¯¹äºå¸¸è§çš„ç³»ç»Ÿï¼Œå¹‚ç­‰æ€§æ“ä½œçš„é€šç”¨æ€§è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p><ul><li><ol><li>é¦–å…ˆé€šè¿‡ç¼“å­˜å»é‡ã€‚åœ¨ç¼“å­˜ä¸­å¦‚æœå·²ç»å­˜åœ¨äº†æŸå¹‚ç­‰ä»¤ç‰Œï¼Œåˆ™è¯´æ˜æœ¬æ¬¡æ“ä½œæ˜¯é‡å¤æ€§æ“ä½œï¼›è‹¥ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</li></ol></li><li><ol start="2"><li>åœ¨å”¯ä¸€æ€§å¤„ç†ä¹‹å‰ï¼Œå…ˆåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å¹‚ç­‰ä»¤ç‰Œä½œä¸ºç´¢å¼•çš„æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚è‹¥å­˜åœ¨ï¼Œåˆ™è¯´æ˜æœ¬æ¬¡æ“ä½œä¸ºé‡å¤æ€§æ“ä½œï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</li></ol></li><li><ol start="3"><li>åœ¨åŒä¸€äº‹åŠ¡ä¸­å®Œæˆä¸‰é¡¹æ“ä½œï¼šå”¯ä¸€æ€§å¤„ç†åï¼Œå°†å¹‚ç­‰ä»¤ç‰Œå†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶å°†å¹‚ç­‰ä»¤ç‰Œä½œä¸ºå”¯ä¸€ç´¢å¼•çš„æ•°æ®å†™å…¥åˆ°DBä¸­ã€‚</li></ol></li></ul><blockquote><p>ç¬¬ 1 æ­¥å·²ç»åˆ¤æ–­è¿‡æ˜¯å¦æ˜¯é‡å¤æ€§æ“ä½œäº†ï¼Œä¸ºä»€ä¹ˆç¬¬ 2 æ­¥è¿˜è¦å†æ¬¡åˆ¤æ–­ï¼Ÿèƒ½å¤Ÿè¿›å…¥ç¬¬ 2 æ­¥ï¼Œè¯´æ˜å·²ç»ä¸æ˜¯é‡å¤æ“ä½œäº†ï¼Œç¬¬ 2 æ¬¡åˆ¤æ–­æ˜¯å¦é‡å¤ï¼Ÿ</p><p>å½“ç„¶ä¸é‡å¤ã€‚ä¸€èˆ¬ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯å…·æœ‰æœ‰æ•ˆæœŸçš„ã€‚ç¼“å­˜ä¸­æ•°æ®çš„æœ‰æ•ˆæœŸä¸€æ—¦è¿‡æœŸï¼Œå°±æ˜¯å‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œä½¿è¯·æ±‚ç›´æ¥å°±åˆ°è¾¾äº†DBMSã€‚</p></blockquote><h4 id="è§£å†³æ–¹æ¡ˆä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆä¸¾ä¾‹"><span>è§£å†³æ–¹æ¡ˆä¸¾ä¾‹</span></a></h4><h4 id="ä»¥æ”¯ä»˜åœºæ™¯ä¸ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»¥æ”¯ä»˜åœºæ™¯ä¸ºä¾‹"><span>ä»¥æ”¯ä»˜åœºæ™¯ä¸ºä¾‹ï¼š</span></a></h4><ul><li><ol><li>å½“æ”¯ä»˜è¯·æ±‚åˆ°è¾¾åï¼Œé¦–å…ˆåœ¨Redisç¼“å­˜ä¸­å´è·å–keyä¸ºæ”¯ä»˜æµæ°´å·çš„ç¼“å­˜valueã€‚è‹¥valueä¸ç©ºï¼Œåˆ™è¯´æ˜æœ¬æ¬¡æ”¯ä»˜æ˜¯é‡å¤æ“ä½œï¼Œä¸šåŠ¡ç³»ç»Ÿç›´æ¥è¿”å›è°ƒç”¨ä¾§é‡å¤æ”¯ä»˜æ ‡è¯†ï¼›è‹¥valueä¸ºç©ºï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥æ“ä½œ</li></ol></li><li><ol start="2"><li>åˆ°DBMSä¸­æ ¹æ®æ”¯ä»˜æµæ°´å·æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç›¸åº”å®ä¾‹ã€‚è‹¥å­˜åœ¨ï¼Œåˆ™è¯´æ˜æœ¬æ¬¡æ”¯ä»˜æ˜¯é‡å¤æ“ä½œï¼Œä¸šåŠ¡ç³»ç»Ÿç›´æ¥è¿”å›è°ƒç”¨ä¾§é‡å¤æ”¯ä»˜æ ‡è¯†ï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æœ¬æ¬¡æ“ä½œæ˜¯é¦–æ¬¡æ“ä½œï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å®Œæˆå”¯ä¸€æ€§å¤„ç†</li></ol></li><li><ol start="3"><li>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­å®Œæˆä¸‰é¡¹æ“ä½œï¼š</li></ol><ul><li>å®Œæˆæ”¯ä»˜ä»»åŠ¡</li><li>å°†å½“å‰æ”¯ä»˜æµæ°´å·ä½œä¸ºkeyï¼Œä»»æ„å­—ç¬¦ä¸²ä½œä¸ºvalueï¼Œé€šè¿‡set(key, value, expireTime)å°†æ•°æ®å†™å…¥åˆ°Redisç¼“å­˜</li><li>å°†å½“å‰æ”¯ä»˜æµæ°´å·ä½œä¸ºä¸»é”®ï¼Œä¸å…¶å®ƒç›¸å…³æ•°æ®å…±åŒå†™å…¥åˆ°DBMS</li></ul></li></ul><h3 id="_4-æ¶ˆè´¹å¹‚ç­‰çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#_4-æ¶ˆè´¹å¹‚ç­‰çš„å®ç°"><span>4 æ¶ˆè´¹å¹‚ç­‰çš„å®ç°</span></a></h3><p>æ¶ˆè´¹å¹‚ç­‰çš„è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼šä¸ºæ¶ˆæ¯æŒ‡å®šä¸ä¼šé‡å¤çš„å”¯ä¸€æ ‡è¯†ã€‚å› ä¸ºMessage IDæœ‰å¯èƒ½å‡ºç°é‡å¤çš„æƒ…å†µï¼Œæ‰€ä»¥çœŸæ­£å®‰å…¨çš„å¹‚ç­‰å¤„ç†ï¼Œä¸å»ºè®®ä»¥Message IDä½œä¸ºå¤„ç†ä¾æ®ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯ä»¥ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ä½œä¸ºå¹‚ç­‰å¤„ç†çš„å…³é”®ä¾æ®ï¼Œè€Œä¸šåŠ¡çš„å”¯ä¸€æ ‡è¯†å¯ä»¥é€šè¿‡æ¶ˆæ¯Keyè®¾ç½®ã€‚</p><p>ä»¥æ”¯ä»˜åœºæ™¯ä¸ºä¾‹ï¼Œå¯ä»¥å°†æ¶ˆæ¯çš„Keyè®¾ç½®ä¸ºè®¢å•å·ï¼Œä½œä¸ºå¹‚ç­‰å¤„ç†çš„ä¾æ®ã€‚å…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> message </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ORDERID_100&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sendResult </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(message);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯æ—¶å¯ä»¥æ ¹æ®æ¶ˆæ¯çš„Keyå³è®¢å•å·æ¥å®ç°æ¶ˆè´¹å¹‚ç­‰ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">msgs){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // æ ¹æ®ä¸šåŠ¡å”¯ä¸€æ ‡è¯†Keyåšå¹‚ç­‰å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // ......</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>RocketMQèƒ½å¤Ÿä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½†ä¸èƒ½ä¿è¯æ¶ˆæ¯ä¸é‡å¤ã€‚</p></blockquote><h2 id="å…«ã€æ¶ˆæ¯å †ç§¯ä¸æ¶ˆè´¹å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#å…«ã€æ¶ˆæ¯å †ç§¯ä¸æ¶ˆè´¹å»¶è¿Ÿ"><span>å…«ã€æ¶ˆæ¯å †ç§¯ä¸æ¶ˆè´¹å»¶è¿Ÿ</span></a></h2><h3 id="_1-æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-æ¦‚å¿µ"><span>1 æ¦‚å¿µ</span></a></h3><p>æ¶ˆæ¯å¤„ç†æµç¨‹ä¸­ï¼Œå¦‚æœConsumerçš„æ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸ŠProducerçš„å‘é€é€Ÿåº¦ï¼ŒMQä¸­æœªå¤„ç†çš„æ¶ˆæ¯ä¼šè¶Šæ¥è¶Šå¤šï¼ˆè¿›çš„å¤šå‡ºçš„å°‘ï¼‰ï¼Œè¿™éƒ¨åˆ†æ¶ˆæ¯å°±è¢«ç§°ä¸º<code>å †ç§¯æ¶ˆæ¯</code>ã€‚æ¶ˆæ¯å‡ºç°å †ç§¯è¿›è€Œä¼šé€ æˆæ¶ˆæ¯çš„<code>æ¶ˆè´¹å»¶è¿Ÿ</code>ã€‚ ä»¥ä¸‹åœºæ™¯éœ€è¦é‡ç‚¹å…³æ³¨æ¶ˆæ¯å †ç§¯å’Œæ¶ˆè´¹å»¶è¿Ÿé—®é¢˜ï¼š</p><ul><li>ä¸šåŠ¡ç³»ç»Ÿä¸Šä¸‹æ¸¸èƒ½åŠ›ä¸åŒ¹é…é€ æˆçš„æŒç»­å †ç§¯ï¼Œä¸”æ— æ³•è‡ªè¡Œæ¢å¤ã€‚</li><li>ä¸šåŠ¡ç³»ç»Ÿå¯¹æ¶ˆæ¯çš„æ¶ˆè´¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜ï¼Œå³ä½¿æ˜¯çŸ­æš‚çš„å †ç§¯é€ æˆçš„æ¶ˆè´¹å»¶è¿Ÿä¹Ÿæ— æ³•æ¥å—ã€‚</li></ul><h3 id="_2-äº§ç”ŸåŸå› åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_2-äº§ç”ŸåŸå› åˆ†æ"><span>2 äº§ç”ŸåŸå› åˆ†æ</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208144842.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>Consumerä½¿ç”¨é•¿è½®è¯¢Pullæ¨¡å¼æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µï¼š</p><h4 id="æ¶ˆæ¯æ‹‰å–-1" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯æ‹‰å–-1"><span>æ¶ˆæ¯æ‹‰å–</span></a></h4><p>Consumeré€šè¿‡é•¿è½®è¯¢Pullæ¨¡å¼æ‰¹é‡æ‹‰å–çš„æ–¹å¼ä»æœåŠ¡ç«¯è·å–æ¶ˆæ¯ï¼Œå°†æ‹‰å–åˆ°çš„æ¶ˆæ¯ç¼“å­˜åˆ°æœ¬åœ°ç¼“å†²é˜Ÿåˆ—ä¸­ã€‚å¯¹äºæ‹‰å–å¼æ¶ˆè´¹ï¼Œåœ¨å†…ç½‘ç¯å¢ƒä¸‹ä¼šæœ‰å¾ˆé«˜çš„ååé‡ï¼Œæ‰€ä»¥è¿™ä¸€é˜¶æ®µä¸€èˆ¬ä¸ä¼šæˆä¸ºæ¶ˆæ¯å †ç§¯çš„ç“¶é¢ˆã€‚</p><blockquote><p>ä¸€ä¸ªå•çº¿ç¨‹å•åˆ†åŒºçš„ä½è§„æ ¼ä¸»æœº(Consumerï¼Œ4C8G)ï¼Œå…¶å¯è¾¾åˆ°å‡ ä¸‡çš„TPSã€‚å¦‚æœæ˜¯å¤šä¸ªåˆ†åŒºå¤šä¸ªçº¿ç¨‹ï¼Œåˆ™å¯ä»¥è½»æ¾è¾¾åˆ°å‡ åä¸‡çš„TPSã€‚</p></blockquote><h4 id="æ¶ˆæ¯æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯æ¶ˆè´¹"><span>æ¶ˆæ¯æ¶ˆè´¹</span></a></h4><p>Consumerå°†æœ¬åœ°ç¼“å­˜çš„æ¶ˆæ¯æäº¤åˆ°æ¶ˆè´¹çº¿ç¨‹ä¸­ï¼Œä½¿ç”¨ä¸šåŠ¡æ¶ˆè´¹é€»è¾‘å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œæ¯•åè·å–åˆ°ä¸€ä¸ªç»“æœã€‚è¿™æ˜¯çœŸæ­£çš„æ¶ˆæ¯æ¶ˆè´¹è¿‡ç¨‹ã€‚æ­¤æ—¶Consumerçš„æ¶ˆè´¹èƒ½åŠ›å°±å®Œå…¨ä¾èµ–äºæ¶ˆæ¯çš„<code>æ¶ˆè´¹è€—æ—¶</code>å’Œ<code>æ¶ˆè´¹å¹¶å‘åº¦</code>äº†ã€‚å¦‚æœç”±äºä¸šåŠ¡å¤„ç†é€»è¾‘å¤æ‚ç­‰åŸå› ï¼Œå¯¼è‡´å¤„ç†å•æ¡æ¶ˆæ¯çš„è€—æ—¶è¾ƒé•¿ï¼Œåˆ™æ•´ä½“çš„æ¶ˆæ¯ååé‡è‚¯å®šä¸ä¼šé«˜ï¼Œæ­¤æ—¶å°±ä¼šå¯¼è‡´Consumeræœ¬åœ°ç¼“å†²é˜Ÿåˆ—è¾¾åˆ°ä¸Šé™ï¼Œåœæ­¢ä»æœåŠ¡ç«¯æ‹‰å–æ¶ˆæ¯ã€‚</p><h4 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h4><p>æ¶ˆæ¯å †ç§¯çš„ä¸»è¦ç“¶é¢ˆåœ¨äºå®¢æˆ·ç«¯çš„æ¶ˆè´¹èƒ½åŠ›ï¼Œè€Œæ¶ˆè´¹èƒ½åŠ›ç”±<code>æ¶ˆè´¹è€—æ—¶</code>å’Œ<code>æ¶ˆè´¹å¹¶å‘åº¦</code>å†³å®šã€‚æ³¨æ„ï¼Œæ¶ˆè´¹è€—æ—¶çš„ä¼˜å…ˆçº§è¦é«˜äºæ¶ˆè´¹å¹¶å‘åº¦ã€‚å³åœ¨ä¿è¯äº†æ¶ˆè´¹è€—æ—¶çš„åˆç†æ€§å‰æä¸‹ï¼Œå†è€ƒè™‘æ¶ˆè´¹å¹¶å‘åº¦é—®é¢˜ã€‚</p><h3 id="_3-æ¶ˆè´¹è€—æ—¶" tabindex="-1"><a class="header-anchor" href="#_3-æ¶ˆè´¹è€—æ—¶"><span>3 æ¶ˆè´¹è€—æ—¶</span></a></h3><p>å½±å“æ¶ˆæ¯å¤„ç†æ—¶é•¿çš„ä¸»è¦å› ç´ æ˜¯ä»£ç é€»è¾‘ã€‚è€Œä»£ç é€»è¾‘ä¸­å¯èƒ½ä¼šå½±å“å¤„ç†æ—¶é•¿ä»£ç ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼š<code>CPUå†…éƒ¨è®¡ç®—å‹ä»£ç </code>å’Œ<code>å¤–éƒ¨I/Oæ“ä½œå‹ä»£ç </code>ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ä»£ç ä¸­å¦‚æœæ²¡æœ‰å¤æ‚çš„é€’å½’å’Œå¾ªç¯çš„è¯ï¼Œå†…éƒ¨è®¡ç®—è€—æ—¶ç›¸å¯¹å¤–éƒ¨I/Oæ“ä½œæ¥è¯´å‡ ä¹å¯ä»¥å¿½ç•¥ã€‚æ‰€ä»¥å¤–éƒ¨IOå‹ä»£ç æ˜¯å½±å“æ¶ˆæ¯å¤„ç†æ—¶é•¿çš„ä¸»è¦ç—‡ç»“æ‰€åœ¨ã€‚</p><blockquote><p>å¤–éƒ¨IOæ“ä½œå‹ä»£ç ä¸¾ä¾‹ï¼š 1)è¯»å†™å¤–éƒ¨æ•°æ®åº“ï¼Œä¾‹å¦‚å¯¹è¿œç¨‹MySQLçš„è®¿é—® 2)è¯»å†™å¤–éƒ¨ç¼“å­˜ç³»ç»Ÿï¼Œä¾‹å¦‚å¯¹è¿œç¨‹Redisçš„è®¿é—® 3)ä¸‹æ¸¸ç³»ç»Ÿè°ƒç”¨ï¼Œä¾‹å¦‚Dubboçš„RPCè¿œç¨‹è°ƒç”¨ï¼ŒSpring Cloudçš„å¯¹ä¸‹æ¸¸ç³»ç»Ÿçš„Httpæ¥å£è°ƒç”¨ å…³äºä¸‹æ¸¸ç³»ç»Ÿè°ƒç”¨é€»è¾‘éœ€è¦è¿›è¡Œæå‰æ¢³ç†ï¼ŒæŒæ¡æ¯ä¸ªè°ƒç”¨æ“ä½œé¢„æœŸçš„è€—æ—¶ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ¤æ–­æ¶ˆè´¹é€»è¾‘ä¸­IOæ“ä½œçš„è€—æ—¶æ˜¯å¦åˆç†ã€‚é€šå¸¸æ¶ˆæ¯å †ç§¯æ˜¯ç”±äºä¸‹æ¸¸ç³»ç»Ÿå‡ºç°äº†<code>æœåŠ¡å¼‚å¸¸</code>æˆ–<code>è¾¾åˆ°äº†DBMSå®¹é‡é™åˆ¶</code>ï¼Œå¯¼è‡´æ¶ˆè´¹è€—æ—¶å¢åŠ ã€‚ æœåŠ¡å¼‚å¸¸ï¼Œå¹¶ä¸ä»…ä»…æ˜¯ç³»ç»Ÿä¸­å‡ºç°çš„ç±»ä¼¼ 500 è¿™æ ·çš„ä»£ç é”™è¯¯ï¼Œè€Œå¯èƒ½æ˜¯æ›´åŠ éšè”½çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œç½‘ç»œå¸¦å®½é—®é¢˜ã€‚ è¾¾åˆ°äº†DBMSå®¹é‡é™åˆ¶ï¼Œå…¶ä¹Ÿä¼šå¼•å‘æ¶ˆæ¯çš„æ¶ˆè´¹è€—æ—¶å¢åŠ ã€‚</p></blockquote><h3 id="_4-æ¶ˆè´¹å¹¶å‘åº¦" tabindex="-1"><a class="header-anchor" href="#_4-æ¶ˆè´¹å¹¶å‘åº¦"><span>4 æ¶ˆè´¹å¹¶å‘åº¦</span></a></h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…ç«¯çš„æ¶ˆè´¹å¹¶å‘åº¦ç”±å•èŠ‚ç‚¹çº¿ç¨‹æ•°å’ŒèŠ‚ç‚¹æ•°é‡å…±åŒå†³å®šï¼Œå…¶å€¼ä¸ºå•èŠ‚ç‚¹çº¿ç¨‹æ•°*èŠ‚ç‚¹æ•°é‡ã€‚ä¸è¿‡ï¼Œé€šå¸¸éœ€è¦ä¼˜å…ˆè°ƒæ•´å•èŠ‚ç‚¹çš„çº¿ç¨‹æ•°ï¼Œè‹¥å•æœºç¡¬ä»¶èµ„æºè¾¾åˆ°äº†ä¸Šé™ï¼Œåˆ™éœ€è¦é€šè¿‡æ¨ªå‘æ‰©å±•æ¥æé«˜æ¶ˆè´¹å¹¶å‘åº¦ã€‚</p><blockquote><p>å•èŠ‚ç‚¹çº¿ç¨‹æ•°ï¼Œå³å•ä¸ªConsumeræ‰€åŒ…å«çš„çº¿ç¨‹æ•°é‡ èŠ‚ç‚¹æ•°é‡ï¼Œå³Consumer Groupæ‰€åŒ…å«çš„Consumeræ•°é‡ å¯¹äºæ™®é€šæ¶ˆæ¯ã€å»¶æ—¶æ¶ˆæ¯åŠäº‹åŠ¡æ¶ˆæ¯ï¼Œå¹¶å‘åº¦è®¡ç®—éƒ½æ˜¯å•èŠ‚ç‚¹çº¿ç¨‹æ•°*èŠ‚ç‚¹æ•°é‡ã€‚ä½†å¯¹äºé¡ºåºæ¶ˆæ¯åˆ™æ˜¯ä¸åŒçš„ã€‚é¡ºåºæ¶ˆæ¯çš„æ¶ˆè´¹å¹¶å‘åº¦ç­‰äºTopicçš„Queueåˆ†åŒºæ•°é‡ã€‚ 1 ï¼‰å…¨å±€é¡ºåºæ¶ˆæ¯ï¼šè¯¥ç±»å‹æ¶ˆæ¯çš„Topicåªæœ‰ä¸€ä¸ªQueueåˆ†åŒºã€‚å…¶å¯ä»¥ä¿è¯è¯¥Topicçš„æ‰€æœ‰æ¶ˆæ¯è¢«é¡ºåºæ¶ˆè´¹ã€‚ä¸ºäº†ä¿è¯è¿™ä¸ªå…¨å±€é¡ºåºæ€§ï¼ŒConsumer Groupä¸­åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªConsumerçš„ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ¶ˆè´¹ã€‚æ‰€ä»¥å…¶å¹¶å‘åº¦ä¸º 1 ã€‚ 2 ï¼‰åˆ†åŒºé¡ºåºæ¶ˆæ¯ï¼šè¯¥ç±»å‹æ¶ˆæ¯çš„Topicæœ‰å¤šä¸ªQueueåˆ†åŒºã€‚å…¶ä»…å¯ä»¥ä¿è¯è¯¥Topicçš„æ¯ä¸ªQueueåˆ†åŒºä¸­çš„æ¶ˆæ¯è¢«é¡ºåºæ¶ˆè´¹ï¼Œä¸èƒ½ä¿è¯æ•´ä¸ªTopicä¸­æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹ã€‚ä¸ºäº†ä¿è¯è¿™ä¸ªåˆ†åŒºé¡ºåºæ€§ï¼Œæ¯ä¸ªQueueåˆ†åŒºä¸­çš„æ¶ˆæ¯åœ¨Consumer Groupä¸­çš„åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªConsumerçš„ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ¶ˆè´¹ã€‚å³ï¼Œåœ¨åŒä¸€æ—¶åˆ»æœ€å¤šä¼šå‡ºç°å¤šä¸ªQueueåˆ†è˜–æœ‰å¤šä¸ªConsumerçš„å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ¶ˆè´¹ã€‚æ‰€ä»¥å…¶å¹¶å‘åº¦ä¸ºTopicçš„åˆ†åŒºæ•°é‡ã€‚</p></blockquote><h3 id="_5-å•æœºçº¿ç¨‹æ•°è®¡ç®—" tabindex="-1"><a class="header-anchor" href="#_5-å•æœºçº¿ç¨‹æ•°è®¡ç®—"><span>5 å•æœºçº¿ç¨‹æ•°è®¡ç®—</span></a></h3><p>å¯¹äºä¸€å°ä¸»æœºä¸­çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°çš„è®¾ç½®éœ€è¦è°¨æ…ï¼Œä¸èƒ½ç›²ç›®ç›´æ¥è°ƒå¤§çº¿ç¨‹æ•°ï¼Œè®¾ç½®è¿‡å¤§çš„çº¿ç¨‹æ•°åè€Œä¼šå¸¦æ¥å¤§é‡çš„çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚ç†æƒ³ç¯å¢ƒä¸‹å•èŠ‚ç‚¹çš„æœ€ä¼˜çº¿ç¨‹æ•°è®¡ç®—æ¨¡å‹ä¸ºï¼šC *ï¼ˆT1 + T2ï¼‰/ T1ã€‚</p><ul><li>Cï¼šCPUå†…æ ¸æ•°</li><li>T1ï¼šCPUå†…éƒ¨é€»è¾‘è®¡ç®—è€—æ—¶</li><li>T2ï¼šå¤–éƒ¨IOæ“ä½œè€—æ—¶</li></ul><blockquote><p>æœ€ä¼˜çº¿ç¨‹æ•° = C *ï¼ˆT1 + T2ï¼‰/ T1 = C * T1/T1 + C * T2/T1 = C + C * T2/T1</p></blockquote><blockquote><p>æ³¨æ„ï¼Œè¯¥è®¡ç®—å‡ºçš„æ•°å€¼æ˜¯ç†æƒ³çŠ¶æ€ä¸‹çš„ç†è®ºæ•°æ®ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸å»ºè®®ç›´æ¥ä½¿ç”¨ã€‚è€Œæ˜¯æ ¹æ®å½“å‰ç¯å¢ƒï¼Œå…ˆè®¾ç½®ä¸€ä¸ªæ¯”è¯¥å€¼å°çš„æ•°å€¼ç„¶åè§‚å¯Ÿå…¶å‹æµ‹æ•ˆæœï¼Œç„¶åå†æ ¹æ®æ•ˆæœé€æ­¥è°ƒå¤§çº¿ç¨‹æ•°ï¼Œç›´è‡³æ‰¾åˆ°åœ¨è¯¥ç¯å¢ƒä¸­æ€§èƒ½æœ€ä½³æ—¶çš„å€¼ã€‚</p></blockquote><h3 id="_6-å¦‚ä½•é¿å…" tabindex="-1"><a class="header-anchor" href="#_6-å¦‚ä½•é¿å…"><span>6 å¦‚ä½•é¿å…</span></a></h3><p>ä¸ºäº†é¿å…åœ¨ä¸šåŠ¡ä½¿ç”¨æ—¶å‡ºç°éé¢„æœŸçš„æ¶ˆæ¯å †ç§¯å’Œæ¶ˆè´¹å»¶è¿Ÿé—®é¢˜ï¼Œéœ€è¦åœ¨å‰æœŸè®¾è®¡é˜¶æ®µå¯¹æ•´ä¸ªä¸šåŠ¡é€»è¾‘è¿›è¡Œå®Œå–„çš„æ’æŸ¥å’Œæ¢³ç†ã€‚å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯<code>æ¢³ç†æ¶ˆæ¯çš„æ¶ˆè´¹è€—æ—¶</code>å’Œ<code>è®¾ç½®æ¶ˆæ¯æ¶ˆè´¹çš„å¹¶å‘åº¦</code>ã€‚</p><h4 id="æ¢³ç†æ¶ˆæ¯çš„æ¶ˆè´¹è€—æ—¶" tabindex="-1"><a class="header-anchor" href="#æ¢³ç†æ¶ˆæ¯çš„æ¶ˆè´¹è€—æ—¶"><span>æ¢³ç†æ¶ˆæ¯çš„æ¶ˆè´¹è€—æ—¶</span></a></h4><p>é€šè¿‡å‹æµ‹è·å–æ¶ˆæ¯çš„æ¶ˆè´¹è€—æ—¶ï¼Œå¹¶å¯¹è€—æ—¶è¾ƒé«˜çš„æ“ä½œçš„ä»£ç é€»è¾‘è¿›è¡Œåˆ†æã€‚æ¢³ç†æ¶ˆæ¯çš„æ¶ˆè´¹è€—æ—¶éœ€è¦å…³æ³¨ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>æ¶ˆæ¯æ¶ˆè´¹é€»è¾‘çš„è®¡ç®—å¤æ‚åº¦æ˜¯å¦è¿‡é«˜ï¼Œä»£ç æ˜¯å¦å­˜åœ¨æ— é™å¾ªç¯å’Œé€’å½’ç­‰ç¼ºé™·ã€‚</li><li>æ¶ˆæ¯æ¶ˆè´¹é€»è¾‘ä¸­çš„I/Oæ“ä½œæ˜¯å¦æ˜¯å¿…é¡»çš„ï¼Œèƒ½å¦ç”¨æœ¬åœ°ç¼“å­˜ç­‰æ–¹æ¡ˆè§„é¿ã€‚</li><li>æ¶ˆè´¹é€»è¾‘ä¸­çš„å¤æ‚è€—æ—¶çš„æ“ä½œæ˜¯å¦å¯ä»¥åšå¼‚æ­¥åŒ–å¤„ç†ã€‚å¦‚æœå¯ä»¥ï¼Œæ˜¯å¦ä¼šé€ æˆé€»è¾‘é”™ä¹±ã€‚</li></ul><h4 id="è®¾ç½®æ¶ˆè´¹å¹¶å‘åº¦" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®æ¶ˆè´¹å¹¶å‘åº¦"><span>è®¾ç½®æ¶ˆè´¹å¹¶å‘åº¦</span></a></h4><p>å¯¹äºæ¶ˆæ¯æ¶ˆè´¹å¹¶å‘åº¦çš„è®¡ç®—ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤æ­¥å®æ–½ï¼š</p><ul><li>é€æ­¥è°ƒå¤§å•ä¸ªConsumerèŠ‚ç‚¹çš„çº¿ç¨‹æ•°ï¼Œå¹¶è§‚æµ‹èŠ‚ç‚¹çš„ç³»ç»ŸæŒ‡æ ‡ï¼Œå¾—åˆ°å•ä¸ªèŠ‚ç‚¹æœ€ä¼˜çš„æ¶ˆè´¹çº¿ç¨‹æ•°å’Œæ¶ˆæ¯ååé‡ã€‚</li><li>æ ¹æ®ä¸Šä¸‹æ¸¸é“¾è·¯çš„æµé‡å³°å€¼è®¡ç®—å‡ºéœ€è¦è®¾ç½®çš„èŠ‚ç‚¹æ•°</li></ul><blockquote><p>èŠ‚ç‚¹æ•° = æµé‡å³°å€¼ / å•ä¸ªèŠ‚ç‚¹æ¶ˆæ¯ååé‡</p></blockquote><h2 id="ä¹ã€æ¶ˆæ¯çš„æ¸…ç†" tabindex="-1"><a class="header-anchor" href="#ä¹ã€æ¶ˆæ¯çš„æ¸…ç†"><span>ä¹ã€æ¶ˆæ¯çš„æ¸…ç†</span></a></h2><p>æ¶ˆæ¯è¢«æ¶ˆè´¹è¿‡åä¼šè¢«æ¸…ç†æ‰å—ï¼Ÿä¸ä¼šçš„ã€‚</p><p>æ¶ˆæ¯æ˜¯è¢«é¡ºåºå­˜å‚¨åœ¨commitlogæ–‡ä»¶çš„ï¼Œä¸”æ¶ˆæ¯å¤§å°ä¸å®šé•¿ï¼Œæ‰€ä»¥æ¶ˆæ¯çš„æ¸…ç†æ˜¯ä¸å¯èƒ½ä»¥æ¶ˆæ¯ä¸ºå•ä½è¿›è¡Œæ¸…ç†çš„ï¼Œè€Œæ˜¯ä»¥commitlogæ–‡ä»¶ä¸ºå•ä½è¿›è¡Œæ¸…ç†çš„ã€‚å¦åˆ™ä¼šæ€¥å‰§ä¸‹é™æ¸…ç†æ•ˆç‡ï¼Œå¹¶å®ç°é€»è¾‘å¤æ‚ã€‚</p><p>commitlogæ–‡ä»¶å­˜åœ¨ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ä¸º 72 å°æ—¶ï¼Œå³ä¸‰å¤©ã€‚é™¤äº†ç”¨æˆ·æ‰‹åŠ¨æ¸…ç†å¤–ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¹Ÿä¼šè¢«è‡ªåŠ¨æ¸…ç†ï¼Œæ— è®ºæ–‡ä»¶ä¸­çš„æ¶ˆæ¯æ˜¯å¦è¢«æ¶ˆè´¹è¿‡ï¼š</p><ul><li>æ–‡ä»¶è¿‡æœŸï¼Œä¸”åˆ°è¾¾æ¸…ç†æ—¶é—´ç‚¹ï¼ˆé»˜è®¤ä¸ºå‡Œæ™¨ 4 ç‚¹ï¼‰åï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ–‡ä»¶</li><li>æ–‡ä»¶è¿‡æœŸï¼Œä¸”ç£ç›˜ç©ºé—´å ç”¨ç‡å·²è¾¾è¿‡æœŸæ¸…ç†è­¦æˆ’çº¿ï¼ˆé»˜è®¤75%ï¼‰åï¼Œæ— è®ºæ˜¯å¦è¾¾åˆ°æ¸…ç†æ—¶é—´ç‚¹ï¼Œéƒ½ä¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ–‡ä»¶</li><li>ç£ç›˜å ç”¨ç‡è¾¾åˆ°æ¸…ç†è­¦æˆ’çº¿ï¼ˆé»˜è®¤85%ï¼‰åï¼Œå¼€å§‹æŒ‰ç…§è®¾å®šå¥½çš„è§„åˆ™æ¸…ç†æ–‡ä»¶ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸã€‚é»˜è®¤ä¼šä»æœ€è€çš„æ–‡ä»¶å¼€å§‹æ¸…ç†</li><li>ç£ç›˜å ç”¨ç‡è¾¾åˆ°ç³»ç»Ÿå±é™©è­¦æˆ’çº¿ï¼ˆé»˜è®¤90%ï¼‰åï¼ŒBrokerå°†æ‹’ç»æ¶ˆæ¯å†™å…¥</li></ul><blockquote><p>éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š 1 ï¼‰å¯¹äºRocketMQç³»ç»Ÿæ¥è¯´ï¼Œåˆ é™¤ä¸€ä¸ª1Gå¤§å°çš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªå‹åŠ›å·¨å¤§çš„IOæ“ä½œã€‚åœ¨åˆ é™¤è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿæ€§èƒ½ä¼šéª¤ç„¶ä¸‹é™ã€‚æ‰€ä»¥ï¼Œå…¶é»˜è®¤æ¸…ç†æ—¶é—´ç‚¹ä¸ºå‡Œæ™¨ 4 ç‚¹ï¼Œè®¿é—®é‡æœ€å°çš„æ—¶é—´ã€‚ä¹Ÿæ­£å› å¦‚æœï¼Œæˆ‘ä»¬è¦ä¿éšœç£ç›˜ç©ºé—´çš„ç©ºé—²ç‡ï¼Œä¸è¦ä½¿ç³»ç»Ÿå‡ºç°åœ¨å…¶å®ƒæ—¶é—´ç‚¹åˆ é™¤commitlogæ–‡ä»¶çš„æƒ…å†µã€‚ 2 ï¼‰å®˜æ–¹å»ºè®®RocketMQæœåŠ¡çš„Linuxæ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨ext4ã€‚å› ä¸ºå¯¹äºæ–‡ä»¶åˆ é™¤æ“ä½œï¼Œext4è¦æ¯”ext3æ€§èƒ½æ›´å¥½</p></blockquote><h1 id="ç¬¬-4-ç« -rocketmqåº”ç”¨" tabindex="-1"><a class="header-anchor" href="#ç¬¬-4-ç« -rocketmqåº”ç”¨"><span>ç¬¬ 4 ç«  RocketMQåº”ç”¨</span></a></h1><h2 id="ä¸€ã€æ™®é€šæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ™®é€šæ¶ˆæ¯"><span>ä¸€ã€æ™®é€šæ¶ˆæ¯</span></a></h2><h3 id="_1-æ¶ˆæ¯å‘é€åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#_1-æ¶ˆæ¯å‘é€åˆ†ç±»"><span>1 æ¶ˆæ¯å‘é€åˆ†ç±»</span></a></h3><p>Producerå¯¹äºæ¶ˆæ¯çš„å‘é€æ–¹å¼ä¹Ÿæœ‰å¤šç§é€‰æ‹©ï¼Œä¸åŒçš„æ–¹å¼ä¼šäº§ç”Ÿä¸åŒçš„ç³»ç»Ÿæ•ˆæœã€‚</p><h4 id="åŒæ­¥å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#åŒæ­¥å‘é€æ¶ˆæ¯"><span>åŒæ­¥å‘é€æ¶ˆæ¯</span></a></h4><p>åŒæ­¥å‘é€æ¶ˆæ¯æ˜¯æŒ‡ï¼ŒProducerå‘å‡ºä¸€æ¡æ¶ˆæ¯åï¼Œä¼šåœ¨æ”¶åˆ°MQè¿”å›çš„ACKä¹‹åæ‰å‘ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚è¯¥æ–¹å¼çš„æ¶ˆæ¯å¯é æ€§æœ€é«˜ï¼Œä½†æ¶ˆæ¯å‘é€æ•ˆç‡å¤ªä½ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208145933.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="å¼‚æ­¥å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥å‘é€æ¶ˆæ¯"><span>å¼‚æ­¥å‘é€æ¶ˆæ¯</span></a></h4><p>å¼‚æ­¥å‘é€æ¶ˆæ¯æ˜¯æŒ‡ï¼ŒProducerå‘å‡ºæ¶ˆæ¯åæ— éœ€ç­‰å¾…MQè¿”å›ACKï¼Œç›´æ¥å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚è¯¥æ–¹å¼çš„æ¶ˆæ¯å¯é æ€§å¯ä»¥å¾—åˆ°ä¿éšœï¼Œæ¶ˆæ¯å‘é€æ•ˆç‡ä¹Ÿå¯ä»¥ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208150004.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="å•å‘å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å•å‘å‘é€æ¶ˆæ¯"><span>å•å‘å‘é€æ¶ˆæ¯</span></a></h4><p>å•å‘å‘é€æ¶ˆæ¯æ˜¯æŒ‡ï¼ŒProducerä»…è´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œä¸ç­‰å¾…ã€ä¸å¤„ç†MQçš„ACKã€‚è¯¥å‘é€æ–¹å¼æ—¶MQä¹Ÿä¸è¿”å›ACKã€‚è¯¥æ–¹å¼çš„æ¶ˆæ¯å‘é€æ•ˆç‡æœ€é«˜ï¼Œä½†æ¶ˆæ¯å¯é æ€§è¾ƒå·®ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208150023.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h3 id="_2-ä»£ç ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-ä»£ç ä¸¾ä¾‹"><span>2 ä»£ç ä¸¾ä¾‹</span></a></h3><h4 id="åˆ›å»ºå·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå·¥ç¨‹"><span>åˆ›å»ºå·¥ç¨‹</span></a></h4><p>åˆ›å»ºä¸€ä¸ªMavençš„Javaå·¥ç¨‹rocketmq-testã€‚</p><p>å¯¼å…¥rocketmqçš„clientä¾èµ–ã€‚</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">project.build.sourceEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;UTF-8&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">project.build.sourceEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">maven.compiler.source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;1.8&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">maven.compiler.source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">maven.compiler.target</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;1.8&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">maven.compiler.target</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;org.apache.rocketmq&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;rocketmq-client&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;4.8.0&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰åŒæ­¥æ¶ˆæ¯å‘é€ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰åŒæ­¥æ¶ˆæ¯å‘é€ç”Ÿäº§è€…"><span>å®šä¹‰åŒæ­¥æ¶ˆæ¯å‘é€ç”Ÿäº§è€…</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SyncProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åˆ›å»ºä¸€ä¸ªproducerï¼Œå‚æ•°ä¸ºProducer Groupåç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šnameServeråœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è®¾ç½®å½“å‘é€å¤±è´¥æ—¶é‡è¯•å‘é€çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 2 æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setRetryTimesWhenSendFailed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è®¾ç½®å‘é€è¶…æ—¶æ—¶é™ä¸º5sï¼Œé»˜è®¤3s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setSendMsgTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å¼€å¯ç”Ÿäº§è€…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ç”Ÿäº§å¹¶å‘é€ 100 æ¡æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, body);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // ä¸ºæ¶ˆæ¯æŒ‡å®škey</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key-&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            SendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sendResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(sendResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å…³é—­producer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¶ˆæ¯å‘é€çš„çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SendStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    SEND_OK</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // å‘é€æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    FLUSH_DISK_TIMEOUT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Â // åˆ·ç›˜è¶…æ—¶ã€‚å½“Brokerè®¾ç½®çš„åˆ·ç›˜ç­–ç•¥ä¸ºåŒæ­¥åˆ·ç›˜æ—¶æ‰å¯èƒ½å‡ºç°è¿™ç§å¼‚å¸¸çŠ¶æ€ã€‚å¼‚æ­¥åˆ·ç›˜ä¸ä¼šå‡ºç°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    FLUSH_SLAVE_TIMEOUT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // SlaveåŒæ­¥è¶…æ—¶ã€‚å½“Brokeré›†ç¾¤è®¾ç½®çš„Master-Slaveçš„å¤åˆ¶æ–¹å¼ä¸ºåŒæ­¥å¤åˆ¶æ—¶æ‰å¯èƒ½å‡ºç°è¿™ç§å¼‚å¸¸çŠ¶æ€ã€‚å¼‚æ­¥å¤åˆ¶ä¸ä¼šå‡ºç°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    SLAVE_NOT_AVAILABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ²¡æœ‰å¯ç”¨çš„Slaveã€‚å½“Brokeré›†ç¾¤è®¾ç½®ä¸ºMaster-Slaveçš„å¤åˆ¶æ–¹å¼ä¸ºåŒæ­¥å¤åˆ¶æ—¶æ‰å¯èƒ½å‡ºç°è¿™ç§å¼‚å¸¸çŠ¶æ€ã€‚å¼‚æ­¥å¤åˆ¶ä¸ä¼šå‡ºç°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰å¼‚æ­¥æ¶ˆæ¯å‘é€ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰å¼‚æ­¥æ¶ˆæ¯å‘é€ç”Ÿäº§è€…"><span>å®šä¹‰å¼‚æ­¥æ¶ˆæ¯å‘é€ç”Ÿäº§è€…</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> AsyncProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šå¼‚æ­¥å‘é€å¤±è´¥åä¸è¿›è¡Œé‡è¯•å‘é€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setRetryTimesWhenSendAsyncFailed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šæ–°åˆ›å»ºçš„Topicçš„Queueæ•°é‡ä¸º 2 ï¼Œé»˜è®¤ä¸º 4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setDefaultTopicQueueNums</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTopicA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, body);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // å¼‚æ­¥å‘é€ã€‚æŒ‡å®šå›è°ƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SendCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                    // å½“produceræ¥æ”¶åˆ°MQå‘é€æ¥çš„ACKåå°±ä¼šè§¦å‘è¯¥å›è°ƒæ–¹æ³•çš„æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SendResult</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> sendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(sendResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> onException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Throwable</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// end-for</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // sleepä¸€ä¼šå„¿</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ç”±äºé‡‡ç”¨çš„æ˜¯å¼‚æ­¥å‘é€ï¼Œæ‰€ä»¥è‹¥è¿™é‡Œä¸sleepï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åˆ™æ¶ˆæ¯è¿˜æœªå‘é€å°±ä¼šå°†producerç»™å…³é—­ï¼ŒæŠ¥é”™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        TimeUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SECONDS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰å•å‘æ¶ˆæ¯å‘é€ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰å•å‘æ¶ˆæ¯å‘é€ç”Ÿäº§è€…"><span>å®šä¹‰å•å‘æ¶ˆæ¯å‘é€ç”Ÿäº§è€…</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> OnewayProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;single&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, body);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // å•å‘å‘é€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sendOneway</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;producer shutdown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰æ¶ˆæ¯æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰æ¶ˆæ¯æ¶ˆè´¹è€…"><span>å®šä¹‰æ¶ˆæ¯æ¶ˆè´¹è€…</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SomeConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MQClientException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å®šä¹‰ä¸€ä¸ªpullæ¶ˆè´¹è€…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // DefaultLitePullConsumer consumer = new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        DefaultLitePullConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å®šä¹‰ä¸€ä¸ªpushæ¶ˆè´¹è€…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šnameServer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šä»ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_FROM_FIRST_OFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šæ¶ˆè´¹topicä¸tag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šé‡‡ç”¨â€œå¹¿æ’­æ¨¡å¼â€è¿›è¡Œæ¶ˆè´¹ï¼Œé»˜è®¤ä¸ºâ€œé›†ç¾¤æ¨¡å¼â€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // consumer.setMessageModel(MessageModel.BROADCASTING);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // ä¸€æ—¦brokerä¸­æœ‰äº†å…¶è®¢é˜…çš„æ¶ˆæ¯å°±ä¼šè§¦å‘è¯¥æ–¹æ³•çš„æ‰§è¡Œï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // å…¶è¿”å›å€¼ä¸ºå½“å‰consumeræ¶ˆè´¹çš„çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // é€æ¡æ¶ˆè´¹æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> msgs) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // è¿”å›æ¶ˆè´¹çŠ¶æ€ï¼šæ¶ˆè´¹æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å¼€å¯æ¶ˆè´¹è€…æ¶ˆè´¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Consumer Started&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äºŒã€é¡ºåºæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#äºŒã€é¡ºåºæ¶ˆæ¯"><span>äºŒã€é¡ºåºæ¶ˆæ¯</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯é¡ºåºæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯é¡ºåºæ¶ˆæ¯"><span>1 ä»€ä¹ˆæ˜¯é¡ºåºæ¶ˆæ¯</span></a></h3><p>é¡ºåºæ¶ˆæ¯æŒ‡çš„æ˜¯ï¼Œä¸¥æ ¼æŒ‰ç…§æ¶ˆæ¯çš„<code>å‘é€é¡ºåº</code>è¿›è¡Œ<code>æ¶ˆè´¹</code>çš„æ¶ˆæ¯(FIFO)ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ç”Ÿäº§è€…ä¼šæŠŠæ¶ˆæ¯ä»¥Round Robinè½®è¯¢æ–¹å¼å‘é€åˆ°ä¸åŒçš„Queueåˆ†åŒºé˜Ÿåˆ—ï¼›è€Œæ¶ˆè´¹æ¶ˆæ¯æ—¶ä¼šä»å¤šä¸ªQueueä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µä¸‹çš„å‘é€å’Œæ¶ˆè´¹æ˜¯ä¸èƒ½ä¿è¯é¡ºåºçš„ã€‚å¦‚æœå°†æ¶ˆæ¯ä»…å‘é€åˆ°åŒä¸€ä¸ªQueueä¸­ï¼Œæ¶ˆè´¹æ—¶ä¹Ÿåªä»è¿™ä¸ªQueueä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œå°±ä¸¥æ ¼ä¿è¯äº†æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚</p><h3 id="_2-ä¸ºä»€ä¹ˆéœ€è¦é¡ºåºæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_2-ä¸ºä»€ä¹ˆéœ€è¦é¡ºåºæ¶ˆæ¯"><span>2 ä¸ºä»€ä¹ˆéœ€è¦é¡ºåºæ¶ˆæ¯</span></a></h3><p>ä¾‹å¦‚ï¼Œç°åœ¨æœ‰TOPIC <code>ORDER_STATUS</code>(è®¢å•çŠ¶æ€)ï¼Œå…¶ä¸‹æœ‰ 4 ä¸ªQueueé˜Ÿåˆ—ï¼Œè¯¥Topicä¸­çš„ä¸åŒæ¶ˆæ¯ç”¨äºæè¿°å½“å‰è®¢å•çš„ä¸åŒçŠ¶æ€ã€‚å‡è®¾è®¢å•æœ‰çŠ¶æ€ï¼šæœªæ”¯ä»˜ã€å·²æ”¯ä»˜ã€å‘è´§ä¸­ã€å‘è´§æˆåŠŸã€å‘è´§å¤±è´¥ã€‚</p><p>æ ¹æ®ä»¥ä¸Šè®¢å•çŠ¶æ€ï¼Œç”Ÿäº§è€…ä»æ—¶åºä¸Šå¯ä»¥ç”Ÿæˆå¦‚ä¸‹å‡ ä¸ªæ¶ˆæ¯ï¼š</p><p>`è®¢å•T0000001:æœªæ”¯ä»˜ --&gt; è®¢å•T0000001:å·²æ”¯ä»˜ --&gt; è®¢å•T0000001:å‘è´§ä¸­ --&gt; è®¢å•T0000001:å‘è´§å¤±è´¥</p><p>æ¶ˆæ¯å‘é€åˆ°MQä¸­ä¹‹åï¼ŒQueueçš„é€‰æ‹©å¦‚æœé‡‡ç”¨è½®è¯¢ç­–ç•¥ï¼Œæ¶ˆæ¯åœ¨MQçš„å­˜å‚¨å¯èƒ½å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208152040.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›Consumeræ¶ˆè´¹æ¶ˆæ¯çš„é¡ºåºå’Œæˆ‘ä»¬å‘é€æ˜¯ä¸€è‡´çš„ï¼Œç„¶è€Œä¸Šè¿°MQçš„æŠ•é€’å’Œæ¶ˆè´¹æ–¹å¼ï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯é¡ºåºæ˜¯æ­£ç¡®çš„ã€‚å¯¹äºé¡ºåºå¼‚å¸¸çš„æ¶ˆæ¯ï¼ŒConsumerå³ä½¿è®¾ç½®æœ‰ä¸€å®šçš„çŠ¶æ€å®¹é”™ï¼Œä¹Ÿä¸èƒ½å®Œå…¨å¤„ç†å¥½è¿™ä¹ˆå¤šç§éšæœºå‡ºç°ç»„åˆæƒ…å†µã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208152144.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>åŸºäºä¸Šè¿°çš„æƒ…å†µï¼Œå¯ä»¥è®¾è®¡å¦‚ä¸‹æ–¹æ¡ˆï¼šå¯¹äºç›¸åŒè®¢å•å·çš„æ¶ˆæ¯ï¼Œé€šè¿‡ä¸€å®šçš„ç­–ç•¥ï¼Œå°†å…¶æ”¾ç½®åœ¨ä¸€ä¸ªQueueä¸­ï¼Œç„¶åæ¶ˆè´¹è€…å†é‡‡ç”¨ä¸€å®šçš„ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹ç‹¬ç«‹å¤„ç†ä¸€ä¸ªqueueï¼Œä¿è¯å¤„ç†æ¶ˆæ¯çš„é¡ºåºæ€§ï¼‰ï¼Œèƒ½å¤Ÿä¿è¯æ¶ˆè´¹çš„é¡ºåºæ€§ã€‚</p><h3 id="_3-æœ‰åºæ€§åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#_3-æœ‰åºæ€§åˆ†ç±»"><span>3 æœ‰åºæ€§åˆ†ç±»</span></a></h3><p>æ ¹æ®æœ‰åºèŒƒå›´çš„ä¸åŒï¼ŒRocketMQå¯ä»¥ä¸¥æ ¼åœ°ä¿è¯ä¸¤ç§æ¶ˆæ¯çš„æœ‰åºæ€§ï¼šåˆ†åŒºæœ‰åºä¸å…¨å±€æœ‰åºã€‚</p><h4 id="å…¨å±€æœ‰åº" tabindex="-1"><a class="header-anchor" href="#å…¨å±€æœ‰åº"><span>å…¨å±€æœ‰åº</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208152224.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>å½“å‘é€å’Œæ¶ˆè´¹å‚ä¸çš„Queueåªæœ‰ä¸€ä¸ªæ—¶æ‰€ä¿è¯çš„æœ‰åºæ˜¯æ•´ä¸ªTopicä¸­æ¶ˆæ¯çš„é¡ºåºï¼Œ ç§°ä¸º<code>å…¨å±€æœ‰åº</code>ã€‚</p><blockquote><p>åœ¨åˆ›å»ºTopicæ—¶æŒ‡å®šQueueçš„æ•°é‡ã€‚æœ‰ä¸‰ç§æŒ‡å®šæ–¹å¼ï¼š 1 ï¼‰åœ¨ä»£ç ä¸­åˆ›å»ºProduceræ—¶ï¼Œå¯ä»¥æŒ‡å®šå…¶è‡ªåŠ¨åˆ›å»ºçš„Topicçš„Queueæ•°é‡ 2 ï¼‰åœ¨RocketMQå¯è§†åŒ–æ§åˆ¶å°ä¸­æ‰‹åŠ¨åˆ›å»ºTopicæ—¶æŒ‡å®šQueueæ•°é‡ 3 ï¼‰ä½¿ç”¨mqadminå‘½ä»¤æ‰‹åŠ¨åˆ›å»ºTopicæ—¶æŒ‡å®šQueueæ•°é‡</p></blockquote><h4 id="åˆ†åŒºæœ‰åº" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºæœ‰åº"><span>åˆ†åŒºæœ‰åº</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208152417.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>å¦‚æœæœ‰å¤šä¸ªQueueå‚ä¸ï¼Œå…¶ä»…å¯ä¿è¯åœ¨è¯¥Queueåˆ†åŒºé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯é¡ºåºï¼Œåˆ™ç§°ä¸º<code>åˆ†åŒºæœ‰åº</code>ã€‚</p><blockquote><p>å¦‚ä½•å®ç°Queueçš„é€‰æ‹©ï¼Ÿåœ¨å®šä¹‰Produceræ—¶æˆ‘ä»¬å¯ä»¥æŒ‡å®šæ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©å™¨ï¼Œè€Œè¿™ä¸ªé€‰æ‹©å™¨æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°äº†MessageQueueSelectoræ¥å£å®šä¹‰çš„ã€‚</p><p>åœ¨å®šä¹‰é€‰æ‹©å™¨çš„é€‰æ‹©ç®—æ³•æ—¶ï¼Œä¸€èˆ¬éœ€è¦ä½¿ç”¨é€‰æ‹©keyã€‚è¿™ä¸ªé€‰æ‹©keyå¯ä»¥æ˜¯æ¶ˆæ¯keyä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒæ•°æ®ã€‚ä½†æ— è®ºè°åšé€‰æ‹©keyï¼Œéƒ½ä¸èƒ½é‡å¤ï¼Œéƒ½æ˜¯å”¯ä¸€çš„ã€‚</p><p>ä¸€èˆ¬æ€§çš„é€‰æ‹©ç®—æ³•æ˜¯ï¼Œè®©é€‰æ‹©keyï¼ˆæˆ–å…¶hashå€¼ï¼‰ä¸è¯¥Topicæ‰€åŒ…å«çš„Queueçš„æ•°é‡å–æ¨¡ï¼Œå…¶ç»“æœå³ä¸ºé€‰æ‹©å‡ºçš„Queueçš„QueueIdã€‚</p><p>å–æ¨¡ç®—æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šä¸åŒé€‰æ‹©keyä¸Queueæ•°é‡å–æ¨¡ç»“æœå¯èƒ½ä¼šæ˜¯ç›¸åŒçš„ï¼Œå³ä¸åŒé€‰æ‹©keyçš„æ¶ˆæ¯å¯èƒ½ä¼šå‡ºç°åœ¨ç›¸åŒçš„Queueï¼Œå³åŒä¸€ä¸ªConsuemrå¯èƒ½ä¼šæ¶ˆè´¹åˆ°ä¸åŒé€‰æ‹©keyçš„æ¶ˆæ¯ã€‚è¿™ä¸ªé—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿä¸€èˆ¬æ€§çš„ä½œæ³•æ˜¯ï¼Œä»æ¶ˆæ¯ä¸­è·å–åˆ°é€‰æ‹©keyï¼Œå¯¹å…¶è¿›è¡Œåˆ¤æ–­ã€‚è‹¥æ˜¯å½“å‰Consumeréœ€è¦æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œåˆ™ç›´æ¥æ¶ˆè´¹ï¼Œå¦åˆ™ï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚è¿™ç§åšæ³•è¦æ±‚é€‰æ‹©keyè¦èƒ½å¤Ÿéšç€æ¶ˆæ¯ä¸€èµ·è¢«Consumerè·å–åˆ°ã€‚æ­¤æ—¶ä½¿ç”¨æ¶ˆæ¯keyä½œä¸ºé€‰æ‹©keyæ˜¯æ¯”è¾ƒå¥½çš„åšæ³•ã€‚</p><p>ä»¥ä¸Šåšæ³•ä¼šä¸ä¼šå‡ºç°å¦‚ä¸‹æ–°çš„é—®é¢˜å‘¢ï¼Ÿä¸å±äºé‚£ä¸ªConsumerçš„æ¶ˆæ¯è¢«æ‹‰å–èµ°äº†ï¼Œé‚£ä¹ˆåº”è¯¥æ¶ˆè´¹è¯¥æ¶ˆæ¯çš„Consumeræ˜¯å¦è¿˜èƒ½å†æ¶ˆè´¹è¯¥æ¶ˆæ¯å‘¢ï¼ŸåŒä¸€ä¸ªQueueä¸­çš„æ¶ˆæ¯ä¸å¯èƒ½è¢«åŒä¸€ä¸ªGroupä¸­çš„ä¸åŒConsumeråŒæ—¶æ¶ˆè´¹ã€‚æ‰€ä»¥ï¼Œæ¶ˆè´¹ç°ä¸€ä¸ªQueueçš„ä¸åŒé€‰æ‹©keyçš„æ¶ˆæ¯çš„Consumerä¸€å®šå±äºä¸åŒçš„Groupã€‚è€Œä¸åŒçš„Groupä¸­çš„Consumeré—´çš„æ¶ˆè´¹æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œäº’ä¸å½±å“çš„ã€‚</p></blockquote><h3 id="_4-ä»£ç ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#_4-ä»£ç ä¸¾ä¾‹"><span>4 ä»£ç ä¸¾ä¾‹</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> OrderedProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> orderId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TopicA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TagA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, body);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            SendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sendResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageQueueSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MessageQueue</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">mqs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                        Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (Integer) arg;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> index</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> mqs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> mqs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(index);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }, orderId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(sendResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 	æ¶ˆè´¹è€…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> orderlyConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">() throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TopicA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // MessageListenerConcurrently å¹¶å‘æ¨¡å¼ å¤šçº¿ç¨‹çš„  é‡è¯•16æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // MessageListenerOrderly é¡ºåºæ¨¡å¼ å•çº¿ç¨‹çš„  é‡è¯•Integer.Max_Value21äº¿</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerOrderly</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeOrderlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeOrderlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;çº¿ç¨‹id:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBody</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeOrderlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        })</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸‰ã€å»¶æ—¶æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å»¶æ—¶æ¶ˆæ¯"><span>ä¸‰ã€å»¶æ—¶æ¶ˆæ¯</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯å»¶æ—¶æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯å»¶æ—¶æ¶ˆæ¯"><span>1 ä»€ä¹ˆæ˜¯å»¶æ—¶æ¶ˆæ¯</span></a></h3><p>å½“æ¶ˆæ¯å†™å…¥åˆ°Brokeråï¼Œåœ¨æŒ‡å®šçš„æ—¶é•¿åæ‰å¯è¢«æ¶ˆè´¹å¤„ç†çš„æ¶ˆæ¯ï¼Œç§°ä¸ºå»¶æ—¶æ¶ˆæ¯ã€‚</p><p>é‡‡ç”¨RocketMQçš„å»¶æ—¶æ¶ˆæ¯å¯ä»¥å®ç°<code>å®šæ—¶ä»»åŠ¡</code>çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€ä½¿ç”¨å®šæ—¶å™¨ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Œç”µå•†äº¤æ˜“ä¸­è¶…æ—¶æœªæ”¯ä»˜å…³é—­è®¢å•çš„åœºæ™¯ï¼Œ 12306 å¹³å°è®¢ç¥¨è¶…æ—¶æœªæ”¯ä»˜å–æ¶ˆè®¢ç¥¨çš„åœºæ™¯ã€‚</p><blockquote><p>åœ¨ç”µå•†å¹³å°ä¸­ï¼Œè®¢å•åˆ›å»ºæ—¶ä¼šå‘é€ä¸€æ¡å»¶è¿Ÿæ¶ˆæ¯ã€‚è¿™æ¡æ¶ˆæ¯å°†ä¼šåœ¨ 30 åˆ†é’ŸåæŠ•é€’ç»™åå°ä¸šåŠ¡ç³»ç»Ÿï¼ˆConsumerï¼‰ï¼Œåå°ä¸šåŠ¡ç³»ç»Ÿæ”¶åˆ°è¯¥æ¶ˆæ¯åä¼šåˆ¤æ–­å¯¹åº”çš„è®¢å•æ˜¯å¦å·²ç»å®Œæˆæ”¯ä»˜ã€‚å¦‚æœæœªå®Œæˆï¼Œåˆ™å–æ¶ˆè®¢å•ï¼Œå°†å•†å“å†æ¬¡æ”¾å›åˆ°åº“å­˜ï¼›å¦‚æœå®Œæˆæ”¯ä»˜ï¼Œåˆ™å¿½ç•¥ã€‚ åœ¨ 12306 å¹³å°ä¸­ï¼Œè½¦ç¥¨é¢„è®¢æˆåŠŸåå°±ä¼šå‘é€ä¸€æ¡å»¶è¿Ÿæ¶ˆæ¯ã€‚è¿™æ¡æ¶ˆæ¯å°†ä¼šåœ¨ 45 åˆ†é’ŸåæŠ•é€’ç»™åå°ä¸šåŠ¡ç³»ç»Ÿï¼ˆConsumerï¼‰ï¼Œåå°ä¸šåŠ¡ç³»ç»Ÿæ”¶åˆ°è¯¥æ¶ˆæ¯åä¼šåˆ¤æ–­å¯¹åº”çš„è®¢å•æ˜¯å¦å·²ç»å®Œæˆæ”¯ä»˜ã€‚å¦‚æœæœªå®Œæˆï¼Œåˆ™å–æ¶ˆé¢„è®¢ï¼Œå°†è½¦ç¥¨å†æ¬¡æ”¾å›åˆ°ç¥¨æ± ï¼›å¦‚æœå®Œæˆæ”¯ä»˜ï¼Œåˆ™å¿½ç•¥ã€‚</p></blockquote><h3 id="_2-å»¶æ—¶ç­‰çº§" tabindex="-1"><a class="header-anchor" href="#_2-å»¶æ—¶ç­‰çº§"><span>2 å»¶æ—¶ç­‰çº§</span></a></h3><p>å»¶æ—¶æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é•¿<code>ä¸æ”¯æŒéšæ„æ—¶é•¿</code>çš„å»¶è¿Ÿï¼Œæ˜¯é€šè¿‡ç‰¹å®šçš„å»¶è¿Ÿç­‰çº§æ¥æŒ‡å®šçš„ã€‚å»¶æ—¶ç­‰çº§å®šä¹‰åœ¨RocketMQæœåŠ¡ç«¯çš„MessageStoreConfigç±»ä¸­çš„å¦‚ä¸‹å˜é‡ä¸­ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208153410.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>å³ï¼Œè‹¥æŒ‡å®šçš„å»¶æ—¶ç­‰çº§ä¸º 3 ï¼Œåˆ™è¡¨ç¤ºå»¶è¿Ÿæ—¶é•¿ä¸º10sï¼Œå³å»¶è¿Ÿç­‰çº§æ˜¯ä» 1 å¼€å§‹è®¡æ•°çš„ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰çš„å»¶æ—¶ç­‰çº§ï¼Œå¯ä»¥é€šè¿‡åœ¨brokeråŠ è½½çš„é…ç½®ä¸­æ–°å¢å¦‚ä¸‹é…ç½®ï¼ˆä¾‹å¦‚ä¸‹é¢å¢åŠ äº† 1å¤©è¿™ä¸ªç­‰çº§1dï¼‰ã€‚é…ç½®æ–‡ä»¶åœ¨RocketMQå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸­ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>messageDelayLevel = 1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h 1d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-å»¶æ—¶æ¶ˆæ¯å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_3-å»¶æ—¶æ¶ˆæ¯å®ç°åŸç†"><span>3 å»¶æ—¶æ¶ˆæ¯å®ç°åŸç†</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208153523.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="å…·ä½“å®ç°æ–¹æ¡ˆæ˜¯" tabindex="-1"><a class="header-anchor" href="#å…·ä½“å®ç°æ–¹æ¡ˆæ˜¯"><span>å…·ä½“å®ç°æ–¹æ¡ˆæ˜¯ï¼š</span></a></h4><h4 id="ä¿®æ”¹æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹æ¶ˆæ¯"><span>ä¿®æ”¹æ¶ˆæ¯</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208153545.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>Producerå°†æ¶ˆæ¯å‘é€åˆ°Brokeråï¼ŒBrokerä¼šé¦–å…ˆå°†æ¶ˆæ¯å†™å…¥åˆ°commitlogæ–‡ä»¶ï¼Œç„¶åéœ€è¦å°†å…¶åˆ†å‘åˆ°ç›¸åº”çš„consumequeueã€‚ä¸è¿‡ï¼Œåœ¨åˆ†å‘ä¹‹å‰ï¼Œç³»ç»Ÿä¼šå…ˆåˆ¤æ–­æ¶ˆæ¯ä¸­æ˜¯å¦å¸¦æœ‰å»¶æ—¶ç­‰çº§ã€‚è‹¥æ²¡æœ‰ï¼Œåˆ™ç›´æ¥æ­£å¸¸åˆ†å‘ï¼›è‹¥æœ‰åˆ™éœ€è¦ç»å†ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼š</p><ul><li>ä¿®æ”¹æ¶ˆæ¯çš„Topicä¸ºSCHEDULE_TOPIC_XXXX</li><li>æ ¹æ®å»¶æ—¶ç­‰çº§ï¼Œåœ¨consumequeueç›®å½•ä¸­SCHEDULE_TOPIC_XXXXä¸»é¢˜ä¸‹åˆ›å»ºå‡ºç›¸åº”çš„queueIdç›®å½•ä¸consumequeueæ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰è¿™äº›ç›®å½•ä¸æ–‡ä»¶çš„è¯ï¼‰ã€‚</li></ul><blockquote><p>å»¶è¿Ÿç­‰çº§delayLevelä¸queueIdçš„å¯¹åº”å…³ç³»ä¸ºqueueId = delayLevel -1 éœ€è¦æ³¨æ„ï¼Œåœ¨åˆ›å»ºqueueIdç›®å½•æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§åœ°å°†æ‰€æœ‰å»¶è¿Ÿç­‰çº§å¯¹åº”çš„ç›®å½•å…¨éƒ¨åˆ›å»ºå®Œæ¯•ï¼Œè€Œæ˜¯ç”¨åˆ°å“ªä¸ªå»¶è¿Ÿç­‰çº§åˆ›å»ºå“ªä¸ªç›®å½•</p></blockquote><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208153635.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><ul><li>ä¿®æ”¹æ¶ˆæ¯ç´¢å¼•å•å…ƒå†…å®¹ã€‚ç´¢å¼•å•å…ƒä¸­çš„Message Tag HashCodeéƒ¨åˆ†åŸæœ¬å­˜æ”¾çš„æ˜¯æ¶ˆæ¯çš„Tagçš„Hashå€¼ã€‚ç°ä¿®æ”¹ä¸ºæ¶ˆæ¯çš„<code>æŠ•é€’æ—¶é—´</code>ã€‚æŠ•é€’æ—¶é—´æ˜¯æŒ‡è¯¥æ¶ˆæ¯è¢«é‡æ–°ä¿®æ”¹ä¸ºåŸTopicåå†æ¬¡è¢«å†™å…¥åˆ°commitlogä¸­çš„æ—¶é—´ã€‚<code>æŠ•é€’æ—¶é—´ = æ¶ˆæ¯å­˜å‚¨æ—¶é—´ + å»¶æ—¶ç­‰çº§æ—¶é—´</code>ã€‚æ¶ˆæ¯å­˜å‚¨æ—¶é—´æŒ‡çš„æ˜¯æ¶ˆæ¯è¢«å‘é€åˆ°Brokeræ—¶çš„æ—¶é—´æˆ³ã€‚</li><li>å°†æ¶ˆæ¯ç´¢å¼•å†™å…¥åˆ°SCHEDULE_TOPIC_XXXXä¸»é¢˜ä¸‹ç›¸åº”çš„consumequeueä¸­</li></ul><blockquote><p>SCHEDULE_TOPIC_XXXXç›®å½•ä¸­å„ä¸ªå»¶æ—¶ç­‰çº§Queueä¸­çš„æ¶ˆæ¯æ˜¯å¦‚ä½•æ’åºçš„ï¼Ÿ æ˜¯æŒ‰ç…§æ¶ˆæ¯æŠ•é€’æ—¶é—´æ’åºçš„ã€‚ä¸€ä¸ªBrokerä¸­åŒä¸€ç­‰çº§çš„æ‰€æœ‰å»¶æ—¶æ¶ˆæ¯ä¼šè¢«å†™å…¥åˆ°consumequeueç›®å½•ä¸­SCHEDULE_TOPIC_XXXXç›®å½•ä¸‹ç›¸åŒQueueä¸­ã€‚å³ä¸€ä¸ªQueueä¸­æ¶ˆæ¯æŠ•é€’æ—¶é—´çš„å»¶è¿Ÿç­‰çº§æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚é‚£ä¹ˆæŠ•é€’æ—¶é—´å°±å–å†³äºäº<code>æ¶ˆæ¯å­˜å‚¨æ—¶é—´</code>äº†ã€‚å³æŒ‰ç…§æ¶ˆæ¯è¢«å‘é€åˆ°Brokerçš„æ—¶é—´è¿›è¡Œæ’åºçš„ã€‚</p></blockquote><h4 id="æŠ•é€’å»¶æ—¶æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æŠ•é€’å»¶æ—¶æ¶ˆæ¯"><span>æŠ•é€’å»¶æ—¶æ¶ˆæ¯</span></a></h4><p>Brokerå†…éƒ¨æœ‰ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯æœåŠ¡ç±»ScheuleMessageServiceï¼Œå…¶ä¼šæ¶ˆè´¹SCHEDULE_TOPIC_XXXXä¸­çš„æ¶ˆæ¯ï¼Œå³æŒ‰ç…§æ¯æ¡æ¶ˆæ¯çš„æŠ•é€’æ—¶é—´ï¼Œå°†å»¶æ—¶æ¶ˆæ¯æŠ•é€’åˆ°ç›®æ ‡Topicä¸­ã€‚ä¸è¿‡ï¼Œåœ¨æŠ•é€’ä¹‹å‰ä¼šä»commitlogä¸­å°†åŸæ¥å†™å…¥çš„æ¶ˆæ¯å†æ¬¡è¯»å‡ºï¼Œå¹¶å°†å…¶åŸæ¥çš„å»¶æ—¶ç­‰çº§è®¾ç½®ä¸º 0 ï¼Œå³åŸæ¶ˆæ¯å˜ä¸ºäº†ä¸€æ¡ä¸å»¶è¿Ÿçš„æ™®é€šæ¶ˆæ¯ã€‚ç„¶åå†æ¬¡å°†æ¶ˆæ¯æŠ•é€’åˆ°ç›®æ ‡Topicä¸­ã€‚</p><blockquote><p>ScheuleMessageServiceåœ¨Brokerå¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨TImerï¼Œç”¨äºæ‰§è¡Œç›¸åº”çš„å®šæ—¶ä»»åŠ¡ã€‚ç³»ç»Ÿä¼šæ ¹æ®å»¶æ—¶ç­‰çº§çš„ä¸ªæ•°ï¼Œå®šä¹‰ç›¸åº”æ•°é‡çš„TimerTaskï¼Œæ¯ä¸ªTimerTaskè´Ÿè´£ä¸€ä¸ªå»¶è¿Ÿç­‰çº§æ¶ˆæ¯çš„æ¶ˆè´¹ä¸æŠ•é€’ã€‚æ¯ä¸ªTimerTaskéƒ½ä¼šæ£€ æµ‹ç›¸åº”Queueé˜Ÿåˆ—çš„ç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯å¦åˆ°æœŸã€‚è‹¥ç¬¬ä¸€æ¡æ¶ˆæ¯æœªåˆ°æœŸï¼Œåˆ™åé¢çš„æ‰€æœ‰æ¶ˆæ¯æ›´ä¸ä¼šåˆ°æœŸï¼ˆæ¶ˆæ¯æ˜¯æŒ‰ç…§æŠ•é€’æ—¶é—´æ’åºçš„ï¼‰ï¼›è‹¥ç¬¬ä¸€æ¡æ¶ˆæ¯åˆ°æœŸäº†ï¼Œåˆ™å°†è¯¥æ¶ˆæ¯æŠ•é€’åˆ°ç›®æ ‡Topicï¼Œå³æ¶ˆè´¹è¯¥æ¶ˆæ¯ã€‚</p></blockquote><h4 id="å°†æ¶ˆæ¯é‡æ–°å†™å…¥commitlog" tabindex="-1"><a class="header-anchor" href="#å°†æ¶ˆæ¯é‡æ–°å†™å…¥commitlog"><span>å°†æ¶ˆæ¯é‡æ–°å†™å…¥commitlog</span></a></h4><p>å»¶è¿Ÿæ¶ˆæ¯æœåŠ¡ç±»ScheuleMessageServiceå°†å»¶è¿Ÿæ¶ˆæ¯å†æ¬¡å‘é€ç»™äº†commitlogï¼Œå¹¶å†æ¬¡å½¢æˆæ–°çš„æ¶ˆæ¯ç´¢å¼•æ¡ç›®ï¼Œåˆ†å‘åˆ°ç›¸åº”Queueã€‚</p><blockquote><p>è¿™å…¶å®å°±æ˜¯ä¸€æ¬¡æ™®é€šæ¶ˆæ¯å‘é€ã€‚åªä¸è¿‡è¿™æ¬¡çš„æ¶ˆæ¯Produceræ˜¯å»¶è¿Ÿæ¶ˆæ¯æœåŠ¡ç±»ScheuleMessageServiceã€‚</p></blockquote><h3 id="_4-ä»£ç ä¸¾ä¾‹-1" tabindex="-1"><a class="header-anchor" href="#_4-ä»£ç ä¸¾ä¾‹-1"><span>4 ä»£ç ä¸¾ä¾‹</span></a></h3><p>å®šä¹‰DelayProducerç±»</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> DelayProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TopicB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, body);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // æŒ‡å®šæ¶ˆæ¯å»¶è¿Ÿç­‰çº§ä¸º 3 çº§ï¼Œå³å»¶è¿Ÿ10s,å…·ä½“ç­‰çº§æ—¶é—´æŸ¥è¯¢å®˜ç½‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setDelayTimeLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            SendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sendResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // è¾“å‡ºæ¶ˆæ¯è¢«å‘é€çš„æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SimpleDateFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;mm:ss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot; ,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> sendResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰OtherConsumerç±»</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> OtherConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MQClientException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_FROM_FIRST_OFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TopicB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> msgs) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                    // è¾“å‡ºæ¶ˆæ¯è¢«æ¶ˆè´¹çš„æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SimpleDateFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;mm:ss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot; ,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Consumer Started&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å››ã€äº‹åŠ¡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å››ã€äº‹åŠ¡æ¶ˆæ¯"><span>å››ã€äº‹åŠ¡æ¶ˆæ¯</span></a></h2><h3 id="_1-é—®é¢˜å¼•å…¥" tabindex="-1"><a class="header-anchor" href="#_1-é—®é¢˜å¼•å…¥"><span>1 é—®é¢˜å¼•å…¥</span></a></h3><p>è¿™é‡Œçš„ä¸€ä¸ªéœ€æ±‚åœºæ™¯æ˜¯ï¼šå·¥è¡Œç”¨æˆ·Aå‘å»ºè¡Œç”¨æˆ·Bè½¬è´¦ 1 ä¸‡å…ƒã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæ­¥æ¶ˆæ¯æ¥å¤„ç†è¯¥éœ€æ±‚åœºæ™¯ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208154429.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><ul><li><ol><li>å·¥è¡Œç³»ç»Ÿå‘é€ä¸€ä¸ªç»™Bå¢æ¬¾ 1 ä¸‡å…ƒçš„åŒæ­¥æ¶ˆæ¯Mç»™Broker</li></ol></li><li><ol start="2"><li>æ¶ˆæ¯è¢«BrokeræˆåŠŸæ¥æ”¶åï¼Œå‘å·¥è¡Œç³»ç»Ÿå‘é€æˆåŠŸACK</li></ol></li><li><ol start="3"><li>å·¥è¡Œç³»ç»Ÿæ”¶åˆ°æˆåŠŸACKåä»ç”¨æˆ·Aä¸­æ‰£æ¬¾ 1 ä¸‡å…ƒ</li></ol></li><li><ol start="4"><li>å»ºè¡Œç³»ç»Ÿä»Brokerä¸­è·å–åˆ°æ¶ˆæ¯M</li></ol></li><li><ol start="5"><li>å»ºè¡Œç³»ç»Ÿæ¶ˆè´¹æ¶ˆæ¯Mï¼Œå³å‘ç”¨æˆ·Bä¸­å¢åŠ  1 ä¸‡å…ƒ</li></ol></li></ul><blockquote><p>è¿™å…¶ä¸­æ˜¯æœ‰é—®é¢˜çš„ï¼šè‹¥ç¬¬ 3 æ­¥ä¸­çš„æ‰£æ¬¾æ“ä½œå¤±è´¥ï¼Œä½†æ¶ˆæ¯å·²ç»æˆåŠŸå‘é€åˆ°äº†Brokerã€‚å¯¹äºMQæ¥è¯´ï¼Œåªè¦æ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯å°±å¯ä»¥è¢«æ¶ˆè´¹ã€‚æ­¤æ—¶å»ºè¡Œç³»ç»Ÿä¸­ç”¨æˆ·Bå¢åŠ äº† 1 ä¸‡å…ƒã€‚å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p></blockquote><h3 id="_2-è§£å†³æ€è·¯" tabindex="-1"><a class="header-anchor" href="#_2-è§£å†³æ€è·¯"><span>2 è§£å†³æ€è·¯</span></a></h3><p>è§£å†³æ€è·¯æ˜¯ï¼Œè®©ç¬¬ 1 ã€ 2 ã€ 3 æ­¥å…·æœ‰åŸå­æ€§ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚å³æ¶ˆæ¯å‘é€æˆåŠŸåï¼Œå¿…é¡»è¦ä¿è¯æ‰£æ¬¾æˆåŠŸã€‚å¦‚æœæ‰£æ¬¾å¤±è´¥ï¼Œåˆ™å›æ»šå‘é€æˆåŠŸçš„æ¶ˆæ¯ã€‚è€Œè¯¥æ€è·¯å³ä½¿ç”¨<code>äº‹åŠ¡æ¶ˆæ¯</code>ã€‚è¿™é‡Œè¦ä½¿ç”¨<code>åˆ†å¸ƒå¼äº‹åŠ¡</code>è§£å†³æ–¹æ¡ˆã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208154545.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><h4 id="ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æ¥å¤„ç†è¯¥éœ€æ±‚åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æ¥å¤„ç†è¯¥éœ€æ±‚åœºæ™¯"><span>ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯æ¥å¤„ç†è¯¥éœ€æ±‚åœºæ™¯ï¼š</span></a></h4><ul><li><ol><li>äº‹åŠ¡ç®¡ç†å™¨TMå‘äº‹åŠ¡åè°ƒå™¨TCå‘èµ·æŒ‡ä»¤ï¼Œå¼€å¯å…¨å±€äº‹åŠ¡</li></ol></li><li><ol start="2"><li>å·¥è¡Œç³»ç»Ÿå‘ä¸€ä¸ªç»™Bå¢æ¬¾ 1 ä¸‡å…ƒçš„äº‹åŠ¡æ¶ˆæ¯Mç»™TC</li></ol></li><li><ol start="3"><li>TCä¼šå‘Brokerå‘é€åŠäº‹åŠ¡æ¶ˆæ¯prepareHalfï¼Œå°†æ¶ˆæ¯Mé¢„æäº¤åˆ°Brokerã€‚æ­¤æ—¶çš„å»ºè¡Œç³»ç»Ÿæ˜¯çœ‹ä¸åˆ°Brokerä¸­çš„æ¶ˆæ¯Mçš„</li></ol></li><li><ol start="4"><li>Brokerä¼šå°†é¢„æäº¤æ‰§è¡Œç»“æœReportç»™TCã€‚</li></ol></li><li><ol start="5"><li>å¦‚æœé¢„æäº¤å¤±è´¥ï¼Œåˆ™TCä¼šå‘TMä¸ŠæŠ¥é¢„æäº¤å¤±è´¥çš„å“åº”ï¼Œå…¨å±€äº‹åŠ¡ç»“æŸï¼›å¦‚æœé¢„æäº¤æˆåŠŸï¼ŒTCä¼šè°ƒç”¨å·¥è¡Œç³»ç»Ÿçš„å›è°ƒæ“ä½œï¼Œå»å®Œæˆå·¥è¡Œç”¨æˆ·Açš„é¢„æ‰£æ¬¾ 1 ä¸‡å…ƒçš„æ“ä½œ</li></ol></li><li><ol start="6"><li>å·¥è¡Œç³»ç»Ÿä¼šå‘TCå‘é€é¢„æ‰£æ¬¾æ‰§è¡Œç»“æœï¼Œå³æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€</li></ol></li><li><ol start="7"><li>TCæ”¶åˆ°é¢„æ‰£æ¬¾æ‰§è¡Œç»“æœåï¼Œä¼šå°†ç»“æœä¸ŠæŠ¥ç»™TMã€‚</li></ol></li></ul><blockquote><p>é¢„æ‰£æ¬¾æ‰§è¡Œç»“æœå­˜åœ¨ä¸‰ç§å¯èƒ½æ€§ï¼š</p></blockquote><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æè¿°æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    COMMIT_MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Â // æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    ROLLBACK_MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Â // æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    UNKNOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Â // ä¸ç¡®å®šï¼Œè¡¨ç¤ºéœ€è¦è¿›è¡Œå›æŸ¥ä»¥ç¡®å®šæœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><ol start="8"><li>TMä¼šæ ¹æ®ä¸ŠæŠ¥ç»“æœå‘TCå‘å‡ºä¸åŒçš„ç¡®è®¤æŒ‡ä»¤</li></ol><ul><li>è‹¥é¢„æ‰£æ¬¾æˆåŠŸï¼ˆæœ¬åœ°äº‹åŠ¡çŠ¶æ€ä¸ºCOMMIT_MESSAGEï¼‰ï¼Œåˆ™TMå‘TCå‘é€Global CommitæŒ‡ä»¤</li><li>è‹¥é¢„æ‰£æ¬¾å¤±è´¥ï¼ˆæœ¬åœ°äº‹åŠ¡çŠ¶æ€ä¸ºROLLBACK_MESSAGEï¼‰ï¼Œåˆ™TMå‘TCå‘é€Global RollbackæŒ‡ä»¤</li><li>è‹¥ç°æœªçŸ¥çŠ¶æ€ï¼ˆæœ¬åœ°äº‹åŠ¡çŠ¶æ€ä¸ºUNKNOWï¼‰ï¼Œåˆ™ä¼šè§¦å‘å·¥è¡Œç³»ç»Ÿçš„æœ¬åœ°äº‹åŠ¡çŠ¶æ€<code>å›æŸ¥æ“ä½œ</code>ã€‚å›æŸ¥æ“ä½œä¼šå°†å›æŸ¥ç»“æœï¼Œå³COMMIT_MESSAGEæˆ–ROLLBACK_MESSAGE Reportç»™TCã€‚TCå°†ç»“æœä¸ŠæŠ¥ç»™TMï¼ŒTMä¼šå†å‘TCå‘é€æœ€ç»ˆç¡®è®¤æŒ‡ä»¤Global Commitæˆ–Global Rollback</li></ul></li><li><ol start="9"><li>TCåœ¨æ¥æ”¶åˆ°æŒ‡ä»¤åä¼šå‘Brokerä¸å·¥è¡Œç³»ç»Ÿå‘å‡ºç¡®è®¤æŒ‡ä»¤</li></ol><ul><li>TCæ¥æ”¶çš„è‹¥æ˜¯Global CommitæŒ‡ä»¤ï¼Œåˆ™å‘Brokerä¸å·¥è¡Œç³»ç»Ÿå‘é€Branch CommitæŒ‡ä»¤ã€‚æ­¤æ—¶Brokerä¸­çš„æ¶ˆæ¯Mæ‰å¯è¢«å»ºè¡Œç³»ç»Ÿçœ‹åˆ°ï¼›æ­¤æ—¶çš„å·¥è¡Œç”¨æˆ·Aä¸­çš„æ‰£æ¬¾æ“ä½œæ‰çœŸæ­£è¢«ç¡®è®¤</li><li>TCæ¥æ”¶åˆ°çš„è‹¥æ˜¯Global RollbackæŒ‡ä»¤ï¼Œåˆ™å‘Brokerä¸å·¥è¡Œç³»ç»Ÿå‘é€Branch RollbackæŒ‡ä»¤ã€‚æ­¤æ—¶Brokerä¸­çš„æ¶ˆæ¯Må°†è¢«æ’¤é”€ï¼›å·¥è¡Œç”¨æˆ·Aä¸­çš„æ‰£æ¬¾æ“ä½œå°†è¢«å›æ»š</li></ul></li></ul><blockquote><p>ä»¥ä¸Šæ–¹æ¡ˆå°±æ˜¯ä¸ºäº†ç¡®ä¿<code>æ¶ˆæ¯æŠ•é€’</code>ä¸<code>æ‰£æ¬¾æ“ä½œ</code>èƒ½å¤Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œè¦æˆåŠŸéƒ½æˆåŠŸï¼Œæœ‰ä¸€ä¸ªå¤±è´¥ï¼Œåˆ™å…¨éƒ¨å›æ»šã€‚</p><p>ä»¥ä¸Šæ–¹æ¡ˆå¹¶ä¸æ˜¯ä¸€ä¸ªå…¸å‹çš„XAæ¨¡å¼ã€‚å› ä¸ºXAæ¨¡å¼ä¸­çš„åˆ†æ”¯äº‹åŠ¡æ˜¯å¼‚æ­¥çš„ï¼Œè€Œäº‹åŠ¡æ¶ˆæ¯æ–¹æ¡ˆä¸­çš„æ¶ˆæ¯é¢„æäº¤ä¸é¢„æ‰£æ¬¾æ“ä½œé—´æ˜¯åŒæ­¥çš„ã€‚</p></blockquote><h3 id="_3-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#_3-åŸºç¡€"><span>3 åŸºç¡€</span></a></h3><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼äº‹åŠ¡"><span>åˆ†å¸ƒå¼äº‹åŠ¡</span></a></h4><p>å¯¹äºåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé€šä¿—åœ°è¯´å°±æ˜¯ï¼Œä¸€æ¬¡æ“ä½œç”±è‹¥å¹²åˆ†æ”¯æ“ä½œç»„æˆï¼Œè¿™äº›åˆ†æ”¯æ“ä½œåˆ†å±ä¸åŒåº”ç”¨ï¼Œåˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šã€‚åˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦ä¿è¯è¿™äº›åˆ†æ”¯æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åˆ†å¸ƒå¼äº‹åŠ¡ä¸æ™®é€šäº‹åŠ¡ä¸€æ ·ï¼Œå°±æ˜¯ä¸ºäº†ä¿è¯æ“ä½œç»“æœçš„ä¸€è‡´æ€§ã€‚</p><h4 id="äº‹åŠ¡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡æ¶ˆæ¯"><span>äº‹åŠ¡æ¶ˆæ¯</span></a></h4><p>RocketMQæä¾›äº†ç±»ä¼¼X/Open XAçš„åˆ†å¸ƒå¼äº‹åŠ¡åŠŸèƒ½ï¼Œé€šè¿‡äº‹åŠ¡æ¶ˆæ¯èƒ½è¾¾åˆ°åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´ã€‚XAæ˜¯ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ¨¡å¼ã€‚</p><h4 id="åŠäº‹åŠ¡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#åŠäº‹åŠ¡æ¶ˆæ¯"><span>åŠäº‹åŠ¡æ¶ˆæ¯</span></a></h4><p>æš‚ä¸èƒ½æŠ•é€’çš„æ¶ˆæ¯ï¼Œå‘é€æ–¹å·²ç»æˆåŠŸåœ°å°†æ¶ˆæ¯å‘é€åˆ°äº†Brokerï¼Œä½†æ˜¯Brokeræœªæ”¶åˆ°æœ€ç»ˆç¡®è®¤æŒ‡ä»¤ï¼Œæ­¤æ—¶è¯¥æ¶ˆæ¯è¢«æ ‡è®°æˆâ€œæš‚ä¸èƒ½æŠ•é€’â€çŠ¶æ€ï¼Œå³ä¸èƒ½è¢«æ¶ˆè´¹è€…çœ‹åˆ°ã€‚å¤„äºè¯¥ç§çŠ¶æ€ä¸‹çš„æ¶ˆæ¯å³åŠäº‹åŠ¡æ¶ˆæ¯ã€‚</p><h4 id="æœ¬åœ°äº‹åŠ¡çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#æœ¬åœ°äº‹åŠ¡çŠ¶æ€"><span>æœ¬åœ°äº‹åŠ¡çŠ¶æ€</span></a></h4><p>Producer<code>å›è°ƒæ“ä½œ</code>æ‰§è¡Œçš„ç»“æœä¸ºæœ¬åœ°äº‹åŠ¡çŠ¶æ€ï¼Œå…¶ä¼šå‘é€ç»™TCï¼Œè€ŒTCä¼šå†å‘é€ç»™TMã€‚TMä¼šæ ¹æ®TCå‘é€æ¥çš„æœ¬åœ°äº‹åŠ¡çŠ¶æ€æ¥å†³å®šå…¨å±€äº‹åŠ¡ç¡®è®¤æŒ‡ä»¤ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æè¿°æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    COMMIT_MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Â // æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    ROLLBACK_MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Â // æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    UNKNOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Â // ä¸ç¡®å®šï¼Œè¡¨ç¤ºéœ€è¦è¿›è¡Œå›æŸ¥ä»¥ç¡®å®šæœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ¶ˆæ¯å›æŸ¥" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯å›æŸ¥"><span>æ¶ˆæ¯å›æŸ¥</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208155046.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>æ¶ˆæ¯å›æŸ¥ï¼Œå³é‡æ–°æŸ¥è¯¢æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚æœ¬ä¾‹å°±æ˜¯é‡æ–°åˆ°DBä¸­æŸ¥çœ‹é¢„æ‰£æ¬¾æ“ä½œæ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚</p><blockquote><p>æ³¨æ„ï¼Œæ¶ˆæ¯å›æŸ¥ä¸æ˜¯é‡æ–°æ‰§è¡Œå›è°ƒæ“ä½œã€‚å›è°ƒæ“ä½œæ˜¯è¿›è¡Œé¢„æ‰£æ¬¾æ“ä½œï¼Œè€Œæ¶ˆæ¯å›æŸ¥åˆ™æ˜¯æŸ¥çœ‹é¢„æ‰£æ¬¾æ“ä½œæ‰§è¡Œçš„ç»“æœã€‚ å¼•å‘æ¶ˆæ¯å›æŸ¥çš„åŸå› æœ€å¸¸è§çš„æœ‰ä¸¤ä¸ªï¼š 1)å›è°ƒæ“ä½œè¿”å›UNKNWON 2)TCæ²¡æœ‰æ¥æ”¶åˆ°TMçš„æœ€ç»ˆå…¨å±€äº‹åŠ¡ç¡®è®¤æŒ‡ä»¤</p></blockquote><h4 id="rocketmqä¸­çš„æ¶ˆæ¯å›æŸ¥è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#rocketmqä¸­çš„æ¶ˆæ¯å›æŸ¥è®¾ç½®"><span>RocketMQä¸­çš„æ¶ˆæ¯å›æŸ¥è®¾ç½®</span></a></h4><p>å…³äºæ¶ˆæ¯å›æŸ¥ï¼Œæœ‰ä¸‰ä¸ªå¸¸è§çš„å±æ€§è®¾ç½®ã€‚å®ƒä»¬éƒ½åœ¨brokeråŠ è½½çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œä¾‹å¦‚ï¼š</p><ul><li>transactionTimeout=20ï¼ŒæŒ‡å®šTMåœ¨ 20 ç§’å†…åº”å°†æœ€ç»ˆç¡®è®¤çŠ¶æ€å‘é€ç»™TCï¼Œå¦åˆ™å¼•å‘æ¶ˆæ¯å›æŸ¥ã€‚é»˜è®¤ä¸º 60 ç§’</li><li>transactionCheckMax=5ï¼ŒæŒ‡å®šæœ€å¤šå›æŸ¥ 5 æ¬¡ï¼Œè¶…è¿‡åå°†ä¸¢å¼ƒæ¶ˆæ¯å¹¶è®°å½•é”™è¯¯æ—¥å¿—ã€‚é»˜è®¤ 15 æ¬¡ã€‚</li><li>transactionCheckInterval=10ï¼ŒæŒ‡å®šè®¾ç½®çš„å¤šæ¬¡æ¶ˆæ¯å›æŸ¥çš„æ—¶é—´é—´éš”ä¸º 10 ç§’ã€‚é»˜è®¤ä¸º 60 ç§’ã€‚</li></ul><h3 id="_4-xaæ¨¡å¼ä¸‰å‰‘å®¢" tabindex="-1"><a class="header-anchor" href="#_4-xaæ¨¡å¼ä¸‰å‰‘å®¢"><span>4 XAæ¨¡å¼ä¸‰å‰‘å®¢</span></a></h3><h4 id="xaåè®®" tabindex="-1"><a class="header-anchor" href="#xaåè®®"><span>XAåè®®</span></a></h4><p>XAï¼ˆUnix Transactionï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ¨¡å¼ï¼Œæ˜¯åŸºäºXAåè®®çš„ã€‚ XAåè®®ç”±Tuxedoï¼ˆTransaction for Unix has been Extended for Distributed Operationï¼Œåˆ†å¸ƒå¼æ“ä½œæ‰©å±•ä¹‹åçš„Unixäº‹åŠ¡ç³»ç»Ÿï¼‰é¦–å…ˆæå‡ºçš„ï¼Œå¹¶äº¤ç»™X/Openç»„ç»‡ï¼Œä½œä¸ºèµ„æºç®¡ç†å™¨ä¸äº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£æ ‡å‡†ã€‚</p><p><code>XAæ¨¡å¼ä¸­æœ‰ä¸‰ä¸ªé‡è¦ç»„ä»¶ï¼šTCã€TMã€RMã€‚</code></p><h4 id="tc" tabindex="-1"><a class="header-anchor" href="#tc"><span>TC</span></a></h4><p>Transaction Coordinatorï¼Œäº‹åŠ¡åè°ƒè€…ã€‚ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>RocketMQä¸­Brokerå……å½“ç€TCã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="tm" tabindex="-1"><a class="header-anchor" href="#tm"><span>TM</span></a></h4><p>Transaction Managerï¼Œäº‹åŠ¡ç®¡ç†å™¨ã€‚å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚å®ƒå®é™…æ˜¯å…¨å±€äº‹åŠ¡çš„å‘èµ·è€…ã€‚</p><blockquote><p>RocketMQä¸­äº‹åŠ¡æ¶ˆæ¯çš„Producerå……å½“ç€TMã€‚</p></blockquote><h4 id="rm" tabindex="-1"><a class="header-anchor" href="#rm"><span>RM</span></a></h4><p>Resource Managerï¼Œèµ„æºç®¡ç†å™¨ã€‚ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p><blockquote><p>RocketMQä¸­äº‹åŠ¡æ¶ˆæ¯çš„ProduceråŠBrokerå‡æ˜¯RMã€‚</p></blockquote><h3 id="_5-xaæ¨¡å¼æ¶æ„" tabindex="-1"><a class="header-anchor" href="#_5-xaæ¨¡å¼æ¶æ„"><span>5 XAæ¨¡å¼æ¶æ„</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208155359.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>XAæ¨¡å¼æ˜¯ä¸€ä¸ªå…¸å‹çš„2PCï¼Œå…¶æ‰§è¡ŒåŸç†å¦‚ä¸‹ï¼š</p><ul><li><ol><li>TMå‘TCå‘èµ·æŒ‡ä»¤ï¼Œå¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</li></ol></li><li><ol start="2"><li>æ ¹æ®ä¸šåŠ¡è¦æ±‚ï¼Œå„ä¸ªRMä¼šé€ä¸ªå‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œç„¶åTCä¼šé€ä¸ªå‘RMå‘å‡ºé¢„æ‰§è¡ŒæŒ‡ä»¤ã€‚</li></ol></li><li><ol start="3"><li>å„ä¸ªRMåœ¨æ¥æ”¶åˆ°æŒ‡ä»¤åä¼šåœ¨è¿›è¡Œæœ¬åœ°äº‹åŠ¡é¢„æ‰§è¡Œã€‚</li></ol></li><li><ol start="4"><li>RMå°†é¢„æ‰§è¡Œç»“æœReportç»™TCã€‚å½“ç„¶ï¼Œè¿™ä¸ªç»“æœå¯èƒ½æ˜¯æˆåŠŸï¼Œä¹Ÿå¯èƒ½æ˜¯å¤±è´¥ã€‚</li></ol></li><li><ol start="5"><li>TCåœ¨æ¥æ”¶åˆ°å„ä¸ªRMçš„Reportåä¼šå°†æ±‡æ€»ç»“æœä¸ŠæŠ¥ç»™TMï¼Œæ ¹æ®æ±‡æ€»ç»“æœTMä¼šå‘TCå‘å‡ºç¡®è®¤æŒ‡ä»¤ã€‚</li></ol><ul><li>è‹¥æ‰€æœ‰ç»“æœéƒ½æ˜¯æˆåŠŸå“åº”ï¼Œåˆ™å‘TCå‘é€Global CommitæŒ‡ä»¤ã€‚</li><li>åªè¦æœ‰ç»“æœæ˜¯å¤±è´¥å“åº”ï¼Œåˆ™å‘TCå‘é€Global RollbackæŒ‡ä»¤ã€‚</li></ul></li><li><ol start="6"><li>TCåœ¨æ¥æ”¶åˆ°æŒ‡ä»¤åå†æ¬¡å‘RMå‘é€ç¡®è®¤æŒ‡ä»¤ã€‚</li></ol></li></ul><blockquote><p>äº‹åŠ¡æ¶ˆæ¯æ–¹æ¡ˆå¹¶ä¸æ˜¯ä¸€ä¸ªå…¸å‹çš„XAæ¨¡å¼ã€‚å› ä¸ºXAæ¨¡å¼ä¸­çš„åˆ†æ”¯äº‹åŠ¡æ˜¯å¼‚æ­¥çš„ï¼Œè€Œäº‹åŠ¡æ¶ˆæ¯æ–¹æ¡ˆä¸­çš„æ¶ˆæ¯é¢„æäº¤ä¸é¢„æ‰£æ¬¾æ“ä½œé—´æ˜¯åŒæ­¥çš„ã€‚</p></blockquote><h3 id="_6-æ³¨æ„" tabindex="-1"><a class="header-anchor" href="#_6-æ³¨æ„"><span>6 æ³¨æ„</span></a></h3><ul><li>äº‹åŠ¡æ¶ˆæ¯ä¸æ”¯æŒå»¶æ—¶æ¶ˆæ¯</li><li>å¯¹äºäº‹åŠ¡æ¶ˆæ¯è¦åšå¥½å¹‚ç­‰æ€§æ£€æŸ¥ï¼Œå› ä¸ºäº‹åŠ¡æ¶ˆæ¯å¯èƒ½ä¸æ­¢ä¸€æ¬¡è¢«æ¶ˆè´¹ï¼ˆå› ä¸ºå­˜åœ¨å›æ»šåå†æäº¤çš„æƒ…å†µï¼‰</li></ul><h3 id="_7-ä»£ç ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#_7-ä»£ç ä¸¾ä¾‹"><span>7 ä»£ç ä¸¾ä¾‹</span></a></h3><h4 id="å®šä¹‰å·¥è¡Œäº‹åŠ¡ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰å·¥è¡Œäº‹åŠ¡ç›‘å¬å™¨"><span>å®šä¹‰å·¥è¡Œäº‹åŠ¡ç›‘å¬å™¨</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ICBCTransactionListener</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> TransactionListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å›è°ƒæ“ä½œæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¶ˆæ¯é¢„æäº¤æˆåŠŸå°±ä¼šè§¦å‘è¯¥æ–¹æ³•çš„æ‰§è¡Œï¼Œç”¨äºå®Œæˆæœ¬åœ°äº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> executeLocalTransaction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é¢„æäº¤æ¶ˆæ¯æˆåŠŸï¼š&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> msg);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å‡è®¾æ¥æ”¶åˆ°TAGAçš„æ¶ˆæ¯å°±è¡¨ç¤ºæ‰£æ¬¾æ“ä½œæˆåŠŸï¼ŒTAGBçš„æ¶ˆæ¯è¡¨ç¤ºæ‰£æ¬¾å¤±è´¥ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // TAGCè¡¨ç¤ºæ‰£æ¬¾ç»“æœä¸æ¸…æ¥šï¼Œéœ€è¦æ‰§è¡Œæ¶ˆæ¯å›æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TAGA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">COMMIT_MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TAGB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ROLLBACK_MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TAGC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">UNKNOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">UNKNOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¶ˆæ¯å›æŸ¥æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¼•å‘æ¶ˆæ¯å›æŸ¥çš„åŸå› æœ€å¸¸è§çš„æœ‰ä¸¤ä¸ªï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 1)å›è°ƒæ“ä½œè¿”å›UNKNWON</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 2)TCæ²¡æœ‰æ¥æ”¶åˆ°TMçš„æœ€ç»ˆå…¨å±€äº‹åŠ¡ç¡®è®¤æŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> checkLocalTransaction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ‰§è¡Œæ¶ˆæ¯å›æŸ¥&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LocalTransactionState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">COMMIT_MESSAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰äº‹ç‰©æ¶ˆæ¯ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰äº‹ç‰©æ¶ˆæ¯ç”Ÿäº§è€…"><span>å®šä¹‰äº‹ç‰©æ¶ˆæ¯ç”Ÿäº§è€…</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> TransactionProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        TransactionMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TransactionMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        * å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        * @param corePoolSize çº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        * @param maximumPoolSize çº¿ç¨‹æ± ä¸­æœ€å¤šçº¿ç¨‹æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        * @param keepAliveTime è¿™æ˜¯ä¸€ä¸ªæ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡æ˜¯ï¼Œå¤šä½™ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é•¿</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        * @param unit æ—¶é—´å•ä½</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        * @param workQueue ä¸´æ—¶å­˜æ”¾ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œå…¶å‚æ•°å°±æ˜¯é˜Ÿåˆ—çš„é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        * @param threadFactory çº¿ç¨‹å·¥å‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        ExecutorService</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> executorService</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadPoolExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">TimeUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SECONDS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ArrayBlockingQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ), </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> newThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Runnable</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> r</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> thread</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(r);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;client-transaction-msg-check-thread&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> thread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ä¸ºç”Ÿäº§è€…æŒ‡å®šä¸€ä¸ªçº¿ç¨‹æ± </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setExecutorService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(executorService);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ä¸ºç”Ÿäº§è€…æ·»åŠ äº‹åŠ¡ç›‘å¬å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTransactionListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ICBCTransactionListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TAGA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TAGB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TAGC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, tags[i], body);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // å‘é€äº‹åŠ¡æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œæœ¬åœ°äº‹åŠ¡æ—¶è¦ä½¿ç”¨çš„ä¸šåŠ¡å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            SendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sendResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sendMessageInTransaction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‘é€ç»“æœä¸ºï¼š&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getSendStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰æ¶ˆè´¹è€…"><span>å®šä¹‰æ¶ˆè´¹è€…</span></a></h4><p>ç›´æ¥ä½¿ç”¨æ™®é€šæ¶ˆæ¯çš„SomeConsumerä½œä¸ºæ¶ˆè´¹è€…å³å¯ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SomeConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MQClientException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // DefaultLitePullConsumer consumer = new DefaultLitePullConsumer(&quot;cg&quot;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å®šä¹‰ä¸€ä¸ªpushæ¶ˆè´¹è€…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šnameServer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šä»ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_FROM_FIRST_OFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šæ¶ˆè´¹topicä¸tag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šé‡‡ç”¨â€œå¹¿æ’­æ¨¡å¼â€è¿›è¡Œæ¶ˆè´¹ï¼Œé»˜è®¤ä¸ºâ€œé›†ç¾¤æ¨¡å¼â€</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // consumer.setMessageModel(MessageModel.BROADCASTING);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // ä¸€æ—¦brokerä¸­æœ‰äº†å…¶è®¢é˜…çš„æ¶ˆæ¯å°±ä¼šè§¦å‘è¯¥æ–¹æ³•çš„æ‰§è¡Œï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // å…¶è¿”å›å€¼ä¸ºå½“å‰consumeræ¶ˆè´¹çš„çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // é€æ¡æ¶ˆè´¹æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> msgs) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // è¿”å›æ¶ˆè´¹çŠ¶æ€ï¼šæ¶ˆè´¹æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å¼€å¯æ¶ˆè´¹è€…æ¶ˆè´¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Consumer Started&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº”ã€æ‰¹é‡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#äº”ã€æ‰¹é‡æ¶ˆæ¯"><span>äº”ã€æ‰¹é‡æ¶ˆæ¯</span></a></h2><h3 id="_1-æ‰¹é‡å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_1-æ‰¹é‡å‘é€æ¶ˆæ¯"><span>1 æ‰¹é‡å‘é€æ¶ˆæ¯</span></a></h3><h4 id="å‘é€é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#å‘é€é™åˆ¶"><span>å‘é€é™åˆ¶</span></a></h4><p>ç”Ÿäº§è€…è¿›è¡Œæ¶ˆæ¯å‘é€æ—¶å¯ä»¥ä¸€æ¬¡å‘é€å¤šæ¡æ¶ˆæ¯ï¼Œè¿™å¯ä»¥å¤§å¤§æå‡Producerçš„å‘é€æ•ˆç‡ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æ‰¹é‡å‘é€çš„æ¶ˆæ¯å¿…é¡»å…·æœ‰ç›¸åŒçš„Topic</li><li>æ‰¹é‡å‘é€çš„æ¶ˆæ¯å¿…é¡»å…·æœ‰ç›¸åŒçš„åˆ·ç›˜ç­–ç•¥</li><li>æ‰¹é‡å‘é€çš„æ¶ˆæ¯ä¸èƒ½æ˜¯å»¶æ—¶æ¶ˆæ¯ä¸äº‹åŠ¡æ¶ˆæ¯</li></ul><h4 id="æ‰¹é‡å‘é€å¤§å°" tabindex="-1"><a class="header-anchor" href="#æ‰¹é‡å‘é€å¤§å°"><span>æ‰¹é‡å‘é€å¤§å°</span></a></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€æ‰¹å‘é€çš„æ¶ˆæ¯æ€»å¤§å°ä¸èƒ½è¶…è¿‡4MBå­—èŠ‚ã€‚å¦‚æœæƒ³è¶…å‡ºè¯¥å€¼ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šå°†æ‰¹é‡æ¶ˆæ¯è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†ä¸ºè‹¥å¹²ä¸å¤§äº4Mçš„æ¶ˆæ¯é›†åˆåˆ†å¤šæ¬¡æ‰¹é‡å‘é€</li><li>æ–¹æ¡ˆäºŒï¼šåœ¨Producerç«¯ä¸Brokerç«¯ä¿®æ”¹å±æ€§</li></ul><p>** Producerç«¯éœ€è¦åœ¨å‘é€ä¹‹å‰è®¾ç½®Producerçš„maxMessageSizeå±æ€§</p><p>** Brokerç«¯éœ€è¦ä¿®æ”¹å…¶åŠ è½½çš„é…ç½®æ–‡ä»¶ä¸­çš„maxMessageSizeå±æ€§</p><h4 id="ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¤§å°" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¤§å°"><span>ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¤§å°</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208160513.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>ç”Ÿäº§è€…é€šè¿‡send()æ–¹æ³•å‘é€çš„Messageï¼Œå¹¶ä¸æ˜¯ç›´æ¥å°†Messageåºåˆ—åŒ–åå‘é€åˆ°ç½‘ç»œä¸Šçš„ï¼Œè€Œæ˜¯é€šè¿‡è¿™ä¸ªMessageç”Ÿæˆäº†ä¸€ä¸ªå­—ç¬¦ä¸²å‘é€å‡ºå»çš„ã€‚è¿™ä¸ªå­—ç¬¦ä¸²ç”±å››éƒ¨åˆ†æ„æˆï¼šTopicã€æ¶ˆæ¯Bodyã€æ¶ˆæ¯æ—¥å¿—ï¼ˆå  20 å­—èŠ‚ï¼‰ï¼ŒåŠç”¨äºæè¿°æ¶ˆæ¯çš„ä¸€å †å±æ€§key-valueã€‚è¿™äº›å±æ€§ä¸­åŒ…å«ä¾‹å¦‚ç”Ÿäº§è€…åœ°å€ã€ç”Ÿäº§æ—¶é—´ã€è¦å‘é€çš„QueueIdç­‰ã€‚æœ€ç»ˆå†™å…¥åˆ°Brokerä¸­æ¶ˆæ¯å•å…ƒä¸­çš„æ•°æ®éƒ½æ˜¯æ¥è‡ªäºè¿™äº›å±æ€§ã€‚</p><h3 id="_2-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_2-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯"><span>2 æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</span></a></h3><h4 id="ä¿®æ”¹æ‰¹é‡å±æ€§" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹æ‰¹é‡å±æ€§"><span>ä¿®æ”¹æ‰¹é‡å±æ€§</span></a></h4><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208160544.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>Consumerçš„MessageListenerConcurrentlyç›‘å¬æ¥å£çš„consumeMessage()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ¶ˆæ¯åˆ—è¡¨ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ¯æ¬¡åªèƒ½æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ã€‚è‹¥è¦ä½¿å…¶ä¸€æ¬¡å¯ä»¥æ¶ˆè´¹å¤šæ¡æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹Consumerçš„consumeMessageBatchMaxSizeå±æ€§æ¥æŒ‡å®šã€‚ä¸è¿‡ï¼Œè¯¥å€¼ä¸èƒ½è¶…è¿‡ 32 ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹æ¶ˆè´¹è€…æ¯æ¬¡å¯ä»¥æ‹‰å–çš„æ¶ˆæ¯æœ€å¤šæ˜¯ 32 æ¡ã€‚è‹¥è¦ä¿®æ”¹ä¸€æ¬¡æ‹‰å–çš„æœ€å¤§å€¼ï¼Œåˆ™å¯é€šè¿‡ä¿®æ”¹Consumerçš„pullBatchSizeå±æ€§æ¥æŒ‡å®šã€‚</p><h4 id="å­˜åœ¨çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å­˜åœ¨çš„é—®é¢˜"><span>å­˜åœ¨çš„é—®é¢˜</span></a></h4><p>Consumerçš„pullBatchSizeå±æ€§ä¸consumeMessageBatchMaxSizeå±æ€§æ˜¯å¦è®¾ç½®çš„è¶Šå¤§è¶Šå¥½ï¼Ÿå½“ç„¶ä¸æ˜¯ã€‚</p><ul><li>pullBatchSizeå€¼è®¾ç½®çš„è¶Šå¤§ï¼ŒConsumeræ¯æ‹‰å–ä¸€æ¬¡éœ€è¦çš„æ—¶é—´å°±ä¼šè¶Šé•¿ï¼Œä¸”åœ¨ç½‘ç»œä¸Šä¼ è¾“å‡ºç°é—®é¢˜çš„å¯èƒ½æ€§å°±è¶Šé«˜ã€‚è‹¥åœ¨æ‹‰å–è¿‡ç¨‹ä¸­è‹¥å‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆæœ¬æ‰¹æ¬¡æ‰€æœ‰æ¶ˆæ¯éƒ½éœ€è¦å…¨éƒ¨é‡æ–°æ‹‰å–ã€‚</li><li>consumeMessageBatchMaxSizeå€¼è®¾ç½®çš„è¶Šå¤§ï¼ŒConsumerçš„æ¶ˆæ¯å¹¶å‘æ¶ˆè´¹èƒ½åŠ›è¶Šä½ï¼Œä¸”è¿™æ‰¹è¢«æ¶ˆè´¹çš„æ¶ˆæ¯å…·æœ‰ç›¸åŒçš„æ¶ˆè´¹ç»“æœã€‚å› ä¸ºconsumeMessageBatchMaxSizeæŒ‡å®šçš„ä¸€æ‰¹æ¶ˆæ¯åªä¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸”åœ¨å¤„ç†è¿‡ç¨‹ä¸­åªè¦æœ‰ä¸€ä¸ªæ¶ˆæ¯å¤„ç†å¼‚å¸¸ï¼Œåˆ™è¿™æ‰¹æ¶ˆæ¯éœ€è¦å…¨éƒ¨é‡æ–°å†æ¬¡æ¶ˆè´¹å¤„ç†ã€‚</li></ul><h3 id="_3-ä»£ç ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-ä»£ç ä¸¾ä¾‹"><span>3 ä»£ç ä¸¾ä¾‹</span></a></h3><p>è¯¥æ‰¹é‡å‘é€çš„éœ€æ±‚æ˜¯ï¼Œä¸ä¿®æ”¹æœ€å¤§å‘é€4Mçš„é»˜è®¤å€¼ï¼Œä½†è¦é˜²æ­¢å‘é€çš„æ‰¹é‡æ¶ˆæ¯è¶…å‡º4Mçš„é™åˆ¶ã€‚</p><h4 id="å®šä¹‰æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²å™¨" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²å™¨"><span>å®šä¹‰æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²å™¨</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²å™¨ï¼šå…¶åªä¼šå¤„ç†æ¯æ¡æ¶ˆæ¯çš„å¤§å°ä¸è¶…4Mçš„æƒ…å†µã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è‹¥å­˜åœ¨æŸæ¡æ¶ˆæ¯ï¼Œå…¶æœ¬èº«å¤§å°å¤§äº4Mï¼Œè¿™ä¸ªåˆ†å‰²å™¨æ— æ³•å¤„ç†ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å…¶ç›´æ¥å°†è¿™æ¡æ¶ˆæ¯æ„æˆä¸€ä¸ªå­åˆ—è¡¨è¿”å›ã€‚å¹¶æ²¡æœ‰å†è¿›è¡Œåˆ†å‰²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MessageListSplitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Iterator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æŒ‡å®šæé™å€¼ä¸º4M</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> SIZE_LIMIT </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> Â 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å­˜æ”¾æ‰€æœ‰è¦å‘é€çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¦è¿›è¡Œæ‰¹é‡å‘é€æ¶ˆæ¯çš„å°é›†åˆèµ·å§‹ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> currIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListSplitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> messages;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> hasNext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆ¤æ–­å½“å‰å¼€å§‹éå†çš„æ¶ˆæ¯ç´¢å¼•è¦å°äºæ¶ˆæ¯æ€»æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> currIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> next</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> nextIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> currIndex;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è®°å½•å½“å‰è¦å‘é€çš„è¿™ä¸€å°æ‰¹æ¬¡æ¶ˆæ¯åˆ—è¡¨çš„å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> totalSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (; nextIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); nextIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // è·å–å½“å‰éå†çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(nextIndex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // ç»Ÿè®¡å½“å‰éå†çš„messageçš„å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> tmpSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getTopic</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBody</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">entry</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">entrySet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                tmpSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            tmpSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tmpSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // åˆ¤æ–­å½“å‰æ¶ˆæ¯æœ¬èº«æ˜¯å¦å¤§äº4M</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (tmpSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> SIZE_LIMIT) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (nextIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> currIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    nextIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (tmpSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> totalSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> SIZE_LIMIT) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                totalSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tmpSize;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// end-for</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è·å–å½“å‰messagesåˆ—è¡¨çš„å­é›†åˆ[currIndex, nextIndex)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">subList</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(currIndex, nextIndex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ä¸‹æ¬¡éå†çš„å¼€å§‹ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        currIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> nextIndex;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> subList;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰æ‰¹é‡æ¶ˆæ¯ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰æ‰¹é‡æ¶ˆæ¯ç”Ÿäº§è€…"><span>å®šä¹‰æ‰¹é‡æ¶ˆæ¯ç”Ÿäº§è€…</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> BatchProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šè¦å‘é€çš„æ¶ˆæ¯çš„æœ€å¤§å¤§å°ï¼Œé»˜è®¤æ˜¯4M</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ä¸è¿‡ï¼Œä»…ä¿®æ”¹è¯¥å±æ€§æ˜¯ä¸è¡Œçš„ï¼Œè¿˜éœ€è¦åŒæ—¶ä¿®æ”¹brokeråŠ è½½çš„é…ç½®æ–‡ä»¶ä¸­çš„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // maxMessageSizeå±æ€§</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // producer.setMaxMessageSize(8 * 1024 * 1024);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å®šä¹‰è¦å‘é€çš„æ¶ˆæ¯é›†åˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, body);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å®šä¹‰æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²å™¨ï¼Œå°†æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²ä¸ºå¤šä¸ªä¸è¶…å‡º4Må¤§å°çš„å°åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        MessageListSplitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> splitter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListSplitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(messages);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">hasNext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">listItem</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(listItem);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å®šä¹‰æ‰¹é‡æ¶ˆæ¯æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰æ‰¹é‡æ¶ˆæ¯æ¶ˆè´¹è€…"><span>å®šä¹‰æ‰¹é‡æ¶ˆæ¯æ¶ˆè´¹è€…</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> BatchConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MQClientException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_FROM_FIRST_OFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;someTopicA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šæ¯æ¬¡å¯ä»¥æ¶ˆè´¹ 10 æ¡æ¶ˆæ¯ï¼Œé»˜è®¤ä¸º 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setConsumeMessageBatchMaxSize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æŒ‡å®šæ¯æ¬¡å¯ä»¥ä»Brokeræ‹‰å– 40 æ¡æ¶ˆæ¯ï¼Œé»˜è®¤ä¸º 32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setPullBatchSize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">40</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                //ä¹Ÿå¯ä»¥é€‰æ‹©åªæ¥å—ä¸€ä¸ªæ¶ˆæ¯,å› ä¸ºè¯¥æ–¹æ³•æ˜¯å¹¶å‘æ‰§è¡Œçš„,æ‰€ä»¥æ¥å—ä¸€ä¸ªæ¶ˆæ¯ä¹Ÿèƒ½æŠŠæ¶ˆæ¯æ¶ˆè´¹å®Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> msgs) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // æ¶ˆè´¹æˆåŠŸçš„è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // æ¶ˆè´¹å¼‚å¸¸æ—¶çš„è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // return ConsumeConcurrentlyStatus.RECONSUME_LATER;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Consumer Started&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…­ã€æ¶ˆæ¯è¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ¶ˆæ¯è¿‡æ»¤"><span>å…­ã€æ¶ˆæ¯è¿‡æ»¤</span></a></h2><p>æ¶ˆæ¯è€…åœ¨è¿›è¡Œæ¶ˆæ¯è®¢é˜…æ—¶ï¼Œé™¤äº†å¯ä»¥æŒ‡å®šè¦è®¢é˜…æ¶ˆæ¯çš„Topicå¤–ï¼Œè¿˜å¯ä»¥å¯¹æŒ‡å®šTopicä¸­çš„æ¶ˆæ¯æ ¹æ®æŒ‡å®šæ¡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå³å¯ä»¥è®¢é˜…æ¯”Topicæ›´åŠ ç»†ç²’åº¦çš„æ¶ˆæ¯ç±»å‹ã€‚</p><p>å¯¹äºæŒ‡å®šTopicæ¶ˆæ¯çš„è¿‡æ»¤æœ‰ä¸¤ç§è¿‡æ»¤æ–¹å¼ï¼šTagè¿‡æ»¤ä¸SQLè¿‡æ»¤ã€‚</p><h3 id="_1-tagè¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#_1-tagè¿‡æ»¤"><span>1 Tagè¿‡æ»¤</span></a></h3><p>é€šè¿‡consumerçš„subscribe()æ–¹æ³•æŒ‡å®šè¦è®¢é˜…æ¶ˆæ¯çš„Tagã€‚å¦‚æœè®¢é˜…å¤šä¸ªTagçš„æ¶ˆæ¯ï¼ŒTagé—´ä½¿ç”¨æˆ–è¿ç®—ç¬¦(åŒç«–çº¿||)è¿æ¥ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;CID_EXAMPLE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TOPIC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TAGA || TAGB || TAGC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-sqlè¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#_2-sqlè¿‡æ»¤"><span>2 SQLè¿‡æ»¤</span></a></h3><p>SQLè¿‡æ»¤æ˜¯ä¸€ç§é€šè¿‡ç‰¹å®šè¡¨è¾¾å¼å¯¹äº‹å…ˆåŸ‹å…¥åˆ°æ¶ˆæ¯ä¸­çš„<code>ç”¨æˆ·å±æ€§</code>è¿›è¡Œç­›é€‰è¿‡æ»¤çš„æ–¹å¼ã€‚é€šè¿‡SQLè¿‡æ»¤ï¼Œå¯ä»¥å®ç°å¯¹æ¶ˆæ¯çš„å¤æ‚è¿‡æ»¤ã€‚ä¸è¿‡ï¼Œåªæœ‰ä½¿ç”¨<code>PUSHæ¨¡å¼</code>çš„æ¶ˆè´¹è€…æ‰èƒ½ä½¿ç”¨SQLè¿‡æ»¤ã€‚</p><p>SQLè¿‡æ»¤è¡¨è¾¾å¼ä¸­æ”¯æŒå¤šç§å¸¸é‡ç±»å‹ä¸è¿ç®—ç¬¦ã€‚</p><p>æ”¯æŒçš„å¸¸é‡ç±»å‹ï¼š</p><ul><li>æ•°å€¼ï¼šæ¯”å¦‚ï¼š 123 ï¼Œ3.1415</li><li>å­—ç¬¦ï¼šå¿…é¡»ç”¨å•å¼•å·åŒ…è£¹èµ·æ¥ï¼Œæ¯”å¦‚ï¼š&#39;abc&#39;</li><li>å¸ƒå°”ï¼šTRUE æˆ– FALSE</li><li>NULLï¼šç‰¹æ®Šçš„å¸¸é‡ï¼Œè¡¨ç¤ºç©º</li></ul><p>æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ï¼š</p><ul><li>æ•°å€¼æ¯”è¾ƒï¼š&gt;ï¼Œ&gt;=ï¼Œ&lt;ï¼Œ&lt;=ï¼ŒBETWEENï¼Œ=</li><li>å­—ç¬¦æ¯”è¾ƒï¼š=ï¼Œ&lt;&gt;ï¼ŒIN</li><li>é€»è¾‘è¿ç®— ï¼šANDï¼ŒORï¼ŒNOT</li><li>NULLåˆ¤æ–­ï¼šIS NULL æˆ–è€… IS NOT NULL</li></ul><p>é»˜è®¤æƒ…å†µä¸‹Brokeræ²¡æœ‰å¼€å¯æ¶ˆæ¯çš„SQLè¿‡æ»¤åŠŸèƒ½ï¼Œéœ€è¦åœ¨BrokeråŠ è½½çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å±æ€§ï¼Œä»¥å¼€å¯è¯¥åŠŸèƒ½ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enablePropertyFilter</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨å¯åŠ¨Brokeræ—¶éœ€è¦æŒ‡å®šè¿™ä¸ªä¿®æ”¹è¿‡çš„é…ç½®æ–‡ä»¶ã€‚ä¾‹å¦‚å¯¹äºå•æœºBrokerçš„å¯åŠ¨ï¼Œå…¶ä¿®æ”¹çš„é…ç½®æ–‡ä»¶æ˜¯conf/broker.confï¼Œå¯åŠ¨æ—¶ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin/mqbroker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost:9876</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> conf/broker.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-ä»£ç ä¸¾ä¾‹-1" tabindex="-1"><a class="header-anchor" href="#_3-ä»£ç ä¸¾ä¾‹-1"><span>3 ä»£ç ä¸¾ä¾‹</span></a></h3><p>å®šä¹‰Tagè¿‡æ»¤Producer</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> FilterByTagProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTagA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTagB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTagC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tags[i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,tag,body);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            SendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sendResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(sendResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰Tagè¿‡æ»¤Consumer</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> FilterByTagConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_FROM_FIRST_OFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTagA || myTagB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> me</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">msgs){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(me);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Consumer Started&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰SQLè¿‡æ»¤Producer</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> FilterBySQLProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                byte</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hi,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, body);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                msg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">putUserProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                SendResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sendResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(sendResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰SQLè¿‡æ»¤Consumer</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> FilterBySQLConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeFromWhere</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_FROM_FIRST_OFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bySql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age between 0 and 6&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> me</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">msgs){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(me);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Consumer Started&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸ƒã€æ¶ˆæ¯å‘é€é‡è¯•æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ¶ˆæ¯å‘é€é‡è¯•æœºåˆ¶"><span>ä¸ƒã€æ¶ˆæ¯å‘é€é‡è¯•æœºåˆ¶</span></a></h2><h3 id="_1-è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_1-è¯´æ˜"><span>1 è¯´æ˜</span></a></h3><p>Producerå¯¹å‘é€å¤±è´¥çš„æ¶ˆæ¯è¿›è¡Œé‡æ–°å‘é€çš„æœºåˆ¶ï¼Œç§°ä¸ºæ¶ˆæ¯å‘é€é‡è¯•æœºåˆ¶ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯é‡æŠ•æœºåˆ¶ã€‚</p><h4 id="å¯¹äºæ¶ˆæ¯é‡æŠ•-éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹" tabindex="-1"><a class="header-anchor" href="#å¯¹äºæ¶ˆæ¯é‡æŠ•-éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹"><span>å¯¹äºæ¶ˆæ¯é‡æŠ•ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</span></a></h4><ul><li>ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‹¥é‡‡ç”¨åŒæ­¥æˆ–å¼‚æ­¥å‘é€æ–¹å¼ï¼Œå‘é€å¤±è´¥ä¼šé‡è¯•ï¼Œä½†onewayæ¶ˆæ¯å‘é€æ–¹å¼å‘é€å¤±è´¥æ˜¯æ²¡æœ‰é‡è¯•æœºåˆ¶çš„</li><li>åªæœ‰æ™®é€šæ¶ˆæ¯å…·æœ‰å‘é€é‡è¯•æœºåˆ¶ï¼Œé¡ºåºæ¶ˆæ¯æ˜¯æ²¡æœ‰çš„</li><li>æ¶ˆæ¯é‡æŠ•æœºåˆ¶å¯ä»¥ä¿è¯æ¶ˆæ¯å°½å¯èƒ½å‘é€æˆåŠŸã€ä¸ä¸¢å¤±ï¼Œä½†å¯èƒ½ä¼šé€ æˆæ¶ˆæ¯é‡å¤ã€‚æ¶ˆæ¯é‡å¤åœ¨RocketMQä¸­æ˜¯æ— æ³•é¿å…çš„é—®é¢˜</li><li>æ¶ˆæ¯é‡å¤åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå‘ç”Ÿï¼Œå½“å‡ºç°æ¶ˆæ¯é‡å¤§ã€ç½‘ç»œæŠ–åŠ¨ï¼Œæ¶ˆæ¯é‡å¤å°±ä¼šæˆä¸ºå¤§æ¦‚ç‡äº‹ä»¶</li><li>producerä¸»åŠ¨é‡å‘ã€consumerè´Ÿè½½å˜åŒ–ï¼ˆå‘ç”ŸRebalanceï¼Œä¸ä¼šå¯¼è‡´æ¶ˆæ¯é‡å¤ï¼Œä½†å¯èƒ½å‡ºç°é‡å¤æ¶ˆè´¹ï¼‰ä¹Ÿä¼šå¯¼è‡´é‡å¤æ¶ˆæ¯</li><li>æ¶ˆæ¯é‡å¤æ— æ³•é¿å…ï¼Œä½†è¦é¿å…æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹ã€‚</li><li>é¿å…æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä¸ºæ¶ˆæ¯æ·»åŠ å”¯ä¸€æ ‡è¯†ï¼ˆä¾‹å¦‚æ¶ˆæ¯keyï¼‰ï¼Œä½¿æ¶ˆè´¹è€…å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹åˆ¤æ–­æ¥é¿å…é‡å¤æ¶ˆè´¹</li><li>æ¶ˆæ¯å‘é€é‡è¯•æœ‰ä¸‰ç§ç­–ç•¥å¯ä»¥é€‰æ‹©ï¼šåŒæ­¥å‘é€å¤±è´¥ç­–ç•¥ã€å¼‚æ­¥å‘é€å¤±è´¥ç­–ç•¥ã€æ¶ˆæ¯åˆ·ç›˜å¤±è´¥ç­–ç•¥</li></ul><h3 id="_2-åŒæ­¥å‘é€å¤±è´¥ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_2-åŒæ­¥å‘é€å¤±è´¥ç­–ç•¥"><span>2 åŒæ­¥å‘é€å¤±è´¥ç­–ç•¥</span></a></h3><p>å¯¹äºæ™®é€šæ¶ˆæ¯ï¼Œæ¶ˆæ¯å‘é€é»˜è®¤é‡‡ç”¨round-robinç­–ç•¥æ¥é€‰æ‹©æ‰€å‘é€åˆ°çš„é˜Ÿåˆ—ã€‚å¦‚æœå‘é€å¤±è´¥ï¼Œé»˜è®¤é‡è¯• 2æ¬¡ã€‚ä½†åœ¨é‡è¯•æ—¶æ˜¯ä¸ä¼šé€‰æ‹©ä¸Šæ¬¡å‘é€å¤±è´¥çš„Brokerï¼Œè€Œæ˜¯é€‰æ‹©å…¶å®ƒBrokerã€‚å½“ç„¶ï¼Œè‹¥åªæœ‰ä¸€ä¸ªBrokerå…¶ä¹Ÿåªèƒ½å‘é€åˆ°è¯¥Brokerï¼Œä½†å…¶ä¼šå°½é‡å‘é€åˆ°è¯¥Brokerä¸Šçš„å…¶å®ƒQueueã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªproducerï¼Œå‚æ•°ä¸ºProducer Groupåç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æŒ‡å®šnameServeråœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®åŒæ­¥å‘é€å¤±è´¥æ—¶é‡è¯•å‘é€çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 2 æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setRetryTimesWhenSendFailed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®å‘é€è¶…æ—¶æ—¶é™ä¸º5sï¼Œé»˜è®¤3s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setSendMsgTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ—¶ï¼ŒBrokerè¿˜å…·æœ‰<code>å¤±è´¥éš”ç¦»</code>åŠŸèƒ½ï¼Œä½¿Producerå°½é‡é€‰æ‹©æœªå‘ç”Ÿè¿‡å‘é€å¤±è´¥çš„Brokerä½œä¸ºç›®æ ‡Brokerã€‚å…¶å¯ä»¥ä¿è¯å…¶å®ƒæ¶ˆæ¯å°½é‡ä¸å‘é€åˆ°é—®é¢˜Brokerï¼Œä¸ºäº†æå‡æ¶ˆæ¯å‘é€æ•ˆç‡ï¼Œé™ä½æ¶ˆæ¯å‘é€è€—æ—¶ã€‚</p><blockquote><p>æ€è€ƒï¼šè®©æˆ‘ä»¬è‡ªå·±å®ç°<code>å¤±è´¥éš”ç¦»</code>åŠŸèƒ½ï¼Œå¦‚ä½•æ¥åšï¼Ÿ 1 ï¼‰æ–¹æ¡ˆä¸€ï¼šProducerä¸­ç»´æŠ¤æŸJUCçš„Mapé›†åˆï¼Œå…¶keyæ˜¯å‘ç”Ÿå¤±è´¥çš„æ—¶é—´æˆ³ï¼Œvalueä¸ºBrokerå®ä¾‹ã€‚Producerä¸­è¿˜ç»´æŠ¤ç€ä¸€ä¸ªSeté›†åˆï¼Œå…¶ä¸­å­˜æ”¾ç€æ‰€æœ‰æœªå‘ç”Ÿå‘é€å¼‚å¸¸çš„Brokerå®ä¾‹ã€‚é€‰æ‹©ç›®æ ‡Brokeræ˜¯ä»è¯¥Seté›†åˆä¸­é€‰æ‹©çš„ã€‚å†å®šä¹‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸä»Mapé›†åˆä¸­å°†é•¿æœŸæœªå‘ç”Ÿå‘é€å¼‚å¸¸çš„Brokeræ¸…ç†å‡ºå»ï¼Œå¹¶æ·»åŠ åˆ°Seté›†åˆã€‚ 2 ï¼‰æ–¹æ¡ˆäºŒï¼šä¸ºProducerä¸­çš„Brokerå®ä¾‹æ·»åŠ ä¸€ä¸ªæ ‡è¯†ï¼Œä¾‹å¦‚æ˜¯ä¸€ä¸ªAtomicBooleanå±æ€§ã€‚åªè¦è¯¥Brokerä¸Šå‘ç”Ÿè¿‡å‘é€å¼‚å¸¸ï¼Œå°±å°†å…¶ç½®ä¸ºtrueã€‚é€‰æ‹©ç›®æ ‡Brokerå°±æ˜¯é€‰æ‹©è¯¥å±æ€§å€¼ä¸ºfalseçš„Brokerã€‚å†å®šä¹‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸå°†Brokerçš„è¯¥å±æ€§ç½®ä¸ºfalseã€‚ 3 ï¼‰æ–¹æ¡ˆä¸‰ï¼šä¸ºProducerä¸­çš„Brokerå®ä¾‹æ·»åŠ ä¸€ä¸ªæ ‡è¯†ï¼Œä¾‹å¦‚æ˜¯ä¸€ä¸ªAtomicLongå±æ€§ã€‚åªè¦è¯¥Brokerä¸Šå‘ç”Ÿè¿‡å‘é€å¼‚å¸¸ï¼Œå°±ä½¿å…¶å€¼å¢ä¸€ã€‚é€‰æ‹©ç›®æ ‡Brokerå°±æ˜¯é€‰æ‹©è¯¥å±æ€§å€¼æœ€å°çš„Brokerã€‚è‹¥è¯¥å€¼ç›¸åŒï¼Œé‡‡ç”¨è½®è¯¢æ–¹å¼é€‰æ‹©ã€‚</p></blockquote><p>å¦‚æœè¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç”±Producerå»ä¿è¯æ¶ˆæ¯ä¸ä¸¢ã€‚å½“ç„¶å½“ç”Ÿäº§è€…å‡ºç°RemotingExceptionã€MQClientExceptionå’ŒMQBrokerExceptionæ—¶ï¼ŒProducerä¼šè‡ªåŠ¨é‡æŠ•æ¶ˆæ¯ã€‚</p><h3 id="_3-å¼‚æ­¥å‘é€å¤±è´¥ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_3-å¼‚æ­¥å‘é€å¤±è´¥ç­–ç•¥"><span>3 å¼‚æ­¥å‘é€å¤±è´¥ç­–ç•¥</span></a></h3><p>å¼‚æ­¥å‘é€å¤±è´¥é‡è¯•æ—¶ï¼Œå¼‚æ­¥é‡è¯•ä¸ä¼šé€‰æ‹©å…¶ä»–brokerï¼Œä»…åœ¨åŒä¸€ä¸ªbrokerä¸Šåšé‡è¯•ï¼Œæ‰€ä»¥è¯¥ç­–ç•¥æ— æ³•ä¿è¯æ¶ˆæ¯ä¸ä¸¢ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;rocketmqOS:9876&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æŒ‡å®šå¼‚æ­¥å‘é€å¤±è´¥åä¸è¿›è¡Œé‡è¯•å‘é€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setRetryTimesWhenSendAsyncFailed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-æ¶ˆæ¯åˆ·ç›˜å¤±è´¥ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_4-æ¶ˆæ¯åˆ·ç›˜å¤±è´¥ç­–ç•¥"><span>4 æ¶ˆæ¯åˆ·ç›˜å¤±è´¥ç­–ç•¥</span></a></h3><p>æ¶ˆæ¯åˆ·ç›˜è¶…æ—¶ï¼ˆMasteræˆ–Slaveï¼‰æˆ–slaveä¸å¯ç”¨ï¼ˆslaveåœ¨åšæ•°æ®åŒæ­¥æ—¶å‘masterè¿”å›çŠ¶æ€ä¸æ˜¯SEND_OKï¼‰æ—¶ï¼Œé»˜è®¤æ˜¯ä¸ä¼šå°†æ¶ˆæ¯å°è¯•å‘é€åˆ°å…¶ä»–Brokerçš„ã€‚ä¸è¿‡ï¼Œå¯¹äºé‡è¦æ¶ˆæ¯å¯ä»¥é€šè¿‡åœ¨Brokerçš„é…ç½®æ–‡ä»¶è®¾ç½®retryAnotherBrokerWhenNotStoreOKå±æ€§ä¸ºtrueæ¥å¼€å¯ã€‚</p><h2 id="å…«ã€æ¶ˆæ¯æ¶ˆè´¹é‡è¯•æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#å…«ã€æ¶ˆæ¯æ¶ˆè´¹é‡è¯•æœºåˆ¶"><span>å…«ã€æ¶ˆæ¯æ¶ˆè´¹é‡è¯•æœºåˆ¶</span></a></h2><h3 id="_1-é¡ºåºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•" tabindex="-1"><a class="header-anchor" href="#_1-é¡ºåºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•"><span>1 é¡ºåºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•</span></a></h3><p>å¯¹äºé¡ºåºæ¶ˆæ¯ï¼Œå½“Consumeræ¶ˆè´¹æ¶ˆæ¯å¤±è´¥åï¼Œä¸ºäº†ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œå…¶ä¼šè‡ªåŠ¨ä¸æ–­åœ°è¿›è¡Œæ¶ˆæ¯é‡è¯•ï¼Œç›´åˆ°æ¶ˆè´¹æˆåŠŸã€‚æ¶ˆè´¹é‡è¯•é»˜è®¤é—´éš”æ—¶é—´ä¸º 1000 æ¯«ç§’ã€‚é‡è¯•æœŸé—´åº”ç”¨ä¼šå‡ºç°æ¶ˆæ¯æ¶ˆè´¹è¢«é˜»å¡çš„æƒ…å†µã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é¡ºåºæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥çš„æ¶ˆè´¹é‡è¯•æ—¶é—´é—´éš”ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤ä¸º 1000 ï¼Œå…¶å–å€¼èŒƒå›´ä¸º[10,30000]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setSuspendCurrentQueueTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ç”±äºå¯¹é¡ºåºæ¶ˆæ¯çš„é‡è¯•æ˜¯æ— ä¼‘æ­¢çš„ï¼Œä¸é—´æ–­çš„ï¼Œç›´è‡³æ¶ˆè´¹æˆåŠŸï¼Œæ‰€ä»¥ï¼Œå¯¹äºé¡ºåºæ¶ˆæ¯çš„æ¶ˆè´¹ï¼ŒåŠ¡å¿…è¦ä¿è¯åº”ç”¨èƒ½å¤ŸåŠæ—¶ç›‘æ§å¹¶å¤„ç†æ¶ˆè´¹å¤±è´¥çš„æƒ…å†µï¼Œé¿å…æ¶ˆè´¹è¢«æ°¸ä¹…æ€§é˜»å¡ã€‚</p><p>æ³¨æ„ï¼Œé¡ºåºæ¶ˆæ¯æ²¡æœ‰å‘é€å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œä½†å…·æœ‰æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶</p></blockquote><h3 id="_2-æ— åºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•" tabindex="-1"><a class="header-anchor" href="#_2-æ— åºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•"><span>2 æ— åºæ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•</span></a></h3><p>å¯¹äºæ— åºæ¶ˆæ¯ï¼ˆæ™®é€šæ¶ˆæ¯ã€å»¶æ—¶æ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ï¼‰ï¼Œå½“Consumeræ¶ˆè´¹æ¶ˆæ¯å¤±è´¥æ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®è¿”å›çŠ¶æ€è¾¾åˆ°æ¶ˆæ¯é‡è¯•çš„æ•ˆæœã€‚ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œæ— åºæ¶ˆæ¯çš„é‡è¯•<code>åªå¯¹é›†ç¾¤æ¶ˆè´¹æ–¹å¼ç”Ÿæ•ˆ</code>ï¼Œå¹¿æ’­æ¶ˆè´¹æ–¹å¼ä¸æä¾›å¤±è´¥é‡è¯•ç‰¹æ€§ã€‚å³å¯¹äºå¹¿æ’­æ¶ˆè´¹ï¼Œæ¶ˆè´¹å¤±è´¥åï¼Œå¤±è´¥æ¶ˆæ¯ä¸å†é‡è¯•ï¼Œç»§ç»­æ¶ˆè´¹åç»­æ¶ˆæ¯ã€‚</p><h3 id="_3-æ¶ˆè´¹é‡è¯•æ¬¡æ•°ä¸é—´éš”" tabindex="-1"><a class="header-anchor" href="#_3-æ¶ˆè´¹é‡è¯•æ¬¡æ•°ä¸é—´éš”"><span>3 æ¶ˆè´¹é‡è¯•æ¬¡æ•°ä¸é—´éš”</span></a></h3><p>å¯¹äº<code>æ— åºæ¶ˆæ¯é›†ç¾¤</code>æ¶ˆè´¹ä¸‹çš„é‡è¯•æ¶ˆè´¹ï¼Œæ¯æ¡æ¶ˆæ¯é»˜è®¤æœ€å¤šé‡è¯• 16 æ¬¡ï¼Œä½†æ¯æ¬¡é‡è¯•çš„é—´éš”æ—¶é—´æ˜¯ä¸åŒçš„ï¼Œä¼šé€æ¸å˜é•¿ã€‚æ¯æ¬¡é‡è¯•çš„é—´éš”æ—¶é—´å¦‚ä¸‹è¡¨ã€‚</p><table><thead><tr><th>é‡è¯•æ¬¡æ•°</th><th style="text-align:center;">ä¸ä¸Šæ¬¡é‡è¯•çš„é—´éš”æ—¶é—´</th><th style="text-align:right;">é‡è¯•æ¬¡æ•°</th><th style="text-align:right;">ä¸ä¸Šæ¬¡é‡è¯•çš„é—´éš”æ—¶é—´</th></tr></thead><tbody><tr><td>1</td><td style="text-align:center;">10ç§’</td><td style="text-align:right;">9</td><td style="text-align:right;">7åˆ†é’Ÿ</td></tr><tr><td>2</td><td style="text-align:center;">30</td><td style="text-align:right;">10</td><td style="text-align:right;">8 åˆ†é’Ÿ</td></tr><tr><td>3</td><td style="text-align:center;">1åˆ†é’Ÿ</td><td style="text-align:right;">11</td><td style="text-align:right;">9 åˆ†é’Ÿ</td></tr><tr><td>4</td><td style="text-align:center;">2åˆ†é’Ÿ</td><td style="text-align:right;">12</td><td style="text-align:right;">10åˆ†é’Ÿ</td></tr><tr><td>5</td><td style="text-align:center;">3åˆ†é’Ÿ</td><td style="text-align:right;">13</td><td style="text-align:right;">20åˆ†é’Ÿ</td></tr><tr><td>6</td><td style="text-align:center;">4åˆ†é’Ÿ</td><td style="text-align:right;">14</td><td style="text-align:right;">30åˆ†é’Ÿ</td></tr><tr><td>7</td><td style="text-align:center;">5åˆ†é’Ÿ</td><td style="text-align:right;">15</td><td style="text-align:right;">1å°æ—¶</td></tr><tr><td>8</td><td style="text-align:center;">6åˆ†é’Ÿ</td><td style="text-align:right;">16</td><td style="text-align:right;">2 å°æ—¶</td></tr></tbody></table><blockquote><p>è‹¥ä¸€æ¡æ¶ˆæ¯åœ¨ä¸€ç›´æ¶ˆè´¹å¤±è´¥çš„å‰æä¸‹ï¼Œå°†ä¼šåœ¨æ­£å¸¸æ¶ˆè´¹åçš„ç¬¬ <code>4 å°æ—¶ 46 åˆ†</code>åè¿›è¡Œç¬¬ 16 æ¬¡é‡è¯•ã€‚ è‹¥ä»ç„¶å¤±è´¥ï¼Œåˆ™å°†æ¶ˆæ¯æŠ•é€’åˆ°<code>æ­»ä¿¡é˜Ÿåˆ—</code> ä¿®æ”¹æ¶ˆè´¹é‡è¯•æ¬¡æ•°</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(&quot;cg&quot;);</span></span>
<span class="line"><span>// ä¿®æ”¹æ¶ˆè´¹é‡è¯•æ¬¡æ•°</span></span>
<span class="line"><span>consumer.setMaxReconsumeTimes( 10 );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å¯¹äºä¿®æ”¹è¿‡çš„é‡è¯•æ¬¡æ•°ï¼Œå°†æŒ‰ç…§ä»¥ä¸‹ç­–ç•¥æ‰§è¡Œï¼š 1)è‹¥ä¿®æ”¹å€¼å°äº 16 ï¼Œåˆ™æŒ‰ç…§æŒ‡å®šé—´éš”è¿›è¡Œé‡è¯• 2)è‹¥ä¿®æ”¹å€¼å¤§äº 16 ï¼Œåˆ™è¶…è¿‡ 16 æ¬¡çš„é‡è¯•æ—¶é—´é—´éš”å‡ä¸º 2 å°æ—¶ å¯¹äºConsumer Groupï¼Œè‹¥ä»…ä¿®æ”¹äº†ä¸€ä¸ªConsumerçš„æ¶ˆè´¹é‡è¯•æ¬¡æ•°ï¼Œåˆ™ä¼šåº”ç”¨åˆ°è¯¥Groupä¸­æ‰€æœ‰å…¶å®ƒConsumerå®ä¾‹ã€‚è‹¥å‡ºç°å¤šä¸ªConsumerå‡åšäº†ä¿®æ”¹çš„æƒ…å†µï¼Œåˆ™é‡‡ç”¨è¦†ç›–æ–¹å¼ç”Ÿæ•ˆã€‚å³æœ€åè¢«ä¿®æ”¹çš„å€¼ä¼šè¦†ç›–å‰é¢è®¾ç½®çš„å€¼ã€‚</p></blockquote><h3 id="_4-é‡è¯•é˜Ÿåˆ—-1" tabindex="-1"><a class="header-anchor" href="#_4-é‡è¯•é˜Ÿåˆ—-1"><span>4 é‡è¯•é˜Ÿåˆ—</span></a></h3><p>å¯¹äºéœ€è¦é‡è¯•æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå¹¶ä¸æ˜¯Consumeråœ¨ç­‰å¾…äº†æŒ‡å®šæ—¶é•¿åå†æ¬¡å»æ‹‰å–åŸæ¥çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œè€Œæ˜¯å°†è¿™äº›éœ€è¦é‡è¯•æ¶ˆè´¹çš„æ¶ˆæ¯æ”¾å…¥åˆ°äº†ä¸€ä¸ªç‰¹æ®ŠTopicçš„é˜Ÿåˆ—ä¸­ï¼Œè€Œåè¿›è¡Œå†æ¬¡æ¶ˆè´¹çš„ã€‚è¿™ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—å°±æ˜¯é‡è¯•é˜Ÿåˆ—ã€‚</p><p>å½“å‡ºç°éœ€è¦è¿›è¡Œé‡è¯•æ¶ˆè´¹çš„æ¶ˆæ¯æ—¶ï¼ŒBrokerä¼šä¸ºæ¯ä¸ªæ¶ˆè´¹ç»„éƒ½è®¾ç½®ä¸€ä¸ªTopicåç§°ä¸º<code>%RETRY%consumerGroup@consumerGroup</code>çš„é‡è¯•é˜Ÿåˆ—ã€‚</p><blockquote><p>1 ï¼‰è¿™ä¸ªé‡è¯•é˜Ÿåˆ—æ˜¯é’ˆå¯¹æ¶ˆæ¯æ‰ç»„çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ¯ä¸ªTopicè®¾ç½®çš„ï¼ˆä¸€ä¸ªTopicçš„æ¶ˆæ¯å¯ä»¥è®©å¤šä¸ªæ¶ˆè´¹è€…ç»„è¿›è¡Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ä¼šä¸ºè¿™äº›æ¶ˆè´¹è€…ç»„å„åˆ›å»ºä¸€ä¸ªé‡è¯•é˜Ÿåˆ—ï¼‰ 2 ï¼‰åªæœ‰å½“å‡ºç°éœ€è¦è¿›è¡Œé‡è¯•æ¶ˆè´¹çš„æ¶ˆæ¯æ—¶ï¼Œæ‰ä¼šä¸ºè¯¥æ¶ˆè´¹è€…ç»„åˆ›å»ºé‡è¯•é˜Ÿåˆ—</p></blockquote><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208163646.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><blockquote><p>æ³¨æ„ï¼Œæ¶ˆè´¹é‡è¯•çš„æ—¶é—´é—´éš”ä¸<code>å»¶æ—¶æ¶ˆè´¹</code>çš„<code>å»¶æ—¶ç­‰çº§</code>ååˆ†ç›¸ä¼¼ï¼Œé™¤äº†æ²¡æœ‰å»¶æ—¶ç­‰çº§çš„å‰ä¸¤ä¸ªæ—¶é—´å¤–ï¼Œå…¶å®ƒçš„æ—¶é—´éƒ½æ˜¯ç›¸åŒçš„</p></blockquote><p>Brokerå¯¹äºé‡è¯•æ¶ˆæ¯çš„å¤„ç†æ˜¯é€šè¿‡<code>å»¶æ—¶æ¶ˆæ¯</code>å®ç°çš„ã€‚å…ˆå°†æ¶ˆæ¯ä¿å­˜åˆ°SCHEDULE_TOPIC_XXXXå»¶è¿Ÿé˜Ÿåˆ—ä¸­ï¼Œå»¶è¿Ÿæ—¶é—´åˆ°åï¼Œä¼šå°†æ¶ˆæ¯æŠ•é€’åˆ°%RETRY%consumerGroup@consumerGroupé‡è¯•é˜Ÿåˆ—ä¸­ã€‚</p><h3 id="_5-æ¶ˆè´¹é‡è¯•é…ç½®æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_5-æ¶ˆè´¹é‡è¯•é…ç½®æ–¹å¼"><span>5 æ¶ˆè´¹é‡è¯•é…ç½®æ–¹å¼</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208163740.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>é›†ç¾¤æ¶ˆè´¹æ–¹å¼ä¸‹ï¼Œæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥åè‹¥å¸Œæœ›æ¶ˆè´¹é‡è¯•ï¼Œåˆ™éœ€è¦åœ¨æ¶ˆæ¯ç›‘å¬å™¨æ¥å£çš„å®ç°ä¸­æ˜ç¡®è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ–¹å¼ä¹‹ä¸€çš„é…ç½®ï¼š</p><ul><li>æ–¹å¼ 1 ï¼šè¿”å›ConsumeConcurrentlyStatus.RECONSUME_LATERï¼ˆæ¨èï¼‰</li><li>æ–¹å¼ 2 ï¼šè¿”å›Null</li><li>æ–¹å¼ 3 ï¼šæŠ›å‡ºå¼‚å¸¸</li></ul><h3 id="_6-æ¶ˆè´¹ä¸é‡è¯•é…ç½®æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_6-æ¶ˆè´¹ä¸é‡è¯•é…ç½®æ–¹å¼"><span>6 æ¶ˆè´¹ä¸é‡è¯•é…ç½®æ–¹å¼</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/RocketMQ/QQæˆªå›¾20220208163826.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜" tabindex="0" loading="lazy"><figcaption>QQæˆªå›¾20201229183512.png</figcaption></figure><p>é›†ç¾¤æ¶ˆè´¹æ–¹å¼ä¸‹ï¼Œæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥åè‹¥ä¸å¸Œæœ›æ¶ˆè´¹é‡è¯•ï¼Œåˆ™åœ¨æ•è·åˆ°å¼‚å¸¸ååŒæ ·ä¹Ÿè¿”å›ä¸æ¶ˆè´¹æˆåŠŸåçš„ç›¸åŒçš„ç»“æœï¼Œå³ConsumeConcurrentlyStatus.CONSUME_SUCCESSï¼Œåˆ™ä¸è¿›è¡Œæ¶ˆè´¹é‡è¯•ã€‚</p><h2 id="ä¹ã€æ­»ä¿¡é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#ä¹ã€æ­»ä¿¡é˜Ÿåˆ—"><span>ä¹ã€æ­»ä¿¡é˜Ÿåˆ—</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—"><span>1 ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—</span></a></h3><p>å½“ä¸€æ¡æ¶ˆæ¯åˆæ¬¡æ¶ˆè´¹å¤±è´¥ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šè‡ªåŠ¨è¿›è¡Œæ¶ˆè´¹é‡è¯•ï¼›è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œè‹¥æ¶ˆè´¹ä¾ç„¶å¤±è´¥ï¼Œåˆ™è¡¨æ˜æ¶ˆè´¹è€…åœ¨æ­£å¸¸æƒ…å†µä¸‹æ— æ³•æ­£ç¡®åœ°æ¶ˆè´¹è¯¥æ¶ˆæ¯ï¼Œæ­¤æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸ä¼šç«‹åˆ»å°†æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†å…¶å‘é€åˆ°è¯¥æ¶ˆè´¹è€…å¯¹åº”çš„ç‰¹æ®Šé˜Ÿåˆ—ä¸­ã€‚è¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-Letter Queueï¼ŒDLQï¼‰ï¼Œè€Œå…¶ä¸­çš„æ¶ˆæ¯ åˆ™ç§°ä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼ˆDead-Letter Messageï¼ŒDLMï¼‰ã€‚</p><blockquote><p>æ­»ä¿¡é˜Ÿåˆ—æ˜¯ç”¨äºå¤„ç†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯çš„ã€‚</p></blockquote><h3 id="_2-æ­»ä¿¡é˜Ÿåˆ—çš„ç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#_2-æ­»ä¿¡é˜Ÿåˆ—çš„ç‰¹å¾"><span>2 æ­»ä¿¡é˜Ÿåˆ—çš„ç‰¹å¾</span></a></h3><h4 id="æ­»ä¿¡é˜Ÿåˆ—å…·æœ‰å¦‚ä¸‹ç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#æ­»ä¿¡é˜Ÿåˆ—å…·æœ‰å¦‚ä¸‹ç‰¹å¾"><span>æ­»ä¿¡é˜Ÿåˆ—å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š</span></a></h4><ul><li>æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸ä¼šå†è¢«æ¶ˆè´¹è€…æ­£å¸¸æ¶ˆè´¹ï¼Œå³DLQå¯¹äºæ¶ˆè´¹è€…æ˜¯ä¸å¯è§çš„</li><li>æ­»ä¿¡å­˜å‚¨æœ‰æ•ˆæœŸä¸æ­£å¸¸æ¶ˆæ¯ç›¸åŒï¼Œå‡ä¸º 3 å¤©ï¼ˆcommitlogæ–‡ä»¶çš„è¿‡æœŸæ—¶é—´ï¼‰ï¼Œ 3 å¤©åä¼šè¢«è‡ªåŠ¨åˆ é™¤</li><li>æ­»ä¿¡é˜Ÿåˆ—å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Topicï¼Œåç§°ä¸º%DLQ%consumerGroup@consumerGroupï¼Œå³æ¯ä¸ªæ¶ˆè´¹è€…ç»„éƒ½æœ‰ä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—</li><li>å¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…ç»„æœªäº§ç”Ÿæ­»ä¿¡æ¶ˆæ¯ï¼Œåˆ™ä¸ä¼šä¸ºå…¶åˆ›å»ºç›¸åº”çš„æ­»ä¿¡é˜Ÿåˆ—</li></ul><h3 id="_3-æ­»ä¿¡æ¶ˆæ¯çš„å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_3-æ­»ä¿¡æ¶ˆæ¯çš„å¤„ç†"><span>3 æ­»ä¿¡æ¶ˆæ¯çš„å¤„ç†</span></a></h3><p>å®é™…ä¸Šï¼Œå½“ä¸€æ¡æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œå°±æ„å‘³ç€ç³»ç»Ÿä¸­æŸäº›åœ°æ–¹å‡ºç°äº†é—®é¢˜ï¼Œä»è€Œå¯¼è‡´æ¶ˆè´¹è€…æ— æ³•æ­£å¸¸æ¶ˆè´¹è¯¥æ¶ˆæ¯ï¼Œæ¯”å¦‚ä»£ç ä¸­åŸæœ¬å°±å­˜åœ¨Bugã€‚å› æ­¤ï¼Œå¯¹äºæ­»ä¿¡æ¶ˆæ¯ï¼Œé€šå¸¸éœ€è¦å¼€å‘äººå‘˜è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚æœ€å…³é”®çš„æ­¥éª¤æ˜¯è¦æ’æŸ¥å¯ç–‘å› ç´ ï¼Œè§£å†³ä»£ç ä¸­å¯èƒ½å­˜åœ¨çš„Bugï¼Œç„¶åå†å°†åŸæ¥çš„æ­»ä¿¡æ¶ˆæ¯å†æ¬¡è¿›è¡ŒæŠ•é€’æ¶ˆè´¹ã€‚</p><p>æ¶ˆæ¯é‡è¯•æœºåˆ¶å’Œæ­»ä¿¡é˜Ÿåˆ—ç¤ºä¾‹ä»£ç :</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> IRetryTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> retryProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> producer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQProducer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;retry-producer-group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MqConstant</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NAME_SRV_ADDR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ é‡è¯•æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setRetryTimesWhenSendFailed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setRetryTimesWhenSendAsyncFailed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> UUID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;retryTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;vip1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, key, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆ‘æ˜¯vip666çš„æ–‡ç« &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(message);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‘é€æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * é‡è¯•çš„æ—¶é—´é—´éš”</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * é»˜è®¤é‡è¯•16æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * 1.èƒ½å¦è‡ªå®šä¹‰é‡è¯•æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * 2.å¦‚æœé‡è¯•äº†16æ¬¡(å¹¶å‘æ¨¡å¼) é¡ºåºæ¨¡å¼ä¸‹(intæœ€å¤§å€¼æ¬¡)éƒ½æ˜¯å¤±è´¥çš„?  æ˜¯ä¸€ä¸ªæ­»ä¿¡æ¶ˆæ¯ åˆ™ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»ä¿¡ä¸»é¢˜ä¸­å» ä¸»é¢˜çš„åç§°:%DLQ%retry-consumer-group</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * 3.å½“æ¶ˆæ¯å¤„ç†å¤±è´¥çš„æ—¶å€™ è¯¥å¦‚ä½•æ­£ç¡®çš„å¤„ç†?</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * --------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * é‡è¯•çš„æ¬¡æ•°ä¸€èˆ¬ 5æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">@throws</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> Exception</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> retryConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;retry-consumer-group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MqConstant</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NAME_SRV_ADDR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;retryTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è®¾å®šé‡è¯•æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setMaxReconsumeTimes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> messageExt</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">messageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getReconsumeTimes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">messageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBody</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // ä¸šåŠ¡æŠ¥é”™äº† è¿”å›null è¿”å› RECONSUME_LATER éƒ½ä¼šé‡è¯•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">RECONSUME_LATER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    /////////// ç›´æ¥ç›‘å¬æ­»ä¿¡ä¸»é¢˜çš„æ¶ˆæ¯,è®°å½•ä¸‹æ‹‰ é€šçŸ¥äººå·¥æ¥å…¥å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> retryDeadConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;retry-dead-consumer-group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MqConstant</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NAME_SRV_ADDR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;%DLQ%retry-consumer-group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> messageExt</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">messageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBody</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è®°å½•åˆ°ç‰¹åˆ«çš„ä½ç½® æ–‡ä»¶ mysql é€šçŸ¥äººå·¥å¤„ç†&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // ä¸šåŠ¡æŠ¥é”™äº† è¿”å›null è¿”å› RECONSUME_LATER éƒ½ä¼šé‡è¯•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //////////////////////// ç¬¬äºŒç§æ–¹æ¡ˆ ç”¨æ³•æ¯”è¾ƒå¤š</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> retryConsumer2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DefaultMQPushConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;retry-consumer-group&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setNamesrvAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MqConstant</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NAME_SRV_ADDR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;retryTopic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è®¾å®šé‡è¯•æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">registerMessageListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageListenerConcurrently</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> consumeMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ConsumeConcurrentlyContext</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                MessageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> messageExt</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // ä¸šåŠ¡å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">                    handleDb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                    // é‡è¯•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> reconsumeTimes</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> messageExt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getReconsumeTimes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (reconsumeTimes </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                        // ä¸è¦é‡è¯•äº†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è®°å½•åˆ°ç‰¹åˆ«çš„ä½ç½® æ–‡ä»¶ mysql é€šçŸ¥äººå·¥å¤„ç†&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">RECONSUME_LATER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // ä¸šåŠ¡æŠ¥é”™äº† è¿”å›null è¿”å› RECONSUME_LATER éƒ½ä¼šé‡è¯•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConsumeConcurrentlyStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CONSUME_SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        consumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleDb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/skxndbzu/JackChenBlogs/edit/main/src/posts/æ¶ˆæ¯ä¸­é—´ä»¶/RocketMQ.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 615880048@qq.com">é™ˆé“­é¹¤</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">åƒé‡Œä¹‹è¡Œ å§‹äºè¶³ä¸‹</div><div class="vp-copyright">Copyright Â© 2024 Jack-Chen </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DIfhtWs6.js" defer></script>
  </body>
</html>
