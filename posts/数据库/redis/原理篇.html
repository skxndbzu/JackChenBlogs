<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%8E%9F%E7%90%86%E7%AF%87.html"><meta property="og:site_name" content="éº»èŠ±çš„å°ç«™"><meta property="og:title" content="åŸç†ç¯‡"><meta property="og:description" content="RedisåŸç†ç¯‡ 1ã€åŸç†ç¯‡-Redisæ•°æ®ç»“æ„ 1.1 Redisæ•°æ®ç»“æ„-åŠ¨æ€å­—ç¬¦ä¸² æˆ‘ä»¬éƒ½çŸ¥é“Redisä¸­ä¿å­˜çš„Keyæ˜¯å­—ç¬¦ä¸²ï¼Œvalueå¾€å¾€æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„é›†åˆã€‚å¯è§å­—ç¬¦ä¸²æ˜¯Redisä¸­æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚ ä¸è¿‡Redisæ²¡æœ‰ç›´æ¥ä½¿ç”¨Cè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºCè¯­è¨€å­—ç¬¦ä¸²å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š è·å–å­—ç¬¦ä¸²é•¿åº¦çš„éœ€è¦é€šè¿‡è¿ç®— éäºŒè¿›åˆ¶å®‰å…¨ ä¸å¯ä¿®æ”¹ R..."><meta property="og:type" content="article"><meta property="og:image" content="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984583289.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-07-20T08:44:09.000Z"><meta property="article:author" content="Jack-Chen"><meta property="article:tag" content="ç‰ˆæœ¬æ§åˆ¶"><meta property="article:tag" content="è¿œç¨‹ä»“åº“"><meta property="article:published_time" content="2023-06-01T00:00:00.000Z"><meta property="article:modified_time" content="2024-07-20T08:44:09.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"åŸç†ç¯‡","image":["https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984583289.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984624671.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984648404.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984787383.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984822363.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984838306.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984923322.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984942385.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985149557.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985197214.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985276621.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985304075.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985327653.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985396560.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985497735.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985570612.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985586543.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985640422.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985716275.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985743412.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985824540.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985987327.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986020491.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986055253.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986172002.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986282879.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986217182.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986328124.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986474927.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986642777.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986667228.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986718554.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986771309.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986813240.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986877620.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986956618.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987103450.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987159575.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987172764.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987202522.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987240622.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987313461.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987342550.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987388177.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987454403.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992091967.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992121692.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992172526.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992238097.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992299740.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992339937.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992360355.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992413406.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653844970346.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653845147190.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653896065386.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653896377259.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653896687354.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653897115346.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653897270074.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653897490116.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653898691736.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653900022580.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653900721427.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653902845082.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653911776583.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653911877542.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653912219712.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653982278727.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653982993020.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983341150.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983366243.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983423128.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983606531.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983652865.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983978671.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984029506.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984085095.png"],"datePublished":"2023-06-01T00:00:00.000Z","dateModified":"2024-07-20T08:44:09.000Z","author":[{"@type":"Person","name":"Jack-Chen","url":"https://chemnminghe.top"}]}</script><title>åŸç†ç¯‡ | éº»èŠ±çš„å°ç«™</title><meta name="description" content="RedisåŸç†ç¯‡ 1ã€åŸç†ç¯‡-Redisæ•°æ®ç»“æ„ 1.1 Redisæ•°æ®ç»“æ„-åŠ¨æ€å­—ç¬¦ä¸² æˆ‘ä»¬éƒ½çŸ¥é“Redisä¸­ä¿å­˜çš„Keyæ˜¯å­—ç¬¦ä¸²ï¼Œvalueå¾€å¾€æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„é›†åˆã€‚å¯è§å­—ç¬¦ä¸²æ˜¯Redisä¸­æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚ ä¸è¿‡Redisæ²¡æœ‰ç›´æ¥ä½¿ç”¨Cè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºCè¯­è¨€å­—ç¬¦ä¸²å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š è·å–å­—ç¬¦ä¸²é•¿åº¦çš„éœ€è¦é€šè¿‡è¿ç®— éäºŒè¿›åˆ¶å®‰å…¨ ä¸å¯ä¿®æ”¹ R...">
    <link rel="preload" href="/assets/style-Tnuk6l9P.css" as="style"><link rel="stylesheet" href="/assets/style-Tnuk6l9P.css">
    <link rel="modulepreload" href="/assets/app-BYKnUcUk.js"><link rel="modulepreload" href="/assets/åŸç†ç¯‡.html-DUjvfC2M.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-Dg26PWDC.js" as="script"><link rel="prefetch" href="/assets/intro.html-KFRiDOsS.js" as="script"><link rel="prefetch" href="/assets/index.html-DXVMGbK_.js" as="script"><link rel="prefetch" href="/assets/index.html-BlkC4sOC.js" as="script"><link rel="prefetch" href="/assets/page.html-8eF0DMIs.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬ä¸­ç§‘è½¯.html-Bck9Ovvv.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬é‘«ä¸‡å®¶ç§‘æŠ€.html-DJyWw-CE.js" as="script"><link rel="prefetch" href="/assets/å—äº¬ä¸­ç§‘è½¯.html-CawQ2rVf.js" as="script"><link rel="prefetch" href="/assets/å¤©æ´¥å‡½æ•°è§†ç•Œ.html-C-TiMN6Z.js" as="script"><link rel="prefetch" href="/assets/å®‰ç¡•ä¿¡æ¯(ä¸œåŒ—éƒ¨).html-DVi4BHIU.js" as="script"><link rel="prefetch" href="/assets/ç”˜è‚ƒä¸­å·¥å›½é™….html-NtUMCt1j.js" as="script"><link rel="prefetch" href="/assets/index.html-DMDh3LDY.js" as="script"><link rel="prefetch" href="/assets/index.html-CqzzyQnl.js" as="script"><link rel="prefetch" href="/assets/disable.html-BOrrIM9r.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-DymZ1DOG.js" as="script"><link rel="prefetch" href="/assets/layout.html-A-c9Ggq0.js" as="script"><link rel="prefetch" href="/assets/markdown.html-C8O_PvDt.js" as="script"><link rel="prefetch" href="/assets/page.html-D2smeGlL.js" as="script"><link rel="prefetch" href="/assets/JUC.html-Cj4sCeFN.js" as="script"><link rel="prefetch" href="/assets/JVM.html-DYElkVqJ.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-Bkoiz6tX.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-DWKKED3-.js" as="script"><link rel="prefetch" href="/assets/vue.html-oadawlZV.js" as="script"><link rel="prefetch" href="/assets/Spring.html-wHqo2Q3V.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-BZDOUqnu.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-BFlMmh-4.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-B3j2Lg8l.js" as="script"><link rel="prefetch" href="/assets/Docker.html-Cy9ibnN8.js" as="script"><link rel="prefetch" href="/assets/Git.html-BlQ49nEZ.js" as="script"><link rel="prefetch" href="/assets/Gradle.html-Dnu6SacT.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-D300gZ6D.js" as="script"><link rel="prefetch" href="/assets/maven.html-CGWWO-4T.js" as="script"><link rel="prefetch" href="/assets/2.html-CKmB1act.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-7U0rTwA0.js" as="script"><link rel="prefetch" href="/assets/zookeeper.html-BmWaRG4e.js" as="script"><link rel="prefetch" href="/assets/2.html-C8mvFmp5.js" as="script"><link rel="prefetch" href="/assets/3.html-k7U_2ikD.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®ä»‹ç».html-BWz1Qj32.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-DSI5_9CS.js" as="script"><link rel="prefetch" href="/assets/elasticsearch.html--akDBJ2P.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-BP4wCjEU.js" as="script"><link rel="prefetch" href="/assets/1.html-B-pCz_Xa.js" as="script"><link rel="prefetch" href="/assets/2.html-B1MtwO_F.js" as="script"><link rel="prefetch" href="/assets/3.html-DMy2siDl.js" as="script"><link rel="prefetch" href="/assets/Linux.html-DOMAI1Pp.js" as="script"><link rel="prefetch" href="/assets/æ“ä½œç³»ç»Ÿ.html-DikAXKka.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œ.html-D4YsVC3c.js" as="script"><link rel="prefetch" href="/assets/1.html-CBzzi2bS.js" as="script"><link rel="prefetch" href="/assets/2.html-CtkFT2MW.js" as="script"><link rel="prefetch" href="/assets/3.html-DyPE17VK.js" as="script"><link rel="prefetch" href="/assets/1.html-BYP8voes.js" as="script"><link rel="prefetch" href="/assets/2.html-B-VuoRyO.js" as="script"><link rel="prefetch" href="/assets/3.html-CFhbBSzB.js" as="script"><link rel="prefetch" href="/assets/1.html-Dfi4JgTT.js" as="script"><link rel="prefetch" href="/assets/2.html-3Ej9hRsH.js" as="script"><link rel="prefetch" href="/assets/3.html-mXKabJxq.js" as="script"><link rel="prefetch" href="/assets/åŸºç¡€ç¯‡.html-BLI3gQ9e.js" as="script"><link rel="prefetch" href="/assets/å®æˆ˜ç¯‡.html-CU5N4Ilp.js" as="script"><link rel="prefetch" href="/assets/é«˜çº§ç¯‡.html-p9YGWfFF.js" as="script"><link rel="prefetch" href="/assets/404.html-HcIB-o9i.js" as="script"><link rel="prefetch" href="/assets/index.html-De94tPkF.js" as="script"><link rel="prefetch" href="/assets/index.html-ByvX0y-H.js" as="script"><link rel="prefetch" href="/assets/index.html-DmZGQL8T.js" as="script"><link rel="prefetch" href="/assets/index.html-C0afhGvF.js" as="script"><link rel="prefetch" href="/assets/index.html-wL1ZfdOf.js" as="script"><link rel="prefetch" href="/assets/index.html-eMvOoaZC.js" as="script"><link rel="prefetch" href="/assets/index.html-BmRkjHr_.js" as="script"><link rel="prefetch" href="/assets/index.html-DpHBumR0.js" as="script"><link rel="prefetch" href="/assets/index.html-DysWg-Eb.js" as="script"><link rel="prefetch" href="/assets/index.html-BJeBBKlO.js" as="script"><link rel="prefetch" href="/assets/index.html-DPs9VwAX.js" as="script"><link rel="prefetch" href="/assets/index.html-CkIkyL6y.js" as="script"><link rel="prefetch" href="/assets/index.html-PJluwjn2.js" as="script"><link rel="prefetch" href="/assets/index.html-DovcwOVQ.js" as="script"><link rel="prefetch" href="/assets/index.html-6-xupXrt.js" as="script"><link rel="prefetch" href="/assets/index.html-D4KrBOga.js" as="script"><link rel="prefetch" href="/assets/index.html-CAkSL-EB.js" as="script"><link rel="prefetch" href="/assets/index.html-DpTuR_ad.js" as="script"><link rel="prefetch" href="/assets/index.html-V6g9-9RJ.js" as="script"><link rel="prefetch" href="/assets/index.html-CYkxHVb0.js" as="script"><link rel="prefetch" href="/assets/index.html-BH7kxkTh.js" as="script"><link rel="prefetch" href="/assets/index.html-ZDUam0Bi.js" as="script"><link rel="prefetch" href="/assets/index.html-hwnE4f7-.js" as="script"><link rel="prefetch" href="/assets/index.html-eAo-BbE2.js" as="script"><link rel="prefetch" href="/assets/index.html-CSTxZy1d.js" as="script"><link rel="prefetch" href="/assets/index.html-BY1NzVnX.js" as="script"><link rel="prefetch" href="/assets/index.html-CN0R_zgD.js" as="script"><link rel="prefetch" href="/assets/index.html-DlnBlkCQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Bu8UcH2W.js" as="script"><link rel="prefetch" href="/assets/index.html-DWCXfRVF.js" as="script"><link rel="prefetch" href="/assets/index.html-DjhPDlDo.js" as="script"><link rel="prefetch" href="/assets/index.html-EqhIMeyP.js" as="script"><link rel="prefetch" href="/assets/index.html-DTI8Yt-I.js" as="script"><link rel="prefetch" href="/assets/index.html-lh4uVlGB.js" as="script"><link rel="prefetch" href="/assets/index.html-cIfrys5U.js" as="script"><link rel="prefetch" href="/assets/index.html-CjQudSQG.js" as="script"><link rel="prefetch" href="/assets/index.html-Dpp1nhq1.js" as="script"><link rel="prefetch" href="/assets/index.html-f-CbCiWH.js" as="script"><link rel="prefetch" href="/assets/index.html-iRFzr8Ry.js" as="script"><link rel="prefetch" href="/assets/index.html-BF6v9vBj.js" as="script"><link rel="prefetch" href="/assets/index.html-BA5bibSx.js" as="script"><link rel="prefetch" href="/assets/index.html-CAQayavk.js" as="script"><link rel="prefetch" href="/assets/index.html-DGHxWL1t.js" as="script"><link rel="prefetch" href="/assets/index.html-B57g5aL0.js" as="script"><link rel="prefetch" href="/assets/index.html-BOzDqnUC.js" as="script"><link rel="prefetch" href="/assets/index.html-B-C72qpx.js" as="script"><link rel="prefetch" href="/assets/index.html-BOnn7tpN.js" as="script"><link rel="prefetch" href="/assets/index.html-DhdpaJ0q.js" as="script"><link rel="prefetch" href="/assets/index.html-DPh0Ij6g.js" as="script"><link rel="prefetch" href="/assets/index.html-KvXzk4j_.js" as="script"><link rel="prefetch" href="/assets/index.html-B4QHnHFp.js" as="script"><link rel="prefetch" href="/assets/index.html-CbHuVcPi.js" as="script"><link rel="prefetch" href="/assets/index.html-OU-yfYV-.js" as="script"><link rel="prefetch" href="/assets/index.html-DyiZHthR.js" as="script"><link rel="prefetch" href="/assets/index.html-amzcZaBg.js" as="script"><link rel="prefetch" href="/assets/index.html-x93sL2WV.js" as="script"><link rel="prefetch" href="/assets/index.html-B1ASKpuy.js" as="script"><link rel="prefetch" href="/assets/index.html-D-Vu4wEk.js" as="script"><link rel="prefetch" href="/assets/index.html-D1PaZ4Px.js" as="script"><link rel="prefetch" href="/assets/index.html-ByHe7rrM.js" as="script"><link rel="prefetch" href="/assets/index.html-iYl8oOWK.js" as="script"><link rel="prefetch" href="/assets/index.html-C2TJv6D3.js" as="script"><link rel="prefetch" href="/assets/index.html-CcmzxkUK.js" as="script"><link rel="prefetch" href="/assets/index.html-CS9wFxAs.js" as="script"><link rel="prefetch" href="/assets/index.html-CusJJHmz.js" as="script"><link rel="prefetch" href="/assets/index.html-XBfBFw9n.js" as="script"><link rel="prefetch" href="/assets/index.html-Bb9TU5uP.js" as="script"><link rel="prefetch" href="/assets/index.html-DW06xorC.js" as="script"><link rel="prefetch" href="/assets/index.html-BAJiDExF.js" as="script"><link rel="prefetch" href="/assets/index.html-D2Fi0_YV.js" as="script"><link rel="prefetch" href="/assets/index.html-BLdCr4hE.js" as="script"><link rel="prefetch" href="/assets/index.html-5XkYVEn9.js" as="script"><link rel="prefetch" href="/assets/index.html-lC-C7DH-.js" as="script"><link rel="prefetch" href="/assets/index.html-BozW6VZQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DA9gqjbM.js" as="script"><link rel="prefetch" href="/assets/index.html-DS1ygI10.js" as="script"><link rel="prefetch" href="/assets/index.html-DCO33K0q.js" as="script"><link rel="prefetch" href="/assets/index.html-d5-3wl__.js" as="script"><link rel="prefetch" href="/assets/index.html-BnTM10cR.js" as="script"><link rel="prefetch" href="/assets/index.html-CU0EkorC.js" as="script"><link rel="prefetch" href="/assets/index.html-BSpai6iX.js" as="script"><link rel="prefetch" href="/assets/index.html-CAqEV4PP.js" as="script"><link rel="prefetch" href="/assets/index.html-BEqMhOv2.js" as="script"><link rel="prefetch" href="/assets/index.html-9dOH66Vh.js" as="script"><link rel="prefetch" href="/assets/index.html-x-2WSG3b.js" as="script"><link rel="prefetch" href="/assets/index.html-Dh4QBATH.js" as="script"><link rel="prefetch" href="/assets/index.html-DdvC0JR-.js" as="script"><link rel="prefetch" href="/assets/index.html-DB9Ce9bK.js" as="script"><link rel="prefetch" href="/assets/index.html-GY66i-NL.js" as="script"><link rel="prefetch" href="/assets/index.html-DVd6jweh.js" as="script"><link rel="prefetch" href="/assets/index.html-BsDJyw0T.js" as="script"><link rel="prefetch" href="/assets/index.html-tMlsy0Tt.js" as="script"><link rel="prefetch" href="/assets/index.html-qJ9VOzN6.js" as="script"><link rel="prefetch" href="/assets/index.html-DW6AtmgZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CcE36Sae.js" as="script"><link rel="prefetch" href="/assets/index.html-Cy2lF-_O.js" as="script"><link rel="prefetch" href="/assets/index.html-BTrnHnwl.js" as="script"><link rel="prefetch" href="/assets/index.html-D_AHdFea.js" as="script"><link rel="prefetch" href="/assets/index.html-DCbCRxOr.js" as="script"><link rel="prefetch" href="/assets/index.html-BZJtHztz.js" as="script"><link rel="prefetch" href="/assets/index.html-BcK4qFOY.js" as="script"><link rel="prefetch" href="/assets/index.html-D2EdXpwA.js" as="script"><link rel="prefetch" href="/assets/index.html-CNpKGhwQ.js" as="script"><link rel="prefetch" href="/assets/index.html-LxMNsTlr.js" as="script"><link rel="prefetch" href="/assets/index.html-GbTEJVbb.js" as="script"><link rel="prefetch" href="/assets/index.html-D8MDU7UK.js" as="script"><link rel="prefetch" href="/assets/index.html-0yDW4CE5.js" as="script"><link rel="prefetch" href="/assets/index.html-Btv9D28_.js" as="script"><link rel="prefetch" href="/assets/index.html-uNlrWcWe.js" as="script"><link rel="prefetch" href="/assets/index.html-CbWbdpyP.js" as="script"><link rel="prefetch" href="/assets/index.html-3QLd1atz.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmSYFqm.js" as="script"><link rel="prefetch" href="/assets/index.html-CHLcacMt.js" as="script"><link rel="prefetch" href="/assets/index.html-LkqckBfX.js" as="script"><link rel="prefetch" href="/assets/index.html-aPWs6wmZ.js" as="script"><link rel="prefetch" href="/assets/index.html-LdEHmxw_.js" as="script"><link rel="prefetch" href="/assets/index.html-DlX5crC1.js" as="script"><link rel="prefetch" href="/assets/index.html-BbOKxsD8.js" as="script"><link rel="prefetch" href="/assets/index.html-Cfey_So8.js" as="script"><link rel="prefetch" href="/assets/index.html-BblCy8B5.js" as="script"><link rel="prefetch" href="/assets/index.html-D4muVTPQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DLhQplXf.js" as="script"><link rel="prefetch" href="/assets/index.html-BB7sJ9VJ.js" as="script"><link rel="prefetch" href="/assets/index.html-C0L5ys2E.js" as="script"><link rel="prefetch" href="/assets/index.html-BEoKypIr.js" as="script"><link rel="prefetch" href="/assets/index.html-BmTZPT6G.js" as="script"><link rel="prefetch" href="/assets/index.html-DvcPzIqP.js" as="script"><link rel="prefetch" href="/assets/index.html-D_OIRe_j.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/touxiang/vue-color-avatar3.png" alt><!----><span class="vp-site-name hide-in-pad">éº»èŠ±çš„å°ç«™</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon iconfont icon-xuexibiji" style=""></span><!--]-->å­¦ä¹ ç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interviewExperience/" aria-label="é¢è¯•ä¸“æ "><!--[--><span class="font-icon icon iconfont icon-flow-interview" style=""></span><!--]-->é¢è¯•ä¸“æ <!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/softwareTutorial/" aria-label="è½¯ä»¶æ•™ç¨‹"><!--[--><span class="font-icon icon iconfont icon-ruanjianjiaocheng1" style=""></span><!--]-->è½¯ä»¶æ•™ç¨‹<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/aboutMe/" aria-label="å…³äºæˆ‘"><!--[--><span class="font-icon icon iconfont icon-guanyuzuozhe" style=""></span><!--]-->å…³äºæˆ‘<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/skxndbzu/JackChenBlogs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-meiribikan" style=""></span><span class="vp-sidebar-title">å¿…çœ‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-zhenrenmianshi" style=""></span><span class="vp-sidebar-title">é¢è¯•ä¸“æ </span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-application--web" style=""></span><span class="vp-sidebar-title">è®¡ç®—æœºåŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-xitongsheji" style=""></span><span class="vp-sidebar-title">ç³»ç»Ÿè®¾è®¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-jurassic_data" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/elasticsearch.html" aria-label="elasticsearch"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->elasticsearch<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" aria-label="MySQL"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->MySQL<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%9F%BA%E7%A1%80%E7%AF%87.html" aria-label="åŸºç¡€ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->åŸºç¡€ç¯‡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%AE%9E%E6%88%98%E7%AF%87.html" aria-label="å®æˆ˜ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->å®æˆ˜ç¯‡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E9%AB%98%E7%BA%A7%E7%AF%87.html" aria-label="é«˜çº§ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->é«˜çº§ç¯‡<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%8E%9F%E7%90%86%E7%AF%87.html" aria-label="åŸç†ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->åŸç†ç¯‡<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-kaifagongju" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/developmentTool/" aria-label="å¼€å‘å·¥å…·"><!---->å¼€å‘å·¥å…·<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¸¸ç”¨æ¡†æ¶"><!---->å¸¸ç”¨æ¡†æ¶<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¾®æœåŠ¡æ¶æ„"><!---->å¾®æœåŠ¡æ¶æ„<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å‰ç«¯"><!---->å‰ç«¯<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ¶ˆæ¯ä¸­é—´ä»¶"><!---->æ¶ˆæ¯ä¸­é—´ä»¶<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="ä»‹ç»é¡µ"><!--[--><span class="font-icon icon iconfont icon-fenxiangdingqijieshao" style=""></span><!--]-->ä»‹ç»é¡µ<!----></a></li><li><a class="auto-link external-link vp-sidebar-link" href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" aria-label="å¹»ç¯ç‰‡" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon iconfont icon-huandengpian-04" style=""></span><!--]-->å¹»ç¯ç‰‡<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>åŸç†ç¯‡</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://chemnminghe.top" target="_blank" rel="noopener noreferrer">Jack-Chen</a></span><span property="author" content="Jack-Chen"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-06-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 46 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT46M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2 clickable" role="navigation">Git</span><!--]--><meta property="articleSection" content="Git"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color3 clickable" role="navigation">ç‰ˆæœ¬æ§åˆ¶</span><span class="page-tag-item color7 clickable" role="navigation">è¿œç¨‹ä»“åº“</span><!--]--><meta property="keywords" content="ç‰ˆæœ¬æ§åˆ¶,è¿œç¨‹ä»“åº“"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1ã€åŸç†ç¯‡-redisæ•°æ®ç»“æ„">1ã€åŸç†ç¯‡-Redisæ•°æ®ç»“æ„</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-redisæ•°æ®ç»“æ„-åŠ¨æ€å­—ç¬¦ä¸²">1.1 Redisæ•°æ®ç»“æ„-åŠ¨æ€å­—ç¬¦ä¸²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-redisæ•°æ®ç»“æ„-intset">1.2 Redisæ•°æ®ç»“æ„-intset</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-3-redisæ•°æ®ç»“æ„-dict">1.3 Redisæ•°æ®ç»“æ„-Dict</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-4-redisæ•°æ®ç»“æ„-ziplist">1.4 Redisæ•°æ®ç»“æ„-ZipList</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-5-redisæ•°æ®ç»“æ„-ziplistçš„è¿é”æ›´æ–°é—®é¢˜">1.5 Redisæ•°æ®ç»“æ„-ZipListçš„è¿é”æ›´æ–°é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-6-redisæ•°æ®ç»“æ„-quicklist">1.6 Redisæ•°æ®ç»“æ„-QuickList</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-7-redisæ•°æ®ç»“æ„-redisobject">1.7 Redisæ•°æ®ç»“æ„-RedisObject</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-8-redisæ•°æ®ç»“æ„-string">1.8 Redisæ•°æ®ç»“æ„-String</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-9-redisæ•°æ®ç»“æ„-list">1.9 Redisæ•°æ®ç»“æ„-List</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-0-redisæ•°æ®ç»“æ„-setç»“æ„">2.0 Redisæ•°æ®ç»“æ„-Setç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1ã€redisæ•°æ®ç»“æ„-zset">2.1ã€Redisæ•°æ®ç»“æ„-ZSET</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-ã€redisæ•°æ®ç»“æ„-hash">2.2 ã€Redisæ•°æ®ç»“æ„-Hash</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2ã€åŸç†ç¯‡-redisç½‘ç»œæ¨¡å‹">2ã€åŸç†ç¯‡-Redisç½‘ç»œæ¨¡å‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸æ€ç©ºé—´">2.1 ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸æ€ç©ºé—´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-ç½‘ç»œæ¨¡å‹-é˜»å¡io">2.2.ç½‘ç»œæ¨¡å‹-é˜»å¡IO</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-ç½‘ç»œæ¨¡å‹-éé˜»å¡io">2.3 ç½‘ç»œæ¨¡å‹-éé˜»å¡IO</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-4-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨">2.4 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-5-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨-selectæ–¹å¼">2.5 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨-selectæ–¹å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-6-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨æ¨¡å‹-pollæ¨¡å¼">2.6 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨æ¨¡å‹-pollæ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-7-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨æ¨¡å‹-epollå‡½æ•°">2.7 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨æ¨¡å‹-epollå‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-8ã€ç½‘ç»œæ¨¡å‹-epollä¸­çš„etå’Œlt">2.8ã€ç½‘ç»œæ¨¡å‹-epollä¸­çš„ETå’ŒLT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-9-ç½‘ç»œæ¨¡å‹-åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹">2.9 ç½‘ç»œæ¨¡å‹-åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-0-ã€ç½‘ç»œæ¨¡å‹-ä¿¡å·é©±åŠ¨">3.0 ã€ç½‘ç»œæ¨¡å‹-ä¿¡å·é©±åŠ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-ã€ç½‘ç»œæ¨¡å‹-redisæ˜¯å•çº¿ç¨‹çš„å—-ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹">3.1 ã€ç½‘ç»œæ¨¡å‹-Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-ã€redisçš„å•çº¿ç¨‹æ¨¡å‹-rediså•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å˜æ›´">3.2 ã€Redisçš„å•çº¿ç¨‹æ¨¡å‹-Rediså•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å˜æ›´</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3ã€redisé€šä¿¡åè®®-respåè®®">3ã€Redisé€šä¿¡åè®®-RESPåè®®</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1ã€redisé€šä¿¡åè®®-åŸºäºsocketè‡ªå®šä¹‰redisçš„å®¢æˆ·ç«¯">3.1ã€Redisé€šä¿¡åè®®-åŸºäºSocketè‡ªå®šä¹‰Redisçš„å®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2ã€rediså†…å­˜å›æ”¶-è¿‡æœŸkeyå¤„ç†">3.2ã€Rediså†…å­˜å›æ”¶-è¿‡æœŸkeyå¤„ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-rediså†…å­˜å›æ”¶-å†…å­˜æ·˜æ±°ç­–ç•¥">3.3 Rediså†…å­˜å›æ”¶-å†…å­˜æ·˜æ±°ç­–ç•¥</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="redisåŸç†ç¯‡" tabindex="-1"><a class="header-anchor" href="#redisåŸç†ç¯‡"><span>RedisåŸç†ç¯‡</span></a></h1><h2 id="_1ã€åŸç†ç¯‡-redisæ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1ã€åŸç†ç¯‡-redisæ•°æ®ç»“æ„"><span>1ã€åŸç†ç¯‡-Redisæ•°æ®ç»“æ„</span></a></h2><h3 id="_1-1-redisæ•°æ®ç»“æ„-åŠ¨æ€å­—ç¬¦ä¸²" tabindex="-1"><a class="header-anchor" href="#_1-1-redisæ•°æ®ç»“æ„-åŠ¨æ€å­—ç¬¦ä¸²"><span>1.1 Redisæ•°æ®ç»“æ„-åŠ¨æ€å­—ç¬¦ä¸²</span></a></h3><p>æˆ‘ä»¬éƒ½çŸ¥é“Redisä¸­ä¿å­˜çš„Keyæ˜¯å­—ç¬¦ä¸²ï¼Œvalueå¾€å¾€æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„é›†åˆã€‚å¯è§å­—ç¬¦ä¸²æ˜¯Redisä¸­æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚</p><p>ä¸è¿‡Redisæ²¡æœ‰ç›´æ¥ä½¿ç”¨Cè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºCè¯­è¨€å­—ç¬¦ä¸²å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š è·å–å­—ç¬¦ä¸²é•¿åº¦çš„éœ€è¦é€šè¿‡è¿ç®— éäºŒè¿›åˆ¶å®‰å…¨ ä¸å¯ä¿®æ”¹ Redisæ„å»ºäº†ä¸€ç§æ–°çš„å­—ç¬¦ä¸²ç»“æ„ï¼Œç§°ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼‰ï¼Œç®€ç§°SDSã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984583289.png" alt="1653984583289" tabindex="0" loading="lazy"><figcaption>1653984583289</figcaption></figure><p>é‚£ä¹ˆRediså°†åœ¨åº•å±‚åˆ›å»ºä¸¤ä¸ªSDSï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯åŒ…å«â€œnameâ€çš„SDSï¼Œå¦ä¸€ä¸ªæ˜¯åŒ…å«â€œè™å“¥â€çš„SDSã€‚</p><p>Redisæ˜¯Cè¯­è¨€å®ç°çš„ï¼Œå…¶ä¸­SDSæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984624671.png" alt="1653984624671" tabindex="0" loading="lazy"><figcaption>1653984624671</figcaption></figure><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²â€œnameâ€çš„sdsç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984648404.png" alt="1653984648404" tabindex="0" loading="lazy"><figcaption>1653984648404</figcaption></figure><p>SDSä¹‹æ‰€ä»¥å«åšåŠ¨æ€å­—ç¬¦ä¸²ï¼Œæ˜¯å› ä¸ºå®ƒå…·å¤‡åŠ¨æ€æ‰©å®¹çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ä¸€ä¸ªå†…å®¹ä¸ºâ€œhiâ€çš„SDSï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984787383.png" alt="1653984787383" tabindex="0" loading="lazy"><figcaption>1653984787383</figcaption></figure><p>å‡å¦‚æˆ‘ä»¬è¦ç»™SDSè¿½åŠ ä¸€æ®µå­—ç¬¦ä¸²â€œ,Amyâ€ï¼Œè¿™é‡Œé¦–å…ˆä¼šç”³è¯·æ–°å†…å­˜ç©ºé—´ï¼š</p><p>å¦‚æœæ–°å­—ç¬¦ä¸²å°äº1Mï¼Œåˆ™æ–°ç©ºé—´ä¸ºæ‰©å±•åå­—ç¬¦ä¸²é•¿åº¦çš„ä¸¤å€+1ï¼›</p><p>å¦‚æœæ–°å­—ç¬¦ä¸²å¤§äº1Mï¼Œåˆ™æ–°ç©ºé—´ä¸ºæ‰©å±•åå­—ç¬¦ä¸²é•¿åº¦+1M+1ã€‚ç§°ä¸ºå†…å­˜é¢„åˆ†é…ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984822363.png" alt="1653984822363" tabindex="0" loading="lazy"><figcaption>1653984822363</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984838306.png" alt="1653984838306" tabindex="0" loading="lazy"><figcaption>1653984838306</figcaption></figure><h3 id="_1-2-redisæ•°æ®ç»“æ„-intset" tabindex="-1"><a class="header-anchor" href="#_1-2-redisæ•°æ®ç»“æ„-intset"><span>1.2 Redisæ•°æ®ç»“æ„-intset</span></a></h3><p>IntSetæ˜¯Redisä¸­seté›†åˆçš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒåŸºäºæ•´æ•°æ•°ç»„æ¥å®ç°ï¼Œå¹¶ä¸”å…·å¤‡é•¿åº¦å¯å˜ã€æœ‰åºç­‰ç‰¹å¾ã€‚ ç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984923322.png" alt="1653984923322" tabindex="0" loading="lazy"><figcaption>1653984923322</figcaption></figure><p>å…¶ä¸­çš„encodingåŒ…å«ä¸‰ç§æ¨¡å¼ï¼Œè¡¨ç¤ºå­˜å‚¨çš„æ•´æ•°å¤§å°ä¸åŒï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984942385.png" alt="1653984942385" tabindex="0" loading="lazy"><figcaption>1653984942385</figcaption></figure><p>ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾ï¼ŒRedisä¼šå°†intsetä¸­æ‰€æœ‰çš„æ•´æ•°æŒ‰ç…§å‡åºä¾æ¬¡ä¿å­˜åœ¨contentsæ•°ç»„ä¸­ï¼Œç»“æ„å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985149557.png" alt="1653985149557" tabindex="0" loading="lazy"><figcaption>1653985149557</figcaption></figure><p>ç°åœ¨ï¼Œæ•°ç»„ä¸­æ¯ä¸ªæ•°å­—éƒ½åœ¨int16_tçš„èŒƒå›´å†…ï¼Œå› æ­¤é‡‡ç”¨çš„ç¼–ç æ–¹å¼æ˜¯INTSET_ENC_INT16ï¼Œæ¯éƒ¨åˆ†å ç”¨çš„å­—èŠ‚å¤§å°ä¸ºï¼š encodingï¼š4å­—èŠ‚ lengthï¼š4å­—èŠ‚ contentsï¼š2å­—èŠ‚ * 3 = 6å­—èŠ‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985197214.png" alt="1653985197214" tabindex="0" loading="lazy"><figcaption>1653985197214</figcaption></figure><p>æˆ‘ä»¬å‘è¯¥å…¶ä¸­æ·»åŠ ä¸€ä¸ªæ•°å­—ï¼š50000ï¼Œè¿™ä¸ªæ•°å­—è¶…å‡ºäº†int16_tçš„èŒƒå›´ï¼Œintsetä¼šè‡ªåŠ¨å‡çº§ç¼–ç æ–¹å¼åˆ°åˆé€‚çš„å¤§å°ã€‚ ä»¥å½“å‰æ¡ˆä¾‹æ¥è¯´æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å‡çº§ç¼–ç ä¸ºINTSET_ENC_INT32, æ¯ä¸ªæ•´æ•°å 4å­—èŠ‚ï¼Œå¹¶æŒ‰ç…§æ–°çš„ç¼–ç æ–¹å¼åŠå…ƒç´ ä¸ªæ•°æ‰©å®¹æ•°ç»„</li><li>å€’åºä¾æ¬¡å°†æ•°ç»„ä¸­çš„å…ƒç´ æ‹·è´åˆ°æ‰©å®¹åçš„æ­£ç¡®ä½ç½®</li><li>å°†å¾…æ·»åŠ çš„å…ƒç´ æ”¾å…¥æ•°ç»„æœ«å°¾</li><li>æœ€åï¼Œå°†insetçš„encodingå±æ€§æ”¹ä¸ºINTSET_ENC_INT32ï¼Œå°†lengthå±æ€§æ”¹ä¸º4</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985276621.png" alt="1653985276621" tabindex="0" loading="lazy"><figcaption>1653985276621</figcaption></figure><p>æºç å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985304075.png" alt="1653985304075" tabindex="0" loading="lazy"><figcaption>1653985304075</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985327653.png" alt="1653985327653" tabindex="0" loading="lazy"><figcaption>1653985327653</figcaption></figure><p>å°æ€»ç»“ï¼š</p><p>Intsetå¯ä»¥çœ‹åšæ˜¯ç‰¹æ®Šçš„æ•´æ•°æ•°ç»„ï¼Œå…·å¤‡ä¸€äº›ç‰¹ç‚¹ï¼š</p><ul><li>Redisä¼šç¡®ä¿Intsetä¸­çš„å…ƒç´ å”¯ä¸€ã€æœ‰åº</li><li>å…·å¤‡ç±»å‹å‡çº§æœºåˆ¶ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´</li><li>åº•å±‚é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾æ–¹å¼æ¥æŸ¥è¯¢</li></ul><h3 id="_1-3-redisæ•°æ®ç»“æ„-dict" tabindex="-1"><a class="header-anchor" href="#_1-3-redisæ•°æ®ç»“æ„-dict"><span>1.3 Redisæ•°æ®ç»“æ„-Dict</span></a></h3><p>æˆ‘ä»¬çŸ¥é“Redisæ˜¯ä¸€ä¸ªé”®å€¼å‹ï¼ˆKey-Value Pairï¼‰çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®é”®å®ç°å¿«é€Ÿçš„å¢åˆ æ”¹æŸ¥ã€‚è€Œé”®ä¸å€¼çš„æ˜ å°„å…³ç³»æ­£æ˜¯é€šè¿‡Dictæ¥å®ç°çš„ã€‚ Dictç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šå“ˆå¸Œè¡¨ï¼ˆDictHashTableï¼‰ã€å“ˆå¸ŒèŠ‚ç‚¹ï¼ˆDictEntryï¼‰ã€å­—å…¸ï¼ˆDictï¼‰</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985396560.png" alt="1653985396560" tabindex="0" loading="lazy"><figcaption>1653985396560</figcaption></figure><p>å½“æˆ‘ä»¬å‘Dictæ·»åŠ é”®å€¼å¯¹æ—¶ï¼ŒRedisé¦–å…ˆæ ¹æ®keyè®¡ç®—å‡ºhashå€¼ï¼ˆhï¼‰ï¼Œç„¶ååˆ©ç”¨ h &amp; sizemaskæ¥è®¡ç®—å…ƒç´ åº”è¯¥å­˜å‚¨åˆ°æ•°ç»„ä¸­çš„å“ªä¸ªç´¢å¼•ä½ç½®ã€‚æˆ‘ä»¬å­˜å‚¨k1=v1ï¼Œå‡è®¾k1çš„å“ˆå¸Œå€¼h =1ï¼Œåˆ™1&amp;3 =1ï¼Œå› æ­¤k1=v1è¦å­˜å‚¨åˆ°æ•°ç»„è§’æ ‡1ä½ç½®ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985497735.png" alt="1653985497735" tabindex="0" loading="lazy"><figcaption>1653985497735</figcaption></figure><p>Dictç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šå“ˆå¸Œè¡¨ï¼ˆDictHashTableï¼‰ã€å“ˆå¸ŒèŠ‚ç‚¹ï¼ˆDictEntryï¼‰ã€å­—å…¸ï¼ˆDictï¼‰</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985570612.png" alt="1653985570612" tabindex="0" loading="lazy"><figcaption>1653985570612</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985586543.png" alt="1653985586543" tabindex="0" loading="lazy"><figcaption>1653985586543</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985640422.png" alt="1653985640422" tabindex="0" loading="lazy"><figcaption>1653985640422</figcaption></figure><p><strong>Dictçš„æ‰©å®¹</strong></p><p>Dictä¸­çš„HashTableå°±æ˜¯æ•°ç»„ç»“åˆå•å‘é“¾è¡¨çš„å®ç°ï¼Œå½“é›†åˆä¸­å…ƒç´ è¾ƒå¤šæ—¶ï¼Œå¿…ç„¶å¯¼è‡´å“ˆå¸Œå†²çªå¢å¤šï¼Œé“¾è¡¨è¿‡é•¿ï¼Œåˆ™æŸ¥è¯¢æ•ˆç‡ä¼šå¤§å¤§é™ä½ã€‚ Dictåœ¨æ¯æ¬¡æ–°å¢é”®å€¼å¯¹æ—¶éƒ½ä¼šæ£€æŸ¥è´Ÿè½½å› å­ï¼ˆLoadFactor = used/sizeï¼‰ ï¼Œæ»¡è¶³ä»¥ä¸‹ä¸¤ç§æƒ…å†µæ—¶ä¼šè§¦å‘å“ˆå¸Œè¡¨æ‰©å®¹ï¼š å“ˆå¸Œè¡¨çš„ LoadFactor &gt;= 1ï¼Œå¹¶ä¸”æœåŠ¡å™¨æ²¡æœ‰æ‰§è¡Œ BGSAVE æˆ–è€… BGREWRITEAOF ç­‰åå°è¿›ç¨‹ï¼› å“ˆå¸Œè¡¨çš„ LoadFactor &gt; 5 ï¼›</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985716275.png" alt="1653985716275" tabindex="0" loading="lazy"><figcaption>1653985716275</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985743412.png" alt="1653985743412" tabindex="0" loading="lazy"><figcaption>1653985743412</figcaption></figure><p><strong>Dictçš„rehash</strong></p><p>ä¸ç®¡æ˜¯æ‰©å®¹è¿˜æ˜¯æ”¶ç¼©ï¼Œå¿…å®šä¼šåˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨ï¼Œå¯¼è‡´å“ˆå¸Œè¡¨çš„sizeå’Œsizemaskå˜åŒ–ï¼Œè€Œkeyçš„æŸ¥è¯¢ä¸sizemaskæœ‰å…³ã€‚å› æ­¤å¿…é¡»å¯¹å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸€ä¸ªkeyé‡æ–°è®¡ç®—ç´¢å¼•ï¼Œæ’å…¥æ–°çš„å“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºrehashã€‚è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>è®¡ç®—æ–°hashè¡¨çš„realeSizeï¼Œå€¼å–å†³äºå½“å‰è¦åšçš„æ˜¯æ‰©å®¹è¿˜æ˜¯æ”¶ç¼©ï¼š</p><ul><li>å¦‚æœæ˜¯æ‰©å®¹ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.ht[0].used + 1çš„2^n</li><li>å¦‚æœæ˜¯æ”¶ç¼©ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.ht[0].usedçš„2^n ï¼ˆä¸å¾—å°äº4ï¼‰</li></ul></li><li><p>æŒ‰ç…§æ–°çš„realeSizeç”³è¯·å†…å­˜ç©ºé—´ï¼Œåˆ›å»ºdicthtï¼Œå¹¶èµ‹å€¼ç»™dict.ht[1]</p></li><li><p>è®¾ç½®dict.rehashidx = 0ï¼Œæ ‡ç¤ºå¼€å§‹rehash</p></li><li><p>å°†dict.ht[0]ä¸­çš„æ¯ä¸€ä¸ªdictEntryéƒ½rehashåˆ°dict.ht[1]</p></li><li><p>å°†dict.ht[1]èµ‹å€¼ç»™dict.ht[0]ï¼Œç»™dict.ht[1]åˆå§‹åŒ–ä¸ºç©ºå“ˆå¸Œè¡¨ï¼Œé‡Šæ”¾åŸæ¥çš„dict.ht[0]çš„å†…å­˜</p></li><li><p>å°†rehashidxèµ‹å€¼ä¸º-1ï¼Œä»£è¡¨rehashç»“æŸ</p></li><li><p>åœ¨rehashè¿‡ç¨‹ä¸­ï¼Œæ–°å¢æ“ä½œï¼Œåˆ™ç›´æ¥å†™å…¥ht[1]ï¼ŒæŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤åˆ™ä¼šåœ¨dict.ht[0]å’Œdict.ht[1]ä¾æ¬¡æŸ¥æ‰¾å¹¶æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ht[0]çš„æ•°æ®åªå‡ä¸å¢ï¼Œéšç€rehashæœ€ç»ˆä¸ºç©º</p></li></ul><p>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥æè¿°æˆï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985824540.png" alt="1653985824540" tabindex="0" loading="lazy"><figcaption>1653985824540</figcaption></figure><p>å°æ€»ç»“ï¼š</p><p>Dictçš„ç»“æ„ï¼š</p><ul><li>ç±»ä¼¼javaçš„HashTableï¼Œåº•å±‚æ˜¯æ•°ç»„åŠ é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çª</li><li>DictåŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œht[0]å¹³å¸¸ç”¨ï¼Œht[1]ç”¨æ¥rehash</li></ul><p>Dictçš„ä¼¸ç¼©ï¼š</p><ul><li>å½“LoadFactorå¤§äº5æˆ–è€…LoadFactorå¤§äº1å¹¶ä¸”æ²¡æœ‰å­è¿›ç¨‹ä»»åŠ¡æ—¶ï¼ŒDictæ‰©å®¹</li><li>å½“LoadFactorå°äº0.1æ—¶ï¼ŒDictæ”¶ç¼©</li><li>æ‰©å®¹å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºused + 1çš„2^n</li><li>æ”¶ç¼©å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºused çš„2^n</li><li>Dicté‡‡ç”¨æ¸è¿›å¼rehashï¼Œæ¯æ¬¡è®¿é—®Dictæ—¶æ‰§è¡Œä¸€æ¬¡rehash</li><li>rehashæ—¶ht[0]åªå‡ä¸å¢ï¼Œæ–°å¢æ“ä½œåªåœ¨ht[1]æ‰§è¡Œï¼Œå…¶å®ƒæ“ä½œåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨</li></ul><h3 id="_1-4-redisæ•°æ®ç»“æ„-ziplist" tabindex="-1"><a class="header-anchor" href="#_1-4-redisæ•°æ®ç»“æ„-ziplist"><span>1.4 Redisæ•°æ®ç»“æ„-ZipList</span></a></h3><p>ZipList æ˜¯ä¸€ç§ç‰¹æ®Šçš„â€œåŒç«¯é“¾è¡¨â€ ï¼Œç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆã€‚å¯ä»¥åœ¨ä»»æ„ä¸€ç«¯è¿›è¡Œå‹å…¥/å¼¹å‡ºæ“ä½œ, å¹¶ä¸”è¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653985987327.png" alt="1653985987327" tabindex="0" loading="lazy"><figcaption>1653985987327</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986020491.png" alt="1653986020491" tabindex="0" loading="lazy"><figcaption>1653986020491</figcaption></figure><table><thead><tr><th><strong>å±æ€§</strong></th><th><strong>ç±»å‹</strong></th><th><strong>é•¿åº¦</strong></th><th><strong>ç”¨é€”</strong></th></tr></thead><tbody><tr><td>zlbytes</td><td>uint32_t</td><td>4 å­—èŠ‚</td><td>è®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°</td></tr><tr><td>zltail</td><td>uint32_t</td><td>4 å­—èŠ‚</td><td>è®°å½•å‹ç¼©åˆ—è¡¨è¡¨å°¾èŠ‚ç‚¹è·ç¦»å‹ç¼©åˆ—è¡¨çš„èµ·å§‹åœ°å€æœ‰å¤šå°‘å­—èŠ‚ï¼Œé€šè¿‡è¿™ä¸ªåç§»é‡ï¼Œå¯ä»¥ç¡®å®šè¡¨å°¾èŠ‚ç‚¹çš„åœ°å€ã€‚</td></tr><tr><td>zllen</td><td>uint16_t</td><td>2 å­—èŠ‚</td><td>è®°å½•äº†å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ã€‚ æœ€å¤§å€¼ä¸ºUINT16_MAX ï¼ˆ65534ï¼‰ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªå€¼ï¼Œæ­¤å¤„ä¼šè®°å½•ä¸º65535ï¼Œä½†èŠ‚ç‚¹çš„çœŸå®æ•°é‡éœ€è¦éå†æ•´ä¸ªå‹ç¼©åˆ—è¡¨æ‰èƒ½è®¡ç®—å¾—å‡ºã€‚</td></tr><tr><td>entry</td><td>åˆ—è¡¨èŠ‚ç‚¹</td><td>ä¸å®š</td><td>å‹ç¼©åˆ—è¡¨åŒ…å«çš„å„ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„é•¿åº¦ç”±èŠ‚ç‚¹ä¿å­˜çš„å†…å®¹å†³å®šã€‚</td></tr><tr><td>zlend</td><td>uint8_t</td><td>1 å­—èŠ‚</td><td>ç‰¹æ®Šå€¼ 0xFF ï¼ˆåè¿›åˆ¶ 255 ï¼‰ï¼Œç”¨äºæ ‡è®°å‹ç¼©åˆ—è¡¨çš„æœ«ç«¯ã€‚</td></tr></tbody></table><p><strong>ZipListEntry</strong></p><p>ZipList ä¸­çš„Entryå¹¶ä¸åƒæ™®é€šé“¾è¡¨é‚£æ ·è®°å½•å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå› ä¸ºè®°å½•ä¸¤ä¸ªæŒ‡é’ˆè¦å ç”¨16ä¸ªå­—èŠ‚ï¼Œæµªè´¹å†…å­˜ã€‚è€Œæ˜¯é‡‡ç”¨äº†ä¸‹é¢çš„ç»“æ„ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986055253.png" alt="1653986055253" tabindex="0" loading="lazy"><figcaption>1653986055253</figcaption></figure><ul><li><p>previous_entry_lengthï¼šå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå 1ä¸ªæˆ–5ä¸ªå­—èŠ‚ã€‚</p><ul><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨1ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼</li><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨5ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0xfeï¼Œåå››ä¸ªå­—èŠ‚æ‰æ˜¯çœŸå®é•¿åº¦æ•°æ®</li></ul></li><li><p>encodingï¼šç¼–ç å±æ€§ï¼Œè®°å½•contentçš„æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼‰ä»¥åŠé•¿åº¦ï¼Œå ç”¨1ä¸ªã€2ä¸ªæˆ–5ä¸ªå­—èŠ‚</p></li><li><p>contentsï¼šè´Ÿè´£ä¿å­˜èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•´æ•°</p></li></ul><p>ZipListä¸­æ‰€æœ‰å­˜å‚¨é•¿åº¦çš„æ•°å€¼å‡é‡‡ç”¨<strong>å°ç«¯å­—èŠ‚åº</strong>ï¼Œå³ä½ä½å­—èŠ‚åœ¨å‰ï¼Œé«˜ä½å­—èŠ‚åœ¨åã€‚ä¾‹å¦‚ï¼šæ•°å€¼0x1234ï¼Œé‡‡ç”¨å°ç«¯å­—èŠ‚åºåå®é™…å­˜å‚¨å€¼ä¸ºï¼š0x3412</p><p><strong>Encodingç¼–ç </strong></p><p>ZipListEntryä¸­çš„encodingç¼–ç åˆ†ä¸ºå­—ç¬¦ä¸²å’Œæ•´æ•°ä¸¤ç§ï¼š å­—ç¬¦ä¸²ï¼šå¦‚æœencodingæ˜¯ä»¥â€œ00â€ã€â€œ01â€æˆ–è€…â€œ10â€å¼€å¤´ï¼Œåˆ™è¯æ˜contentæ˜¯å­—ç¬¦ä¸²</p><table><thead><tr><th><strong>ç¼–ç </strong></th><th><strong>ç¼–ç é•¿åº¦</strong></th><th><strong>å­—ç¬¦ä¸²å¤§å°</strong></th></tr></thead><tbody><tr><td>|00pppppp|</td><td>1 bytes</td><td>&lt;= 63 bytes</td></tr><tr><td>|01pppppp|qqqqqqqq|</td><td>2 bytes</td><td>&lt;= 16383 bytes</td></tr><tr><td>|10000000|qqqqqqqq|rrrrrrrr|ssssssss|tttttttt|</td><td>5 bytes</td><td>&lt;= 4294967295 bytes</td></tr></tbody></table><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦ä¿å­˜å­—ç¬¦ä¸²ï¼šâ€œabâ€å’Œ â€œbcâ€</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986172002.png" alt="1653986172002" tabindex="0" loading="lazy"><figcaption>1653986172002</figcaption></figure><p>ZipListEntryä¸­çš„encodingç¼–ç åˆ†ä¸ºå­—ç¬¦ä¸²å’Œæ•´æ•°ä¸¤ç§ï¼š</p><ul><li>æ•´æ•°ï¼šå¦‚æœencodingæ˜¯ä»¥â€œ11â€å¼€å§‹ï¼Œåˆ™è¯æ˜contentæ˜¯æ•´æ•°ï¼Œä¸”encodingå›ºå®šåªå ç”¨1ä¸ªå­—èŠ‚</li></ul><table><thead><tr><th><strong>ç¼–ç </strong></th><th><strong>ç¼–ç é•¿åº¦</strong></th><th><strong>æ•´æ•°ç±»å‹</strong></th></tr></thead><tbody><tr><td>11000000</td><td>1</td><td>int16_tï¼ˆ2 bytesï¼‰</td></tr><tr><td>11010000</td><td>1</td><td>int32_tï¼ˆ4 bytesï¼‰</td></tr><tr><td>11100000</td><td>1</td><td>int64_tï¼ˆ8 bytesï¼‰</td></tr><tr><td>11110000</td><td>1</td><td>24ä½æœ‰ç¬¦æ•´æ•°(3 bytes)</td></tr><tr><td>11111110</td><td>1</td><td>8ä½æœ‰ç¬¦æ•´æ•°(1 bytes)</td></tr><tr><td>1111xxxx</td><td>1</td><td>ç›´æ¥åœ¨xxxxä½ç½®ä¿å­˜æ•°å€¼ï¼ŒèŒƒå›´ä»0001~1101ï¼Œå‡1åç»“æœä¸ºå®é™…å€¼</td></tr></tbody></table><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986282879.png" alt="1653986282879" tabindex="0" loading="lazy"><figcaption>1653986282879</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986217182.png" alt="1653986217182" tabindex="0" loading="lazy"><figcaption>1653986217182</figcaption></figure><h3 id="_1-5-redisæ•°æ®ç»“æ„-ziplistçš„è¿é”æ›´æ–°é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_1-5-redisæ•°æ®ç»“æ„-ziplistçš„è¿é”æ›´æ–°é—®é¢˜"><span>1.5 Redisæ•°æ®ç»“æ„-ZipListçš„è¿é”æ›´æ–°é—®é¢˜</span></a></h3><p>ZipListçš„æ¯ä¸ªEntryéƒ½åŒ…å«previous_entry_lengthæ¥è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°ï¼Œé•¿åº¦æ˜¯1ä¸ªæˆ–5ä¸ªå­—èŠ‚ï¼š å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨1ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨5ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0xfeï¼Œåå››ä¸ªå­—èŠ‚æ‰æ˜¯çœŸå®é•¿åº¦æ•°æ® ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æœ‰Nä¸ªè¿ç»­çš„ã€é•¿åº¦ä¸º250~253å­—èŠ‚ä¹‹é—´çš„entryï¼Œå› æ­¤entryçš„previous_entry_lengthå±æ€§ç”¨1ä¸ªå­—èŠ‚å³å¯è¡¨ç¤ºï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986328124.png" alt="1653986328124" tabindex="0" loading="lazy"><figcaption>1653986328124</figcaption></figure><p>ZipListè¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹äº§ç”Ÿçš„è¿ç»­å¤šæ¬¡ç©ºé—´æ‰©å±•æ“ä½œç§°ä¹‹ä¸ºè¿é”æ›´æ–°ï¼ˆCascade Updateï¼‰ã€‚æ–°å¢ã€åˆ é™¤éƒ½å¯èƒ½å¯¼è‡´è¿é”æ›´æ–°çš„å‘ç”Ÿã€‚</p><p><strong>å°æ€»ç»“ï¼š</strong></p><p><strong>ZipListç‰¹æ€§ï¼š</strong></p><ul><li>å‹ç¼©åˆ—è¡¨çš„å¯ä»¥çœ‹åšä¸€ç§è¿ç»­å†…å­˜ç©ºé—´çš„&quot;åŒå‘é“¾è¡¨&quot;</li><li>åˆ—è¡¨çš„èŠ‚ç‚¹ä¹‹é—´ä¸æ˜¯é€šè¿‡æŒ‡é’ˆè¿æ¥ï¼Œè€Œæ˜¯è®°å½•ä¸Šä¸€èŠ‚ç‚¹å’Œæœ¬èŠ‚ç‚¹é•¿åº¦æ¥å¯»å€ï¼Œå†…å­˜å ç”¨è¾ƒä½</li><li>å¦‚æœåˆ—è¡¨æ•°æ®è¿‡å¤šï¼Œå¯¼è‡´é“¾è¡¨è¿‡é•¿ï¼Œå¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½</li><li>å¢æˆ–åˆ è¾ƒå¤§æ•°æ®æ—¶æœ‰å¯èƒ½å‘ç”Ÿè¿ç»­æ›´æ–°é—®é¢˜</li></ul><h3 id="_1-6-redisæ•°æ®ç»“æ„-quicklist" tabindex="-1"><a class="header-anchor" href="#_1-6-redisæ•°æ®ç»“æ„-quicklist"><span>1.6 Redisæ•°æ®ç»“æ„-QuickList</span></a></h3><p>é—®é¢˜1ï¼šZipListè™½ç„¶èŠ‚çœå†…å­˜ï¼Œä½†ç”³è¯·å†…å­˜å¿…é¡»æ˜¯è¿ç»­ç©ºé—´ï¼Œå¦‚æœå†…å­˜å ç”¨è¾ƒå¤šï¼Œç”³è¯·å†…å­˜æ•ˆç‡å¾ˆä½ã€‚æ€ä¹ˆåŠï¼Ÿ</p><p>â€‹ ç­”ï¼šä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»é™åˆ¶ZipListçš„é•¿åº¦å’Œentryå¤§å°ã€‚</p><p>é—®é¢˜2ï¼šä½†æ˜¯æˆ‘ä»¬è¦å­˜å‚¨å¤§é‡æ•°æ®ï¼Œè¶…å‡ºäº†ZipListæœ€ä½³çš„ä¸Šé™è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>â€‹ ç­”ï¼šæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªZipListæ¥åˆ†ç‰‡å­˜å‚¨æ•°æ®ã€‚</p><p>é—®é¢˜3ï¼šæ•°æ®æ‹†åˆ†åæ¯”è¾ƒåˆ†æ•£ï¼Œä¸æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ï¼Œè¿™å¤šä¸ªZipListå¦‚ä½•å»ºç«‹è”ç³»ï¼Ÿ</p><p>â€‹ ç­”ï¼šRedisåœ¨3.2ç‰ˆæœ¬å¼•å…¥äº†æ–°çš„æ•°æ®ç»“æ„QuickListï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒç«¯é“¾è¡¨ï¼Œåªä¸è¿‡é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªZipListã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986474927.png" alt="1653986474927" tabindex="0" loading="lazy"><figcaption>1653986474927</figcaption></figure><p>ä¸ºäº†é¿å…QuickListä¸­çš„æ¯ä¸ªZipListä¸­entryè¿‡å¤šï¼ŒRedisæä¾›äº†ä¸€ä¸ªé…ç½®é¡¹ï¼šlist-max-ziplist-sizeæ¥é™åˆ¶ã€‚ å¦‚æœå€¼ä¸ºæ­£ï¼Œåˆ™ä»£è¡¨ZipListçš„å…è®¸çš„entryä¸ªæ•°çš„æœ€å¤§å€¼ å¦‚æœå€¼ä¸ºè´Ÿï¼Œåˆ™ä»£è¡¨ZipListçš„æœ€å¤§å†…å­˜å¤§å°ï¼Œåˆ†5ç§æƒ…å†µï¼š</p><ul><li>-1ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡4kb</li><li>-2ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡8kb</li><li>-3ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡16kb</li><li>-4ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡32kb</li><li>-5ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡64kb</li></ul><p>å…¶é»˜è®¤å€¼ä¸º -2ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986642777.png" alt="1653986642777" tabindex="0" loading="lazy"><figcaption>1653986642777</figcaption></figure><p>ä»¥ä¸‹æ˜¯QuickListçš„å’ŒQuickListNodeçš„ç»“æ„æºç ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986667228.png" alt="1653986667228" tabindex="0" loading="lazy"><figcaption>1653986667228</figcaption></figure><p>æˆ‘ä»¬æ¥ä¸‹æ¥ç”¨ä¸€æ®µæµç¨‹å›¾æ¥æè¿°å½“å‰çš„è¿™ä¸ªç»“æ„</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986718554.png" alt="1653986718554" tabindex="0" loading="lazy"><figcaption>1653986718554</figcaption></figure><p>æ€»ç»“ï¼š</p><p>QuickListçš„ç‰¹ç‚¹ï¼š</p><ul><li>æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ºZipListçš„åŒç«¯é“¾è¡¨</li><li>èŠ‚ç‚¹é‡‡ç”¨ZipListï¼Œè§£å†³äº†ä¼ ç»Ÿé“¾è¡¨çš„å†…å­˜å ç”¨é—®é¢˜</li><li>æ§åˆ¶äº†ZipListå¤§å°ï¼Œè§£å†³è¿ç»­å†…å­˜ç©ºé—´ç”³è¯·æ•ˆç‡é—®é¢˜</li><li>ä¸­é—´èŠ‚ç‚¹å¯ä»¥å‹ç¼©ï¼Œè¿›ä¸€æ­¥èŠ‚çœäº†å†…å­˜</li></ul><p>1.7 Redisæ•°æ®ç»“æ„-SkipList</p><p>SkipListï¼ˆè·³è¡¨ï¼‰é¦–å…ˆæ˜¯é“¾è¡¨ï¼Œä½†ä¸ä¼ ç»Ÿé“¾è¡¨ç›¸æ¯”æœ‰å‡ ç‚¹å·®å¼‚ï¼š å…ƒç´ æŒ‰ç…§å‡åºæ’åˆ—å­˜å‚¨ èŠ‚ç‚¹å¯èƒ½åŒ…å«å¤šä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆè·¨åº¦ä¸åŒã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986771309.png" alt="1653986771309" tabindex="0" loading="lazy"><figcaption>1653986771309</figcaption></figure><p>SkipListï¼ˆè·³è¡¨ï¼‰é¦–å…ˆæ˜¯é“¾è¡¨ï¼Œä½†ä¸ä¼ ç»Ÿé“¾è¡¨ç›¸æ¯”æœ‰å‡ ç‚¹å·®å¼‚ï¼š å…ƒç´ æŒ‰ç…§å‡åºæ’åˆ—å­˜å‚¨ èŠ‚ç‚¹å¯èƒ½åŒ…å«å¤šä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆè·¨åº¦ä¸åŒã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986813240.png" alt="1653986813240" tabindex="0" loading="lazy"><figcaption>1653986813240</figcaption></figure><p>SkipListï¼ˆè·³è¡¨ï¼‰é¦–å…ˆæ˜¯é“¾è¡¨ï¼Œä½†ä¸ä¼ ç»Ÿé“¾è¡¨ç›¸æ¯”æœ‰å‡ ç‚¹å·®å¼‚ï¼š å…ƒç´ æŒ‰ç…§å‡åºæ’åˆ—å­˜å‚¨ èŠ‚ç‚¹å¯èƒ½åŒ…å«å¤šä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆè·¨åº¦ä¸åŒã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986877620.png" alt="1653986877620" tabindex="0" loading="lazy"><figcaption>1653986877620</figcaption></figure><p>å°æ€»ç»“ï¼š</p><p>SkipListçš„ç‰¹ç‚¹ï¼š</p><ul><li>è·³è·ƒè¡¨æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«scoreå’Œeleå€¼</li><li>èŠ‚ç‚¹æŒ‰ç…§scoreå€¼æ’åºï¼Œscoreå€¼ä¸€æ ·åˆ™æŒ‰ç…§eleå­—å…¸æ’åº</li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥åŒ…å«å¤šå±‚æŒ‡é’ˆï¼Œå±‚æ•°æ˜¯1åˆ°32ä¹‹é—´çš„éšæœºæ•°</li><li>ä¸åŒå±‚æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„è·¨åº¦ä¸åŒï¼Œå±‚çº§è¶Šé«˜ï¼Œè·¨åº¦è¶Šå¤§</li><li>å¢åˆ æ”¹æŸ¥æ•ˆç‡ä¸çº¢é»‘æ ‘åŸºæœ¬ä¸€è‡´ï¼Œå®ç°å´æ›´ç®€å•</li></ul><h3 id="_1-7-redisæ•°æ®ç»“æ„-redisobject" tabindex="-1"><a class="header-anchor" href="#_1-7-redisæ•°æ®ç»“æ„-redisobject"><span>1.7 Redisæ•°æ®ç»“æ„-RedisObject</span></a></h3><p>Redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹çš„é”®å’Œå€¼éƒ½ä¼šè¢«å°è£…ä¸ºä¸€ä¸ªRedisObjectï¼Œä¹Ÿå«åšRediså¯¹è±¡ï¼Œæºç å¦‚ä¸‹ï¼š</p><p>1ã€ä»€ä¹ˆæ˜¯redisObjectï¼š ä»Redisçš„ä½¿ç”¨è€…çš„è§’åº¦æ¥çœ‹ï¼Œâ¼€ä¸ªRedisèŠ‚ç‚¹åŒ…å«å¤šä¸ªdatabaseï¼ˆéclusteræ¨¡å¼ä¸‹é»˜è®¤æ˜¯16ä¸ªï¼Œclusteræ¨¡å¼ä¸‹åªèƒ½æ˜¯1ä¸ªï¼‰ï¼Œè€Œä¸€ä¸ªdatabaseç»´æŠ¤äº†ä»key spaceåˆ°object spaceçš„æ˜ å°„å…³ç³»ã€‚è¿™ä¸ªæ˜ å°„å…³ç³»çš„keyæ˜¯stringç±»å‹ï¼Œâ½½valueå¯ä»¥æ˜¯å¤šç§æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ï¼š string, list, hashã€setã€sorted setç­‰ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œkeyçš„ç±»å‹å›ºå®šæ˜¯stringï¼Œè€Œvalueå¯èƒ½çš„ç±»å‹æ˜¯å¤šä¸ªã€‚ â½½ä»Rediså†…éƒ¨å®ç°çš„â¾“åº¦æ¥çœ‹ï¼Œdatabaseå†…çš„è¿™ä¸ªæ˜ å°„å…³ç³»æ˜¯ç”¨â¼€ä¸ªdictæ¥ç»´æŠ¤çš„ã€‚dictçš„keyå›ºå®šç”¨â¼€ç§æ•°æ®ç»“æ„æ¥è¡¨è¾¾å°±å¤Ÿäº†ï¼Œè¿™å°±æ˜¯åŠ¨æ€å­—ç¬¦ä¸²sdsã€‚è€Œvalueåˆ™æ¯”è¾ƒå¤æ‚ï¼Œä¸ºäº†åœ¨åŒâ¼€ä¸ªdictå†…èƒ½å¤Ÿå­˜å‚¨ä¸åŒç±»å‹çš„valueï¼Œè¿™å°±éœ€è¦â¼€ä¸ªé€šâ½¤çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªé€šç”¨çš„æ•°æ®ç»“æ„å°±æ˜¯robjï¼Œå…¨åæ˜¯redisObjectã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653986956618.png" alt="1653986956618" tabindex="0" loading="lazy"><figcaption>1653986956618</figcaption></figure><p>Redisçš„ç¼–ç æ–¹å¼</p><p>Redisä¸­ä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œå…±åŒ…å«11ç§ä¸åŒç±»å‹ï¼š</p><table><thead><tr><th><strong>ç¼–å·</strong></th><th><strong>ç¼–ç æ–¹å¼</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>0</td><td>OBJ_ENCODING_RAW</td><td>rawç¼–ç åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>1</td><td>OBJ_ENCODING_INT</td><td>longç±»å‹çš„æ•´æ•°çš„å­—ç¬¦ä¸²</td></tr><tr><td>2</td><td>OBJ_ENCODING_HT</td><td>hashè¡¨ï¼ˆå­—å…¸dictï¼‰</td></tr><tr><td>3</td><td>OBJ_ENCODING_ZIPMAP</td><td>å·²åºŸå¼ƒ</td></tr><tr><td>4</td><td>OBJ_ENCODING_LINKEDLIST</td><td>åŒç«¯é“¾è¡¨</td></tr><tr><td>5</td><td>OBJ_ENCODING_ZIPLIST</td><td>å‹ç¼©åˆ—è¡¨</td></tr><tr><td>6</td><td>OBJ_ENCODING_INTSET</td><td>æ•´æ•°é›†åˆ</td></tr><tr><td>7</td><td>OBJ_ENCODING_SKIPLIST</td><td>è·³è¡¨</td></tr><tr><td>8</td><td>OBJ_ENCODING_EMBSTR</td><td>embstrçš„åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>9</td><td>OBJ_ENCODING_QUICKLIST</td><td>å¿«é€Ÿåˆ—è¡¨</td></tr><tr><td>10</td><td>OBJ_ENCODING_STREAM</td><td>Streamæµ</td></tr></tbody></table><p>äº”ç§æ•°æ®ç»“æ„</p><p>Redisä¸­ä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„ç¼–ç æ–¹å¼ã€‚æ¯ç§æ•°æ®ç±»å‹çš„ä½¿ç”¨çš„ç¼–ç æ–¹å¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>ç¼–ç æ–¹å¼</strong></th></tr></thead><tbody><tr><td>OBJ_STRING</td><td>intã€embstrã€raw</td></tr><tr><td>OBJ_LIST</td><td>LinkedListå’ŒZipList(3.2ä»¥å‰)ã€QuickListï¼ˆ3.2ä»¥åï¼‰</td></tr><tr><td>OBJ_SET</td><td>intsetã€HT</td></tr><tr><td>OBJ_ZSET</td><td>ZipListã€HTã€SkipList</td></tr><tr><td>OBJ_HASH</td><td>ZipListã€HT</td></tr></tbody></table><h3 id="_1-8-redisæ•°æ®ç»“æ„-string" tabindex="-1"><a class="header-anchor" href="#_1-8-redisæ•°æ®ç»“æ„-string"><span>1.8 Redisæ•°æ®ç»“æ„-String</span></a></h3><p>Stringæ˜¯Redisä¸­æœ€å¸¸è§çš„æ•°æ®å­˜å‚¨ç±»å‹ï¼š</p><p>å…¶åŸºæœ¬ç¼–ç æ–¹å¼æ˜¯RAWï¼ŒåŸºäºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰å®ç°ï¼Œå­˜å‚¨ä¸Šé™ä¸º512mbã€‚</p><p>å¦‚æœå­˜å‚¨çš„SDSé•¿åº¦å°äº44å­—èŠ‚ï¼Œåˆ™ä¼šé‡‡ç”¨EMBSTRç¼–ç ï¼Œæ­¤æ—¶object headä¸SDSæ˜¯ä¸€æ®µè¿ç»­ç©ºé—´ã€‚ç”³è¯·å†…å­˜æ—¶</p><p>åªéœ€è¦è°ƒç”¨ä¸€æ¬¡å†…å­˜åˆ†é…å‡½æ•°ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p><p>ï¼ˆ1ï¼‰åº•å±‚å®ç°â½…å¼ï¼šåŠ¨æ€å­—ç¬¦ä¸²sds æˆ–è€… long Stringçš„å†…éƒ¨å­˜å‚¨ç»“æ„â¼€èˆ¬æ˜¯sdsï¼ˆSimple Dynamic Stringï¼Œå¯ä»¥åŠ¨æ€æ‰©å±•å†…å­˜ï¼‰ï¼Œä½†æ˜¯å¦‚æœâ¼€ä¸ªStringç±»å‹çš„valueçš„å€¼æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆRediså†…éƒ¨ä¼šæŠŠå®ƒè½¬æˆlongç±»å‹æ¥å­˜å‚¨ï¼Œä»â½½å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987103450.png" alt="1653987103450" tabindex="0" loading="lazy"><figcaption>1653987103450</figcaption></figure><p>å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²æ˜¯æ•´æ•°å€¼ï¼Œå¹¶ä¸”å¤§å°åœ¨LONG_MAXèŒƒå›´å†…ï¼Œåˆ™ä¼šé‡‡ç”¨INTç¼–ç ï¼šç›´æ¥å°†æ•°æ®ä¿å­˜åœ¨RedisObjectçš„ptræŒ‡é’ˆä½ç½®ï¼ˆåˆšå¥½8å­—èŠ‚ï¼‰ï¼Œä¸å†éœ€è¦SDSäº†ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987159575.png" alt="1653987159575" tabindex="0" loading="lazy"><figcaption>1653987159575</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987172764.png" alt="1653987172764" tabindex="0" loading="lazy"><figcaption>1653987172764</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987202522.png" alt="1653987202522" tabindex="0" loading="lazy"><figcaption>1653987202522</figcaption></figure><p>ç¡®åˆ‡åœ°è¯´ï¼ŒStringåœ¨Redisä¸­æ˜¯â½¤â¼€ä¸ªrobjæ¥è¡¨ç¤ºçš„ã€‚</p><p>ç”¨æ¥è¡¨ç¤ºStringçš„robjå¯èƒ½ç¼–ç æˆ3ç§å†…éƒ¨è¡¨â½°ï¼šOBJ_ENCODING_RAWï¼ŒOBJ_ENCODING_EMBSTRï¼ŒOBJ_ENCODING_INTã€‚ å…¶ä¸­å‰ä¸¤ç§ç¼–ç ä½¿â½¤çš„æ˜¯sdsæ¥å­˜å‚¨ï¼Œæœ€åâ¼€ç§OBJ_ENCODING_INTç¼–ç ç›´æ¥æŠŠstringå­˜æˆäº†longå‹ã€‚ åœ¨å¯¹stringè¿›è¡Œincr, decrç­‰æ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœå®ƒå†…éƒ¨æ˜¯OBJ_ENCODING_INTç¼–ç ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¡ŒåŠ å‡æ“ä½œï¼›å¦‚æœå®ƒå†…éƒ¨æ˜¯OBJ_ENCODING_RAWæˆ–OBJ_ENCODING_EMBSTRç¼–ç ï¼Œé‚£ä¹ˆRedisä¼šå…ˆè¯•å›¾æŠŠsdså­˜å‚¨çš„å­—ç¬¦ä¸²è½¬æˆlongå‹ï¼Œå¦‚æœèƒ½è½¬æˆåŠŸï¼Œå†è¿›è¡ŒåŠ å‡æ“ä½œã€‚å¯¹â¼€ä¸ªå†…éƒ¨è¡¨ç¤ºæˆlongå‹çš„stringæ‰§è¡Œappend, setbit, getrangeè¿™äº›å‘½ä»¤ï¼Œé’ˆå¯¹çš„ä»ç„¶æ˜¯stringçš„å€¼ï¼ˆå³â¼—è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼‰ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å†…éƒ¨è¡¨â½°çš„longå‹è¿›â¾æ“ä½œã€‚æ¯”å¦‚å­—ç¬¦ä¸²â€32â€ï¼Œå¦‚æœæŒ‰ç…§å­—ç¬¦æ•°ç»„æ¥è§£é‡Šï¼Œå®ƒåŒ…å«ä¸¤ä¸ªå­—ç¬¦ï¼Œå®ƒä»¬çš„ASCIIç åˆ†åˆ«æ˜¯0x33å’Œ0x32ã€‚å½“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤setbit key 7 0çš„æ—¶å€™ï¼Œç›¸å½“äºæŠŠå­—ç¬¦0x33å˜æˆäº†0x32ï¼Œè¿™æ ·å­—ç¬¦ä¸²çš„å€¼å°±å˜æˆäº†â€22â€ã€‚â½½å¦‚æœå°†å­—ç¬¦ä¸²â€32â€æŒ‰ç…§å†…éƒ¨çš„64ä½longå‹æ¥è§£é‡Šï¼Œé‚£ä¹ˆå®ƒæ˜¯0x0000000000000020ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ‰§â¾setbitä½æ“ä½œï¼Œç»“æœå°±å®Œå…¨ä¸å¯¹äº†ã€‚å› æ­¤ï¼Œåœ¨è¿™äº›å‘½ä»¤çš„å®ç°ä¸­ï¼Œä¼šæŠŠlongå‹å…ˆè½¬æˆå­—ç¬¦ä¸²å†è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p><h3 id="_1-9-redisæ•°æ®ç»“æ„-list" tabindex="-1"><a class="header-anchor" href="#_1-9-redisæ•°æ®ç»“æ„-list"><span>1.9 Redisæ•°æ®ç»“æ„-List</span></a></h3><p>Redisçš„Listç±»å‹å¯ä»¥ä»é¦–ã€å°¾æ“ä½œåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987240622.png" alt="1653987240622" tabindex="0" loading="lazy"><figcaption>1653987240622</figcaption></figure><p>å“ªä¸€ä¸ªæ•°æ®ç»“æ„èƒ½æ»¡è¶³ä¸Šè¿°ç‰¹å¾ï¼Ÿ</p><ul><li>LinkedList ï¼šæ™®é€šé“¾è¡¨ï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨è¾ƒé«˜ï¼Œå†…å­˜ç¢ç‰‡è¾ƒå¤š</li><li>ZipList ï¼šå‹ç¼©åˆ—è¡¨ï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨ä½ï¼Œå­˜å‚¨ä¸Šé™ä½</li><li>QuickListï¼šLinkedList + ZipListï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨è¾ƒä½ï¼ŒåŒ…å«å¤šä¸ªZipListï¼Œå­˜å‚¨ä¸Šé™é«˜</li></ul><p>Redisçš„Listç»“æ„ç±»ä¼¼ä¸€ä¸ªåŒç«¯é“¾è¡¨ï¼Œå¯ä»¥ä»é¦–ã€å°¾æ“ä½œåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼š</p><p>åœ¨3.2ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedisé‡‡ç”¨ZipListå’ŒLinkedListæ¥å®ç°Listï¼Œå½“å…ƒç´ æ•°é‡å°äº512å¹¶ä¸”å…ƒç´ å¤§å°å°äº64å­—èŠ‚æ—¶é‡‡ç”¨ZipListç¼–ç ï¼Œè¶…è¿‡åˆ™é‡‡ç”¨LinkedListç¼–ç ã€‚</p><p>åœ¨3.2ç‰ˆæœ¬ä¹‹åï¼ŒRedisç»Ÿä¸€é‡‡ç”¨QuickListæ¥å®ç°Listï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987313461.png" alt="1653987313461" tabindex="0" loading="lazy"><figcaption>1653987313461</figcaption></figure><h3 id="_2-0-redisæ•°æ®ç»“æ„-setç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-0-redisæ•°æ®ç»“æ„-setç»“æ„"><span>2.0 Redisæ•°æ®ç»“æ„-Setç»“æ„</span></a></h3><p>Setæ˜¯Redisä¸­çš„å•åˆ—é›†åˆï¼Œæ»¡è¶³ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><ul><li>ä¸ä¿è¯æœ‰åºæ€§</li><li>ä¿è¯å…ƒç´ å”¯ä¸€</li><li>æ±‚äº¤é›†ã€å¹¶é›†ã€å·®é›†</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987342550.png" alt="1653987342550" tabindex="0" loading="lazy"><figcaption>1653987342550</figcaption></figure><p>å¯ä»¥çœ‹å‡ºï¼ŒSetå¯¹æŸ¥è¯¢å…ƒç´ çš„æ•ˆç‡è¦æ±‚éå¸¸é«˜ï¼Œæ€è€ƒä¸€ä¸‹ï¼Œä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„å¯ä»¥æ»¡è¶³ï¼Ÿ HashTableï¼Œä¹Ÿå°±æ˜¯Redisä¸­çš„Dictï¼Œä¸è¿‡Dictæ˜¯åŒåˆ—é›†åˆï¼ˆå¯ä»¥å­˜é”®ã€å€¼å¯¹ï¼‰</p><p>Setæ˜¯Redisä¸­çš„é›†åˆï¼Œä¸ä¸€å®šç¡®ä¿å…ƒç´ æœ‰åºï¼Œå¯ä»¥æ»¡è¶³å…ƒç´ å”¯ä¸€ã€æŸ¥è¯¢æ•ˆç‡è¦æ±‚æé«˜ã€‚ ä¸ºäº†æŸ¥è¯¢æ•ˆç‡å’Œå”¯ä¸€æ€§ï¼Œseté‡‡ç”¨HTç¼–ç ï¼ˆDictï¼‰ã€‚Dictä¸­çš„keyç”¨æ¥å­˜å‚¨å…ƒç´ ï¼Œvalueç»Ÿä¸€ä¸ºnullã€‚ å½“å­˜å‚¨çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯æ•´æ•°ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡ä¸è¶…è¿‡set-max-intset-entriesæ—¶ï¼ŒSetä¼šé‡‡ç”¨IntSetç¼–ç ï¼Œä»¥èŠ‚çœå†…å­˜</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987388177.png" alt="1653987388177" tabindex="0" loading="lazy"><figcaption>1653987388177</figcaption></figure><p>ç»“æ„å¦‚ä¸‹ï¼š</p><p>â€‹ <img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653987454403.png" alt="1653987454403" loading="lazy"></p><h3 id="_2-1ã€redisæ•°æ®ç»“æ„-zset" tabindex="-1"><a class="header-anchor" href="#_2-1ã€redisæ•°æ®ç»“æ„-zset"><span>2.1ã€Redisæ•°æ®ç»“æ„-ZSET</span></a></h3><p>ZSetä¹Ÿå°±æ˜¯SortedSetï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªscoreå€¼å’Œmemberå€¼ï¼š</p><ul><li>å¯ä»¥æ ¹æ®scoreå€¼æ’åºå</li><li>memberå¿…é¡»å”¯ä¸€</li><li>å¯ä»¥æ ¹æ®memberæŸ¥è¯¢åˆ†æ•°</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992091967.png" alt="1653992091967" tabindex="0" loading="lazy"><figcaption>1653992091967</figcaption></figure><p>å› æ­¤ï¼Œzsetåº•å±‚æ•°æ®ç»“æ„å¿…é¡»æ»¡è¶³é”®å€¼å­˜å‚¨ã€é”®å¿…é¡»å”¯ä¸€ã€å¯æ’åºè¿™å‡ ä¸ªéœ€æ±‚ã€‚ä¹‹å‰å­¦ä¹ çš„å“ªç§ç¼–ç ç»“æ„å¯ä»¥æ»¡è¶³ï¼Ÿ</p><ul><li>SkipListï¼šå¯ä»¥æ’åºï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶å­˜å‚¨scoreå’Œeleå€¼ï¼ˆmemberï¼‰</li><li>HTï¼ˆDictï¼‰ï¼šå¯ä»¥é”®å€¼å­˜å‚¨ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®keyæ‰¾value</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992121692.png" alt="1653992121692" tabindex="0" loading="lazy"><figcaption>1653992121692</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992172526.png" alt="1653992172526" tabindex="0" loading="lazy"><figcaption>1653992172526</figcaption></figure><p>å½“å…ƒç´ æ•°é‡ä¸å¤šæ—¶ï¼ŒHTå’ŒSkipListçš„ä¼˜åŠ¿ä¸æ˜æ˜¾ï¼Œè€Œä¸”æ›´è€—å†…å­˜ã€‚å› æ­¤zsetè¿˜ä¼šé‡‡ç”¨ZipListç»“æ„æ¥èŠ‚çœå†…å­˜ï¼Œä¸è¿‡éœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>å…ƒç´ æ•°é‡å°äºzset_max_ziplist_entriesï¼Œé»˜è®¤å€¼128</li><li>æ¯ä¸ªå…ƒç´ éƒ½å°äºzset_max_ziplist_valueå­—èŠ‚ï¼Œé»˜è®¤å€¼64</li></ul><p>ziplistæœ¬èº«æ²¡æœ‰æ’åºåŠŸèƒ½ï¼Œè€Œä¸”æ²¡æœ‰é”®å€¼å¯¹çš„æ¦‚å¿µï¼Œå› æ­¤éœ€è¦æœ‰zseté€šè¿‡ç¼–ç å®ç°ï¼š</p><ul><li>ZipListæ˜¯è¿ç»­å†…å­˜ï¼Œå› æ­¤scoreå’Œelementæ˜¯ç´§æŒ¨åœ¨ä¸€èµ·çš„ä¸¤ä¸ªentryï¼Œ elementåœ¨å‰ï¼Œscoreåœ¨å</li><li>scoreè¶Šå°è¶Šæ¥è¿‘é˜Ÿé¦–ï¼Œscoreè¶Šå¤§è¶Šæ¥è¿‘é˜Ÿå°¾ï¼ŒæŒ‰ç…§scoreå€¼å‡åºæ’åˆ—</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992238097.png" alt="1653992238097" tabindex="0" loading="lazy"><figcaption>1653992238097</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992299740.png" alt="1653992299740" tabindex="0" loading="lazy"><figcaption>1653992299740</figcaption></figure><h3 id="_2-2-ã€redisæ•°æ®ç»“æ„-hash" tabindex="-1"><a class="header-anchor" href="#_2-2-ã€redisæ•°æ®ç»“æ„-hash"><span>2.2 ã€Redisæ•°æ®ç»“æ„-Hash</span></a></h3><p>Hashç»“æ„ä¸Redisä¸­çš„Zsetéå¸¸ç±»ä¼¼ï¼š</p><ul><li>éƒ½æ˜¯é”®å€¼å­˜å‚¨</li><li>éƒ½éœ€æ±‚æ ¹æ®é”®è·å–å€¼</li><li>é”®å¿…é¡»å”¯ä¸€</li></ul><p>åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>zsetçš„é”®æ˜¯memberï¼Œå€¼æ˜¯scoreï¼›hashçš„é”®å’Œå€¼éƒ½æ˜¯ä»»æ„å€¼</li><li>zsetè¦æ ¹æ®scoreæ’åºï¼›hashåˆ™æ— éœ€æ’åº</li></ul><p>ï¼ˆ1ï¼‰åº•å±‚å®ç°æ–¹å¼ï¼šå‹ç¼©åˆ—è¡¨ziplist æˆ–è€… å­—å…¸dict å½“Hashä¸­æ•°æ®é¡¹æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ŒHashåº•å±‚æ‰â½¤å‹ç¼©åˆ—è¡¨ziplistè¿›â¾å­˜å‚¨æ•°æ®ï¼Œéšç€æ•°æ®çš„å¢åŠ ï¼Œåº•å±‚çš„ziplistå°±å¯èƒ½ä¼šè½¬æˆdictï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p><p>hash-max-ziplist-entries 512</p><p>hash-max-ziplist-value 64</p><p>å½“æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶å…¶ä¸­ä¹‹â¼€çš„æ—¶å€™ï¼ŒRediså°±ä½¿â½¤dictå­—å…¸æ¥å®ç°hashã€‚ Redisçš„hashä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡ï¼Œæ˜¯å› ä¸ºå½“ziplistå˜å¾—å¾ˆâ¼¤çš„æ—¶å€™ï¼Œå®ƒæœ‰å¦‚ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š</p><ul><li>æ¯æ¬¡æ’â¼Šæˆ–ä¿®æ”¹å¼•å‘çš„reallocæ“ä½œä¼šæœ‰æ›´â¼¤çš„æ¦‚ç‡é€ æˆå†…å­˜æ‹·è´ï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚</li><li>â¼€æ—¦å‘ç”Ÿå†…å­˜æ‹·è´ï¼Œå†…å­˜æ‹·è´çš„æˆæœ¬ä¹Ÿç›¸åº”å¢åŠ ï¼Œå› ä¸ºè¦æ‹·è´æ›´â¼¤çš„â¼€å—æ•°æ®ã€‚</li><li>å½“ziplistæ•°æ®é¡¹è¿‡å¤šçš„æ—¶å€™ï¼Œåœ¨å®ƒä¸Šâ¾¯æŸ¥æ‰¾æŒ‡å®šçš„æ•°æ®é¡¹å°±ä¼šæ€§èƒ½å˜å¾—å¾ˆä½ï¼Œå› ä¸ºziplistä¸Šçš„æŸ¥æ‰¾éœ€è¦è¿›è¡Œéå†ã€‚</li></ul><p>æ€»ä¹‹ï¼Œziplistæœ¬æ¥å°±è®¾è®¡ä¸ºå„ä¸ªæ•°æ®é¡¹æŒ¨åœ¨â¼€èµ·ç»„æˆè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè¿™ç§ç»“æ„å¹¶ä¸æ“…é•¿åšä¿®æ”¹æ“ä½œã€‚â¼€æ—¦æ•°æ®å‘â½£æ”¹åŠ¨ï¼Œå°±ä¼šå¼•å‘å†…å­˜reallocï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ‹·è´ã€‚</p><p>hashç»“æ„å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992339937.png" alt="1653992339937" tabindex="0" loading="lazy"><figcaption>1653992339937</figcaption></figure><p>zseté›†åˆå¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992360355.png" alt="1653992360355" tabindex="0" loading="lazy"><figcaption>1653992360355</figcaption></figure><p>å› æ­¤ï¼ŒHashåº•å±‚é‡‡ç”¨çš„ç¼–ç ä¸Zsetä¹ŸåŸºæœ¬ä¸€è‡´ï¼Œåªéœ€è¦æŠŠæ’åºæœ‰å…³çš„SkipListå»æ‰å³å¯ï¼š</p><p>Hashç»“æ„é»˜è®¤é‡‡ç”¨ZipListç¼–ç ï¼Œç”¨ä»¥èŠ‚çœå†…å­˜ã€‚ ZipListä¸­ç›¸é‚»çš„ä¸¤ä¸ªentry åˆ†åˆ«ä¿å­˜fieldå’Œvalue</p><p>å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼ŒHashç»“æ„ä¼šè½¬ä¸ºHTç¼–ç ï¼Œä¹Ÿå°±æ˜¯Dictï¼Œè§¦å‘æ¡ä»¶æœ‰ä¸¤ä¸ªï¼š</p><ul><li>ZipListä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†hash-max-ziplist-entriesï¼ˆé»˜è®¤512ï¼‰</li><li>ZipListä¸­çš„ä»»æ„entryå¤§å°è¶…è¿‡äº†hash-max-ziplist-valueï¼ˆé»˜è®¤64å­—èŠ‚ï¼‰</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653992413406.png" alt="1653992413406" tabindex="0" loading="lazy"><figcaption>1653992413406</figcaption></figure><h2 id="_2ã€åŸç†ç¯‡-redisç½‘ç»œæ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_2ã€åŸç†ç¯‡-redisç½‘ç»œæ¨¡å‹"><span>2ã€åŸç†ç¯‡-Redisç½‘ç»œæ¨¡å‹</span></a></h2><h3 id="_2-1-ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸æ€ç©ºé—´" tabindex="-1"><a class="header-anchor" href="#_2-1-ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸æ€ç©ºé—´"><span>2.1 ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸æ€ç©ºé—´</span></a></h3><p>æœåŠ¡å™¨å¤§å¤šéƒ½é‡‡ç”¨Linuxç³»ç»Ÿï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥Linuxä¸ºä¾‹æ¥è®²è§£:</p><p>ubuntuå’ŒCentos éƒ½æ˜¯Linuxçš„å‘è¡Œç‰ˆï¼Œå‘è¡Œç‰ˆå¯ä»¥çœ‹æˆå¯¹linuxåŒ…äº†ä¸€å±‚å£³ï¼Œä»»ä½•Linuxå‘è¡Œç‰ˆï¼Œå…¶ç³»ç»Ÿå†…æ ¸éƒ½æ˜¯Linuxã€‚æˆ‘ä»¬çš„åº”ç”¨éƒ½éœ€è¦é€šè¿‡Linuxå†…æ ¸ä¸ç¡¬ä»¶äº¤äº’</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653844970346.png" alt="1653844970346" tabindex="0" loading="lazy"><figcaption>1653844970346</figcaption></figure><p>ç”¨æˆ·çš„åº”ç”¨ï¼Œæ¯”å¦‚redisï¼Œmysqlç­‰å…¶å®æ˜¯æ²¡æœ‰åŠæ³•å»æ‰§è¡Œè®¿é—®æˆ‘ä»¬æ“ä½œç³»ç»Ÿçš„ç¡¬ä»¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘è¡Œç‰ˆçš„è¿™ä¸ªå£³å­å»è®¿é—®å†…æ ¸ï¼Œå†é€šè¿‡å†…æ ¸å»è®¿é—®è®¡ç®—æœºç¡¬ä»¶</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653845147190.png" alt="1653845147190" tabindex="0" loading="lazy"><figcaption>1653845147190</figcaption></figure><p>è®¡ç®—æœºç¡¬ä»¶åŒ…æ‹¬ï¼Œå¦‚cpuï¼Œå†…å­˜ï¼Œç½‘å¡ç­‰ç­‰ï¼Œå†…æ ¸ï¼ˆé€šè¿‡å¯»å€ç©ºé—´ï¼‰å¯ä»¥æ“ä½œç¡¬ä»¶çš„ï¼Œä½†æ˜¯å†…æ ¸éœ€è¦ä¸åŒè®¾å¤‡çš„é©±åŠ¨ï¼Œæœ‰äº†è¿™äº›é©±åŠ¨ä¹‹åï¼Œå†…æ ¸å°±å¯ä»¥å»å¯¹è®¡ç®—æœºç¡¬ä»¶å»è¿›è¡Œ å†…å­˜ç®¡ç†ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„ç®¡ç†ï¼Œè¿›ç¨‹çš„ç®¡ç†ç­‰ç­‰</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653896065386.png" alt="1653896065386" tabindex="0" loading="lazy"><figcaption>1653896065386</figcaption></figure><p>æˆ‘ä»¬æƒ³è¦ç”¨æˆ·çš„åº”ç”¨æ¥è®¿é—®ï¼Œè®¡ç®—æœºå°±å¿…é¡»è¦é€šè¿‡å¯¹å¤–æš´éœ²çš„ä¸€äº›æ¥å£ï¼Œæ‰èƒ½è®¿é—®åˆ°ï¼Œä»è€Œç®€ä»‹çš„å®ç°å¯¹å†…æ ¸çš„æ“æ§ï¼Œä½†æ˜¯å†…æ ¸æœ¬èº«ä¸Šæ¥è¯´ä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œæ‰€ä»¥ä»–æœ¬èº«ä¹Ÿéœ€è¦ä¸€äº›å†…å­˜ï¼Œcpuç­‰è®¾å¤‡èµ„æºï¼Œç”¨æˆ·åº”ç”¨æœ¬èº«ä¹Ÿåœ¨æ¶ˆè€—è¿™äº›èµ„æºï¼Œå¦‚æœä¸åŠ ä»»ä½•é™åˆ¶ï¼Œç”¨æˆ·å»æ“ä½œéšæ„çš„å»æ“ä½œæˆ‘ä»¬çš„èµ„æºï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä¸€äº›å†²çªï¼Œç”šè‡³æœ‰å¯èƒ½å¯¼è‡´æˆ‘ä»¬çš„ç³»ç»Ÿå‡ºç°æ— æ³•è¿è¡Œçš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·å’Œ<strong>å†…æ ¸éš”ç¦»å¼€</strong></p><p>è¿›ç¨‹çš„å¯»å€ç©ºé—´åˆ’åˆ†æˆä¸¤éƒ¨åˆ†ï¼š<strong>å†…æ ¸ç©ºé—´ã€ç”¨æˆ·ç©ºé—´</strong></p><p>ä»€ä¹ˆæ˜¯å¯»å€ç©ºé—´å‘¢ï¼Ÿæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹Ÿå¥½ï¼Œè¿˜æ˜¯å†…æ ¸ç©ºé—´ä¹Ÿå¥½ï¼Œéƒ½æ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥å»ç‰©ç†å†…å­˜çš„ï¼Œè€Œæ˜¯é€šè¿‡åˆ†é…ä¸€äº›è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œæˆ‘ä»¬çš„å†…æ ¸å’Œåº”ç”¨ç¨‹åºå»è®¿é—®è™šæ‹Ÿå†…å­˜çš„æ—¶å€™ï¼Œå°±éœ€è¦ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ï¼Œæ¯”å¦‚ä¸€ä¸ª32ä½çš„æ“ä½œç³»ç»Ÿï¼Œä»–çš„å¸¦å®½å°±æ˜¯32ï¼Œä»–çš„è™šæ‹Ÿåœ°å€å°±æ˜¯2çš„32æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–å¯»å€çš„èŒƒå›´å°±æ˜¯0~2çš„32æ¬¡æ–¹ï¼Œ è¿™ç‰‡å¯»å€ç©ºé—´å¯¹åº”çš„å°±æ˜¯2çš„32ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯4GBï¼Œè¿™ä¸ª4GBï¼Œä¼šæœ‰3ä¸ªGBåˆ†ç»™ç”¨æˆ·ç©ºé—´ï¼Œä¼šæœ‰1GBç»™å†…æ ¸ç³»ç»Ÿ</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653896377259.png" alt="1653896377259" tabindex="0" loading="lazy"><figcaption>1653896377259</figcaption></figure><p>åœ¨linuxä¸­ï¼Œä»–ä»¬æƒé™åˆ†æˆä¸¤ä¸ªç­‰çº§ï¼Œ0å’Œ3ï¼Œç”¨æˆ·ç©ºé—´åªèƒ½æ‰§è¡Œå—é™çš„å‘½ä»¤ï¼ˆRing3ï¼‰ï¼Œè€Œä¸”ä¸èƒ½ç›´æ¥è°ƒç”¨ç³»ç»Ÿèµ„æºï¼Œå¿…é¡»é€šè¿‡å†…æ ¸æä¾›çš„æ¥å£æ¥è®¿é—®å†…æ ¸ç©ºé—´å¯ä»¥æ‰§è¡Œç‰¹æƒå‘½ä»¤ï¼ˆRing0ï¼‰ï¼Œè°ƒç”¨ä¸€åˆ‡ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„æ“ä½œæ˜¯è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œè€Œå†…æ ¸è¿è¡Œçš„æ•°æ®æ˜¯åœ¨å†…æ ¸ç©ºé—´çš„ï¼Œè€Œæœ‰çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦å»è°ƒç”¨ä¸€äº›ç‰¹æƒèµ„æºï¼Œå»è°ƒç”¨ä¸€äº›å†…æ ¸ç©ºé—´çš„æ“ä½œï¼Œæ‰€ä»¥æ­¤æ—¶ä»–ä¿©éœ€è¦åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚</p><p>æ¯”å¦‚ï¼š</p><p>Linuxç³»ç»Ÿä¸ºäº†æé«˜IOæ•ˆç‡ï¼Œä¼šåœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´éƒ½åŠ å…¥ç¼“å†²åŒºï¼š</p><p>å†™æ•°æ®æ—¶ï¼Œè¦æŠŠç”¨æˆ·ç¼“å†²æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åå†™å…¥è®¾å¤‡</p><p>è¯»æ•°æ®æ—¶ï¼Œè¦ä»è®¾å¤‡è¯»å–æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒº</p><p>é’ˆå¯¹è¿™ä¸ªæ“ä½œï¼šæˆ‘ä»¬çš„ç”¨æˆ·åœ¨å†™è¯»æ•°æ®æ—¶ï¼Œä¼šå»å‘å†…æ ¸æ€ç”³è¯·ï¼Œæƒ³è¦è¯»å–å†…æ ¸çš„æ•°æ®ï¼Œè€Œå†…æ ¸æ•°æ®è¦å»ç­‰å¾…é©±åŠ¨ç¨‹åºä»ç¡¬ä»¶ä¸Šè¯»å–æ•°æ®ï¼Œå½“ä»ç£ç›˜ä¸ŠåŠ è½½åˆ°æ•°æ®ä¹‹åï¼Œå†…æ ¸ä¼šå°†æ•°æ®å†™å…¥åˆ°å†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åå†å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·æ€çš„bufferä¸­ï¼Œç„¶åå†è¿”å›ç»™åº”ç”¨ç¨‹åºï¼Œæ•´ä½“è€Œè¨€ï¼Œé€Ÿåº¦æ…¢ï¼Œå°±æ˜¯è¿™ä¸ªåŸå› ï¼Œä¸ºäº†åŠ é€Ÿï¼Œæˆ‘ä»¬å¸Œæœ›readä¹Ÿå¥½ï¼Œè¿˜æ˜¯wait for dataä¹Ÿæœ€å¥½éƒ½ä¸è¦ç­‰å¾…ï¼Œæˆ–è€…æ—¶é—´å°½é‡çš„çŸ­ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653896687354.png" alt="1653896687354" tabindex="0" loading="lazy"><figcaption>1653896687354</figcaption></figure><h3 id="_2-2-ç½‘ç»œæ¨¡å‹-é˜»å¡io" tabindex="-1"><a class="header-anchor" href="#_2-2-ç½‘ç»œæ¨¡å‹-é˜»å¡io"><span>2.2.ç½‘ç»œæ¨¡å‹-é˜»å¡IO</span></a></h3><p>åœ¨ã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ä¸€ä¹¦ä¸­ï¼Œæ€»ç»“å½’çº³äº†5ç§IOæ¨¡å‹ï¼š</p><ul><li>é˜»å¡IOï¼ˆBlocking IOï¼‰</li><li>éé˜»å¡IOï¼ˆNonblocking IOï¼‰</li><li>IOå¤šè·¯å¤ç”¨ï¼ˆIO Multiplexingï¼‰</li><li>ä¿¡å·é©±åŠ¨IOï¼ˆSignal Driven IOï¼‰</li><li>å¼‚æ­¥IOï¼ˆAsynchronous IOï¼‰</li></ul><p>åº”ç”¨ç¨‹åºæƒ³è¦å»è¯»å–æ•°æ®ï¼Œä»–æ˜¯æ— æ³•ç›´æ¥å»è¯»å–ç£ç›˜æ•°æ®çš„ï¼Œä»–éœ€è¦å…ˆåˆ°å†…æ ¸é‡Œè¾¹å»ç­‰å¾…å†…æ ¸æ“ä½œç¡¬ä»¶æ‹¿åˆ°æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯1ï¼Œæ˜¯éœ€è¦ç­‰å¾…çš„ï¼Œç­‰åˆ°å†…æ ¸ä»ç£ç›˜ä¸ŠæŠŠæ•°æ®åŠ è½½å‡ºæ¥ä¹‹åï¼Œå†æŠŠè¿™ä¸ªæ•°æ®å†™ç»™ç”¨æˆ·çš„ç¼“å­˜åŒºï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯2ï¼Œå¦‚æœæ˜¯é˜»å¡IOï¼Œé‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·ä»å‘èµ·è¯»è¯·æ±‚å¼€å§‹ï¼Œä¸€ç›´åˆ°è¯»å–åˆ°æ•°æ®ï¼Œéƒ½æ˜¯ä¸€ä¸ªé˜»å¡çŠ¶æ€ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653897115346.png" alt="1653897115346" tabindex="0" loading="lazy"><figcaption>1653897115346</figcaption></figure><p>å…·ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p>ç”¨æˆ·å»è¯»å–æ•°æ®æ—¶ï¼Œä¼šå»å…ˆå‘èµ·recvformä¸€ä¸ªå‘½ä»¤ï¼Œå»å°è¯•ä»å†…æ ¸ä¸ŠåŠ è½½æ•°æ®ï¼Œå¦‚æœå†…æ ¸æ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆç”¨æˆ·å°±ä¼šç­‰å¾…ï¼Œæ­¤æ—¶å†…æ ¸ä¼šå»ä»ç¡¬ä»¶ä¸Šè¯»å–æ•°æ®ï¼Œå†…æ ¸è¯»å–æ•°æ®ä¹‹åï¼Œä¼šæŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œå¹¶ä¸”è¿”å›okï¼Œæ•´ä¸ªè¿‡ç¨‹ï¼Œéƒ½æ˜¯é˜»å¡ç­‰å¾…çš„ï¼Œè¿™å°±æ˜¯é˜»å¡IO</p><p>æ€»ç»“å¦‚ä¸‹ï¼š</p><p>é¡¾åæ€ä¹‰ï¼Œé˜»å¡IOå°±æ˜¯ä¸¤ä¸ªé˜¶æ®µéƒ½å¿…é¡»é˜»å¡ç­‰å¾…ï¼š</p><p><strong>é˜¶æ®µä¸€ï¼š</strong></p><ul><li>ç”¨æˆ·è¿›ç¨‹å°è¯•è¯»å–æ•°æ®ï¼ˆæ¯”å¦‚ç½‘å¡æ•°æ®ï¼‰</li><li>æ­¤æ—¶æ•°æ®å°šæœªåˆ°è¾¾ï¼Œå†…æ ¸éœ€è¦ç­‰å¾…æ•°æ®</li><li>æ­¤æ—¶ç”¨æˆ·è¿›ç¨‹ä¹Ÿå¤„äºé˜»å¡çŠ¶æ€</li></ul><p>é˜¶æ®µäºŒï¼š</p><ul><li>æ•°æ®åˆ°è¾¾å¹¶æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œä»£è¡¨å·²å°±ç»ª</li><li>å°†å†…æ ¸æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒº</li><li>æ‹·è´è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹ä¾ç„¶é˜»å¡ç­‰å¾…</li><li>æ‹·è´å®Œæˆï¼Œç”¨æˆ·è¿›ç¨‹è§£é™¤é˜»å¡ï¼Œå¤„ç†æ•°æ®</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œé˜»å¡IOæ¨¡å‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯é˜»å¡çŠ¶æ€ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653897270074.png" alt="1653897270074" tabindex="0" loading="lazy"><figcaption>1653897270074</figcaption></figure><h3 id="_2-3-ç½‘ç»œæ¨¡å‹-éé˜»å¡io" tabindex="-1"><a class="header-anchor" href="#_2-3-ç½‘ç»œæ¨¡å‹-éé˜»å¡io"><span>2.3 ç½‘ç»œæ¨¡å‹-éé˜»å¡IO</span></a></h3><p>é¡¾åæ€ä¹‰ï¼Œéé˜»å¡IOçš„recvfromæ“ä½œä¼šç«‹å³è¿”å›ç»“æœè€Œä¸æ˜¯é˜»å¡ç”¨æˆ·è¿›ç¨‹ã€‚</p><p>é˜¶æ®µä¸€ï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹å°è¯•è¯»å–æ•°æ®ï¼ˆæ¯”å¦‚ç½‘å¡æ•°æ®ï¼‰</li><li>æ­¤æ—¶æ•°æ®å°šæœªåˆ°è¾¾ï¼Œå†…æ ¸éœ€è¦ç­‰å¾…æ•°æ®</li><li>è¿”å›å¼‚å¸¸ç»™ç”¨æˆ·è¿›ç¨‹</li><li>ç”¨æˆ·è¿›ç¨‹æ‹¿åˆ°erroråï¼Œå†æ¬¡å°è¯•è¯»å–</li><li>å¾ªç¯å¾€å¤ï¼Œç›´åˆ°æ•°æ®å°±ç»ª</li></ul><p>é˜¶æ®µäºŒï¼š</p><ul><li>å°†å†…æ ¸æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒº</li><li>æ‹·è´è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹ä¾ç„¶é˜»å¡ç­‰å¾…</li><li>æ‹·è´å®Œæˆï¼Œç”¨æˆ·è¿›ç¨‹è§£é™¤é˜»å¡ï¼Œå¤„ç†æ•°æ®</li><li>å¯ä»¥çœ‹åˆ°ï¼Œéé˜»å¡IOæ¨¡å‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯éé˜»å¡ï¼Œç¬¬äºŒä¸ªé˜¶æ®µæ˜¯é˜»å¡çŠ¶æ€ã€‚è™½ç„¶æ˜¯éé˜»å¡ï¼Œä½†æ€§èƒ½å¹¶æ²¡æœ‰å¾—åˆ°æé«˜ã€‚è€Œä¸”å¿™ç­‰æœºåˆ¶ä¼šå¯¼è‡´CPUç©ºè½¬ï¼ŒCPUä½¿ç”¨ç‡æš´å¢ã€‚</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653897490116.png" alt="1653897490116" tabindex="0" loading="lazy"><figcaption>1653897490116</figcaption></figure><h3 id="_2-4-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-4-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨"><span>2.4 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨</span></a></h3><p>æ— è®ºæ˜¯é˜»å¡IOè¿˜æ˜¯éé˜»å¡IOï¼Œç”¨æˆ·åº”ç”¨åœ¨ä¸€é˜¶æ®µéƒ½éœ€è¦è°ƒç”¨recvfromæ¥è·å–æ•°æ®ï¼Œå·®åˆ«åœ¨äºæ— æ•°æ®æ—¶çš„å¤„ç†æ–¹æ¡ˆï¼š</p><p>å¦‚æœè°ƒç”¨recvfromæ—¶ï¼Œæ°å¥½æ²¡æœ‰æ•°æ®ï¼Œé˜»å¡IOä¼šä½¿CPUé˜»å¡ï¼Œéé˜»å¡IOä½¿CPUç©ºè½¬ï¼Œéƒ½ä¸èƒ½å……åˆ†å‘æŒ¥CPUçš„ä½œç”¨ã€‚ å¦‚æœè°ƒç”¨recvfromæ—¶ï¼Œæ°å¥½æœ‰æ•°æ®ï¼Œåˆ™ç”¨æˆ·è¿›ç¨‹å¯ä»¥ç›´æ¥è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼Œè¯»å–å¹¶å¤„ç†æ•°æ®</p><p>æ‰€ä»¥æ€ä¹ˆçœ‹èµ·æ¥ä»¥ä¸Šä¸¤ç§æ–¹å¼æ€§èƒ½éƒ½ä¸å¥½</p><p>è€Œåœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œåªèƒ½ä¾æ¬¡å¤„ç†IOäº‹ä»¶ï¼Œå¦‚æœæ­£åœ¨å¤„ç†çš„IOäº‹ä»¶æ°å¥½æœªå°±ç»ªï¼ˆæ•°æ®ä¸å¯è¯»æˆ–ä¸å¯å†™ï¼‰ï¼Œçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œæ‰€æœ‰IOäº‹ä»¶éƒ½å¿…é¡»ç­‰å¾…ï¼Œæ€§èƒ½è‡ªç„¶ä¼šå¾ˆå·®ã€‚</p><p>å°±æ¯”å¦‚æœåŠ¡å‘˜ç»™é¡¾å®¢ç‚¹é¤ï¼Œ<strong>åˆ†ä¸¤æ­¥</strong>ï¼š</p><ul><li>é¡¾å®¢æ€è€ƒè¦åƒä»€ä¹ˆï¼ˆç­‰å¾…æ•°æ®å°±ç»ªï¼‰</li><li>é¡¾å®¢æƒ³å¥½äº†ï¼Œå¼€å§‹ç‚¹é¤ï¼ˆè¯»å–æ•°æ®ï¼‰</li></ul><p>è¦æé«˜æ•ˆç‡æœ‰å‡ ç§åŠæ³•ï¼Ÿ</p><p>æ–¹æ¡ˆä¸€ï¼šå¢åŠ æ›´å¤šæœåŠ¡å‘˜ï¼ˆå¤šçº¿ç¨‹ï¼‰ æ–¹æ¡ˆäºŒï¼šä¸æ’é˜Ÿï¼Œè°æƒ³å¥½äº†åƒä»€ä¹ˆï¼ˆæ•°æ®å°±ç»ªäº†ï¼‰ï¼ŒæœåŠ¡å‘˜å°±ç»™è°ç‚¹é¤ï¼ˆç”¨æˆ·åº”ç”¨å°±å»è¯»å–æ•°æ®ï¼‰</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šç”¨æˆ·è¿›ç¨‹å¦‚ä½•çŸ¥é“å†…æ ¸ä¸­æ•°æ®æ˜¯å¦å°±ç»ªå‘¢ï¼Ÿ</p><p>æ‰€ä»¥æ¥ä¸‹æ¥å°±éœ€è¦è¯¦ç»†çš„æ¥è§£å†³å¤šè·¯å¤ç”¨æ¨¡å‹æ˜¯å¦‚ä½•çŸ¥é“åˆ°åº•æ€ä¹ˆçŸ¥é“å†…æ ¸æ•°æ®æ˜¯å¦å°±ç»ªçš„é—®é¢˜äº†</p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³ä¾èµ–äºæå‡ºçš„</p><p>æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰ï¼šç®€ç§°FDï¼Œæ˜¯ä¸€ä¸ªä»0 å¼€å§‹çš„æ— ç¬¦å·æ•´æ•°ï¼Œç”¨æ¥å…³è”Linuxä¸­çš„ä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨Linuxä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼Œä¾‹å¦‚å¸¸è§„æ–‡ä»¶ã€è§†é¢‘ã€ç¡¬ä»¶è®¾å¤‡ç­‰ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ç½‘ç»œå¥—æ¥å­—ï¼ˆSocketï¼‰ã€‚</p><p>é€šè¿‡FDï¼Œæˆ‘ä»¬çš„ç½‘ç»œæ¨¡å‹å¯ä»¥åˆ©ç”¨ä¸€ä¸ªçº¿ç¨‹ç›‘å¬å¤šä¸ªFDï¼Œå¹¶åœ¨æŸä¸ªFDå¯è¯»ã€å¯å†™æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œé¿å…æ— æ•ˆçš„ç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºã€‚</p><p>é˜¶æ®µä¸€ï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨selectï¼ŒæŒ‡å®šè¦ç›‘å¬çš„FDé›†åˆ</li><li>æ ¸ç›‘å¬FDå¯¹åº”çš„å¤šä¸ªsocket</li><li>ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªsocketæ•°æ®å°±ç»ªåˆ™è¿”å›readable</li><li>æ­¤è¿‡ç¨‹ä¸­ç”¨æˆ·è¿›ç¨‹é˜»å¡</li></ul><p>é˜¶æ®µäºŒï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹æ‰¾åˆ°å°±ç»ªçš„socket</li><li>ä¾æ¬¡è°ƒç”¨recvfromè¯»å–æ•°æ®</li><li>å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</li><li>ç”¨æˆ·è¿›ç¨‹å¤„ç†æ•°æ®</li></ul><p>å½“ç”¨æˆ·å»è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¸å†å»ç›´æ¥è°ƒç”¨recvfromäº†ï¼Œè€Œæ˜¯è°ƒç”¨selectçš„å‡½æ•°ï¼Œselectå‡½æ•°ä¼šå°†éœ€è¦ç›‘å¬çš„æ•°æ®äº¤ç»™å†…æ ¸ï¼Œç”±å†…æ ¸å»æ£€æŸ¥è¿™äº›æ•°æ®æ˜¯å¦å°±ç»ªäº†ï¼Œå¦‚æœè¯´è¿™ä¸ªæ•°æ®å°±ç»ªäº†ï¼Œå°±ä¼šé€šçŸ¥åº”ç”¨ç¨‹åºæ•°æ®å°±ç»ªï¼Œç„¶åæ¥è¯»å–æ•°æ®ï¼Œå†ä»å†…æ ¸ä¸­æŠŠæ•°æ®æ‹·è´ç»™ç”¨æˆ·æ€ï¼Œå®Œæˆæ•°æ®å¤„ç†ï¼Œå¦‚æœNå¤šä¸ªFDä¸€ä¸ªéƒ½æ²¡å¤„ç†å®Œï¼Œæ­¤æ—¶å°±è¿›è¡Œç­‰å¾…ã€‚</p><p>ç”¨IOå¤ç”¨æ¨¡å¼ï¼Œå¯ä»¥ç¡®ä¿å»è¯»æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®æ˜¯ä¸€å®šå­˜åœ¨çš„ï¼Œä»–çš„æ•ˆç‡æ¯”åŸæ¥çš„é˜»å¡IOå’Œéé˜»å¡IOæ€§èƒ½éƒ½è¦é«˜</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653898691736.png" alt="1653898691736" tabindex="0" loading="lazy"><figcaption>1653898691736</figcaption></figure><p>IOå¤šè·¯å¤ç”¨æ˜¯åˆ©ç”¨å•ä¸ªçº¿ç¨‹æ¥åŒæ—¶ç›‘å¬å¤šä¸ªFDï¼Œå¹¶åœ¨æŸä¸ªFDå¯è¯»ã€å¯å†™æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œé¿å…æ— æ•ˆçš„ç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºã€‚ä¸è¿‡ç›‘å¬FDçš„æ–¹å¼ã€é€šçŸ¥çš„æ–¹å¼åˆæœ‰å¤šç§å®ç°ï¼Œå¸¸è§çš„æœ‰ï¼š</p><ul><li>select</li><li>poll</li><li>epoll</li></ul><p>å…¶ä¸­selectå’Œpoolç›¸å½“äºæ˜¯å½“è¢«ç›‘å¬çš„æ•°æ®å‡†å¤‡å¥½ä¹‹åï¼Œä»–ä¼šæŠŠä½ ç›‘å¬çš„FDæ•´ä¸ªæ•°æ®éƒ½å‘ç»™ä½ ï¼Œä½ éœ€è¦åˆ°æ•´ä¸ªFDä¸­å»æ‰¾ï¼Œå“ªäº›æ˜¯å¤„ç†å¥½äº†çš„ï¼Œéœ€è¦é€šè¿‡éå†çš„æ–¹å¼ï¼Œæ‰€ä»¥æ€§èƒ½ä¹Ÿå¹¶ä¸æ˜¯é‚£ä¹ˆå¥½</p><p>è€Œepollï¼Œåˆ™ç›¸å½“äºå†…æ ¸å‡†å¤‡å¥½äº†ä¹‹åï¼Œä»–ä¼šæŠŠå‡†å¤‡å¥½çš„æ•°æ®ï¼Œç›´æ¥å‘ç»™ä½ ï¼Œå’±ä»¬å°±çœå»äº†éå†çš„åŠ¨ä½œã€‚</p><h3 id="_2-5-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨-selectæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2-5-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨-selectæ–¹å¼"><span>2.5 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨-selectæ–¹å¼</span></a></h3><p>selectæ˜¯Linuxæœ€æ—©æ˜¯ç”±çš„I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼š</p><p>ç®€å•è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬æŠŠéœ€è¦å¤„ç†çš„æ•°æ®å°è£…æˆFDï¼Œç„¶ååœ¨ç”¨æˆ·æ€æ—¶åˆ›å»ºä¸€ä¸ªfdçš„é›†åˆï¼ˆè¿™ä¸ªé›†åˆçš„å¤§å°æ˜¯è¦ç›‘å¬çš„é‚£ä¸ªFDçš„æœ€å¤§å€¼+1ï¼Œä½†æ˜¯å¤§å°æ•´ä½“æ˜¯æœ‰é™åˆ¶çš„ ï¼‰ï¼Œè¿™ä¸ªé›†åˆçš„é•¿åº¦å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªé›†åˆä¸­ï¼Œæ ‡æ˜å‡ºæ¥æˆ‘ä»¬è¦æ§åˆ¶å“ªäº›æ•°æ®ï¼Œ</p><p>æ¯”å¦‚è¦ç›‘å¬çš„æ•°æ®ï¼Œæ˜¯1,2,5ä¸‰ä¸ªæ•°æ®ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œselectå‡½æ•°ï¼Œç„¶åå°†æ•´ä¸ªfdå‘ç»™å†…æ ¸æ€ï¼Œå†…æ ¸æ€ä¼šå»éå†ç”¨æˆ·æ€ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œå¦‚æœå‘ç°è¿™é‡Œè¾¹éƒ½æ•°æ®éƒ½æ²¡æœ‰å°±ç»ªï¼Œå°±ä¼‘çœ ï¼Œç›´åˆ°æœ‰æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œå°±ä¼šè¢«å”¤é†’ï¼Œå”¤é†’ä¹‹åï¼Œå†æ¬¡éå†ä¸€éï¼Œçœ‹çœ‹è°å‡†å¤‡å¥½äº†ï¼Œç„¶åå†å°†å¤„ç†æ‰æ²¡æœ‰å‡†å¤‡å¥½çš„æ•°æ®ï¼Œæœ€åå†å°†è¿™ä¸ªFDé›†åˆå†™å›åˆ°ç”¨æˆ·æ€ä¸­å»ï¼Œæ­¤æ—¶ç”¨æˆ·æ€å°±çŸ¥é“äº†ï¼Œå¥¥ï¼Œæœ‰äººå‡†å¤‡å¥½äº†ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·æ€è€Œè¨€ï¼Œå¹¶ä¸çŸ¥é“è°å¤„ç†å¥½äº†ï¼Œæ‰€ä»¥ç”¨æˆ·æ€ä¹Ÿéœ€è¦å»è¿›è¡Œéå†ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”å‡†å¤‡å¥½æ•°æ®çš„èŠ‚ç‚¹ï¼Œå†å»å‘èµ·è¯»è¯·æ±‚ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™ç§æ¨¡å¼ä¸‹ä»–è™½ç„¶æ¯”é˜»å¡IOå’Œéé˜»å¡IOå¥½ï¼Œä½†æ˜¯ä¾ç„¶æœ‰äº›éº»çƒ¦çš„äº‹æƒ…ï¼Œ æ¯”å¦‚è¯´é¢‘ç¹çš„ä¼ é€’fdé›†åˆï¼Œé¢‘ç¹çš„å»éå†FDç­‰é—®é¢˜</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653900022580.png" alt="1653900022580" tabindex="0" loading="lazy"><figcaption>1653900022580</figcaption></figure><h3 id="_2-6-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨æ¨¡å‹-pollæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-6-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨æ¨¡å‹-pollæ¨¡å¼"><span>2.6 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨æ¨¡å‹-pollæ¨¡å¼</span></a></h3><p>pollæ¨¡å¼å¯¹selectæ¨¡å¼åšäº†ç®€å•æ”¹è¿›ï¼Œä½†æ€§èƒ½æå‡ä¸æ˜æ˜¾ï¼Œéƒ¨åˆ†å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><p>IOæµç¨‹ï¼š</p><ul><li>åˆ›å»ºpollfdæ•°ç»„ï¼Œå‘å…¶ä¸­æ·»åŠ å…³æ³¨çš„fdä¿¡æ¯ï¼Œæ•°ç»„å¤§å°è‡ªå®šä¹‰</li><li>è°ƒç”¨pollå‡½æ•°ï¼Œå°†pollfdæ•°ç»„æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œè½¬é“¾è¡¨å­˜å‚¨ï¼Œæ— ä¸Šé™</li><li>å†…æ ¸éå†fdï¼Œåˆ¤æ–­æ˜¯å¦å°±ç»ª</li><li>æ•°æ®å°±ç»ªæˆ–è¶…æ—¶åï¼Œæ‹·è´pollfdæ•°ç»„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿”å›å°±ç»ªfdæ•°é‡n</li><li>ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­næ˜¯å¦å¤§äº0,å¤§äº0åˆ™éå†pollfdæ•°ç»„ï¼Œæ‰¾åˆ°å°±ç»ªçš„fd</li></ul><p><strong>ä¸selectå¯¹æ¯”ï¼š</strong></p><ul><li>selectæ¨¡å¼ä¸­çš„fd_setå¤§å°å›ºå®šä¸º1024ï¼Œè€Œpollfdåœ¨å†…æ ¸ä¸­é‡‡ç”¨é“¾è¡¨ï¼Œç†è®ºä¸Šæ— ä¸Šé™</li><li>ç›‘å¬FDè¶Šå¤šï¼Œæ¯æ¬¡éå†æ¶ˆè€—æ—¶é—´ä¹Ÿè¶Šä¹…ï¼Œæ€§èƒ½åè€Œä¼šä¸‹é™</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653900721427.png" alt="1653900721427" tabindex="0" loading="lazy"><figcaption>1653900721427</figcaption></figure><h3 id="_2-7-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨æ¨¡å‹-epollå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_2-7-ç½‘ç»œæ¨¡å‹-ioå¤šè·¯å¤ç”¨æ¨¡å‹-epollå‡½æ•°"><span>2.7 ç½‘ç»œæ¨¡å‹-IOå¤šè·¯å¤ç”¨æ¨¡å‹-epollå‡½æ•°</span></a></h3><p>epollæ¨¡å¼æ˜¯å¯¹selectå’Œpollçš„æ”¹è¿›ï¼Œå®ƒæä¾›äº†ä¸‰ä¸ªå‡½æ•°ï¼š</p><p>ç¬¬ä¸€ä¸ªæ˜¯ï¼ševentpollçš„å‡½æ•°ï¼Œä»–å†…éƒ¨åŒ…å«ä¸¤ä¸ªä¸œè¥¿</p><p>ä¸€ä¸ªæ˜¯ï¼š</p><p>1ã€çº¢é»‘æ ‘-&gt; è®°å½•çš„äº‹è¦ç›‘å¬çš„FD</p><p>2ã€ä¸€ä¸ªæ˜¯é“¾è¡¨-&gt;ä¸€ä¸ªé“¾è¡¨ï¼Œè®°å½•çš„æ˜¯å°±ç»ªçš„FD</p><p>ç´§æ¥ç€è°ƒç”¨epoll_ctlæ“ä½œï¼Œå°†è¦ç›‘å¬çš„æ•°æ®æ·»åŠ åˆ°çº¢é»‘æ ‘ä¸Šå»ï¼Œå¹¶ä¸”ç»™æ¯ä¸ªfdè®¾ç½®ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨fdæ•°æ®å°±ç»ªæ—¶è§¦å‘ï¼Œå°±æ˜¯å‡†å¤‡å¥½äº†ï¼Œç°åœ¨å°±æŠŠfdæŠŠæ•°æ®æ·»åŠ åˆ°list_headä¸­å»</p><p>3ã€è°ƒç”¨epoll_waitå‡½æ•°</p><p>å°±å»ç­‰å¾…ï¼Œåœ¨ç”¨æˆ·æ€åˆ›å»ºä¸€ä¸ªç©ºçš„eventsæ•°ç»„ï¼Œå½“å°±ç»ªä¹‹åï¼Œæˆ‘ä»¬çš„å›è°ƒå‡½æ•°ä¼šæŠŠæ•°æ®æ·»åŠ åˆ°list_headä¸­å»ï¼Œå½“è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šå»æ£€æŸ¥list_headï¼Œå½“ç„¶è¿™ä¸ªè¿‡ç¨‹éœ€è¦å‚è€ƒé…ç½®çš„ç­‰å¾…æ—¶é—´ï¼Œå¯ä»¥ç­‰ä¸€å®šæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä¸€ç›´ç­‰ï¼Œ å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæ£€æŸ¥åˆ°äº†list_headä¸­æœ‰æ•°æ®ä¼šå°†æ•°æ®æ·»åŠ åˆ°é“¾è¡¨ä¸­ï¼Œæ­¤æ—¶å°†æ•°æ®æ”¾å…¥åˆ°eventsæ•°ç»„ä¸­ï¼Œå¹¶ä¸”è¿”å›å¯¹åº”çš„æ“ä½œçš„æ•°é‡ï¼Œç”¨æˆ·æ€çš„æ­¤æ—¶æ”¶åˆ°å“åº”åï¼Œä»eventsä¸­æ‹¿åˆ°å¯¹åº”å‡†å¤‡å¥½çš„æ•°æ®çš„èŠ‚ç‚¹ï¼Œå†å»è°ƒç”¨æ–¹æ³•å»æ‹¿æ•°æ®ã€‚</p><p>å°æ€»ç»“ï¼š</p><p>selectæ¨¡å¼å­˜åœ¨çš„ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li>èƒ½ç›‘å¬çš„FDæœ€å¤§ä¸è¶…è¿‡1024</li><li>æ¯æ¬¡selectéƒ½éœ€è¦æŠŠæ‰€æœ‰è¦ç›‘å¬çš„FDéƒ½æ‹·è´åˆ°å†…æ ¸ç©ºé—´</li><li>æ¯æ¬¡éƒ½è¦éå†æ‰€æœ‰FDæ¥åˆ¤æ–­å°±ç»ªçŠ¶æ€</li></ul><p>pollæ¨¡å¼çš„é—®é¢˜ï¼š</p><ul><li>pollåˆ©ç”¨é“¾è¡¨è§£å†³äº†selectä¸­ç›‘å¬FDä¸Šé™çš„é—®é¢˜ï¼Œä½†ä¾ç„¶è¦éå†æ‰€æœ‰FDï¼Œå¦‚æœç›‘å¬è¾ƒå¤šï¼Œæ€§èƒ½ä¼šä¸‹é™</li></ul><p>epollæ¨¡å¼ä¸­å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ï¼Ÿ</p><ul><li>åŸºäºepollå®ä¾‹ä¸­çš„çº¢é»‘æ ‘ä¿å­˜è¦ç›‘å¬çš„FDï¼Œç†è®ºä¸Šæ— ä¸Šé™ï¼Œè€Œä¸”å¢åˆ æ”¹æŸ¥æ•ˆç‡éƒ½éå¸¸é«˜</li><li>æ¯ä¸ªFDåªéœ€è¦æ‰§è¡Œä¸€æ¬¡epoll_ctlæ·»åŠ åˆ°çº¢é»‘æ ‘ï¼Œä»¥åæ¯æ¬¡epol_waitæ— éœ€ä¼ é€’ä»»ä½•å‚æ•°ï¼Œæ— éœ€é‡å¤æ‹·è´FDåˆ°å†…æ ¸ç©ºé—´</li><li>åˆ©ç”¨ep_poll_callbackæœºåˆ¶æ¥ç›‘å¬FDçŠ¶æ€ï¼Œæ— éœ€éå†æ‰€æœ‰FDï¼Œå› æ­¤æ€§èƒ½ä¸ä¼šéšç›‘å¬çš„FDæ•°é‡å¢å¤šè€Œä¸‹é™</li></ul><h3 id="_2-8ã€ç½‘ç»œæ¨¡å‹-epollä¸­çš„etå’Œlt" tabindex="-1"><a class="header-anchor" href="#_2-8ã€ç½‘ç»œæ¨¡å‹-epollä¸­çš„etå’Œlt"><span>2.8ã€ç½‘ç»œæ¨¡å‹-epollä¸­çš„ETå’ŒLT</span></a></h3><p>å½“FDæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨epoll_waitï¼ˆæˆ–è€…selectã€pollï¼‰å¯ä»¥å¾—åˆ°é€šçŸ¥ã€‚ä½†æ˜¯äº‹ä»¶é€šçŸ¥çš„æ¨¡å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>LevelTriggeredï¼šç®€ç§°LTï¼Œä¹Ÿå«åšæ°´å¹³è§¦å‘ã€‚åªè¦æŸä¸ªFDä¸­æœ‰æ•°æ®å¯è¯»ï¼Œæ¯æ¬¡è°ƒç”¨epoll_waitéƒ½ä¼šå¾—åˆ°é€šçŸ¥ã€‚</li><li>EdgeTriggeredï¼šç®€ç§°ETï¼Œä¹Ÿå«åšè¾¹æ²¿è§¦å‘ã€‚åªæœ‰åœ¨æŸä¸ªFDæœ‰çŠ¶æ€å˜åŒ–æ—¶ï¼Œè°ƒç”¨epoll_waitæ‰ä¼šè¢«é€šçŸ¥ã€‚</li></ul><p>ä¸¾ä¸ªæ —å­ï¼š</p><ul><li>å‡è®¾ä¸€ä¸ªå®¢æˆ·ç«¯socketå¯¹åº”çš„FDå·²ç»æ³¨å†Œåˆ°äº†epollå®ä¾‹ä¸­</li><li>å®¢æˆ·ç«¯socketå‘é€äº†2kbçš„æ•°æ®</li><li>æœåŠ¡ç«¯è°ƒç”¨epoll_waitï¼Œå¾—åˆ°é€šçŸ¥è¯´FDå°±ç»ª</li><li>æœåŠ¡ç«¯ä»FDè¯»å–äº†1kbæ•°æ®å›åˆ°æ­¥éª¤3ï¼ˆå†æ¬¡è°ƒç”¨epoll_waitï¼Œå½¢æˆå¾ªç¯ï¼‰</li></ul><p>ç»“è®º</p><p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨LTæ¨¡å¼ï¼Œå› ä¸ºFDä¸­ä»æœ‰1kbæ•°æ®ï¼Œåˆ™ç¬¬â‘¤æ­¥ä¾ç„¶ä¼šè¿”å›ç»“æœï¼Œå¹¶ä¸”å¾—åˆ°é€šçŸ¥ å¦‚æœæˆ‘ä»¬é‡‡ç”¨ETæ¨¡å¼ï¼Œå› ä¸ºç¬¬â‘¢æ­¥å·²ç»æ¶ˆè´¹äº†FDå¯è¯»äº‹ä»¶ï¼Œç¬¬â‘¤æ­¥FDçŠ¶æ€æ²¡æœ‰å˜åŒ–ï¼Œå› æ­¤epoll_waitä¸ä¼šè¿”å›ï¼Œæ•°æ®æ— æ³•è¯»å–ï¼Œå®¢æˆ·ç«¯å“åº”è¶…æ—¶ã€‚</p><h3 id="_2-9-ç½‘ç»œæ¨¡å‹-åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-9-ç½‘ç»œæ¨¡å‹-åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹"><span>2.9 ç½‘ç»œæ¨¡å‹-åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹</span></a></h3><p>æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹è¿™å¼ å›¾</p><p>æœåŠ¡å™¨å¯åŠ¨ä»¥åï¼ŒæœåŠ¡ç«¯ä¼šå»è°ƒç”¨epoll_createï¼Œåˆ›å»ºä¸€ä¸ªepollå®ä¾‹ï¼Œepollå®ä¾‹ä¸­åŒ…å«ä¸¤ä¸ªæ•°æ®</p><p>1ã€çº¢é»‘æ ‘ï¼ˆä¸ºç©ºï¼‰ï¼šrb_root ç”¨æ¥å»è®°å½•éœ€è¦è¢«ç›‘å¬çš„FD</p><p>2ã€é“¾è¡¨ï¼ˆä¸ºç©ºï¼‰ï¼šlist_headï¼Œç”¨æ¥å­˜æ”¾å·²ç»å°±ç»ªçš„FD</p><p>åˆ›å»ºå¥½äº†ä¹‹åï¼Œä¼šå»è°ƒç”¨epoll_ctlå‡½æ•°ï¼Œæ­¤å‡½æ•°ä¼šä¼šå°†éœ€è¦ç›‘å¬çš„æ•°æ®æ·»åŠ åˆ°rb_rootä¸­å»ï¼Œå¹¶ä¸”å¯¹å½“å‰è¿™äº›å­˜åœ¨äºçº¢é»‘æ ‘çš„èŠ‚ç‚¹è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå½“è¿™äº›è¢«ç›‘å¬çš„æ•°æ®ä¸€æ—¦å‡†å¤‡å®Œæˆï¼Œå°±ä¼šè¢«è°ƒç”¨ï¼Œè€Œè°ƒç”¨çš„ç»“æœå°±æ˜¯å°†çº¢é»‘æ ‘çš„fdæ·»åŠ åˆ°list_headä¸­å»(ä½†æ˜¯æ­¤æ—¶å¹¶æ²¡æœ‰å®Œæˆ)</p><p>3ã€å½“ç¬¬äºŒæ­¥å®Œæˆåï¼Œå°±ä¼šè°ƒç”¨epoll_waitå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå»æ ¡éªŒæ˜¯å¦æœ‰æ•°æ®å‡†å¤‡å®Œæ¯•ï¼ˆå› ä¸ºæ•°æ®ä¸€æ—¦å‡†å¤‡å°±ç»ªï¼Œå°±ä¼šè¢«å›è°ƒå‡½æ•°æ·»åŠ åˆ°list_headä¸­ï¼‰ï¼Œåœ¨ç­‰å¾…äº†ä¸€æ®µæ—¶é—´å(å¯ä»¥è¿›è¡Œé…ç½®)ï¼Œå¦‚æœç­‰å¤Ÿäº†è¶…æ—¶æ—¶é—´ï¼Œåˆ™è¿”å›æ²¡æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­å½“å‰æ˜¯ä»€ä¹ˆäº‹ä»¶ï¼Œå¦‚æœæ˜¯å»ºç«‹è¿æ¥æ—¶é—´ï¼Œåˆ™è°ƒç”¨accept() æ¥å—å®¢æˆ·ç«¯socketï¼Œæ‹¿åˆ°å»ºç«‹è¿æ¥çš„socketï¼Œç„¶åå»ºç«‹èµ·æ¥è¿æ¥ï¼Œå¦‚æœæ˜¯å…¶ä»–äº‹ä»¶ï¼Œåˆ™æŠŠæ•°æ®è¿›è¡Œå†™å‡º</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653902845082.png" alt="1653902845082" tabindex="0" loading="lazy"><figcaption>1653902845082</figcaption></figure><h3 id="_3-0-ã€ç½‘ç»œæ¨¡å‹-ä¿¡å·é©±åŠ¨" tabindex="-1"><a class="header-anchor" href="#_3-0-ã€ç½‘ç»œæ¨¡å‹-ä¿¡å·é©±åŠ¨"><span>3.0 ã€ç½‘ç»œæ¨¡å‹-ä¿¡å·é©±åŠ¨</span></a></h3><p>ä¿¡å·é©±åŠ¨IOæ˜¯ä¸å†…æ ¸å»ºç«‹SIGIOçš„ä¿¡å·å…³è”å¹¶è®¾ç½®å›è°ƒï¼Œå½“å†…æ ¸æœ‰FDå°±ç»ªæ—¶ï¼Œä¼šå‘å‡ºSIGIOä¿¡å·é€šçŸ¥ç”¨æˆ·ï¼ŒæœŸé—´ç”¨æˆ·åº”ç”¨å¯ä»¥æ‰§è¡Œå…¶å®ƒä¸šåŠ¡ï¼Œæ— éœ€é˜»å¡ç­‰å¾…ã€‚</p><p>é˜¶æ®µä¸€ï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨sigactionï¼Œæ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°</li><li>å†…æ ¸è¿”å›æˆåŠŸï¼Œå¼€å§‹ç›‘å¬FD</li><li>ç”¨æˆ·è¿›ç¨‹ä¸é˜»å¡ç­‰å¾…ï¼Œå¯ä»¥æ‰§è¡Œå…¶å®ƒä¸šåŠ¡</li><li>å½“å†…æ ¸æ•°æ®å°±ç»ªåï¼Œå›è°ƒç”¨æˆ·è¿›ç¨‹çš„SIGIOå¤„ç†å‡½æ•°</li></ul><p>é˜¶æ®µäºŒï¼š</p><ul><li>æ”¶åˆ°SIGIOå›è°ƒä¿¡å·</li><li>è°ƒç”¨recvfromï¼Œè¯»å–</li><li>å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</li><li>ç”¨æˆ·è¿›ç¨‹å¤„ç†æ•°æ®</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653911776583.png" alt="1653911776583" tabindex="0" loading="lazy"><figcaption>1653911776583</figcaption></figure><p>å½“æœ‰å¤§é‡IOæ“ä½œæ—¶ï¼Œä¿¡å·è¾ƒå¤šï¼ŒSIGIOå¤„ç†å‡½æ•°ä¸èƒ½åŠæ—¶å¤„ç†å¯èƒ½å¯¼è‡´ä¿¡å·é˜Ÿåˆ—æº¢å‡ºï¼Œè€Œä¸”å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´çš„é¢‘ç¹ä¿¡å·äº¤äº’æ€§èƒ½ä¹Ÿè¾ƒä½ã€‚</p><h4 id="_3-0-1-å¼‚æ­¥io" tabindex="-1"><a class="header-anchor" href="#_3-0-1-å¼‚æ­¥io"><span>3.0.1 å¼‚æ­¥IO</span></a></h4><p>è¿™ç§æ–¹å¼ï¼Œä¸ä»…ä»…æ˜¯ç”¨æˆ·æ€åœ¨è¯•å›¾è¯»å–æ•°æ®åï¼Œä¸é˜»å¡ï¼Œè€Œä¸”å½“å†…æ ¸çš„æ•°æ®å‡†å¤‡å®Œæˆåï¼Œä¹Ÿä¸ä¼šé˜»å¡</p><p>ä»–ä¼šç”±å†…æ ¸å°†æ‰€æœ‰æ•°æ®å¤„ç†å®Œæˆåï¼Œç”±å†…æ ¸å°†æ•°æ®å†™å…¥åˆ°ç”¨æˆ·æ€ä¸­ï¼Œç„¶åæ‰ç®—å®Œæˆï¼Œæ‰€ä»¥æ€§èƒ½æé«˜ï¼Œä¸ä¼šæœ‰ä»»ä½•é˜»å¡ï¼Œå…¨éƒ¨éƒ½ç”±å†…æ ¸å®Œæˆï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¼‚æ­¥IOæ¨¡å‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯éé˜»å¡çŠ¶æ€ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653911877542.png" alt="1653911877542" tabindex="0" loading="lazy"><figcaption>1653911877542</figcaption></figure><h4 id="_3-0-2-å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_3-0-2-å¯¹æ¯”"><span>3.0.2 å¯¹æ¯”</span></a></h4><p>æœ€åç”¨ä¸€å¹…å›¾ï¼Œæ¥è¯´æ˜ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653912219712.png" alt="1653912219712" tabindex="0" loading="lazy"><figcaption>1653912219712</figcaption></figure><h3 id="_3-1-ã€ç½‘ç»œæ¨¡å‹-redisæ˜¯å•çº¿ç¨‹çš„å—-ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-1-ã€ç½‘ç»œæ¨¡å‹-redisæ˜¯å•çº¿ç¨‹çš„å—-ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹"><span>3.1 ã€ç½‘ç»œæ¨¡å‹-Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹</span></a></h3><p><strong>Redisåˆ°åº•æ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ</strong></p><ul><li>å¦‚æœä»…ä»…èŠRedisçš„æ ¸å¿ƒä¸šåŠ¡éƒ¨åˆ†ï¼ˆå‘½ä»¤å¤„ç†ï¼‰ï¼Œç­”æ¡ˆæ˜¯å•çº¿ç¨‹</li><li>å¦‚æœæ˜¯èŠæ•´ä¸ªRedisï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯å¤šçº¿ç¨‹</li></ul><p>åœ¨Redisç‰ˆæœ¬è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œåœ¨ä¸¤ä¸ªé‡è¦çš„æ—¶é—´èŠ‚ç‚¹ä¸Šå¼•å…¥äº†å¤šçº¿ç¨‹çš„æ”¯æŒï¼š</p><ul><li>Redis v4.0ï¼šå¼•å…¥å¤šçº¿ç¨‹å¼‚æ­¥å¤„ç†ä¸€äº›è€—æ—¶è¾ƒæ—§çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å¼‚æ­¥åˆ é™¤å‘½ä»¤unlink</li><li>Redis v6.0ï¼šåœ¨æ ¸å¿ƒç½‘ç»œæ¨¡å‹ä¸­å¼•å…¥ å¤šçº¿ç¨‹ï¼Œè¿›ä¸€æ­¥æé«˜å¯¹äºå¤šæ ¸CPUçš„åˆ©ç”¨ç‡</li></ul><p>å› æ­¤ï¼Œå¯¹äºRedisçš„æ ¸å¿ƒç½‘ç»œæ¨¡å‹ï¼Œåœ¨Redis 6.0ä¹‹å‰ç¡®å®éƒ½æ˜¯å•çº¿ç¨‹ã€‚æ˜¯åˆ©ç”¨epollï¼ˆLinuxç³»ç»Ÿï¼‰è¿™æ ·çš„IOå¤šè·¯å¤ç”¨æŠ€æœ¯åœ¨äº‹ä»¶å¾ªç¯ä¸­ä¸æ–­å¤„ç†å®¢æˆ·ç«¯æƒ…å†µã€‚</p><p><strong>ä¸ºä»€ä¹ˆRedisè¦é€‰æ‹©å•çº¿ç¨‹ï¼Ÿ</strong></p><ul><li>æŠ›å¼€æŒä¹…åŒ–ä¸è°ˆï¼ŒRedisæ˜¯çº¯ å†…å­˜æ“ä½œï¼Œæ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œå®ƒçš„æ€§èƒ½ç“¶é¢ˆæ˜¯ç½‘ç»œå»¶è¿Ÿè€Œä¸æ˜¯æ‰§è¡Œé€Ÿåº¦ï¼Œå› æ­¤å¤šçº¿ç¨‹å¹¶ä¸ä¼šå¸¦æ¥å·¨å¤§çš„æ€§èƒ½æå‡ã€‚</li><li>å¤šçº¿ç¨‹ä¼šå¯¼è‡´è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¸¦æ¥ä¸å¿…è¦çš„å¼€é”€</li><li>å¼•å…¥å¤šçº¿ç¨‹ä¼šé¢ä¸´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¿…ç„¶è¦å¼•å…¥çº¿ç¨‹é”è¿™æ ·çš„å®‰å…¨æ‰‹æ®µï¼Œå®ç°å¤æ‚åº¦å¢é«˜ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿä¼šå¤§æ‰“æŠ˜æ‰£</li></ul><h3 id="_3-2-ã€redisçš„å•çº¿ç¨‹æ¨¡å‹-rediså•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å˜æ›´" tabindex="-1"><a class="header-anchor" href="#_3-2-ã€redisçš„å•çº¿ç¨‹æ¨¡å‹-rediså•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å˜æ›´"><span>3.2 ã€Redisçš„å•çº¿ç¨‹æ¨¡å‹-Rediså•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å˜æ›´</span></a></h3><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653982278727.png" alt="1653982278727" tabindex="0" loading="lazy"><figcaption>1653982278727</figcaption></figure><p>å½“æˆ‘ä»¬çš„å®¢æˆ·ç«¯æƒ³è¦å»è¿æ¥æˆ‘ä»¬æœåŠ¡å™¨ï¼Œä¼šå»å…ˆåˆ°IOå¤šè·¯å¤ç”¨æ¨¡å‹å»è¿›è¡Œæ’é˜Ÿï¼Œä¼šæœ‰ä¸€ä¸ªè¿æ¥åº”ç­”å¤„ç†å™¨ï¼Œä»–ä¼šå»æ¥å—è¯»è¯·æ±‚ï¼Œç„¶ååˆæŠŠè¯»è¯·æ±‚æ³¨å†Œåˆ°å…·ä½“æ¨¡å‹ä¸­å»ï¼Œæ­¤æ—¶è¿™äº›å»ºç«‹èµ·æ¥çš„è¿æ¥ï¼Œå¦‚æœæ˜¯å®¢æˆ·ç«¯è¯·æ±‚å¤„ç†å™¨å»è¿›è¡Œæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œä»–ä¼šå»æŠŠæ•°æ®è¯»å–å‡ºæ¥ï¼Œç„¶åæŠŠæ•°æ®æ”¾å…¥åˆ°clientä¸­ï¼Œ clinetå»è§£æå½“å‰çš„å‘½ä»¤è½¬åŒ–ä¸ºredisè®¤è¯†çš„å‘½ä»¤ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹å¤„ç†è¿™äº›å‘½ä»¤ï¼Œä»redisä¸­çš„commandä¸­æ‰¾åˆ°è¿™äº›å‘½ä»¤ï¼Œç„¶åå°±çœŸæ­£çš„å»æ“ä½œå¯¹åº”çš„æ•°æ®äº†ï¼Œå½“æ•°æ®æ“ä½œå®Œæˆåï¼Œä¼šå»æ‰¾åˆ°å‘½ä»¤å›å¤å¤„ç†å™¨ï¼Œå†ç”±ä»–å°†æ•°æ®å†™å‡ºã€‚</p><h2 id="_3ã€redisé€šä¿¡åè®®-respåè®®" tabindex="-1"><a class="header-anchor" href="#_3ã€redisé€šä¿¡åè®®-respåè®®"><span>3ã€Redisé€šä¿¡åè®®-RESPåè®®</span></a></h2><p>Redisæ˜¯ä¸€ä¸ªCSæ¶æ„çš„è½¯ä»¶ï¼Œé€šä¿¡ä¸€èˆ¬åˆ†ä¸¤æ­¥ï¼ˆä¸åŒ…æ‹¬pipelineå’ŒPubSubï¼‰ï¼š</p><p>å®¢æˆ·ç«¯ï¼ˆclientï¼‰å‘æœåŠ¡ç«¯ï¼ˆserverï¼‰å‘é€ä¸€æ¡å‘½ä»¤</p><p>æœåŠ¡ç«¯è§£æå¹¶æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›å“åº”ç»“æœç»™å®¢æˆ·ç«¯</p><p>å› æ­¤å®¢æˆ·ç«¯å‘é€å‘½ä»¤çš„æ ¼å¼ã€æœåŠ¡ç«¯å“åº”ç»“æœçš„æ ¼å¼å¿…é¡»æœ‰ä¸€ä¸ªè§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒå°±æ˜¯é€šä¿¡åè®®ã€‚</p><p>è€Œåœ¨Redisä¸­é‡‡ç”¨çš„æ˜¯RESPï¼ˆRedis Serialization Protocolï¼‰åè®®ï¼š</p><p>Redis 1.2ç‰ˆæœ¬å¼•å…¥äº†RESPåè®®</p><p>Redis 2.0ç‰ˆæœ¬ä¸­æˆä¸ºä¸RedisæœåŠ¡ç«¯é€šä¿¡çš„æ ‡å‡†ï¼Œç§°ä¸ºRESP2</p><p>Redis 6.0ç‰ˆæœ¬ä¸­ï¼Œä»RESP2å‡çº§åˆ°äº†RESP3åè®®ï¼Œå¢åŠ äº†æ›´å¤šæ•°æ®ç±»å‹å¹¶ä¸”æ”¯æŒ6.0çš„æ–°ç‰¹æ€§--å®¢æˆ·ç«¯ç¼“å­˜</p><p>ä½†ç›®å‰ï¼Œé»˜è®¤ä½¿ç”¨çš„ä¾ç„¶æ˜¯RESP2åè®®ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¦å­¦ä¹ çš„åè®®ç‰ˆæœ¬ï¼ˆä»¥ä¸‹ç®€ç§°RESPï¼‰ã€‚</p><p>åœ¨RESPä¸­ï¼Œé€šè¿‡é¦–å­—èŠ‚çš„å­—ç¬¦æ¥åŒºåˆ†ä¸åŒæ•°æ®ç±»å‹ï¼Œå¸¸ç”¨çš„æ•°æ®ç±»å‹åŒ…æ‹¬5ç§ï¼š</p><p>å•è¡Œå­—ç¬¦ä¸²ï¼šé¦–å­—èŠ‚æ˜¯ â€˜+â€™ ï¼Œåé¢è·Ÿä¸Šå•è¡Œå­—ç¬¦ä¸²ï¼Œä»¥CRLFï¼ˆ &quot;\r\n&quot; ï¼‰ç»“å°¾ã€‚ä¾‹å¦‚è¿”å›&quot;OK&quot;ï¼š &quot;+OK\r\n&quot;</p><p>é”™è¯¯ï¼ˆErrorsï¼‰ï¼šé¦–å­—èŠ‚æ˜¯ â€˜-â€™ ï¼Œä¸å•è¡Œå­—ç¬¦ä¸²æ ¼å¼ä¸€æ ·ï¼Œåªæ˜¯å­—ç¬¦ä¸²æ˜¯å¼‚å¸¸ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š&quot;-Error message\r\n&quot;</p><p>æ•°å€¼ï¼šé¦–å­—èŠ‚æ˜¯ â€˜:â€™ ï¼Œåé¢è·Ÿä¸Šæ•°å­—æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä»¥CRLFç»“å°¾ã€‚ä¾‹å¦‚ï¼š&quot;:10\r\n&quot;</p><p>å¤šè¡Œå­—ç¬¦ä¸²ï¼šé¦–å­—èŠ‚æ˜¯ â€˜$â€™ ï¼Œè¡¨ç¤ºäºŒè¿›åˆ¶å®‰å…¨çš„å­—ç¬¦ä¸²ï¼Œæœ€å¤§æ”¯æŒ512MBï¼š</p><p>å¦‚æœå¤§å°ä¸º0ï¼Œåˆ™ä»£è¡¨ç©ºå­—ç¬¦ä¸²ï¼š&quot;$0\r\n\r\n&quot;</p><p>å¦‚æœå¤§å°ä¸º-1ï¼Œåˆ™ä»£è¡¨ä¸å­˜åœ¨ï¼š&quot;$-1\r\n&quot;</p><p>æ•°ç»„ï¼šé¦–å­—èŠ‚æ˜¯ â€˜*â€™ï¼Œåé¢è·Ÿä¸Šæ•°ç»„å…ƒç´ ä¸ªæ•°ï¼Œå†è·Ÿä¸Šå…ƒç´ ï¼Œå…ƒç´ æ•°æ®ç±»å‹ä¸é™:</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653982993020.png" alt="1653982993020" tabindex="0" loading="lazy"><figcaption>1653982993020</figcaption></figure><h3 id="_3-1ã€redisé€šä¿¡åè®®-åŸºäºsocketè‡ªå®šä¹‰redisçš„å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_3-1ã€redisé€šä¿¡åè®®-åŸºäºsocketè‡ªå®šä¹‰redisçš„å®¢æˆ·ç«¯"><span>3.1ã€Redisé€šä¿¡åè®®-åŸºäºSocketè‡ªå®šä¹‰Redisçš„å®¢æˆ·ç«¯</span></a></h3><p>Redisæ”¯æŒTCPé€šä¿¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Socketæ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯ï¼Œä¸RedisæœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> PrintWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> BufferedReader</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 1.å»ºç«‹è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> host</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            s </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(host, port);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.è·å–è¾“å‡ºæµã€è¾“å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            writer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PrintWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> OutputStreamWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getOutputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">StandardCharsets</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">UTF_8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            reader </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> BufferedReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> InputStreamReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getInputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">StandardCharsets</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">UTF_8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 3.å‘å‡ºè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 3.1.è·å–æˆæƒ auth 123321</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;123321&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;obj = &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> obj);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 3.2.set name è™å“¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;set&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è™å“¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 4.è§£æå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;obj = &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> obj);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 3.2.set name è™å“¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 4.è§£æå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;obj = &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> obj);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 3.2.set name è™å“¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;mget&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;num&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;msg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 4.è§£æå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;obj = &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> obj);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">IOException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 5.é‡Šæ”¾è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (reader </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (writer </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (s </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">IOException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è¯»å–é¦–å­—èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åˆ¤æ–­æ•°æ®ç±»å‹æ ‡ç¤º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        switch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (prefix) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;+&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // å•è¡Œå­—ç¬¦ä¸²ï¼Œç›´æ¥è¯»ä¸€è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;-&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // å¼‚å¸¸ï¼Œä¹Ÿè¯»ä¸€è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;:&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // æ•°å­—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parseLong</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // å¤šè¡Œå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // å…ˆè¯»é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> len</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // å†è¯»æ•°æ®,è¯»lenä¸ªå­—èŠ‚ã€‚æˆ‘ä»¬å‡è®¾æ²¡æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥è¯»ä¸€è¡Œï¼ˆç®€åŒ–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readBulkString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            default:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é”™è¯¯çš„æ•°æ®æ ¼å¼ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readBulkString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è·å–æ•°ç»„å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> len</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å®šä¹‰é›†åˆï¼Œæ¥æ”¶å¤šä¸ªå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;(len);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // éå†ï¼Œä¾æ¬¡è¯»å–æ¯ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> len; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> list;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // set name è™å“¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sendRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ... </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> args) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;$&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">StandardCharsets</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">UTF_8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(arg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">flush</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2ã€rediså†…å­˜å›æ”¶-è¿‡æœŸkeyå¤„ç†" tabindex="-1"><a class="header-anchor" href="#_3-2ã€rediså†…å­˜å›æ”¶-è¿‡æœŸkeyå¤„ç†"><span>3.2ã€Rediså†…å­˜å›æ”¶-è¿‡æœŸkeyå¤„ç†</span></a></h3><p>Redisä¹‹æ‰€ä»¥æ€§èƒ½å¼ºï¼Œæœ€ä¸»è¦çš„åŸå› å°±æ˜¯åŸºäºå†…å­˜å­˜å‚¨ã€‚ç„¶è€Œå•èŠ‚ç‚¹çš„Rediså…¶å†…å­˜å¤§å°ä¸å®œè¿‡å¤§ï¼Œä¼šå½±å“æŒä¹…åŒ–æˆ–ä¸»ä»åŒæ­¥æ€§èƒ½ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è®¾ç½®Redisçš„æœ€å¤§å†…å­˜ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983341150.png" alt="1653983341150" tabindex="0" loading="lazy"><figcaption>1653983341150</figcaption></figure><p>å½“å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå°±æ— æ³•å­˜å‚¨æ›´å¤šæ•°æ®äº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedisæä¾›äº†ä¸€äº›ç­–ç•¥å®ç°å†…å­˜å›æ”¶ï¼š</p><p>å†…å­˜è¿‡æœŸç­–ç•¥</p><p>åœ¨å­¦ä¹ Redisç¼“å­˜çš„æ—¶å€™æˆ‘ä»¬è¯´è¿‡ï¼Œå¯ä»¥é€šè¿‡expireå‘½ä»¤ç»™Redisçš„keyè®¾ç½®TTLï¼ˆå­˜æ´»æ—¶é—´ï¼‰ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983366243.png" alt="1653983366243" tabindex="0" loading="lazy"><figcaption>1653983366243</figcaption></figure><p>å¯ä»¥å‘ç°ï¼Œå½“keyçš„TTLåˆ°æœŸä»¥åï¼Œå†æ¬¡è®¿é—®nameè¿”å›çš„æ˜¯nilï¼Œè¯´æ˜è¿™ä¸ªkeyå·²ç»ä¸å­˜åœ¨äº†ï¼Œå¯¹åº”çš„å†…å­˜ä¹Ÿå¾—åˆ°é‡Šæ”¾ã€‚ä»è€Œèµ·åˆ°å†…å­˜å›æ”¶çš„ç›®çš„ã€‚</p><p>Redisæœ¬èº«æ˜¯ä¸€ä¸ªå…¸å‹çš„key-valueå†…å­˜å­˜å‚¨æ•°æ®åº“ï¼Œå› æ­¤æ‰€æœ‰çš„keyã€valueéƒ½ä¿å­˜åœ¨ä¹‹å‰å­¦ä¹ è¿‡çš„Dictç»“æ„ä¸­ã€‚ä¸è¿‡åœ¨å…¶databaseç»“æ„ä½“ä¸­ï¼Œæœ‰ä¸¤ä¸ªDictï¼šä¸€ä¸ªç”¨æ¥è®°å½•key-valueï¼›å¦ä¸€ä¸ªç”¨æ¥è®°å½•key-TTLã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983423128.png" alt="1653983423128" tabindex="0" loading="lazy"><figcaption>1653983423128</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983606531.png" alt="1653983606531" tabindex="0" loading="lazy"><figcaption>1653983606531</figcaption></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æˆ‘ä»¬æ€è€ƒï¼š Redisæ˜¯å¦‚ä½•çŸ¥é“ä¸€ä¸ªkeyæ˜¯å¦è¿‡æœŸå‘¢ï¼Ÿ</p><p>åˆ©ç”¨ä¸¤ä¸ªDictåˆ†åˆ«è®°å½•key-valueå¯¹åŠkey-ttlå¯¹</p><p>æ˜¯ä¸æ˜¯TTLåˆ°æœŸå°±ç«‹å³åˆ é™¤äº†å‘¢ï¼Ÿ</p><p><strong>æƒ°æ€§åˆ é™¤</strong></p><p>æƒ°æ€§åˆ é™¤ï¼šé¡¾æ˜æ€è®®å¹¶ä¸æ˜¯åœ¨TTLåˆ°æœŸåå°±ç«‹åˆ»åˆ é™¤ï¼Œè€Œæ˜¯åœ¨è®¿é—®ä¸€ä¸ªkeyçš„æ—¶å€™ï¼Œæ£€æŸ¥è¯¥keyçš„å­˜æ´»æ—¶é—´ï¼Œå¦‚æœå·²ç»è¿‡æœŸæ‰æ‰§è¡Œåˆ é™¤ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983652865.png" alt="1653983652865" tabindex="0" loading="lazy"><figcaption>1653983652865</figcaption></figure><p><strong>å‘¨æœŸåˆ é™¤</strong></p><p>å‘¨æœŸåˆ é™¤ï¼šé¡¾æ˜æ€è®®æ˜¯é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå‘¨æœŸæ€§çš„æŠ½æ ·éƒ¨åˆ†è¿‡æœŸçš„keyï¼Œç„¶åæ‰§è¡Œåˆ é™¤ã€‚æ‰§è¡Œå‘¨æœŸæœ‰ä¸¤ç§ï¼š RedisæœåŠ¡åˆå§‹åŒ–å‡½æ•°initServer()ä¸­è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ŒæŒ‰ç…§server.hzçš„é¢‘ç‡æ¥æ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼Œæ¨¡å¼ä¸ºSLOW Redisçš„æ¯ä¸ªäº‹ä»¶å¾ªç¯å‰ä¼šè°ƒç”¨beforeSleep()å‡½æ•°ï¼Œæ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼Œæ¨¡å¼ä¸ºFAST</p><p>å‘¨æœŸåˆ é™¤ï¼šé¡¾æ˜æ€è®®æ˜¯é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå‘¨æœŸæ€§çš„æŠ½æ ·éƒ¨åˆ†è¿‡æœŸçš„keyï¼Œç„¶åæ‰§è¡Œåˆ é™¤ã€‚æ‰§è¡Œå‘¨æœŸæœ‰ä¸¤ç§ï¼š RedisæœåŠ¡åˆå§‹åŒ–å‡½æ•°initServer()ä¸­è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ŒæŒ‰ç…§server.hzçš„é¢‘ç‡æ¥æ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼Œæ¨¡å¼ä¸ºSLOW Redisçš„æ¯ä¸ªäº‹ä»¶å¾ªç¯å‰ä¼šè°ƒç”¨beforeSleep()å‡½æ•°ï¼Œæ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼Œæ¨¡å¼ä¸ºFAST</p><p>SLOWæ¨¡å¼è§„åˆ™ï¼š</p><ul><li>æ‰§è¡Œé¢‘ç‡å—server.hzå½±å“ï¼Œé»˜è®¤ä¸º10ï¼Œå³æ¯ç§’æ‰§è¡Œ10æ¬¡ï¼Œæ¯ä¸ªæ‰§è¡Œå‘¨æœŸ100msã€‚</li><li>æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡ä¸€æ¬¡æ‰§è¡Œå‘¨æœŸçš„25%.é»˜è®¤slowæ¨¡å¼è€—æ—¶ä¸è¶…è¿‡25ms</li><li>é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ</li><li>å¦‚æœæ²¡è¾¾åˆ°æ—¶é—´ä¸Šé™ï¼ˆ25msï¼‰å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸ</li><li>FASTæ¨¡å¼è§„åˆ™ï¼ˆè¿‡æœŸkeyæ¯”ä¾‹å°äº10%ä¸æ‰§è¡Œ ï¼‰ï¼š</li><li>æ‰§è¡Œé¢‘ç‡å—beforeSleep()è°ƒç”¨é¢‘ç‡å½±å“ï¼Œä½†ä¸¤æ¬¡FASTæ¨¡å¼é—´éš”ä¸ä½äº2ms</li><li>æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡1ms</li><li>é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ å¦‚æœæ²¡è¾¾åˆ°æ—¶é—´ä¸Šé™ï¼ˆ1msï¼‰å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸ</li></ul><p>å°æ€»ç»“ï¼š</p><p>RedisKeyçš„TTLè®°å½•æ–¹å¼ï¼š</p><p>åœ¨RedisDBä¸­é€šè¿‡ä¸€ä¸ªDictè®°å½•æ¯ä¸ªKeyçš„TTLæ—¶é—´</p><p>è¿‡æœŸkeyçš„åˆ é™¤ç­–ç•¥ï¼š</p><p>æƒ°æ€§æ¸…ç†ï¼šæ¯æ¬¡æŸ¥æ‰¾keyæ—¶åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤</p><p>å®šæœŸæ¸…ç†ï¼šå®šæœŸæŠ½æ ·éƒ¨åˆ†keyï¼Œåˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤ã€‚ å®šæœŸæ¸…ç†çš„ä¸¤ç§æ¨¡å¼ï¼š</p><p>SLOWæ¨¡å¼æ‰§è¡Œé¢‘ç‡é»˜è®¤ä¸º10ï¼Œæ¯æ¬¡ä¸è¶…è¿‡25ms</p><p>FASTæ¨¡å¼æ‰§è¡Œé¢‘ç‡ä¸å›ºå®šï¼Œä½†ä¸¤æ¬¡é—´éš”ä¸ä½äº2msï¼Œæ¯æ¬¡è€—æ—¶ä¸è¶…è¿‡1ms</p><h3 id="_3-3-rediså†…å­˜å›æ”¶-å†…å­˜æ·˜æ±°ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_3-3-rediså†…å­˜å›æ”¶-å†…å­˜æ·˜æ±°ç­–ç•¥"><span>3.3 Rediså†…å­˜å›æ”¶-å†…å­˜æ·˜æ±°ç­–ç•¥</span></a></h3><p>å†…å­˜æ·˜æ±°ï¼šå°±æ˜¯å½“Rediså†…å­˜ä½¿ç”¨è¾¾åˆ°è®¾ç½®çš„ä¸Šé™æ—¶ï¼Œä¸»åŠ¨æŒ‘é€‰éƒ¨åˆ†keyåˆ é™¤ä»¥é‡Šæ”¾æ›´å¤šå†…å­˜çš„æµç¨‹ã€‚Redisä¼šåœ¨å¤„ç†å®¢æˆ·ç«¯å‘½ä»¤çš„æ–¹æ³•processCommand()ä¸­å°è¯•åšå†…å­˜æ·˜æ±°ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653983978671.png" alt="1653983978671" tabindex="0" loading="lazy"><figcaption>1653983978671</figcaption></figure><p>æ·˜æ±°ç­–ç•¥</p><p>Redisæ”¯æŒ8ç§ä¸åŒç­–ç•¥æ¥é€‰æ‹©è¦åˆ é™¤çš„keyï¼š</p><ul><li>noevictionï¼š ä¸æ·˜æ±°ä»»ä½•keyï¼Œä½†æ˜¯å†…å­˜æ»¡æ—¶ä¸å…è®¸å†™å…¥æ–°æ•°æ®ï¼Œé»˜è®¤å°±æ˜¯è¿™ç§ç­–ç•¥ã€‚</li><li>volatile-ttlï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼Œæ¯”è¾ƒkeyçš„å‰©ä½™TTLå€¼ï¼ŒTTLè¶Šå°è¶Šå…ˆè¢«æ·˜æ±°</li><li>allkeys-randomï¼šå¯¹å…¨ä½“key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ç›´æ¥ä»db-&gt;dictä¸­éšæœºæŒ‘é€‰</li><li>volatile-randomï¼šå¯¹è®¾ç½®äº†TTLçš„key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ä»db-&gt;expiresä¸­éšæœºæŒ‘é€‰ã€‚</li><li>allkeys-lruï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</li><li>volatile-lruï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</li><li>allkeys-lfuï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°</li><li>volatile-lfuï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLFIç®—æ³•è¿›è¡Œæ·˜æ±° æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æœ‰ä¸¤ä¸ªï¼š <ul><li>LRUï¼ˆLeast Recently Usedï¼‰ï¼Œæœ€å°‘æœ€è¿‘ä½¿ç”¨ã€‚ç”¨å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œè¿™ä¸ªå€¼è¶Šå¤§åˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li><li>LFUï¼ˆLeast Frequently Usedï¼‰ï¼Œæœ€å°‘é¢‘ç‡ä½¿ç”¨ã€‚ä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li></ul></li></ul><p>Redisçš„æ•°æ®éƒ½ä¼šè¢«å°è£…ä¸ºRedisObjectç»“æ„ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984029506.png" alt="1653984029506" tabindex="0" loading="lazy"><figcaption>1653984029506</figcaption></figure><p>LFUçš„è®¿é—®æ¬¡æ•°ä¹‹æ‰€ä»¥å«åšé€»è¾‘è®¿é—®æ¬¡æ•°ï¼Œæ˜¯å› ä¸ºå¹¶ä¸æ˜¯æ¯æ¬¡keyè¢«è®¿é—®éƒ½è®¡æ•°ï¼Œè€Œæ˜¯é€šè¿‡è¿ç®—ï¼š</p><ul><li>ç”Ÿæˆ0~1ä¹‹é—´çš„éšæœºæ•°R</li><li>è®¡ç®— (æ—§æ¬¡æ•° * lfu_log_factor + 1)ï¼Œè®°å½•ä¸ºP</li><li>å¦‚æœ R &lt; P ï¼Œåˆ™è®¡æ•°å™¨ + 1ï¼Œä¸”æœ€å¤§ä¸è¶…è¿‡255</li><li>è®¿é—®æ¬¡æ•°ä¼šéšæ—¶é—´è¡°å‡ï¼Œè·ç¦»ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´æ¯éš” lfu_decay_time åˆ†é’Ÿï¼Œè®¡æ•°å™¨ -1</li></ul><p>æœ€åç”¨ä¸€å‰¯å›¾æ¥æè¿°å½“å‰çš„è¿™ä¸ªæµç¨‹å§</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653984085095.png" alt="1653984085095" tabindex="0" loading="lazy"><figcaption>1653984085095</figcaption></figure></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/skxndbzu/JackChenBlogs/edit/main/src/posts/æ•°æ®åº“/redis/åŸç†ç¯‡.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 615880048@qq.com">é™ˆé“­é¹¤</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E9%AB%98%E7%BA%A7%E7%AF%87.html" aria-label="é«˜çº§ç¯‡"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>é«˜çº§ç¯‡</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">åƒé‡Œä¹‹è¡Œ å§‹äºè¶³ä¸‹</div><div class="vp-copyright">Copyright Â© 2024 Jack-Chen </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BYKnUcUk.js" defer></script>
  </body>
</html>
