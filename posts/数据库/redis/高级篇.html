<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E9%AB%98%E7%BA%A7%E7%AF%87.html"><meta property="og:site_name" content="éº»èŠ±çš„å°ç«™"><meta property="og:title" content="é«˜çº§ç¯‡"><meta property="og:description" content="åˆ†å¸ƒå¼ç¼“å­˜ -- åŸºäºRedisé›†ç¾¤è§£å†³å•æœºRediså­˜åœ¨çš„é—®é¢˜ å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜ï¼š image-20210725144240631image-20210725144240631 1.RedisæŒä¹…åŒ– Redisæœ‰ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š RDBæŒä¹…åŒ– AOFæŒä¹…åŒ– 1.1.RDBæŒä¹…åŒ– RDBå…¨ç§°Redis Database Backup fil..."><meta property="og:type" content="article"><meta property="og:image" content="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725144240631.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-07-20T08:44:09.000Z"><meta property="article:author" content="Jack-Chen"><meta property="article:tag" content="æŒä¹…åŒ–"><meta property="article:tag" content="ä¸»ä»"><meta property="article:published_time" content="2023-01-01T00:00:00.000Z"><meta property="article:modified_time" content="2024-07-20T08:44:09.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"é«˜çº§ç¯‡","image":["https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725144240631.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725144536958.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725144725943.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151319695.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151543640.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151654046.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151729118.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151940515.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152037611.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152052501.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152222497.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152700914.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153201086.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153359022.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153524190.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153715910.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153937031.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154155984.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154216392.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154405899.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154528072.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154632354.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154816841.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155019276.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155124958.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155747294.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155806288.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155820320.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155850200.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725160138290.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725160448139.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725160448139.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161007099.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161241793.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161401925.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161506241.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161540841.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161637152.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161731738.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161817642.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162030478.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162101228.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162145497.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162224058.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727161152065.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162319490.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162408979.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727160803386.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162441407.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727160037766.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727161152065.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821075259137.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821075558137.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821080511581.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821080954947.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821081418456.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821081826399.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091437975.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091621308.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091638140.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091835406.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091904332.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821092657918.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821092902946.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821092941139.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/yeVDlwtfMx.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821093144700.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821094447709.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821100755080.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821100801756.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821101217089.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821101433528.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821101721649.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821102235467.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821102610167.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821102959829.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821104149061.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821104857413.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821110441222.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821111023255.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112420464.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112444482.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112559965.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112637430.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821113340111.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821114528954.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821114742950.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115108528.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115552327.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115719363.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115914748.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115948395.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821120017324.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821120049024.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521120213631.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521122320482.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521124650117.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521133359507.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521133703245.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521140415785.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521140621204.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521142943350.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521143458010.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521144339377.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521151459880.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521151524621.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521151902080.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653126446641.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653129590210.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653130457771.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653130475979.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653130858066.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132073570.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132098823.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132410073.png","https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132740637.png"],"datePublished":"2023-01-01T00:00:00.000Z","dateModified":"2024-07-20T08:44:09.000Z","author":[{"@type":"Person","name":"Jack-Chen","url":"https://chemnminghe.top"}]}</script><title>é«˜çº§ç¯‡ | éº»èŠ±çš„å°ç«™</title><meta name="description" content="åˆ†å¸ƒå¼ç¼“å­˜ -- åŸºäºRedisé›†ç¾¤è§£å†³å•æœºRediså­˜åœ¨çš„é—®é¢˜ å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜ï¼š image-20210725144240631image-20210725144240631 1.RedisæŒä¹…åŒ– Redisæœ‰ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š RDBæŒä¹…åŒ– AOFæŒä¹…åŒ– 1.1.RDBæŒä¹…åŒ– RDBå…¨ç§°Redis Database Backup fil...">
    <link rel="preload" href="/assets/style-Tnuk6l9P.css" as="style"><link rel="stylesheet" href="/assets/style-Tnuk6l9P.css">
    <link rel="modulepreload" href="/assets/app-BYKnUcUk.js"><link rel="modulepreload" href="/assets/é«˜çº§ç¯‡.html-p9YGWfFF.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-Dg26PWDC.js" as="script"><link rel="prefetch" href="/assets/intro.html-KFRiDOsS.js" as="script"><link rel="prefetch" href="/assets/index.html-DXVMGbK_.js" as="script"><link rel="prefetch" href="/assets/index.html-BlkC4sOC.js" as="script"><link rel="prefetch" href="/assets/page.html-8eF0DMIs.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬ä¸­ç§‘è½¯.html-Bck9Ovvv.js" as="script"><link rel="prefetch" href="/assets/åŒ—äº¬é‘«ä¸‡å®¶ç§‘æŠ€.html-DJyWw-CE.js" as="script"><link rel="prefetch" href="/assets/å—äº¬ä¸­ç§‘è½¯.html-CawQ2rVf.js" as="script"><link rel="prefetch" href="/assets/å¤©æ´¥å‡½æ•°è§†ç•Œ.html-C-TiMN6Z.js" as="script"><link rel="prefetch" href="/assets/å®‰ç¡•ä¿¡æ¯(ä¸œåŒ—éƒ¨).html-DVi4BHIU.js" as="script"><link rel="prefetch" href="/assets/ç”˜è‚ƒä¸­å·¥å›½é™….html-NtUMCt1j.js" as="script"><link rel="prefetch" href="/assets/index.html-DMDh3LDY.js" as="script"><link rel="prefetch" href="/assets/index.html-CqzzyQnl.js" as="script"><link rel="prefetch" href="/assets/disable.html-BOrrIM9r.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-DymZ1DOG.js" as="script"><link rel="prefetch" href="/assets/layout.html-A-c9Ggq0.js" as="script"><link rel="prefetch" href="/assets/markdown.html-C8O_PvDt.js" as="script"><link rel="prefetch" href="/assets/page.html-D2smeGlL.js" as="script"><link rel="prefetch" href="/assets/JUC.html-Cj4sCeFN.js" as="script"><link rel="prefetch" href="/assets/JVM.html-DYElkVqJ.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-Bkoiz6tX.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-DWKKED3-.js" as="script"><link rel="prefetch" href="/assets/vue.html-oadawlZV.js" as="script"><link rel="prefetch" href="/assets/Spring.html-wHqo2Q3V.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-BZDOUqnu.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-BFlMmh-4.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-B3j2Lg8l.js" as="script"><link rel="prefetch" href="/assets/Docker.html-Cy9ibnN8.js" as="script"><link rel="prefetch" href="/assets/Git.html-BlQ49nEZ.js" as="script"><link rel="prefetch" href="/assets/Gradle.html-Dnu6SacT.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-D300gZ6D.js" as="script"><link rel="prefetch" href="/assets/maven.html-CGWWO-4T.js" as="script"><link rel="prefetch" href="/assets/2.html-CKmB1act.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-7U0rTwA0.js" as="script"><link rel="prefetch" href="/assets/zookeeper.html-BmWaRG4e.js" as="script"><link rel="prefetch" href="/assets/2.html-C8mvFmp5.js" as="script"><link rel="prefetch" href="/assets/3.html-k7U_2ikD.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®ä»‹ç».html-BWz1Qj32.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-DSI5_9CS.js" as="script"><link rel="prefetch" href="/assets/elasticsearch.html--akDBJ2P.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-BP4wCjEU.js" as="script"><link rel="prefetch" href="/assets/1.html-B-pCz_Xa.js" as="script"><link rel="prefetch" href="/assets/2.html-B1MtwO_F.js" as="script"><link rel="prefetch" href="/assets/3.html-DMy2siDl.js" as="script"><link rel="prefetch" href="/assets/Linux.html-DOMAI1Pp.js" as="script"><link rel="prefetch" href="/assets/æ“ä½œç³»ç»Ÿ.html-DikAXKka.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œ.html-D4YsVC3c.js" as="script"><link rel="prefetch" href="/assets/1.html-CBzzi2bS.js" as="script"><link rel="prefetch" href="/assets/2.html-CtkFT2MW.js" as="script"><link rel="prefetch" href="/assets/3.html-DyPE17VK.js" as="script"><link rel="prefetch" href="/assets/1.html-BYP8voes.js" as="script"><link rel="prefetch" href="/assets/2.html-B-VuoRyO.js" as="script"><link rel="prefetch" href="/assets/3.html-CFhbBSzB.js" as="script"><link rel="prefetch" href="/assets/1.html-Dfi4JgTT.js" as="script"><link rel="prefetch" href="/assets/2.html-3Ej9hRsH.js" as="script"><link rel="prefetch" href="/assets/3.html-mXKabJxq.js" as="script"><link rel="prefetch" href="/assets/åŸç†ç¯‡.html-DUjvfC2M.js" as="script"><link rel="prefetch" href="/assets/åŸºç¡€ç¯‡.html-BLI3gQ9e.js" as="script"><link rel="prefetch" href="/assets/å®æˆ˜ç¯‡.html-CU5N4Ilp.js" as="script"><link rel="prefetch" href="/assets/404.html-HcIB-o9i.js" as="script"><link rel="prefetch" href="/assets/index.html-De94tPkF.js" as="script"><link rel="prefetch" href="/assets/index.html-ByvX0y-H.js" as="script"><link rel="prefetch" href="/assets/index.html-DmZGQL8T.js" as="script"><link rel="prefetch" href="/assets/index.html-C0afhGvF.js" as="script"><link rel="prefetch" href="/assets/index.html-wL1ZfdOf.js" as="script"><link rel="prefetch" href="/assets/index.html-eMvOoaZC.js" as="script"><link rel="prefetch" href="/assets/index.html-BmRkjHr_.js" as="script"><link rel="prefetch" href="/assets/index.html-DpHBumR0.js" as="script"><link rel="prefetch" href="/assets/index.html-DysWg-Eb.js" as="script"><link rel="prefetch" href="/assets/index.html-BJeBBKlO.js" as="script"><link rel="prefetch" href="/assets/index.html-DPs9VwAX.js" as="script"><link rel="prefetch" href="/assets/index.html-CkIkyL6y.js" as="script"><link rel="prefetch" href="/assets/index.html-PJluwjn2.js" as="script"><link rel="prefetch" href="/assets/index.html-DovcwOVQ.js" as="script"><link rel="prefetch" href="/assets/index.html-6-xupXrt.js" as="script"><link rel="prefetch" href="/assets/index.html-D4KrBOga.js" as="script"><link rel="prefetch" href="/assets/index.html-CAkSL-EB.js" as="script"><link rel="prefetch" href="/assets/index.html-DpTuR_ad.js" as="script"><link rel="prefetch" href="/assets/index.html-V6g9-9RJ.js" as="script"><link rel="prefetch" href="/assets/index.html-CYkxHVb0.js" as="script"><link rel="prefetch" href="/assets/index.html-BH7kxkTh.js" as="script"><link rel="prefetch" href="/assets/index.html-ZDUam0Bi.js" as="script"><link rel="prefetch" href="/assets/index.html-hwnE4f7-.js" as="script"><link rel="prefetch" href="/assets/index.html-eAo-BbE2.js" as="script"><link rel="prefetch" href="/assets/index.html-CSTxZy1d.js" as="script"><link rel="prefetch" href="/assets/index.html-BY1NzVnX.js" as="script"><link rel="prefetch" href="/assets/index.html-CN0R_zgD.js" as="script"><link rel="prefetch" href="/assets/index.html-DlnBlkCQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Bu8UcH2W.js" as="script"><link rel="prefetch" href="/assets/index.html-DWCXfRVF.js" as="script"><link rel="prefetch" href="/assets/index.html-DjhPDlDo.js" as="script"><link rel="prefetch" href="/assets/index.html-EqhIMeyP.js" as="script"><link rel="prefetch" href="/assets/index.html-DTI8Yt-I.js" as="script"><link rel="prefetch" href="/assets/index.html-lh4uVlGB.js" as="script"><link rel="prefetch" href="/assets/index.html-cIfrys5U.js" as="script"><link rel="prefetch" href="/assets/index.html-CjQudSQG.js" as="script"><link rel="prefetch" href="/assets/index.html-Dpp1nhq1.js" as="script"><link rel="prefetch" href="/assets/index.html-f-CbCiWH.js" as="script"><link rel="prefetch" href="/assets/index.html-iRFzr8Ry.js" as="script"><link rel="prefetch" href="/assets/index.html-BF6v9vBj.js" as="script"><link rel="prefetch" href="/assets/index.html-BA5bibSx.js" as="script"><link rel="prefetch" href="/assets/index.html-CAQayavk.js" as="script"><link rel="prefetch" href="/assets/index.html-DGHxWL1t.js" as="script"><link rel="prefetch" href="/assets/index.html-B57g5aL0.js" as="script"><link rel="prefetch" href="/assets/index.html-BOzDqnUC.js" as="script"><link rel="prefetch" href="/assets/index.html-B-C72qpx.js" as="script"><link rel="prefetch" href="/assets/index.html-BOnn7tpN.js" as="script"><link rel="prefetch" href="/assets/index.html-DhdpaJ0q.js" as="script"><link rel="prefetch" href="/assets/index.html-DPh0Ij6g.js" as="script"><link rel="prefetch" href="/assets/index.html-KvXzk4j_.js" as="script"><link rel="prefetch" href="/assets/index.html-B4QHnHFp.js" as="script"><link rel="prefetch" href="/assets/index.html-CbHuVcPi.js" as="script"><link rel="prefetch" href="/assets/index.html-OU-yfYV-.js" as="script"><link rel="prefetch" href="/assets/index.html-DyiZHthR.js" as="script"><link rel="prefetch" href="/assets/index.html-amzcZaBg.js" as="script"><link rel="prefetch" href="/assets/index.html-x93sL2WV.js" as="script"><link rel="prefetch" href="/assets/index.html-B1ASKpuy.js" as="script"><link rel="prefetch" href="/assets/index.html-D-Vu4wEk.js" as="script"><link rel="prefetch" href="/assets/index.html-D1PaZ4Px.js" as="script"><link rel="prefetch" href="/assets/index.html-ByHe7rrM.js" as="script"><link rel="prefetch" href="/assets/index.html-iYl8oOWK.js" as="script"><link rel="prefetch" href="/assets/index.html-C2TJv6D3.js" as="script"><link rel="prefetch" href="/assets/index.html-CcmzxkUK.js" as="script"><link rel="prefetch" href="/assets/index.html-CS9wFxAs.js" as="script"><link rel="prefetch" href="/assets/index.html-CusJJHmz.js" as="script"><link rel="prefetch" href="/assets/index.html-XBfBFw9n.js" as="script"><link rel="prefetch" href="/assets/index.html-Bb9TU5uP.js" as="script"><link rel="prefetch" href="/assets/index.html-DW06xorC.js" as="script"><link rel="prefetch" href="/assets/index.html-BAJiDExF.js" as="script"><link rel="prefetch" href="/assets/index.html-D2Fi0_YV.js" as="script"><link rel="prefetch" href="/assets/index.html-BLdCr4hE.js" as="script"><link rel="prefetch" href="/assets/index.html-5XkYVEn9.js" as="script"><link rel="prefetch" href="/assets/index.html-lC-C7DH-.js" as="script"><link rel="prefetch" href="/assets/index.html-BozW6VZQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DA9gqjbM.js" as="script"><link rel="prefetch" href="/assets/index.html-DS1ygI10.js" as="script"><link rel="prefetch" href="/assets/index.html-DCO33K0q.js" as="script"><link rel="prefetch" href="/assets/index.html-d5-3wl__.js" as="script"><link rel="prefetch" href="/assets/index.html-BnTM10cR.js" as="script"><link rel="prefetch" href="/assets/index.html-CU0EkorC.js" as="script"><link rel="prefetch" href="/assets/index.html-BSpai6iX.js" as="script"><link rel="prefetch" href="/assets/index.html-CAqEV4PP.js" as="script"><link rel="prefetch" href="/assets/index.html-BEqMhOv2.js" as="script"><link rel="prefetch" href="/assets/index.html-9dOH66Vh.js" as="script"><link rel="prefetch" href="/assets/index.html-x-2WSG3b.js" as="script"><link rel="prefetch" href="/assets/index.html-Dh4QBATH.js" as="script"><link rel="prefetch" href="/assets/index.html-DdvC0JR-.js" as="script"><link rel="prefetch" href="/assets/index.html-DB9Ce9bK.js" as="script"><link rel="prefetch" href="/assets/index.html-GY66i-NL.js" as="script"><link rel="prefetch" href="/assets/index.html-DVd6jweh.js" as="script"><link rel="prefetch" href="/assets/index.html-BsDJyw0T.js" as="script"><link rel="prefetch" href="/assets/index.html-tMlsy0Tt.js" as="script"><link rel="prefetch" href="/assets/index.html-qJ9VOzN6.js" as="script"><link rel="prefetch" href="/assets/index.html-DW6AtmgZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CcE36Sae.js" as="script"><link rel="prefetch" href="/assets/index.html-Cy2lF-_O.js" as="script"><link rel="prefetch" href="/assets/index.html-BTrnHnwl.js" as="script"><link rel="prefetch" href="/assets/index.html-D_AHdFea.js" as="script"><link rel="prefetch" href="/assets/index.html-DCbCRxOr.js" as="script"><link rel="prefetch" href="/assets/index.html-BZJtHztz.js" as="script"><link rel="prefetch" href="/assets/index.html-BcK4qFOY.js" as="script"><link rel="prefetch" href="/assets/index.html-D2EdXpwA.js" as="script"><link rel="prefetch" href="/assets/index.html-CNpKGhwQ.js" as="script"><link rel="prefetch" href="/assets/index.html-LxMNsTlr.js" as="script"><link rel="prefetch" href="/assets/index.html-GbTEJVbb.js" as="script"><link rel="prefetch" href="/assets/index.html-D8MDU7UK.js" as="script"><link rel="prefetch" href="/assets/index.html-0yDW4CE5.js" as="script"><link rel="prefetch" href="/assets/index.html-Btv9D28_.js" as="script"><link rel="prefetch" href="/assets/index.html-uNlrWcWe.js" as="script"><link rel="prefetch" href="/assets/index.html-CbWbdpyP.js" as="script"><link rel="prefetch" href="/assets/index.html-3QLd1atz.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmSYFqm.js" as="script"><link rel="prefetch" href="/assets/index.html-CHLcacMt.js" as="script"><link rel="prefetch" href="/assets/index.html-LkqckBfX.js" as="script"><link rel="prefetch" href="/assets/index.html-aPWs6wmZ.js" as="script"><link rel="prefetch" href="/assets/index.html-LdEHmxw_.js" as="script"><link rel="prefetch" href="/assets/index.html-DlX5crC1.js" as="script"><link rel="prefetch" href="/assets/index.html-BbOKxsD8.js" as="script"><link rel="prefetch" href="/assets/index.html-Cfey_So8.js" as="script"><link rel="prefetch" href="/assets/index.html-BblCy8B5.js" as="script"><link rel="prefetch" href="/assets/index.html-D4muVTPQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DLhQplXf.js" as="script"><link rel="prefetch" href="/assets/index.html-BB7sJ9VJ.js" as="script"><link rel="prefetch" href="/assets/index.html-C0L5ys2E.js" as="script"><link rel="prefetch" href="/assets/index.html-BEoKypIr.js" as="script"><link rel="prefetch" href="/assets/index.html-BmTZPT6G.js" as="script"><link rel="prefetch" href="/assets/index.html-DvcPzIqP.js" as="script"><link rel="prefetch" href="/assets/index.html-D_OIRe_j.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/touxiang/vue-color-avatar3.png" alt><!----><span class="vp-site-name hide-in-pad">éº»èŠ±çš„å°ç«™</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon iconfont icon-xuexibiji" style=""></span><!--]-->å­¦ä¹ ç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interviewExperience/" aria-label="é¢è¯•ä¸“æ "><!--[--><span class="font-icon icon iconfont icon-flow-interview" style=""></span><!--]-->é¢è¯•ä¸“æ <!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/softwareTutorial/" aria-label="è½¯ä»¶æ•™ç¨‹"><!--[--><span class="font-icon icon iconfont icon-ruanjianjiaocheng1" style=""></span><!--]-->è½¯ä»¶æ•™ç¨‹<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/aboutMe/" aria-label="å…³äºæˆ‘"><!--[--><span class="font-icon icon iconfont icon-guanyuzuozhe" style=""></span><!--]-->å…³äºæˆ‘<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/skxndbzu/JackChenBlogs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon iconfont icon-shouye" style=""></span><!--]-->é¦–é¡µ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-meiribikan" style=""></span><span class="vp-sidebar-title">å¿…çœ‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-zhenrenmianshi" style=""></span><span class="vp-sidebar-title">é¢è¯•ä¸“æ </span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-application--web" style=""></span><span class="vp-sidebar-title">è®¡ç®—æœºåŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-xitongsheji" style=""></span><span class="vp-sidebar-title">ç³»ç»Ÿè®¾è®¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-jurassic_data" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/elasticsearch.html" aria-label="elasticsearch"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->elasticsearch<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" aria-label="MySQL"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->MySQL<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%9F%BA%E7%A1%80%E7%AF%87.html" aria-label="åŸºç¡€ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->åŸºç¡€ç¯‡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%AE%9E%E6%88%98%E7%AF%87.html" aria-label="å®æˆ˜ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->å®æˆ˜ç¯‡<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E9%AB%98%E7%BA%A7%E7%AF%87.html" aria-label="é«˜çº§ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->é«˜çº§ç¯‡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%8E%9F%E7%90%86%E7%AF%87.html" aria-label="åŸç†ç¯‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->åŸç†ç¯‡<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-kaifagongju" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/developmentTool/" aria-label="å¼€å‘å·¥å…·"><!---->å¼€å‘å·¥å…·<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¸¸ç”¨æ¡†æ¶"><!---->å¸¸ç”¨æ¡†æ¶<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-yemiankuangjia_o" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å¾®æœåŠ¡æ¶æ„"><!---->å¾®æœåŠ¡æ¶æ„<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="å‰ç«¯"><!---->å‰ç«¯<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-qianduan" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/demo/" aria-label="æ¶ˆæ¯ä¸­é—´ä»¶"><!---->æ¶ˆæ¯ä¸­é—´ä»¶<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="ä»‹ç»é¡µ"><!--[--><span class="font-icon icon iconfont icon-fenxiangdingqijieshao" style=""></span><!--]-->ä»‹ç»é¡µ<!----></a></li><li><a class="auto-link external-link vp-sidebar-link" href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" aria-label="å¹»ç¯ç‰‡" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon iconfont icon-huandengpian-04" style=""></span><!--]-->å¹»ç¯ç‰‡<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>é«˜çº§ç¯‡</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://chemnminghe.top" target="_blank" rel="noopener noreferrer">Jack-Chen</a></span><span property="author" content="Jack-Chen"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 67 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT67M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color3 clickable" role="navigation">Redis</span><!--]--><meta property="articleSection" content="Redis"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color7 clickable" role="navigation">æŒä¹…åŒ–</span><span class="page-tag-item color4 clickable" role="navigation">ä¸»ä»</span><!--]--><meta property="keywords" content="æŒä¹…åŒ–,ä¸»ä»"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-1-rdbæŒä¹…åŒ–">1.1.RDBæŒä¹…åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-1-æ‰§è¡Œæ—¶æœº">1.1.1.æ‰§è¡Œæ—¶æœº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-2-rdbåŸç†">1.1.2.RDBåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-3-å°ç»“">1.1.3.å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-aofæŒä¹…åŒ–">1.2.AOFæŒä¹…åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-1-aofåŸç†">1.2.1.AOFåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-2-aofé…ç½®">1.2.2.AOFé…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-3-aofæ–‡ä»¶é‡å†™">1.2.3.AOFæ–‡ä»¶é‡å†™</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-3-rdbä¸aofå¯¹æ¯”">1.3.RDBä¸AOFå¯¹æ¯”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-1-æ­å»ºä¸»ä»æ¶æ„">2.1.æ­å»ºä¸»ä»æ¶æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-2-ä¸»ä»æ•°æ®åŒæ­¥åŸç†">2.2.ä¸»ä»æ•°æ®åŒæ­¥åŸç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-1-å…¨é‡åŒæ­¥">2.2.1.å…¨é‡åŒæ­¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-2-å¢é‡åŒæ­¥">2.2.2.å¢é‡åŒæ­¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-3-repl-backlogåŸç†">2.2.3.repl_backlogåŸç†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-3-ä¸»ä»åŒæ­¥ä¼˜åŒ–">2.3.ä¸»ä»åŒæ­¥ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-4-å°ç»“">2.4.å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-1-å“¨å…µåŸç†">3.1.å“¨å…µåŸç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-1-é›†ç¾¤ç»“æ„å’Œä½œç”¨">3.1.1.é›†ç¾¤ç»“æ„å’Œä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-2-é›†ç¾¤ç›‘æ§åŸç†">3.1.2.é›†ç¾¤ç›‘æ§åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-3-é›†ç¾¤æ•…éšœæ¢å¤åŸç†">3.1.3.é›†ç¾¤æ•…éšœæ¢å¤åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-4-å°ç»“">3.1.4.å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-2-æ­å»ºå“¨å…µé›†ç¾¤">3.2.æ­å»ºå“¨å…µé›†ç¾¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-3-redistemplate">3.3.RedisTemplate</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-1-å¯¼å…¥demoå·¥ç¨‹">3.3.1.å¯¼å…¥Demoå·¥ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-2-å¼•å…¥ä¾èµ–">3.3.2.å¼•å…¥ä¾èµ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-3-é…ç½®redisåœ°å€">3.3.3.é…ç½®Redisåœ°å€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-4-é…ç½®è¯»å†™åˆ†ç¦»">3.3.4.é…ç½®è¯»å†™åˆ†ç¦»</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-1-æ­å»ºåˆ†ç‰‡é›†ç¾¤">4.1.æ­å»ºåˆ†ç‰‡é›†ç¾¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-2-æ•£åˆ—æ’æ§½">4.2.æ•£åˆ—æ’æ§½</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-1-æ’æ§½åŸç†">4.2.1.æ’æ§½åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-1-å°ç»“">4.2.1.å°ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-3-é›†ç¾¤ä¼¸ç¼©">4.3.é›†ç¾¤ä¼¸ç¼©</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-1-éœ€æ±‚åˆ†æ">4.3.1.éœ€æ±‚åˆ†æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-2-åˆ›å»ºæ–°çš„rediså®ä¾‹">4.3.2.åˆ›å»ºæ–°çš„rediså®ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-3-æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis">4.3.3.æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-4-è½¬ç§»æ’æ§½">4.3.4.è½¬ç§»æ’æ§½</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-4-æ•…éšœè½¬ç§»">4.4.æ•…éšœè½¬ç§»</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-1-è‡ªåŠ¨æ•…éšœè½¬ç§»">4.4.1.è‡ªåŠ¨æ•…éšœè½¬ç§»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-2-æ‰‹åŠ¨æ•…éšœè½¬ç§»">4.4.2.æ‰‹åŠ¨æ•…éšœè½¬ç§»</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-5-redistemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤">4.5.RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-1-å¯¼å…¥æ¡ˆä¾‹">2.1.å¯¼å…¥æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-2-åˆè¯†caffeine">2.2.åˆè¯†Caffeine</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-3-å®ç°jvmè¿›ç¨‹ç¼“å­˜">2.3.å®ç°JVMè¿›ç¨‹ç¼“å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-1-éœ€æ±‚">2.3.1.éœ€æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-2-å®ç°">2.3.2.å®ç°</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-1-åˆè¯†lua">3.1.åˆè¯†Lua</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-1-helloworld">3.1.HelloWorld</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-2-å˜é‡å’Œå¾ªç¯">3.2.å˜é‡å’Œå¾ªç¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-1-luaçš„æ•°æ®ç±»å‹">3.2.1.Luaçš„æ•°æ®ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-2-å£°æ˜å˜é‡">3.2.2.å£°æ˜å˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-3-å¾ªç¯">3.2.3.å¾ªç¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-3-æ¡ä»¶æ§åˆ¶ã€å‡½æ•°">3.3.æ¡ä»¶æ§åˆ¶ã€å‡½æ•°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-1-å‡½æ•°">3.3.1.å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-2-æ¡ä»¶æ§åˆ¶">3.3.2.æ¡ä»¶æ§åˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-3-æ¡ˆä¾‹">3.3.3.æ¡ˆä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-1-å®‰è£…openresty">4.1.å®‰è£…OpenResty</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-2-openrestyå¿«é€Ÿå…¥é—¨">4.2.OpenRestyå¿«é€Ÿå…¥é—¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-1-åå‘ä»£ç†æµç¨‹">4.2.1.åå‘ä»£ç†æµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-2-openrestyç›‘å¬è¯·æ±‚">4.2.2.OpenRestyç›‘å¬è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-3-ç¼–å†™item-lua">4.2.3.ç¼–å†™item.lua</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-3-è¯·æ±‚å‚æ•°å¤„ç†">4.3.è¯·æ±‚å‚æ•°å¤„ç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-1-è·å–å‚æ•°çš„api">4.3.1.è·å–å‚æ•°çš„API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-2-è·å–å‚æ•°å¹¶è¿”å›">4.3.2.è·å–å‚æ•°å¹¶è¿”å›</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-4-æŸ¥è¯¢tomcat">4.4.æŸ¥è¯¢Tomcat</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-1-å‘é€httpè¯·æ±‚çš„api">4.4.1.å‘é€httpè¯·æ±‚çš„API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-2-å°è£…httpå·¥å…·">4.4.2.å°è£…httpå·¥å…·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-3-cjsonå·¥å…·ç±»">4.4.3.CJSONå·¥å…·ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-4-å®ç°tomcatæŸ¥è¯¢">4.4.4.å®ç°TomcatæŸ¥è¯¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-5-åŸºäºidè´Ÿè½½å‡è¡¡">4.4.5.åŸºäºIDè´Ÿè½½å‡è¡¡</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-5-redisç¼“å­˜é¢„çƒ­">4.5.Redisç¼“å­˜é¢„çƒ­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-6-æŸ¥è¯¢redisç¼“å­˜">4.6.æŸ¥è¯¢Redisç¼“å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-6-1-å°è£…rediså·¥å…·">4.6.1.å°è£…Rediså·¥å…·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-6-2-å®ç°redisæŸ¥è¯¢">4.6.2.å®ç°RedisæŸ¥è¯¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-7-nginxæœ¬åœ°ç¼“å­˜">4.7.Nginxæœ¬åœ°ç¼“å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-7-1-æœ¬åœ°ç¼“å­˜api">4.7.1.æœ¬åœ°ç¼“å­˜API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-7-2-å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢">4.7.2.å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-1-æ•°æ®åŒæ­¥ç­–ç•¥">5.1.æ•°æ®åŒæ­¥ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-2-å®‰è£…canal">5.2.å®‰è£…Canal</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-1-è®¤è¯†canal">5.2.1.è®¤è¯†Canal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-2-å®‰è£…canal">5.2.2.å®‰è£…Canal</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-3-ç›‘å¬canal">5.3.ç›‘å¬Canal</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-1-å¼•å…¥ä¾èµ–">5.3.1.å¼•å…¥ä¾èµ–ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-2-ç¼–å†™é…ç½®">5.3.2.ç¼–å†™é…ç½®ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-3-ä¿®æ”¹itemå®ä½“ç±»">5.3.3.ä¿®æ”¹Itemå®ä½“ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-4-ç¼–å†™ç›‘å¬å™¨">5.3.4.ç¼–å†™ç›‘å¬å™¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#redisé«˜çº§ç¯‡ä¹‹å®è·µ">Redisé«˜çº§ç¯‡ä¹‹å®è·µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1ã€redisé”®å€¼è®¾è®¡">1ã€Redisé”®å€¼è®¾è®¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1ã€ä¼˜é›…çš„keyç»“æ„">1.1ã€ä¼˜é›…çš„keyç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2ã€æ‹’ç»bigkey">1.2ã€æ‹’ç»BigKey</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-3ã€æ°å½“çš„æ•°æ®ç±»å‹">1.3ã€æ°å½“çš„æ•°æ®ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-4ã€æ€»ç»“">1.4ã€æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2ã€æ‰¹å¤„ç†ä¼˜åŒ–">2ã€æ‰¹å¤„ç†ä¼˜åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1ã€pipeline">2.1ã€Pipeline</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2ã€é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†">2.2ã€é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æŒä¹…åŒ–é…ç½®">3ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æŒä¹…åŒ–é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æ…¢æŸ¥è¯¢ä¼˜åŒ–">4ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æ…¢æŸ¥è¯¢ä¼˜åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢">4.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢">4.2 å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-å‘½ä»¤åŠå®‰å…¨é…ç½®">5ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-å‘½ä»¤åŠå®‰å…¨é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-rediså†…å­˜åˆ’åˆ†å’Œå†…å­˜é…ç½®">6ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-Rediså†…å­˜åˆ’åˆ†å’Œå†…å­˜é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7ã€æœåŠ¡å™¨ç«¯é›†ç¾¤ä¼˜åŒ–-é›†ç¾¤è¿˜æ˜¯ä¸»ä»">7ã€æœåŠ¡å™¨ç«¯é›†ç¾¤ä¼˜åŒ–-é›†ç¾¤è¿˜æ˜¯ä¸»ä»</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="åˆ†å¸ƒå¼ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼ç¼“å­˜"><span>åˆ†å¸ƒå¼ç¼“å­˜</span></a></h1><p>-- åŸºäºRedisé›†ç¾¤è§£å†³å•æœºRediså­˜åœ¨çš„é—®é¢˜</p><p>å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725144240631.png" alt="image-20210725144240631" tabindex="0" loading="lazy"><figcaption>image-20210725144240631</figcaption></figure><h1 id="_1-redisæŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-redisæŒä¹…åŒ–"><span>1.RedisæŒä¹…åŒ–</span></a></h1><p>Redisæœ‰ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š</p><ul><li>RDBæŒä¹…åŒ–</li><li>AOFæŒä¹…åŒ–</li></ul><h2 id="_1-1-rdbæŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-1-rdbæŒä¹…åŒ–"><span>1.1.RDBæŒä¹…åŒ–</span></a></h2><p>RDBå…¨ç§°Redis Database Backup fileï¼ˆRedisæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼‰ï¼Œä¹Ÿè¢«å«åšRedisæ•°æ®å¿«ç…§ã€‚ç®€å•æ¥è¯´å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚å½“Rediså®ä¾‹æ•…éšœé‡å¯åï¼Œä»ç£ç›˜è¯»å–å¿«ç…§æ–‡ä»¶ï¼Œæ¢å¤æ•°æ®ã€‚å¿«ç…§æ–‡ä»¶ç§°ä¸ºRDBæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ä¿å­˜åœ¨å½“å‰è¿è¡Œç›®å½•ã€‚</p><h3 id="_1-1-1-æ‰§è¡Œæ—¶æœº" tabindex="-1"><a class="header-anchor" href="#_1-1-1-æ‰§è¡Œæ—¶æœº"><span>1.1.1.æ‰§è¡Œæ—¶æœº</span></a></h3><p>RDBæŒä¹…åŒ–åœ¨å››ç§æƒ…å†µä¸‹ä¼šæ‰§è¡Œï¼š</p><ul><li>æ‰§è¡Œsaveå‘½ä»¤</li><li>æ‰§è¡Œbgsaveå‘½ä»¤</li><li>Redisåœæœºæ—¶</li><li>è§¦å‘RDBæ¡ä»¶æ—¶</li></ul><p><strong>1ï¼‰saveå‘½ä»¤</strong></p><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œä¸€æ¬¡RDBï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725144536958.png" alt="image-20210725144536958" tabindex="0" loading="lazy"><figcaption>image-20210725144536958</figcaption></figure><p>saveå‘½ä»¤ä¼šå¯¼è‡´ä¸»è¿›ç¨‹æ‰§è¡ŒRDBï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å…¶å®ƒæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«é˜»å¡ã€‚åªæœ‰åœ¨æ•°æ®è¿ç§»æ—¶å¯èƒ½ç”¨åˆ°ã€‚</p><p><strong>2ï¼‰bgsaveå‘½ä»¤</strong></p><p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¼‚æ­¥æ‰§è¡ŒRDBï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725144725943.png" alt="image-20210725144725943" tabindex="0" loading="lazy"><figcaption>image-20210725144725943</figcaption></figure><p>è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåä¼šå¼€å¯ç‹¬ç«‹è¿›ç¨‹å®ŒæˆRDBï¼Œä¸»è¿›ç¨‹å¯ä»¥æŒç»­å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œä¸å—å½±å“ã€‚</p><p><strong>3ï¼‰åœæœºæ—¶</strong></p><p>Redisåœæœºæ—¶ä¼šæ‰§è¡Œä¸€æ¬¡saveå‘½ä»¤ï¼Œå®ç°RDBæŒä¹…åŒ–ã€‚</p><p><strong>4ï¼‰è§¦å‘RDBæ¡ä»¶</strong></p><p>Rediså†…éƒ¨æœ‰è§¦å‘RDBçš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 900ç§’å†…ï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹ï¼Œåˆ™æ‰§è¡Œbgsave ï¼Œ å¦‚æœæ˜¯save &quot;&quot; åˆ™è¡¨ç¤ºç¦ç”¨RDB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">save 900 1  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">save 300 10  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">save 60 10000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RDBçš„å…¶å®ƒé…ç½®ä¹Ÿå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­è®¾ç½®ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ˜¯å¦å‹ç¼© ,å»ºè®®ä¸å¼€å¯ï¼Œå‹ç¼©ä¹Ÿä¼šæ¶ˆè€—cpuï¼Œç£ç›˜çš„è¯ä¸å€¼é’±</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">rdbcompression yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># RDBæ–‡ä»¶åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">dbfilename dump.rdb  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">dir ./</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-1-2-rdbåŸç†" tabindex="-1"><a class="header-anchor" href="#_1-1-2-rdbåŸç†"><span>1.1.2.RDBåŸç†</span></a></h3><p>bgsaveå¼€å§‹æ—¶ä¼šforkä¸»è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å…±äº«ä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚å®Œæˆforkåè¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥ RDB æ–‡ä»¶ã€‚</p><p>forké‡‡ç”¨çš„æ˜¯copy-on-writeæŠ€æœ¯ï¼š</p><ul><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œè®¿é—®å…±äº«å†…å­˜ï¼›</li><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œåˆ™ä¼šæ‹·è´ä¸€ä»½æ•°æ®ï¼Œæ‰§è¡Œå†™æ“ä½œã€‚</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151319695.png" alt="image-20210725151319695" tabindex="0" loading="lazy"><figcaption>image-20210725151319695</figcaption></figure><h3 id="_1-1-3-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_1-1-3-å°ç»“"><span>1.1.3.å°ç»“</span></a></h3><p>RDBæ–¹å¼bgsaveçš„åŸºæœ¬æµç¨‹ï¼Ÿ</p><ul><li>forkä¸»è¿›ç¨‹å¾—åˆ°ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…±äº«å†…å­˜ç©ºé—´</li><li>å­è¿›ç¨‹è¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥æ–°çš„RDBæ–‡ä»¶</li><li>ç”¨æ–°RDBæ–‡ä»¶æ›¿æ¢æ—§çš„RDBæ–‡ä»¶</li></ul><p>RDBä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿsave 60 1000ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ</p><ul><li>é»˜è®¤æ˜¯æœåŠ¡åœæ­¢æ—¶</li><li>ä»£è¡¨60ç§’å†…è‡³å°‘æ‰§è¡Œ1000æ¬¡ä¿®æ”¹åˆ™è§¦å‘RDB</li></ul><p>RDBçš„ç¼ºç‚¹ï¼Ÿ</p><ul><li>RDBæ‰§è¡Œé—´éš”æ—¶é—´é•¿ï¼Œä¸¤æ¬¡RDBä¹‹é—´å†™å…¥æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©</li><li>forkå­è¿›ç¨‹ã€å‹ç¼©ã€å†™å‡ºRDBæ–‡ä»¶éƒ½æ¯”è¾ƒè€—æ—¶</li></ul><h2 id="_1-2-aofæŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-2-aofæŒä¹…åŒ–"><span>1.2.AOFæŒä¹…åŒ–</span></a></h2><h3 id="_1-2-1-aofåŸç†" tabindex="-1"><a class="header-anchor" href="#_1-2-1-aofåŸç†"><span>1.2.1.AOFåŸç†</span></a></h3><p>AOFå…¨ç§°ä¸ºAppend Only Fileï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰ã€‚Rediså¤„ç†çš„æ¯ä¸€ä¸ªå†™å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åšæ˜¯å‘½ä»¤æ—¥å¿—æ–‡ä»¶ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151543640.png" alt="image-20210725151543640" tabindex="0" loading="lazy"><figcaption>image-20210725151543640</figcaption></figure><h3 id="_1-2-2-aofé…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-2-2-aofé…ç½®"><span>1.2.2.AOFé…ç½®</span></a></h3><p>AOFé»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶æ¥å¼€å¯AOFï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ˜¯å¦å¼€å¯AOFåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">appendonly yes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># AOFæ–‡ä»¶çš„åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">appendfilename </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;appendonly.aof&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AOFçš„å‘½ä»¤è®°å½•çš„é¢‘ç‡ä¹Ÿå¯ä»¥é€šè¿‡redis.confæ–‡ä»¶æ¥é…ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># è¡¨ç¤ºæ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œç«‹å³è®°å½•åˆ°AOFæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">appendfsync always </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç„¶åè¡¨ç¤ºæ¯éš”1ç§’å°†ç¼“å†²åŒºæ•°æ®å†™åˆ°AOFæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤æ–¹æ¡ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">appendfsync everysec </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">appendfsync no</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‰ç§ç­–ç•¥å¯¹æ¯”ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151654046.png" alt="image-20210725151654046" tabindex="0" loading="lazy"><figcaption>image-20210725151654046</figcaption></figure><h3 id="_1-2-3-aofæ–‡ä»¶é‡å†™" tabindex="-1"><a class="header-anchor" href="#_1-2-3-aofæ–‡ä»¶é‡å†™"><span>1.2.3.AOFæ–‡ä»¶é‡å†™</span></a></h3><p>å› ä¸ºæ˜¯è®°å½•å‘½ä»¤ï¼ŒAOFæ–‡ä»¶ä¼šæ¯”RDBæ–‡ä»¶å¤§çš„å¤šã€‚è€Œä¸”AOFä¼šè®°å½•å¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†™æ“ä½œï¼Œä½†åªæœ‰æœ€åä¸€æ¬¡å†™æ“ä½œæ‰æœ‰æ„ä¹‰ã€‚é€šè¿‡æ‰§è¡Œbgrewriteaofå‘½ä»¤ï¼Œå¯ä»¥è®©AOFæ–‡ä»¶æ‰§è¡Œé‡å†™åŠŸèƒ½ï¼Œç”¨æœ€å°‘çš„å‘½ä»¤è¾¾åˆ°ç›¸åŒæ•ˆæœã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151729118.png" alt="image-20210725151729118" tabindex="0" loading="lazy"><figcaption>image-20210725151729118</figcaption></figure><p>å¦‚å›¾ï¼ŒAOFåŸæœ¬æœ‰ä¸‰ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯<code>set num 123 å’Œ set num 666</code>éƒ½æ˜¯å¯¹numçš„æ“ä½œï¼Œç¬¬äºŒæ¬¡ä¼šè¦†ç›–ç¬¬ä¸€æ¬¡çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå‘½ä»¤è®°å½•ä¸‹æ¥æ²¡æœ‰æ„ä¹‰ã€‚</p><p>æ‰€ä»¥é‡å†™å‘½ä»¤åï¼ŒAOFæ–‡ä»¶å†…å®¹å°±æ˜¯ï¼š<code>mset name jack num 666</code></p><p>Redisä¹Ÿä¼šåœ¨è§¦å‘é˜ˆå€¼æ—¶è‡ªåŠ¨å»é‡å†™AOFæ–‡ä»¶ã€‚é˜ˆå€¼ä¹Ÿå¯ä»¥åœ¨redis.confä¸­é…ç½®ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># AOFæ–‡ä»¶æ¯”ä¸Šæ¬¡æ–‡ä»¶ å¢é•¿è¶…è¿‡å¤šå°‘ç™¾åˆ†æ¯”åˆ™è§¦å‘é‡å†™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># AOFæ–‡ä»¶ä½“ç§¯æœ€å°å¤šå¤§ä»¥ä¸Šæ‰è§¦å‘é‡å†™ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">auto-aof-rewrite-min-size 64mb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-3-rdbä¸aofå¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_1-3-rdbä¸aofå¯¹æ¯”"><span>1.3.RDBä¸AOFå¯¹æ¯”</span></a></h2><p>RDBå’ŒAOFå„æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œå¦‚æœå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¾€å¾€ä¼š<strong>ç»“åˆ</strong>ä¸¤è€…æ¥ä½¿ç”¨ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725151940515.png" alt="image-20210725151940515" tabindex="0" loading="lazy"><figcaption>image-20210725151940515</figcaption></figure><h1 id="_2-redisä¸»ä»" tabindex="-1"><a class="header-anchor" href="#_2-redisä¸»ä»"><span>2.Redisä¸»ä»</span></a></h1><h2 id="_2-1-æ­å»ºä¸»ä»æ¶æ„" tabindex="-1"><a class="header-anchor" href="#_2-1-æ­å»ºä¸»ä»æ¶æ„"><span>2.1.æ­å»ºä¸»ä»æ¶æ„</span></a></h2><p>å•èŠ‚ç‚¹Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œå°±éœ€è¦æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152037611.png" alt="image-20210725152037611" tabindex="0" loading="lazy"><figcaption>image-20210725152037611</figcaption></figure><p>å…·ä½“æ­å»ºæµç¨‹å‚è€ƒè¯¾å‰èµ„æ–™ã€ŠRedisé›†ç¾¤.mdã€‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152052501.png" alt="image-20210725152052501" tabindex="0" loading="lazy"><figcaption>image-20210725152052501</figcaption></figure><h2 id="_2-2-ä¸»ä»æ•°æ®åŒæ­¥åŸç†" tabindex="-1"><a class="header-anchor" href="#_2-2-ä¸»ä»æ•°æ®åŒæ­¥åŸç†"><span>2.2.ä¸»ä»æ•°æ®åŒæ­¥åŸç†</span></a></h2><h3 id="_2-2-1-å…¨é‡åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_2-2-1-å…¨é‡åŒæ­¥"><span>2.2.1.å…¨é‡åŒæ­¥</span></a></h3><p>ä¸»ä»ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œä¼šæ‰§è¡Œ<strong>å…¨é‡åŒæ­¥</strong>ï¼Œå°†masterèŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®éƒ½æ‹·è´ç»™slaveèŠ‚ç‚¹ï¼Œæµç¨‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152222497.png" alt="image-20210725152222497" tabindex="0" loading="lazy"><figcaption>image-20210725152222497</figcaption></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œmasterå¦‚ä½•å¾—çŸ¥salveæ˜¯ç¬¬ä¸€æ¬¡æ¥è¿æ¥å‘¢ï¼Ÿï¼Ÿ</p><p>æœ‰å‡ ä¸ªæ¦‚å¿µï¼Œå¯ä»¥ä½œä¸ºåˆ¤æ–­ä¾æ®ï¼š</p><ul><li><strong>Replication Id</strong>ï¼šç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterèŠ‚ç‚¹çš„replid</li><li><strong>offset</strong>ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚</li></ul><p>å› æ­¤slaveåšæ•°æ®åŒæ­¥ï¼Œå¿…é¡»å‘masterå£°æ˜è‡ªå·±çš„replication id å’Œoffsetï¼Œmasteræ‰å¯ä»¥åˆ¤æ–­åˆ°åº•éœ€è¦åŒæ­¥å“ªäº›æ•°æ®ã€‚</p><p>å› ä¸ºslaveåŸæœ¬ä¹Ÿæ˜¯ä¸€ä¸ªmasterï¼Œæœ‰è‡ªå·±çš„replidå’Œoffsetï¼Œå½“ç¬¬ä¸€æ¬¡å˜æˆslaveï¼Œä¸masterå»ºç«‹è¿æ¥æ—¶ï¼Œå‘é€çš„replidå’Œoffsetæ˜¯è‡ªå·±çš„replidå’Œoffsetã€‚</p><p>masteråˆ¤æ–­å‘ç°slaveå‘é€æ¥çš„replidä¸è‡ªå·±çš„ä¸ä¸€è‡´ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„slaveï¼Œå°±çŸ¥é“è¦åšå…¨é‡åŒæ­¥äº†ã€‚</p><p>masterä¼šå°†è‡ªå·±çš„replidå’Œoffsetéƒ½å‘é€ç»™è¿™ä¸ªslaveï¼Œslaveä¿å­˜è¿™äº›ä¿¡æ¯ã€‚ä»¥åslaveçš„replidå°±ä¸masterä¸€è‡´äº†ã€‚</p><p>å› æ­¤ï¼Œ<strong>masteråˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥çš„ä¾æ®ï¼Œå°±æ˜¯çœ‹replidæ˜¯å¦ä¸€è‡´</strong>ã€‚</p><p>å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725152700914.png" alt="image-20210725152700914" tabindex="0" loading="lazy"><figcaption>image-20210725152700914</figcaption></figure><p>å®Œæ•´æµç¨‹æè¿°ï¼š</p><ul><li>slaveèŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥</li><li>masterèŠ‚ç‚¹åˆ¤æ–­replidï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥</li><li>masterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slave</li><li>slaveæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½masterçš„RDB</li><li>masterå°†RDBæœŸé—´çš„å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œå¹¶æŒç»­å°†logä¸­çš„å‘½ä»¤å‘é€ç»™slave</li><li>slaveæ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸masterä¹‹é—´çš„åŒæ­¥</li></ul><h3 id="_2-2-2-å¢é‡åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_2-2-2-å¢é‡åŒæ­¥"><span>2.2.2.å¢é‡åŒæ­¥</span></a></h3><p>å…¨é‡åŒæ­¥éœ€è¦å…ˆåšRDBï¼Œç„¶åå°†RDBæ–‡ä»¶é€šè¿‡ç½‘ç»œä¼ è¾“ä¸ªslaveï¼Œæˆæœ¬å¤ªé«˜äº†ã€‚å› æ­¤é™¤äº†ç¬¬ä¸€æ¬¡åšå…¨é‡åŒæ­¥ï¼Œå…¶å®ƒå¤§å¤šæ•°æ—¶å€™slaveä¸masteréƒ½æ˜¯åš<strong>å¢é‡åŒæ­¥</strong>ã€‚</p><p>ä»€ä¹ˆæ˜¯å¢é‡åŒæ­¥ï¼Ÿå°±æ˜¯åªæ›´æ–°slaveä¸masterå­˜åœ¨å·®å¼‚çš„éƒ¨åˆ†æ•°æ®ã€‚å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153201086.png" alt="image-20210725153201086" tabindex="0" loading="lazy"><figcaption>image-20210725153201086</figcaption></figure><p>é‚£ä¹ˆmasteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><h3 id="_2-2-3-repl-backlogåŸç†" tabindex="-1"><a class="header-anchor" href="#_2-2-3-repl-backlogåŸç†"><span>2.2.3.repl_backlogåŸç†</span></a></h3><p>masteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><p>è¿™å°±è¦è¯´åˆ°å…¨é‡åŒæ­¥æ—¶çš„repl_baklogæ–‡ä»¶äº†ã€‚</p><p>è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œåªä¸è¿‡æ•°ç»„æ˜¯ç¯å½¢ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>è§’æ ‡åˆ°è¾¾æ•°ç»„æœ«å°¾åï¼Œä¼šå†æ¬¡ä»0å¼€å§‹è¯»å†™</strong>ï¼Œè¿™æ ·æ•°ç»„å¤´éƒ¨çš„æ•°æ®å°±ä¼šè¢«è¦†ç›–ã€‚</p><p>repl_baklogä¸­ä¼šè®°å½•Rediså¤„ç†è¿‡çš„å‘½ä»¤æ—¥å¿—åŠoffsetï¼ŒåŒ…æ‹¬masterå½“å‰çš„offsetï¼Œå’Œslaveå·²ç»æ‹·è´åˆ°çš„offsetï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153359022.png" alt="image-20210725153359022" tabindex="0" loading="lazy"><figcaption>image-20210725153359022</figcaption></figure><p>slaveä¸masterçš„offsetä¹‹é—´çš„å·®å¼‚ï¼Œå°±æ˜¯salveéœ€è¦å¢é‡æ‹·è´çš„æ•°æ®äº†ã€‚</p><p>éšç€ä¸æ–­æœ‰æ•°æ®å†™å…¥ï¼Œmasterçš„offseté€æ¸å˜å¤§ï¼Œslaveä¹Ÿä¸æ–­çš„æ‹·è´ï¼Œè¿½èµ¶masterçš„offsetï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153524190.png" alt="image-20210725153524190" tabindex="0" loading="lazy"><figcaption>image-20210725153524190</figcaption></figure><p>ç›´åˆ°æ•°ç»„è¢«å¡«æ»¡ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153715910.png" alt="image-20210725153715910" tabindex="0" loading="lazy"><figcaption>image-20210725153715910</figcaption></figure><p>æ­¤æ—¶ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œå°±ä¼šè¦†ç›–æ•°ç»„ä¸­çš„æ—§æ•°æ®ã€‚ä¸è¿‡ï¼Œæ—§çš„æ•°æ®åªè¦æ˜¯ç»¿è‰²çš„ï¼Œè¯´æ˜æ˜¯å·²ç»è¢«åŒæ­¥åˆ°slaveçš„æ•°æ®ï¼Œå³ä¾¿è¢«è¦†ç›–äº†ä¹Ÿæ²¡ä»€ä¹ˆå½±å“ã€‚å› ä¸ºæœªåŒæ­¥çš„ä»…ä»…æ˜¯çº¢è‰²éƒ¨åˆ†ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœslaveå‡ºç°ç½‘ç»œé˜»å¡ï¼Œå¯¼è‡´masterçš„offsetè¿œè¿œè¶…è¿‡äº†slaveçš„offsetï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725153937031.png" alt="image-20210725153937031" tabindex="0" loading="lazy"><figcaption>image-20210725153937031</figcaption></figure><p>å¦‚æœmasterç»§ç»­å†™å…¥æ–°æ•°æ®ï¼Œå…¶offsetå°±ä¼šè¦†ç›–æ—§çš„æ•°æ®ï¼Œç›´åˆ°å°†slaveç°åœ¨çš„offsetä¹Ÿè¦†ç›–ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154155984.png" alt="image-20210725154155984" tabindex="0" loading="lazy"><figcaption>image-20210725154155984</figcaption></figure><p>æ£•è‰²æ¡†ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯å°šæœªåŒæ­¥ï¼Œä½†æ˜¯å´å·²ç»è¢«è¦†ç›–çš„æ•°æ®ã€‚æ­¤æ—¶å¦‚æœslaveæ¢å¤ï¼Œéœ€è¦åŒæ­¥ï¼Œå´å‘ç°è‡ªå·±çš„offsetéƒ½æ²¡æœ‰äº†ï¼Œæ— æ³•å®Œæˆå¢é‡åŒæ­¥äº†ã€‚åªèƒ½åšå…¨é‡åŒæ­¥ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154216392.png" alt="image-20210725154216392" tabindex="0" loading="lazy"><figcaption>image-20210725154216392</figcaption></figure><h2 id="_2-3-ä¸»ä»åŒæ­¥ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-3-ä¸»ä»åŒæ­¥ä¼˜åŒ–"><span>2.3.ä¸»ä»åŒæ­¥ä¼˜åŒ–</span></a></h2><p>ä¸»ä»åŒæ­¥å¯ä»¥ä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéå¸¸é‡è¦ã€‚</p><p>å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä¼˜åŒ–Redisä¸»ä»å°±é›†ç¾¤ï¼š</p><ul><li>åœ¨masterä¸­é…ç½®repl-diskless-sync yeså¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼Œé¿å…å…¨é‡åŒæ­¥æ—¶çš„ç£ç›˜IOã€‚</li><li>Rediså•èŠ‚ç‚¹ä¸Šçš„å†…å­˜å ç”¨ä¸è¦å¤ªå¤§ï¼Œå‡å°‘RDBå¯¼è‡´çš„è¿‡å¤šç£ç›˜IO</li><li>é€‚å½“æé«˜repl_baklogçš„å¤§å°ï¼Œå‘ç°slaveå®•æœºæ—¶å°½å¿«å®ç°æ•…éšœæ¢å¤ï¼Œå°½å¯èƒ½é¿å…å…¨é‡åŒæ­¥</li><li>é™åˆ¶ä¸€ä¸ªmasterä¸Šçš„slaveèŠ‚ç‚¹æ•°é‡ï¼Œå¦‚æœå®åœ¨æ˜¯å¤ªå¤šslaveï¼Œåˆ™å¯ä»¥é‡‡ç”¨ä¸»-ä»-ä»é“¾å¼ç»“æ„ï¼Œå‡å°‘masterå‹åŠ›</li></ul><p>ä¸»ä»ä»æ¶æ„å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154405899.png" alt="image-20210725154405899" tabindex="0" loading="lazy"><figcaption>image-20210725154405899</figcaption></figure><h2 id="_2-4-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_2-4-å°ç»“"><span>2.4.å°ç»“</span></a></h2><p>ç®€è¿°å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥åŒºåˆ«ï¼Ÿ</p><ul><li>å…¨é‡åŒæ­¥ï¼šmasterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slaveã€‚åç»­å‘½ä»¤åˆ™è®°å½•åœ¨repl_baklogï¼Œé€ä¸ªå‘é€ç»™slaveã€‚</li><li>å¢é‡åŒæ­¥ï¼šslaveæäº¤è‡ªå·±çš„offsetåˆ°masterï¼Œmasterè·å–repl_baklogä¸­ä»offsetä¹‹åçš„å‘½ä»¤ç»™slave</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå…¨é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¿æ¥masterèŠ‚ç‚¹æ—¶</li><li>slaveèŠ‚ç‚¹æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_baklogä¸­çš„offsetå·²ç»è¢«è¦†ç›–æ—¶</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå¢é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹æ–­å¼€åˆæ¢å¤ï¼Œå¹¶ä¸”åœ¨repl_baklogä¸­èƒ½æ‰¾åˆ°offsetæ—¶</li></ul><h1 id="_3-rediså“¨å…µ" tabindex="-1"><a class="header-anchor" href="#_3-rediså“¨å…µ"><span>3.Rediså“¨å…µ</span></a></h1><p>Redisæä¾›äº†å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶æ¥å®ç°ä¸»ä»é›†ç¾¤çš„è‡ªåŠ¨æ•…éšœæ¢å¤ã€‚</p><h2 id="_3-1-å“¨å…µåŸç†" tabindex="-1"><a class="header-anchor" href="#_3-1-å“¨å…µåŸç†"><span>3.1.å“¨å…µåŸç†</span></a></h2><h3 id="_3-1-1-é›†ç¾¤ç»“æ„å’Œä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_3-1-1-é›†ç¾¤ç»“æ„å’Œä½œç”¨"><span>3.1.1.é›†ç¾¤ç»“æ„å’Œä½œç”¨</span></a></h3><p>å“¨å…µçš„ç»“æ„å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154528072.png" alt="image-20210725154528072" tabindex="0" loading="lazy"><figcaption>image-20210725154528072</figcaption></figure><p>å“¨å…µçš„ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li><strong>ç›‘æ§</strong>ï¼šSentinel ä¼šä¸æ–­æ£€æŸ¥æ‚¨çš„masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li><li><strong>è‡ªåŠ¨æ•…éšœæ¢å¤</strong>ï¼šå¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»</li><li><strong>é€šçŸ¥</strong>ï¼šSentinelå……å½“Rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™Redisçš„å®¢æˆ·ç«¯</li></ul><h3 id="_3-1-2-é›†ç¾¤ç›‘æ§åŸç†" tabindex="-1"><a class="header-anchor" href="#_3-1-2-é›†ç¾¤ç›‘æ§åŸç†"><span>3.1.2.é›†ç¾¤ç›‘æ§åŸç†</span></a></h3><p>SentinelåŸºäºå¿ƒè·³æœºåˆ¶ç›‘æµ‹æœåŠ¡çŠ¶æ€ï¼Œæ¯éš”1ç§’å‘é›†ç¾¤çš„æ¯ä¸ªå®ä¾‹å‘é€pingå‘½ä»¤ï¼š</p><p>â€¢ä¸»è§‚ä¸‹çº¿ï¼šå¦‚æœæŸsentinelèŠ‚ç‚¹å‘ç°æŸå®ä¾‹æœªåœ¨è§„å®šæ—¶é—´å“åº”ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€‚</p><p>â€¢å®¢è§‚ä¸‹çº¿ï¼šè‹¥è¶…è¿‡æŒ‡å®šæ•°é‡ï¼ˆquorumï¼‰çš„sentineléƒ½è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥å®ä¾‹<strong>å®¢è§‚ä¸‹çº¿</strong>ã€‚quorumå€¼æœ€å¥½è¶…è¿‡Sentinelå®ä¾‹æ•°é‡çš„ä¸€åŠã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154632354.png" alt="image-20210725154632354" tabindex="0" loading="lazy"><figcaption>image-20210725154632354</figcaption></figure><h3 id="_3-1-3-é›†ç¾¤æ•…éšœæ¢å¤åŸç†" tabindex="-1"><a class="header-anchor" href="#_3-1-3-é›†ç¾¤æ•…éšœæ¢å¤åŸç†"><span>3.1.3.é›†ç¾¤æ•…éšœæ¢å¤åŸç†</span></a></h3><p>ä¸€æ—¦å‘ç°masteræ•…éšœï¼Œsentineléœ€è¦åœ¨salveä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°çš„masterï¼Œé€‰æ‹©ä¾æ®æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>é¦–å…ˆä¼šåˆ¤æ–­slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹æ–­å¼€æ—¶é—´é•¿çŸ­ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šå€¼ï¼ˆdown-after-milliseconds * 10ï¼‰åˆ™ä¼šæ’é™¤è¯¥slaveèŠ‚ç‚¹</li><li>ç„¶ååˆ¤æ–­slaveèŠ‚ç‚¹çš„slave-priorityå€¼ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¦‚æœæ˜¯0åˆ™æ°¸ä¸å‚ä¸é€‰ä¸¾</li><li>å¦‚æœslave-prorityä¸€æ ·ï¼Œåˆ™åˆ¤æ–­slaveèŠ‚ç‚¹çš„offsetå€¼ï¼Œè¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li><li>æœ€åæ˜¯åˆ¤æ–­slaveèŠ‚ç‚¹çš„è¿è¡Œidå¤§å°ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li></ul><p>å½“é€‰å‡ºä¸€ä¸ªæ–°çš„masteråï¼Œè¯¥å¦‚ä½•å®ç°åˆ‡æ¢å‘¢ï¼Ÿ</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>sentinelç»™å¤‡é€‰çš„slave1èŠ‚ç‚¹å‘é€slaveof no oneå‘½ä»¤ï¼Œè®©è¯¥èŠ‚ç‚¹æˆä¸ºmaster</li><li>sentinelç»™æ‰€æœ‰å…¶å®ƒslaveå‘é€slaveof 192.168.150.101 7002 å‘½ä»¤ï¼Œè®©è¿™äº›slaveæˆä¸ºæ–°masterçš„ä»èŠ‚ç‚¹ï¼Œå¼€å§‹ä»æ–°çš„masterä¸ŠåŒæ­¥æ•°æ®ã€‚</li><li>æœ€åï¼Œsentinelå°†æ•…éšœèŠ‚ç‚¹æ ‡è®°ä¸ºslaveï¼Œå½“æ•…éšœèŠ‚ç‚¹æ¢å¤åä¼šè‡ªåŠ¨æˆä¸ºæ–°çš„masterçš„slaveèŠ‚ç‚¹</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725154816841.png" alt="image-20210725154816841" tabindex="0" loading="lazy"><figcaption>image-20210725154816841</figcaption></figure><h3 id="_3-1-4-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_3-1-4-å°ç»“"><span>3.1.4.å°ç»“</span></a></h3><p>Sentinelçš„ä¸‰ä¸ªä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç›‘æ§</li><li>æ•…éšœè½¬ç§»</li><li>é€šçŸ¥</li></ul><p>Sentinelå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªrediså®ä¾‹æ˜¯å¦å¥åº·ï¼Ÿ</p><ul><li>æ¯éš”1ç§’å‘é€ä¸€æ¬¡pingå‘½ä»¤ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ç›¸å‘åˆ™è®¤ä¸ºæ˜¯ä¸»è§‚ä¸‹çº¿</li><li>å¦‚æœå¤§å¤šæ•°sentineléƒ½è®¤ä¸ºå®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™åˆ¤å®šæœåŠ¡ä¸‹çº¿</li></ul><p>æ•…éšœè½¬ç§»æ­¥éª¤æœ‰å“ªäº›ï¼Ÿ</p><ul><li>é¦–å…ˆé€‰å®šä¸€ä¸ªslaveä½œä¸ºæ–°çš„masterï¼Œæ‰§è¡Œslaveof no one</li><li>ç„¶åè®©æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œslaveof æ–°master</li><li>ä¿®æ”¹æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œæ·»åŠ slaveof æ–°master</li></ul><h2 id="_3-2-æ­å»ºå“¨å…µé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_3-2-æ­å»ºå“¨å…µé›†ç¾¤"><span>3.2.æ­å»ºå“¨å…µé›†ç¾¤</span></a></h2><p>å…·ä½“æ­å»ºæµç¨‹å‚è€ƒè¯¾å‰èµ„æ–™ã€ŠRedisé›†ç¾¤.mdã€‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155019276.png" alt="image-20210725155019276" tabindex="0" loading="lazy"><figcaption>image-20210725155019276</figcaption></figure><h2 id="_3-3-redistemplate" tabindex="-1"><a class="header-anchor" href="#_3-3-redistemplate"><span>3.3.RedisTemplate</span></a></h2><p>åœ¨Sentinelé›†ç¾¤ç›‘ç®¡ä¸‹çš„Redisä¸»ä»é›†ç¾¤ï¼Œå…¶èŠ‚ç‚¹ä¼šå› ä¸ºè‡ªåŠ¨æ•…éšœè½¬ç§»è€Œå‘ç”Ÿå˜åŒ–ï¼ŒRedisçš„å®¢æˆ·ç«¯å¿…é¡»æ„ŸçŸ¥è¿™ç§å˜åŒ–ï¼ŒåŠæ—¶æ›´æ–°è¿æ¥ä¿¡æ¯ã€‚Springçš„RedisTemplateåº•å±‚åˆ©ç”¨lettuceå®ç°äº†èŠ‚ç‚¹çš„æ„ŸçŸ¥å’Œè‡ªåŠ¨åˆ‡æ¢ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæµ‹è¯•æ¥å®ç°RedisTemplateé›†æˆå“¨å…µæœºåˆ¶ã€‚</p><h3 id="_3-3-1-å¯¼å…¥demoå·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-3-1-å¯¼å…¥demoå·¥ç¨‹"><span>3.3.1.å¯¼å…¥Demoå·¥ç¨‹</span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¼•å…¥è¯¾å‰èµ„æ–™æä¾›çš„Demoå·¥ç¨‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155124958.png" alt="image-20210725155124958" tabindex="0" loading="lazy"><figcaption>image-20210725155124958</figcaption></figure><h3 id="_3-3-2-å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_3-3-2-å¼•å…¥ä¾èµ–"><span>3.3.2.å¼•å…¥ä¾èµ–</span></a></h3><p>åœ¨é¡¹ç›®çš„pomæ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-data-redis&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-3-é…ç½®redisåœ°å€" tabindex="-1"><a class="header-anchor" href="#_3-3-3-é…ç½®redisåœ°å€"><span>3.3.3.é…ç½®Redisåœ°å€</span></a></h3><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶application.ymlä¸­æŒ‡å®šredisçš„sentinelç›¸å…³ä¿¡æ¯ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    sentinel</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      master</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> mymaster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      nodes</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 192.168</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">150</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">101</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">27001</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 192.168</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">150</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">101</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">27002</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 192.168</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">150</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">101</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">27003</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-4-é…ç½®è¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#_3-3-4-é…ç½®è¯»å†™åˆ†ç¦»"><span>3.3.4.é…ç½®è¯»å†™åˆ†ç¦»</span></a></h3><p>åœ¨é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„beanï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LettuceClientConfigurationBuilderCustomizer</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> clientConfigurationBuilderCustomizer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> clientConfigurationBuilder </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> clientConfigurationBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ReadFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">REPLICA_PREFERRED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªbeanä¸­é…ç½®çš„å°±æ˜¯è¯»å†™ç­–ç•¥ï¼ŒåŒ…æ‹¬å››ç§ï¼š</p><ul><li>MASTERï¼šä»ä¸»èŠ‚ç‚¹è¯»å–</li><li>MASTER_PREFERREDï¼šä¼˜å…ˆä»masterèŠ‚ç‚¹è¯»å–ï¼Œmasterä¸å¯ç”¨æ‰è¯»å–replica</li><li>REPLICAï¼šä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–</li><li>REPLICA _PREFERREDï¼šä¼˜å…ˆä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–ï¼Œæ‰€æœ‰çš„slaveéƒ½ä¸å¯ç”¨æ‰è¯»å–master</li></ul><h1 id="_4-redisåˆ†ç‰‡é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-redisåˆ†ç‰‡é›†ç¾¤"><span>4.Redisåˆ†ç‰‡é›†ç¾¤</span></a></h1><h2 id="_4-1-æ­å»ºåˆ†ç‰‡é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-1-æ­å»ºåˆ†ç‰‡é›†ç¾¤"><span>4.1.æ­å»ºåˆ†ç‰‡é›†ç¾¤</span></a></h2><p>ä¸»ä»å’Œå“¨å…µå¯ä»¥è§£å†³é«˜å¯ç”¨ã€é«˜å¹¶å‘è¯»çš„é—®é¢˜ã€‚ä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼š</p><ul><li><p>æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜</p></li><li><p>é«˜å¹¶å‘å†™çš„é—®é¢˜</p></li></ul><p>ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¦‚å›¾:</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155747294.png" alt="image-20210725155747294" tabindex="0" loading="lazy"><figcaption>image-20210725155747294</figcaption></figure><p>åˆ†ç‰‡é›†ç¾¤ç‰¹å¾ï¼š</p><ul><li><p>é›†ç¾¤ä¸­æœ‰å¤šä¸ªmasterï¼Œæ¯ä¸ªmasterä¿å­˜ä¸åŒæ•°æ®</p></li><li><p>æ¯ä¸ªmasteréƒ½å¯ä»¥æœ‰å¤šä¸ªslaveèŠ‚ç‚¹</p></li><li><p>masterä¹‹é—´é€šè¿‡pingç›‘æµ‹å½¼æ­¤å¥åº·çŠ¶æ€</p></li><li><p>å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®èŠ‚ç‚¹</p></li></ul><p>å…·ä½“æ­å»ºæµç¨‹å‚è€ƒè¯¾å‰èµ„æ–™ã€ŠRedisé›†ç¾¤.mdã€‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155806288.png" alt="image-20210725155806288" tabindex="0" loading="lazy"><figcaption>image-20210725155806288</figcaption></figure><h2 id="_4-2-æ•£åˆ—æ’æ§½" tabindex="-1"><a class="header-anchor" href="#_4-2-æ•£åˆ—æ’æ§½"><span>4.2.æ•£åˆ—æ’æ§½</span></a></h2><h3 id="_4-2-1-æ’æ§½åŸç†" tabindex="-1"><a class="header-anchor" href="#_4-2-1-æ’æ§½åŸç†"><span>4.2.1.æ’æ§½åŸç†</span></a></h3><p>Redisä¼šæŠŠæ¯ä¸€ä¸ªmasterèŠ‚ç‚¹æ˜ å°„åˆ°0~16383å…±16384ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ä¸Šï¼ŒæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯æ—¶å°±èƒ½çœ‹åˆ°ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155820320.png" alt="image-20210725155820320" tabindex="0" loading="lazy"><figcaption>image-20210725155820320</figcaption></figure><p>æ•°æ®keyä¸æ˜¯ä¸èŠ‚ç‚¹ç»‘å®šï¼Œè€Œæ˜¯ä¸æ’æ§½ç»‘å®šã€‚redisä¼šæ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—æ’æ§½å€¼ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p><ul><li>keyä¸­åŒ…å«<code>{}</code>ï¼Œä¸”<code>{}</code>ä¸­è‡³å°‘åŒ…å«1ä¸ªå­—ç¬¦ï¼Œ<code>{}</code>ä¸­çš„éƒ¨åˆ†æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li><li>keyä¸­ä¸åŒ…å«<code>{}</code>ï¼Œæ•´ä¸ªkeyéƒ½æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li></ul><p>ä¾‹å¦‚ï¼škeyæ˜¯numï¼Œé‚£ä¹ˆå°±æ ¹æ®numè®¡ç®—ï¼Œå¦‚æœæ˜¯{itcast}numï¼Œåˆ™æ ¹æ®itcastè®¡ç®—ã€‚è®¡ç®—æ–¹å¼æ˜¯åˆ©ç”¨CRC16ç®—æ³•å¾—åˆ°ä¸€ä¸ªhashå€¼ï¼Œç„¶åå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯slotå€¼ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725155850200.png" alt="image-20210725155850200" tabindex="0" loading="lazy"><figcaption>image-20210725155850200</figcaption></figure><p>å¦‚å›¾ï¼Œåœ¨7001è¿™ä¸ªèŠ‚ç‚¹æ‰§è¡Œset a 1æ—¶ï¼Œå¯¹aåšhashè¿ç®—ï¼Œå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯15495ï¼Œå› æ­¤è¦å­˜å‚¨åˆ°103èŠ‚ç‚¹ã€‚</p><p>åˆ°äº†7003åï¼Œæ‰§è¡Œ<code>get num</code>æ—¶ï¼Œå¯¹numåšhashè¿ç®—ï¼Œå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯2765ï¼Œå› æ­¤éœ€è¦åˆ‡æ¢åˆ°7001èŠ‚ç‚¹</p><h3 id="_4-2-1-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_4-2-1-å°ç»“"><span>4.2.1.å°ç»“</span></a></h3><p>Rediså¦‚ä½•åˆ¤æ–­æŸä¸ªkeyåº”è¯¥åœ¨å“ªä¸ªå®ä¾‹ï¼Ÿ</p><ul><li>å°†16384ä¸ªæ’æ§½åˆ†é…åˆ°ä¸åŒçš„å®ä¾‹</li><li>æ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¯¹16384å–ä½™</li><li>ä½™æ•°ä½œä¸ºæ’æ§½ï¼Œå¯»æ‰¾æ’æ§½æ‰€åœ¨å®ä¾‹å³å¯</li></ul><p>å¦‚ä½•å°†åŒä¸€ç±»æ•°æ®å›ºå®šçš„ä¿å­˜åœ¨åŒä¸€ä¸ªRediså®ä¾‹ï¼Ÿ</p><ul><li>è¿™ä¸€ç±»æ•°æ®ä½¿ç”¨ç›¸åŒçš„æœ‰æ•ˆéƒ¨åˆ†ï¼Œä¾‹å¦‚keyéƒ½ä»¥<code>{typeId}</code>ä¸ºå‰ç¼€</li></ul><h2 id="_4-3-é›†ç¾¤ä¼¸ç¼©" tabindex="-1"><a class="header-anchor" href="#_4-3-é›†ç¾¤ä¼¸ç¼©"><span>4.3.é›†ç¾¤ä¼¸ç¼©</span></a></h2><p>redis-cli --clusteræä¾›äº†å¾ˆå¤šæ“ä½œé›†ç¾¤çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼æŸ¥çœ‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725160138290.png" alt="image-20210725160138290" tabindex="0" loading="lazy"><figcaption>image-20210725160138290</figcaption></figure><p>æ¯”å¦‚ï¼Œæ·»åŠ èŠ‚ç‚¹çš„å‘½ä»¤ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725160448139.png" alt="image-20210725160448139" tabindex="0" loading="lazy"><figcaption>image-20210725160448139</figcaption></figure><h3 id="_4-3-1-éœ€æ±‚åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-3-1-éœ€æ±‚åˆ†æ"><span>4.3.1.éœ€æ±‚åˆ†æ</span></a></h3><p>éœ€æ±‚ï¼šå‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„masterèŠ‚ç‚¹ï¼Œå¹¶å‘å…¶ä¸­å­˜å‚¨ num = 10</p><ul><li>å¯åŠ¨ä¸€ä¸ªæ–°çš„rediså®ä¾‹ï¼Œç«¯å£ä¸º7004</li><li>æ·»åŠ 7004åˆ°ä¹‹å‰çš„é›†ç¾¤ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªmasterèŠ‚ç‚¹</li><li>ç»™7004èŠ‚ç‚¹åˆ†é…æ’æ§½ï¼Œä½¿å¾—numè¿™ä¸ªkeyå¯ä»¥å­˜å‚¨åˆ°7004å®ä¾‹</li></ul><p>è¿™é‡Œéœ€è¦ä¸¤ä¸ªæ–°çš„åŠŸèƒ½ï¼š</p><ul><li>æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­</li><li>å°†éƒ¨åˆ†æ’æ§½åˆ†é…åˆ°æ–°æ’æ§½</li></ul><h3 id="_4-3-2-åˆ›å»ºæ–°çš„rediså®ä¾‹" tabindex="-1"><a class="header-anchor" href="#_4-3-2-åˆ›å»ºæ–°çš„rediså®ä¾‹"><span>4.3.2.åˆ›å»ºæ–°çš„rediså®ä¾‹</span></a></h3><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 7004</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ‹·è´é…ç½®æ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redis.conf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /7004</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /s/6379/7004/g</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 7004/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¯åŠ¨</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 7004/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-3-3-æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis" tabindex="-1"><a class="header-anchor" href="#_4-3-3-æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis"><span>4.3.3.æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis</span></a></h3><p>æ·»åŠ èŠ‚ç‚¹çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725160448139.png" alt="image-20210725160448139" tabindex="0" loading="lazy"><figcaption>image-20210725160448139</figcaption></figure><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> add-node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  192.168.150.101:7004</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 192.168.150.101:7001</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é€šè¿‡å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 7001</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nodes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚å›¾ï¼Œ7004åŠ å…¥äº†é›†ç¾¤ï¼Œå¹¶ä¸”é»˜è®¤æ˜¯ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161007099.png" alt="image-20210725161007099" tabindex="0" loading="lazy"><figcaption>image-20210725161007099</figcaption></figure><p>ä½†æ˜¯ï¼Œå¯ä»¥çœ‹åˆ°7004èŠ‚ç‚¹çš„æ’æ§½æ•°é‡ä¸º0ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•æ•°æ®å¯ä»¥å­˜å‚¨åˆ°7004ä¸Š</p><h3 id="_4-3-4-è½¬ç§»æ’æ§½" tabindex="-1"><a class="header-anchor" href="#_4-3-4-è½¬ç§»æ’æ§½"><span>4.3.4.è½¬ç§»æ’æ§½</span></a></h3><p>æˆ‘ä»¬è¦å°†numå­˜å‚¨åˆ°7004èŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦å…ˆçœ‹çœ‹numçš„æ’æ§½æ˜¯å¤šå°‘ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161241793.png" alt="image-20210725161241793" tabindex="0" loading="lazy"><figcaption>image-20210725161241793</figcaption></figure><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œnumçš„æ’æ§½ä¸º2765.</p><p>æˆ‘ä»¬å¯ä»¥å°†0~3000çš„æ’æ§½ä»7001è½¬ç§»åˆ°7004ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161401925.png" alt="image-20210725161401925" tabindex="0" loading="lazy"><figcaption>image-20210725161401925</figcaption></figure><p>å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><p>å»ºç«‹è¿æ¥ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161506241.png" alt="image-20210725161506241" tabindex="0" loading="lazy"><figcaption>image-20210725161506241</figcaption></figure><p>å¾—åˆ°ä¸‹é¢çš„åé¦ˆï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161540841.png" alt="image-20210725161540841" tabindex="0" loading="lazy"><figcaption>image-20210725161540841</figcaption></figure><p>è¯¢é—®è¦ç§»åŠ¨å¤šå°‘ä¸ªæ’æ§½ï¼Œæˆ‘ä»¬è®¡åˆ’æ˜¯3000ä¸ªï¼š</p><p>æ–°çš„é—®é¢˜æ¥äº†ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161637152.png" alt="image-20210725161637152" tabindex="0" loading="lazy"><figcaption>image-20210725161637152</figcaption></figure><p>é‚£ä¸ªnodeæ¥æ¥æ”¶è¿™äº›æ’æ§½ï¼Ÿï¼Ÿ</p><p>æ˜¾ç„¶æ˜¯7004ï¼Œé‚£ä¹ˆ7004èŠ‚ç‚¹çš„idæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161731738.png" alt="image-20210725161731738" tabindex="0" loading="lazy"><figcaption>image-20210725161731738</figcaption></figure><p>å¤åˆ¶è¿™ä¸ªidï¼Œç„¶åæ‹·è´åˆ°åˆšæ‰çš„æ§åˆ¶å°åï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725161817642.png" alt="image-20210725161817642" tabindex="0" loading="lazy"><figcaption>image-20210725161817642</figcaption></figure><p>è¿™é‡Œè¯¢é—®ï¼Œä½ çš„æ’æ§½æ˜¯ä»å“ªé‡Œç§»åŠ¨è¿‡æ¥çš„ï¼Ÿ</p><ul><li>allï¼šä»£è¡¨å…¨éƒ¨ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹å„è½¬ç§»ä¸€éƒ¨åˆ†</li><li>å…·ä½“çš„idï¼šç›®æ ‡èŠ‚ç‚¹çš„id</li><li>doneï¼šæ²¡æœ‰äº†</li></ul><p>è¿™é‡Œæˆ‘ä»¬è¦ä»7001è·å–ï¼Œå› æ­¤å¡«å†™7001çš„idï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162030478.png" alt="image-20210725162030478" tabindex="0" loading="lazy"><figcaption>image-20210725162030478</figcaption></figure><p>å¡«å®Œåï¼Œç‚¹å‡»doneï¼Œè¿™æ ·æ’æ§½è½¬ç§»å°±å‡†å¤‡å¥½äº†ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162101228.png" alt="image-20210725162101228" tabindex="0" loading="lazy"><figcaption>image-20210725162101228</figcaption></figure><p>ç¡®è®¤è¦è½¬ç§»å—ï¼Ÿè¾“å…¥yesï¼š</p><p>ç„¶åï¼Œé€šè¿‡å‘½ä»¤æŸ¥çœ‹ç»“æœï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162145497.png" alt="image-20210725162145497" tabindex="0" loading="lazy"><figcaption>image-20210725162145497</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162224058.png" alt="image-20210725162224058" tabindex="0" loading="lazy"><figcaption>image-20210725162224058</figcaption></figure><p>ç›®çš„è¾¾æˆã€‚</p><h2 id="_4-4-æ•…éšœè½¬ç§»" tabindex="-1"><a class="header-anchor" href="#_4-4-æ•…éšœè½¬ç§»"><span>4.4.æ•…éšœè½¬ç§»</span></a></h2><p>é›†ç¾¤åˆè¯†çŠ¶æ€æ˜¯è¿™æ ·çš„ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727161152065.png" alt="image-20210727161152065" tabindex="0" loading="lazy"><figcaption>image-20210727161152065</figcaption></figure><p>å…¶ä¸­7001ã€7002ã€7003éƒ½æ˜¯masterï¼Œæˆ‘ä»¬è®¡åˆ’è®©7002å®•æœºã€‚</p><h3 id="_4-4-1-è‡ªåŠ¨æ•…éšœè½¬ç§»" tabindex="-1"><a class="header-anchor" href="#_4-4-1-è‡ªåŠ¨æ•…éšœè½¬ç§»"><span>4.4.1.è‡ªåŠ¨æ•…éšœè½¬ç§»</span></a></h3><p>å½“é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªmasterå®•æœºä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç›´æ¥åœæ­¢ä¸€ä¸ªrediså®ä¾‹ï¼Œä¾‹å¦‚7002ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 7002</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> shutdown</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1ï¼‰é¦–å…ˆæ˜¯è¯¥å®ä¾‹ä¸å…¶å®ƒå®ä¾‹å¤±å»è¿æ¥</p><p>2ï¼‰ç„¶åæ˜¯ç–‘ä¼¼å®•æœºï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162319490.png" alt="image-20210725162319490" tabindex="0" loading="lazy"><figcaption>image-20210725162319490</figcaption></figure><p>3ï¼‰æœ€åæ˜¯ç¡®å®šä¸‹çº¿ï¼Œè‡ªåŠ¨æå‡ä¸€ä¸ªslaveä¸ºæ–°çš„masterï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162408979.png" alt="image-20210725162408979" tabindex="0" loading="lazy"><figcaption>image-20210725162408979</figcaption></figure><p>4ï¼‰å½“7002å†æ¬¡å¯åŠ¨ï¼Œå°±ä¼šå˜ä¸ºä¸€ä¸ªslaveèŠ‚ç‚¹äº†ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727160803386.png" alt="image-20210727160803386" tabindex="0" loading="lazy"><figcaption>image-20210727160803386</figcaption></figure><h3 id="_4-4-2-æ‰‹åŠ¨æ•…éšœè½¬ç§»" tabindex="-1"><a class="header-anchor" href="#_4-4-2-æ‰‹åŠ¨æ•…éšœè½¬ç§»"><span>4.4.2.æ‰‹åŠ¨æ•…éšœè½¬ç§»</span></a></h3><p>åˆ©ç”¨cluster failoverå‘½ä»¤å¯ä»¥æ‰‹åŠ¨è®©é›†ç¾¤ä¸­çš„æŸä¸ªmasterå®•æœºï¼Œåˆ‡æ¢åˆ°æ‰§è¡Œcluster failoverå‘½ä»¤çš„è¿™ä¸ªslaveèŠ‚ç‚¹ï¼Œå®ç°æ— æ„ŸçŸ¥çš„æ•°æ®è¿ç§»ã€‚å…¶æµç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210725162441407.png" alt="image-20210725162441407" tabindex="0" loading="lazy"><figcaption>image-20210725162441407</figcaption></figure><p>è¿™ç§failoverå‘½ä»¤å¯ä»¥æŒ‡å®šä¸‰ç§æ¨¡å¼ï¼š</p><ul><li>ç¼ºçœï¼šé»˜è®¤çš„æµç¨‹ï¼Œå¦‚å›¾1~6æ­©</li><li>forceï¼šçœç•¥äº†å¯¹offsetçš„ä¸€è‡´æ€§æ ¡éªŒ</li><li>takeoverï¼šç›´æ¥æ‰§è¡Œç¬¬5æ­©ï¼Œå¿½ç•¥æ•°æ®ä¸€è‡´æ€§ã€å¿½ç•¥masterçŠ¶æ€å’Œå…¶å®ƒmasterçš„æ„è§</li></ul><p><strong>æ¡ˆä¾‹éœ€æ±‚</strong>ï¼šåœ¨7002è¿™ä¸ªslaveèŠ‚ç‚¹æ‰§è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§»ï¼Œé‡æ–°å¤ºå›masteråœ°ä½</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1ï¼‰åˆ©ç”¨redis-cliè¿æ¥7002è¿™ä¸ªèŠ‚ç‚¹</p><p>2ï¼‰æ‰§è¡Œcluster failoverå‘½ä»¤</p><p>å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727160037766.png" alt="image-20210727160037766" tabindex="0" loading="lazy"><figcaption>image-20210727160037766</figcaption></figure><p>æ•ˆæœï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210727161152065.png" alt="image-20210727161152065" tabindex="0" loading="lazy"><figcaption>image-20210727161152065</figcaption></figure><h2 id="_4-5-redistemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-5-redistemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤"><span>4.5.RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤</span></a></h2><p>RedisTemplateåº•å±‚åŒæ ·åŸºäºlettuceå®ç°äº†åˆ†ç‰‡é›†ç¾¤çš„æ”¯æŒï¼Œè€Œä½¿ç”¨çš„æ­¥éª¤ä¸å“¨å…µæ¨¡å¼åŸºæœ¬ä¸€è‡´ï¼š</p><p>1ï¼‰å¼•å…¥redisçš„starterä¾èµ–</p><p>2ï¼‰é…ç½®åˆ†ç‰‡é›†ç¾¤åœ°å€</p><p>3ï¼‰é…ç½®è¯»å†™åˆ†ç¦»</p><p>ä¸å“¨å…µæ¨¡å¼ç›¸æ¯”ï¼Œå…¶ä¸­åªæœ‰åˆ†ç‰‡é›†ç¾¤çš„é…ç½®æ–¹å¼ç•¥æœ‰å·®å¼‚ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    cluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">      nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.150.101:7001</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.150.101:7002</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.150.101:7003</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.150.101:8001</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.150.101:8002</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.150.101:8003</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="å¤šçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#å¤šçº§ç¼“å­˜"><span>å¤šçº§ç¼“å­˜</span></a></h1><h1 id="_1-ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜"><span>1.ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜</span></a></h1><p>ä¼ ç»Ÿçš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ˜¯è¯·æ±‚åˆ°è¾¾Tomcatåï¼Œå…ˆæŸ¥è¯¢Redisï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821075259137.png" alt="image-20210821075259137" tabindex="0" loading="lazy"><figcaption>image-20210821075259137</figcaption></figure><p>å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p>â€¢è¯·æ±‚è¦ç»è¿‡Tomcatå¤„ç†ï¼ŒTomcatçš„æ€§èƒ½æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆ</p><p>â€¢Redisç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¼šå¯¹æ•°æ®åº“äº§ç”Ÿå†²å‡»</p><p>å¤šçº§ç¼“å­˜å°±æ˜¯å……åˆ†åˆ©ç”¨è¯·æ±‚å¤„ç†çš„æ¯ä¸ªç¯èŠ‚ï¼Œåˆ†åˆ«æ·»åŠ ç¼“å­˜ï¼Œå‡è½»Tomcatå‹åŠ›ï¼Œæå‡æœåŠ¡æ€§èƒ½ï¼š</p><ul><li>æµè§ˆå™¨è®¿é—®é™æ€èµ„æºæ—¶ï¼Œä¼˜å…ˆè¯»å–æµè§ˆå™¨æœ¬åœ°ç¼“å­˜</li><li>è®¿é—®éé™æ€èµ„æºï¼ˆajaxæŸ¥è¯¢æ•°æ®ï¼‰æ—¶ï¼Œè®¿é—®æœåŠ¡ç«¯</li><li>è¯·æ±‚åˆ°è¾¾Nginxåï¼Œä¼˜å…ˆè¯»å–Nginxæœ¬åœ°ç¼“å­˜</li><li>å¦‚æœNginxæœ¬åœ°ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™å»ç›´æ¥æŸ¥è¯¢Redisï¼ˆä¸ç»è¿‡Tomcatï¼‰</li><li>å¦‚æœRedisæŸ¥è¯¢æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢Tomcat</li><li>è¯·æ±‚è¿›å…¥Tomcatåï¼Œä¼˜å…ˆæŸ¥è¯¢JVMè¿›ç¨‹ç¼“å­˜</li><li>å¦‚æœJVMè¿›ç¨‹ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821075558137.png" alt="image-20210821075558137" tabindex="0" loading="lazy"><figcaption>image-20210821075558137</figcaption></figure><p>åœ¨å¤šçº§ç¼“å­˜æ¶æ„ä¸­ï¼ŒNginxå†…éƒ¨éœ€è¦ç¼–å†™æœ¬åœ°ç¼“å­˜æŸ¥è¯¢ã€RedisæŸ¥è¯¢ã€TomcatæŸ¥è¯¢çš„ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤è¿™æ ·çš„nginxæœåŠ¡ä¸å†æ˜¯ä¸€ä¸ª<strong>åå‘ä»£ç†æœåŠ¡å™¨</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ªç¼–å†™<strong>ä¸šåŠ¡çš„WebæœåŠ¡å™¨äº†</strong>ã€‚</p><p>å› æ­¤è¿™æ ·çš„ä¸šåŠ¡NginxæœåŠ¡ä¹Ÿéœ€è¦æ­å»ºé›†ç¾¤æ¥æé«˜å¹¶å‘ï¼Œå†æœ‰ä¸“é—¨çš„nginxæœåŠ¡æ¥åšåå‘ä»£ç†ï¼Œå¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821080511581.png" alt="image-20210821080511581" tabindex="0" loading="lazy"><figcaption>image-20210821080511581</figcaption></figure><p>å¦å¤–ï¼Œæˆ‘ä»¬çš„TomcatæœåŠ¡å°†æ¥ä¹Ÿä¼šéƒ¨ç½²ä¸ºé›†ç¾¤æ¨¡å¼ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821080954947.png" alt="image-20210821080954947" tabindex="0" loading="lazy"><figcaption>image-20210821080954947</figcaption></figure><p>å¯è§ï¼Œå¤šçº§ç¼“å­˜çš„å…³é”®æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>ä¸€ä¸ªæ˜¯åœ¨nginxä¸­ç¼–å†™ä¸šåŠ¡ï¼Œå®ç°nginxæœ¬åœ°ç¼“å­˜ã€Redisã€Tomcatçš„æŸ¥è¯¢</p></li><li><p>å¦ä¸€ä¸ªå°±æ˜¯åœ¨Tomcatä¸­å®ç°JVMè¿›ç¨‹ç¼“å­˜</p></li></ul><p>å…¶ä¸­Nginxç¼–ç¨‹åˆ™ä¼šç”¨åˆ°OpenRestyæ¡†æ¶ç»“åˆLuaè¿™æ ·çš„è¯­è¨€ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä»Šå¤©è¯¾ç¨‹çš„éš¾ç‚¹å’Œé‡ç‚¹ã€‚</p><h1 id="_2-jvmè¿›ç¨‹ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-jvmè¿›ç¨‹ç¼“å­˜"><span>2.JVMè¿›ç¨‹ç¼“å­˜</span></a></h1><p>ä¸ºäº†æ¼”ç¤ºå¤šçº§ç¼“å­˜çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ªå•†å“æŸ¥è¯¢çš„ä¸šåŠ¡ã€‚</p><h2 id="_2-1-å¯¼å…¥æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-1-å¯¼å…¥æ¡ˆä¾‹"><span>2.1.å¯¼å…¥æ¡ˆä¾‹</span></a></h2><p>å‚è€ƒè¯¾å‰èµ„æ–™çš„ï¼šã€Šæ¡ˆä¾‹å¯¼å…¥è¯´æ˜.mdã€‹</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821081418456.png" alt="image-20210821081418456" tabindex="0" loading="lazy"><figcaption>image-20210821081418456</figcaption></figure><h2 id="_2-2-åˆè¯†caffeine" tabindex="-1"><a class="header-anchor" href="#_2-2-åˆè¯†caffeine"><span>2.2.åˆè¯†Caffeine</span></a></h2><p>ç¼“å­˜åœ¨æ—¥å¸¸å¼€å‘ä¸­å¯åŠ¨è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œç”±äºæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„è¯»å–é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œèƒ½å¤§é‡å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚æˆ‘ä»¬æŠŠç¼“å­˜åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¾‹å¦‚Redisï¼š <ul><li>ä¼˜ç‚¹ï¼šå­˜å‚¨å®¹é‡æ›´å¤§ã€å¯é æ€§æ›´å¥½ã€å¯ä»¥åœ¨é›†ç¾¤é—´å…±äº«</li><li>ç¼ºç‚¹ï¼šè®¿é—®ç¼“å­˜æœ‰ç½‘ç»œå¼€é”€</li><li>åœºæ™¯ï¼šç¼“å­˜æ•°æ®é‡è¾ƒå¤§ã€å¯é æ€§è¦æ±‚è¾ƒé«˜ã€éœ€è¦åœ¨é›†ç¾¤é—´å…±äº«</li></ul></li><li>è¿›ç¨‹æœ¬åœ°ç¼“å­˜ï¼Œä¾‹å¦‚HashMapã€GuavaCacheï¼š <ul><li>ä¼˜ç‚¹ï¼šè¯»å–æœ¬åœ°å†…å­˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œé€Ÿåº¦æ›´å¿«</li><li>ç¼ºç‚¹ï¼šå­˜å‚¨å®¹é‡æœ‰é™ã€å¯é æ€§è¾ƒä½ã€æ— æ³•å…±äº«</li><li>åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œç¼“å­˜æ•°æ®é‡è¾ƒå°</li></ul></li></ul><p>æˆ‘ä»¬ä»Šå¤©ä¼šåˆ©ç”¨Caffeineæ¡†æ¶æ¥å®ç°JVMè¿›ç¨‹ç¼“å­˜ã€‚</p><p><strong>Caffeine</strong>æ˜¯ä¸€ä¸ªåŸºäºJava8å¼€å‘çš„ï¼Œæä¾›äº†è¿‘ä¹æœ€ä½³å‘½ä¸­ç‡çš„é«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜åº“ã€‚ç›®å‰Springå†…éƒ¨çš„ç¼“å­˜ä½¿ç”¨çš„å°±æ˜¯Caffeineã€‚GitHubåœ°å€ï¼šhttps://github.com/ben-manes/caffeine</p><p>Caffeineçš„æ€§èƒ½éå¸¸å¥½ï¼Œä¸‹å›¾æ˜¯å®˜æ–¹ç»™å‡ºçš„æ€§èƒ½å¯¹æ¯”ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821081826399.png" alt="image-20210821081826399" tabindex="0" loading="lazy"><figcaption>image-20210821081826399</figcaption></figure><p>å¯ä»¥çœ‹åˆ°Caffeineçš„æ€§èƒ½é¥é¥é¢†å…ˆï¼</p><p>ç¼“å­˜ä½¿ç”¨çš„åŸºæœ¬APIï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testBasicOps</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ„å»ºcacheå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å­˜æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;gf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿ªä¸½çƒ­å·´&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> gf </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getIfPresent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;gf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;gf = &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> gf);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å–æ•°æ®ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‚æ•°ä¸€ï¼šç¼“å­˜çš„key</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‚æ•°äºŒï¼šLambdaè¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼å‚æ•°å°±æ˜¯ç¼“å­˜çš„keyï¼Œæ–¹æ³•ä½“æ˜¯æŸ¥è¯¢æ•°æ®åº“çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä¼˜å…ˆæ ¹æ®keyæŸ¥è¯¢JVMç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æ‰§è¡Œå‚æ•°äºŒçš„Lambdaè¡¨è¾¾å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> defaultGF </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;defaultGF&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, key </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æ ¹æ®keyå»æ•°æ®åº“æŸ¥è¯¢æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æŸ³å²©&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;defaultGF = &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> defaultGF);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Caffeineæ—¢ç„¶æ˜¯ç¼“å­˜çš„ä¸€ç§ï¼Œè‚¯å®šéœ€è¦æœ‰ç¼“å­˜çš„æ¸…é™¤ç­–ç•¥ï¼Œä¸ç„¶çš„è¯å†…å­˜æ€»ä¼šæœ‰è€—å°½çš„æ—¶å€™ã€‚</p><p>Caffeineæä¾›äº†ä¸‰ç§ç¼“å­˜é©±é€ç­–ç•¥ï¼š</p><ul><li><p><strong>åŸºäºå®¹é‡</strong>ï¼šè®¾ç½®ç¼“å­˜çš„æ•°é‡ä¸Šé™</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºç¼“å­˜å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">maximumSize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åŸºäºæ—¶é—´</strong>ï¼šè®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºç¼“å­˜å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸º 10 ç§’ï¼Œä»æœ€åä¸€æ¬¡å†™å…¥å¼€å§‹è®¡æ—¶ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">expireAfterWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ofSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åŸºäºå¼•ç”¨</strong>ï¼šè®¾ç½®ç¼“å­˜ä¸ºè½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨ï¼Œåˆ©ç”¨GCæ¥å›æ”¶ç¼“å­˜æ•°æ®ã€‚æ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç¼“å­˜å…ƒç´ è¿‡æœŸçš„æ—¶å€™ï¼ŒCaffeineä¸ä¼šè‡ªåŠ¨ç«‹å³å°†å…¶æ¸…ç†å’Œé©±é€ã€‚è€Œæ˜¯åœ¨ä¸€æ¬¡è¯»æˆ–å†™æ“ä½œåï¼Œæˆ–è€…åœ¨ç©ºé—²æ—¶é—´å®Œæˆå¯¹å¤±æ•ˆæ•°æ®çš„é©±é€ã€‚</p></blockquote><h2 id="_2-3-å®ç°jvmè¿›ç¨‹ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-3-å®ç°jvmè¿›ç¨‹ç¼“å­˜"><span>2.3.å®ç°JVMè¿›ç¨‹ç¼“å­˜</span></a></h2><h3 id="_2-3-1-éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-3-1-éœ€æ±‚"><span>2.3.1.éœ€æ±‚</span></a></h3><p>åˆ©ç”¨Caffeineå®ç°ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li>ç»™æ ¹æ®idæŸ¥è¯¢å•†å“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</li><li>ç»™æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</li><li>ç¼“å­˜åˆå§‹å¤§å°ä¸º100</li><li>ç¼“å­˜ä¸Šé™ä¸º10000</li></ul><h3 id="_2-3-2-å®ç°" tabindex="-1"><a class="header-anchor" href="#_2-3-2-å®ç°"><span>2.3.2.å®ç°</span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸¤ä¸ªCaffeineçš„ç¼“å­˜å¯¹è±¡ï¼Œåˆ†åˆ«ä¿å­˜å•†å“ã€åº“å­˜çš„ç¼“å­˜æ•°æ®ã€‚</p><p>åœ¨item-serviceçš„<code>com.heima.item.config</code>åŒ…ä¸‹å®šä¹‰<code>CaffeineConfig</code>ç±»ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.heima.item.config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.github.benmanes.caffeine.cache.Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.github.benmanes.caffeine.cache.Caffeine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.pojo.ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.context.annotation.Bean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.context.annotation.Configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CaffeineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> itemCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">initialCapacity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">maximumSize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10_000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> stockCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">initialCapacity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">maximumSize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10_000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä¿®æ”¹item-serviceä¸­çš„<code>com.heima.item.web</code>åŒ…ä¸‹çš„ItemControllerç±»ï¼Œæ·»åŠ ç¼“å­˜é€»è¾‘ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ItemController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IItemService</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IItemStockService</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stockCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ...å…¶å®ƒç•¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/{id}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> findById</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> itemCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(id, key </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> itemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ne</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, key)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">one</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/stock/{id}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ItemStock</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> findStockById</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stockCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(id, key </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getById</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_3-luaè¯­æ³•å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_3-luaè¯­æ³•å…¥é—¨"><span>3.Luaè¯­æ³•å…¥é—¨</span></a></h1><p>Nginxç¼–ç¨‹éœ€è¦ç”¨åˆ°Luaè¯­è¨€ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å…ˆå…¥é—¨Luaçš„åŸºæœ¬è¯­æ³•ã€‚</p><h2 id="_3-1-åˆè¯†lua" tabindex="-1"><a class="header-anchor" href="#_3-1-åˆè¯†lua"><span>3.1.åˆè¯†Lua</span></a></h2><p>Lua æ˜¯ä¸€ç§è½»é‡å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œ å…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚å®˜ç½‘ï¼šhttps://www.lua.org/</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091437975.png" alt="image-20210821091437975" tabindex="0" loading="lazy"><figcaption>image-20210821091437975</figcaption></figure><p>Luaç»å¸¸åµŒå…¥åˆ°Cè¯­è¨€å¼€å‘çš„ç¨‹åºä¸­ï¼Œä¾‹å¦‚æ¸¸æˆå¼€å‘ã€æ¸¸æˆæ’ä»¶ç­‰ã€‚</p><p>Nginxæœ¬èº«ä¹Ÿæ˜¯Cè¯­è¨€å¼€å‘ï¼Œå› æ­¤ä¹Ÿå…è®¸åŸºäºLuaåšæ‹“å±•ã€‚</p><h2 id="_3-1-helloworld" tabindex="-1"><a class="header-anchor" href="#_3-1-helloworld"><span>3.1.HelloWorld</span></a></h2><p>CentOS7é»˜è®¤å·²ç»å®‰è£…äº†Luaè¯­è¨€ç¯å¢ƒï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿è¡ŒLuaä»£ç ã€‚</p><p>1ï¼‰åœ¨Linuxè™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªhello.luaæ–‡ä»¶</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091621308.png" alt="image-20210821091621308" tabindex="0" loading="lazy"><figcaption>image-20210821091621308</figcaption></figure><p>2ï¼‰æ·»åŠ ä¸‹é¢çš„å†…å®¹</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3ï¼‰è¿è¡Œ</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091638140.png" alt="image-20210821091638140" tabindex="0" loading="lazy"><figcaption>image-20210821091638140</figcaption></figure><h2 id="_3-2-å˜é‡å’Œå¾ªç¯" tabindex="-1"><a class="header-anchor" href="#_3-2-å˜é‡å’Œå¾ªç¯"><span>3.2.å˜é‡å’Œå¾ªç¯</span></a></h2><p>å­¦ä¹ ä»»ä½•è¯­è¨€å¿…ç„¶ç¦»ä¸å¼€å˜é‡ï¼Œè€Œå˜é‡çš„å£°æ˜å¿…é¡»å…ˆçŸ¥é“æ•°æ®çš„ç±»å‹ã€‚</p><h3 id="_3-2-1-luaçš„æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_3-2-1-luaçš„æ•°æ®ç±»å‹"><span>3.2.1.Luaçš„æ•°æ®ç±»å‹</span></a></h3><p>Luaä¸­æ”¯æŒçš„å¸¸è§æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091835406.png" alt="image-20210821091835406" tabindex="0" loading="lazy"><figcaption>image-20210821091835406</figcaption></figure><p>å¦å¤–ï¼ŒLuaæä¾›äº†type()å‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821091904332.png" alt="image-20210821091904332" tabindex="0" loading="lazy"><figcaption>image-20210821091904332</figcaption></figure><h3 id="_3-2-2-å£°æ˜å˜é‡" tabindex="-1"><a class="header-anchor" href="#_3-2-2-å£°æ˜å˜é‡"><span>3.2.2.å£°æ˜å˜é‡</span></a></h3><p>Luaå£°æ˜å˜é‡çš„æ—¶å€™æ— éœ€æŒ‡å®šæ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ç”¨localæ¥å£°æ˜å˜é‡ä¸ºå±€éƒ¨å˜é‡ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å£°æ˜å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨å•å¼•å·æˆ–åŒå¼•å·ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> str</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;hello&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å­—ç¬¦ä¸²æ‹¼æ¥å¯ä»¥ä½¿ç”¨ ..</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> str2</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;hello&#39; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;world&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å£°æ˜æ•°å­—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> num</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 21</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å£°æ˜å¸ƒå°”ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> flag</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Luaä¸­çš„tableç±»å‹æ—¢å¯ä»¥ä½œä¸ºæ•°ç»„ï¼Œåˆå¯ä»¥ä½œä¸ºJavaä¸­çš„mapæ¥ä½¿ç”¨ã€‚æ•°ç»„å°±æ˜¯ç‰¹æ®Šçš„tableï¼Œkeyæ˜¯æ•°ç»„è§’æ ‡è€Œå·²ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å£°æ˜æ•°ç»„ ï¼Œkeyä¸ºè§’æ ‡çš„ table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;java&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;python&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;lua&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å£°æ˜tableï¼Œç±»ä¼¼javaçš„map</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  {</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Jack&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">21</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Luaä¸­çš„æ•°ç»„è§’æ ‡æ˜¯ä»1å¼€å§‹ï¼Œè®¿é—®çš„æ—¶å€™ä¸Javaä¸­ç±»ä¼¼ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è®¿é—®æ•°ç»„ï¼Œluaæ•°ç»„çš„è§’æ ‡ä»1å¼€å§‹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Luaä¸­çš„tableå¯ä»¥ç”¨keyæ¥è®¿é—®ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è®¿é—®table</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-3-å¾ªç¯" tabindex="-1"><a class="header-anchor" href="#_3-2-3-å¾ªç¯"><span>3.2.3.å¾ªç¯</span></a></h3><p>å¯¹äºtableï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨forå¾ªç¯æ¥éå†ã€‚ä¸è¿‡æ•°ç»„å’Œæ™®é€štableéå†ç•¥æœ‰å·®å¼‚ã€‚</p><p>éå†æ•°ç»„ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å£°æ˜æ•°ç»„ keyä¸ºç´¢å¼•çš„ table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;java&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;python&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;lua&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- éå†æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> ipairs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éå†æ™®é€štable</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å£°æ˜mapï¼Œä¹Ÿå°±æ˜¯table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Jack&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">21</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- éå†table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> pairs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-3-æ¡ä»¶æ§åˆ¶ã€å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-3-æ¡ä»¶æ§åˆ¶ã€å‡½æ•°"><span>3.3.æ¡ä»¶æ§åˆ¶ã€å‡½æ•°</span></a></h2><p>Luaä¸­çš„æ¡ä»¶æ§åˆ¶å’Œå‡½æ•°å£°æ˜ä¸Javaç±»ä¼¼ã€‚</p><h3 id="_3-3-1-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-3-1-å‡½æ•°"><span>3.3.1.å‡½æ•°</span></a></h3><p>å®šä¹‰å‡½æ•°çš„è¯­æ³•ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> å‡½æ•°å( </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">argument1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">argument2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">..., </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">argumentn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- å‡½æ•°ä½“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> è¿”å›å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ‰“å°æ•°ç»„ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> printArr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> ipairs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-2-æ¡ä»¶æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_3-3-2-æ¡ä»¶æ§åˆ¶"><span>3.3.2.æ¡ä»¶æ§åˆ¶</span></a></h3><p>ç±»ä¼¼Javaçš„æ¡ä»¶æ§åˆ¶ï¼Œä¾‹å¦‚ifã€elseè¯­æ³•ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(å¸ƒå°”è¡¨è¾¾å¼)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   --[ å¸ƒå°”è¡¨è¾¾å¼ä¸º true æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   --[ å¸ƒå°”è¡¨è¾¾å¼ä¸º false æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸javaä¸åŒï¼Œå¸ƒå°”è¡¨è¾¾å¼ä¸­çš„é€»è¾‘è¿ç®—æ˜¯åŸºäºè‹±æ–‡å•è¯ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821092657918.png" alt="image-20210821092657918" tabindex="0" loading="lazy"><figcaption>image-20210821092657918</figcaption></figure><h3 id="_3-3-3-æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-3-3-æ¡ˆä¾‹"><span>3.3.3.æ¡ˆä¾‹</span></a></h3><p>éœ€æ±‚ï¼šè‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ‰“å°tableï¼Œå½“å‚æ•°ä¸ºnilæ—¶ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> printArr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;æ•°ç»„ä¸èƒ½ä¸ºç©ºï¼&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> ipairs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-å®ç°å¤šçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_4-å®ç°å¤šçº§ç¼“å­˜"><span>4.å®ç°å¤šçº§ç¼“å­˜</span></a></h1><p>å¤šçº§ç¼“å­˜çš„å®ç°ç¦»ä¸å¼€Nginxç¼–ç¨‹ï¼Œè€ŒNginxç¼–ç¨‹åˆç¦»ä¸å¼€OpenRestyã€‚</p><h2 id="_4-1-å®‰è£…openresty" tabindex="-1"><a class="header-anchor" href="#_4-1-å®‰è£…openresty"><span>4.1.å®‰è£…OpenResty</span></a></h2><p>OpenRestyÂ® æ˜¯ä¸€ä¸ªåŸºäº Nginxçš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><ul><li>å…·å¤‡Nginxçš„å®Œæ•´åŠŸèƒ½</li><li>åŸºäºLuaè¯­è¨€è¿›è¡Œæ‰©å±•ï¼Œé›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—</li><li>å…è®¸ä½¿ç”¨Lua<strong>è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘</strong>ã€<strong>è‡ªå®šä¹‰åº“</strong></li></ul><p>å®˜æ–¹ç½‘ç«™ï¼š https://openresty.org/cn/</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821092902946.png" alt="image-20210821092902946" tabindex="0" loading="lazy"><figcaption>image-20210821092902946</figcaption></figure><p>å®‰è£…Luaå¯ä»¥å‚è€ƒè¯¾å‰èµ„æ–™æä¾›çš„ã€Šå®‰è£…OpenResty.mdã€‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821092941139.png" alt="image-20210821092941139" tabindex="0" loading="lazy"><figcaption>image-20210821092941139</figcaption></figure><h2 id="_4-2-openrestyå¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_4-2-openrestyå¿«é€Ÿå…¥é—¨"><span>4.2.OpenRestyå¿«é€Ÿå…¥é—¨</span></a></h2><p>æˆ‘ä»¬å¸Œæœ›è¾¾åˆ°çš„å¤šçº§ç¼“å­˜æ¶æ„å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/yeVDlwtfMx.png" alt="yeVDlwtfMx" tabindex="0" loading="lazy"><figcaption>yeVDlwtfMx</figcaption></figure><p>å…¶ä¸­ï¼š</p><ul><li><p>windowsä¸Šçš„nginxç”¨æ¥åšåå‘ä»£ç†æœåŠ¡ï¼Œå°†å‰ç«¯çš„æŸ¥è¯¢å•†å“çš„ajaxè¯·æ±‚ä»£ç†åˆ°OpenRestyé›†ç¾¤</p></li><li><p>OpenRestyé›†ç¾¤ç”¨æ¥ç¼–å†™å¤šçº§ç¼“å­˜ä¸šåŠ¡</p></li></ul><h3 id="_4-2-1-åå‘ä»£ç†æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-2-1-åå‘ä»£ç†æµç¨‹"><span>4.2.1.åå‘ä»£ç†æµç¨‹</span></a></h3><p>ç°åœ¨ï¼Œå•†å“è¯¦æƒ…é¡µä½¿ç”¨çš„æ˜¯å‡çš„å•†å“æ•°æ®ã€‚ä¸è¿‡åœ¨æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢æœ‰å‘èµ·ajaxè¯·æ±‚æŸ¥è¯¢çœŸå®å•†å“æ•°æ®ã€‚</p><p>è¿™ä¸ªè¯·æ±‚å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821093144700.png" alt="image-20210821093144700" tabindex="0" loading="lazy"><figcaption>image-20210821093144700</figcaption></figure><p>è¯·æ±‚åœ°å€æ˜¯localhostï¼Œç«¯å£æ˜¯80ï¼Œå°±è¢«windowsä¸Šå®‰è£…çš„NginxæœåŠ¡ç»™æ¥æ”¶åˆ°äº†ã€‚ç„¶åä»£ç†ç»™äº†OpenRestyé›†ç¾¤ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821094447709.png" alt="image-20210821094447709" tabindex="0" loading="lazy"><figcaption>image-20210821094447709</figcaption></figure><p>æˆ‘ä»¬éœ€è¦åœ¨OpenRestyä¸­ç¼–å†™ä¸šåŠ¡ï¼ŒæŸ¥è¯¢å•†å“æ•°æ®å¹¶è¿”å›åˆ°æµè§ˆå™¨ã€‚</p><p>ä½†æ˜¯è¿™æ¬¡ï¼Œæˆ‘ä»¬å…ˆåœ¨OpenRestyæ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å‡çš„å•†å“æ•°æ®ã€‚</p><h3 id="_4-2-2-openrestyç›‘å¬è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_4-2-2-openrestyç›‘å¬è¯·æ±‚"><span>4.2.2.OpenRestyç›‘å¬è¯·æ±‚</span></a></h3><p>OpenRestyçš„å¾ˆå¤šåŠŸèƒ½éƒ½ä¾èµ–äºå…¶ç›®å½•ä¸‹çš„Luaåº“ï¼Œéœ€è¦åœ¨nginx.confä¸­æŒ‡å®šä¾èµ–åº“çš„ç›®å½•ï¼Œå¹¶å¯¼å…¥ä¾èµ–ï¼š</p><p>1ï¼‰æ·»åŠ å¯¹OpenRestyçš„Luaæ¨¡å—çš„åŠ è½½</p><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­çš„httpä¸‹é¢ï¼Œæ·»åŠ ä¸‹é¢ä»£ç ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#lua æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">lua_package_path</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/usr/local/openresty/lualib/?.lua;;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#cæ¨¡å—     </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">lua_package_cpath</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/usr/local/openresty/lualib/?.so;;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰ç›‘å¬/api/itemè·¯å¾„</p><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œåœ¨nginx.confçš„serverä¸‹é¢ï¼Œæ·»åŠ å¯¹/api/itemè¿™ä¸ªè·¯å¾„çš„ç›‘å¬ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">  /api/item </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # é»˜è®¤çš„å“åº”ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">application/json;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # å“åº”ç»“æœç”±lua/item.luaæ–‡ä»¶æ¥å†³å®š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    content_by_lua_file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> lua/item.lua;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç›‘å¬ï¼Œå°±ç±»ä¼¼äºSpringMVCä¸­çš„<code>@GetMapping(&quot;/api/item&quot;)</code>åšè·¯å¾„æ˜ å°„ã€‚</p><p>è€Œ<code>content_by_lua_file lua/item.lua</code>åˆ™ç›¸å½“äºè°ƒç”¨item.luaè¿™ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œå…¶ä¸­çš„ä¸šåŠ¡ï¼ŒæŠŠç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ç›¸å½“äºjavaä¸­è°ƒç”¨serviceã€‚</p><h3 id="_4-2-3-ç¼–å†™item-lua" tabindex="-1"><a class="header-anchor" href="#_4-2-3-ç¼–å†™item-lua"><span>4.2.3.ç¼–å†™item.lua</span></a></h3><p>1ï¼‰åœ¨<code>/usr/loca/openresty/nginx</code>ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹ï¼šlua</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821100755080.png" alt="image-20210821100755080" tabindex="0" loading="lazy"><figcaption>image-20210821100755080</figcaption></figure><p>2ï¼‰åœ¨<code>/usr/loca/openresty/nginx/lua</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶ï¼šitem.lua</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821100801756.png" alt="image-20210821100801756" tabindex="0" loading="lazy"><figcaption>image-20210821100801756</figcaption></figure><p>3ï¼‰ç¼–å†™item.luaï¼Œè¿”å›å‡æ•°æ®</p><p>item.luaä¸­ï¼Œåˆ©ç”¨ngx.say()å‡½æ•°è¿”å›æ•°æ®åˆ°Responseä¸­</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;{&quot;id&quot;:10001,&quot;name&quot;:&quot;SALSA AIR&quot;,&quot;title&quot;:&quot;RIMOWA 21å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4&quot;,&quot;price&quot;:17900,&quot;image&quot;:&quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp&quot;,&quot;category&quot;:&quot;æ‹‰æ†ç®±&quot;,&quot;brand&quot;:&quot;RIMOWA&quot;,&quot;spec&quot;:&quot;&quot;,&quot;status&quot;:1,&quot;createTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;updateTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;stock&quot;:2999,&quot;sold&quot;:31290}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>4ï¼‰é‡æ–°åŠ è½½é…ç½®</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åˆ·æ–°å•†å“é¡µé¢ï¼šhttp://localhost/item.html?id=1001ï¼Œå³å¯çœ‹åˆ°æ•ˆæœï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821101217089.png" alt="image-20210821101217089" tabindex="0" loading="lazy"><figcaption>image-20210821101217089</figcaption></figure><h2 id="_4-3-è¯·æ±‚å‚æ•°å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-3-è¯·æ±‚å‚æ•°å¤„ç†"><span>4.3.è¯·æ±‚å‚æ•°å¤„ç†</span></a></h2><p>ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨OpenRestyæ¥æ”¶å‰ç«¯è¯·æ±‚ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯å‡æ•°æ®ã€‚</p><p>è¦è¿”å›çœŸå®æ•°æ®ï¼Œå¿…é¡»æ ¹æ®å‰ç«¯ä¼ é€’æ¥çš„å•†å“idï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯æ‰å¯ä»¥ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•è·å–å‰ç«¯ä¼ é€’çš„å•†å“å‚æ•°å‘¢ï¼Ÿ</p><h3 id="_4-3-1-è·å–å‚æ•°çš„api" tabindex="-1"><a class="header-anchor" href="#_4-3-1-è·å–å‚æ•°çš„api"><span>4.3.1.è·å–å‚æ•°çš„API</span></a></h3><p>OpenRestyä¸­æä¾›äº†ä¸€äº›APIç”¨æ¥è·å–ä¸åŒç±»å‹çš„å‰ç«¯è¯·æ±‚å‚æ•°ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821101433528.png" alt="image-20210821101433528" tabindex="0" loading="lazy"><figcaption>image-20210821101433528</figcaption></figure><h3 id="_4-3-2-è·å–å‚æ•°å¹¶è¿”å›" tabindex="-1"><a class="header-anchor" href="#_4-3-2-è·å–å‚æ•°å¹¶è¿”å›"><span>4.3.2.è·å–å‚æ•°å¹¶è¿”å›</span></a></h3><p>åœ¨å‰ç«¯å‘èµ·çš„ajaxè¯·æ±‚å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821101721649.png" alt="image-20210821101721649" tabindex="0" loading="lazy"><figcaption>image-20210821101721649</figcaption></figure><p>å¯ä»¥çœ‹åˆ°å•†å“idæ˜¯ä»¥è·¯å¾„å ä½ç¬¦æ–¹å¼ä¼ é€’çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–¹å¼æ¥è·å–ID</p><p>1ï¼‰è·å–å•†å“id</p><p>ä¿®æ”¹<code>/usr/loca/openresty/nginx/nginx.conf</code>æ–‡ä»¶ä¸­ç›‘å¬/api/itemçš„ä»£ç ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è·å–IDï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#E06C75;"> /api/item/(\d+) </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # é»˜è®¤çš„å“åº”ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">application/json;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # å“åº”ç»“æœç”±lua/item.luaæ–‡ä»¶æ¥å†³å®š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    content_by_lua_file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> lua/item.lua;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰æ‹¼æ¥IDå¹¶è¿”å›</p><p>ä¿®æ”¹<code>/usr/loca/openresty/nginx/lua/item.lua</code>æ–‡ä»¶ï¼Œè·å–idå¹¶æ‹¼æ¥åˆ°ç»“æœä¸­è¿”å›ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è·å–å•†å“id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æ‹¼æ¥å¹¶è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;{&quot;id&quot;:&#39; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ..</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;,&quot;name&quot;:&quot;SALSA AIR&quot;,&quot;title&quot;:&quot;RIMOWA 21å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4&quot;,&quot;price&quot;:17900,&quot;image&quot;:&quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp&quot;,&quot;category&quot;:&quot;æ‹‰æ†ç®±&quot;,&quot;brand&quot;:&quot;RIMOWA&quot;,&quot;spec&quot;:&quot;&quot;,&quot;status&quot;:1,&quot;createTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;updateTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;stock&quot;:2999,&quot;sold&quot;:31290}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰é‡æ–°åŠ è½½å¹¶æµ‹è¯•</p><p>è¿è¡Œå‘½ä»¤ä»¥é‡æ–°åŠ è½½OpenRestyé…ç½®ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åˆ·æ–°é¡µé¢å¯ä»¥çœ‹åˆ°ç»“æœä¸­å·²ç»å¸¦ä¸Šäº†IDï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821102235467.png" alt="image-20210821102235467" tabindex="0" loading="lazy"><figcaption>image-20210821102235467</figcaption></figure><h2 id="_4-4-æŸ¥è¯¢tomcat" tabindex="-1"><a class="header-anchor" href="#_4-4-æŸ¥è¯¢tomcat"><span>4.4.æŸ¥è¯¢Tomcat</span></a></h2><p>æ‹¿åˆ°å•†å“IDåï¼Œæœ¬åº”å»ç¼“å­˜ä¸­æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼Œä¸è¿‡ç›®å‰æˆ‘ä»¬è¿˜æœªå»ºç«‹nginxã€redisç¼“å­˜ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ ¹æ®å•†å“idå»tomcatæŸ¥è¯¢å•†å“ä¿¡æ¯ã€‚æˆ‘ä»¬å®ç°å¦‚å›¾éƒ¨åˆ†ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821102610167.png" alt="image-20210821102610167" tabindex="0" loading="lazy"><figcaption>image-20210821102610167</figcaption></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬çš„OpenRestyæ˜¯åœ¨è™šæ‹Ÿæœºï¼ŒTomcatæ˜¯åœ¨Windowsç”µè„‘ä¸Šã€‚ä¸¤è€…IPä¸€å®šä¸è¦æé”™äº†ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821102959829.png" alt="image-20210821102959829" tabindex="0" loading="lazy"><figcaption>image-20210821102959829</figcaption></figure><h3 id="_4-4-1-å‘é€httpè¯·æ±‚çš„api" tabindex="-1"><a class="header-anchor" href="#_4-4-1-å‘é€httpè¯·æ±‚çš„api"><span>4.4.1.å‘é€httpè¯·æ±‚çš„API</span></a></h3><p>nginxæä¾›äº†å†…éƒ¨APIç”¨ä»¥å‘é€httpè¯·æ±‚ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">location</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">capture</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    method</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">HTTP_GET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è¯·æ±‚æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    args</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">},  </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- getæ–¹å¼ä¼ å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿”å›çš„å“åº”å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>resp.statusï¼šå“åº”çŠ¶æ€ç </li><li>resp.headerï¼šå“åº”å¤´ï¼Œæ˜¯ä¸€ä¸ªtable</li><li>resp.bodyï¼šå“åº”ä½“ï¼Œå°±æ˜¯å“åº”æ•°æ®</li></ul><p>æ³¨æ„ï¼šè¿™é‡Œçš„pathæ˜¯è·¯å¾„ï¼Œå¹¶ä¸åŒ…å«IPå’Œç«¯å£ã€‚è¿™ä¸ªè¯·æ±‚ä¼šè¢«nginxå†…éƒ¨çš„serverç›‘å¬å¹¶å¤„ç†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè¯·æ±‚å‘é€åˆ°TomcatæœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¼–å†™ä¸€ä¸ªserveræ¥å¯¹è¿™ä¸ªè·¯å¾„åšåå‘ä»£ç†ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> /path </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     # è¿™é‡Œæ˜¯windowsç”µè„‘çš„ipå’ŒJavaæœåŠ¡ç«¯å£ï¼Œéœ€è¦ç¡®ä¿windowsé˜²ç«å¢™å¤„äºå…³é—­çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">     proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">http://192.168.150.1:8081; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸç†å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821104149061.png" alt="image-20210821104149061" tabindex="0" loading="lazy"><figcaption>image-20210821104149061</figcaption></figure><h3 id="_4-4-2-å°è£…httpå·¥å…·" tabindex="-1"><a class="header-anchor" href="#_4-4-2-å°è£…httpå·¥å…·"><span>4.4.2.å°è£…httpå·¥å…·</span></a></h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°è£…ä¸€ä¸ªå‘é€Httpè¯·æ±‚çš„å·¥å…·ï¼ŒåŸºäºngx.location.captureæ¥å®ç°æŸ¥è¯¢tomcatã€‚</p><p>1ï¼‰æ·»åŠ åå‘ä»£ç†ï¼Œåˆ°windowsçš„JavaæœåŠ¡</p><p>å› ä¸ºitem-serviceä¸­çš„æ¥å£éƒ½æ˜¯/itemå¼€å¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›‘å¬/itemè·¯å¾„ï¼Œä»£ç†åˆ°windowsä¸Šçš„tomcatæœåŠ¡ã€‚</p><p>ä¿®æ”¹ <code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªlocationï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> /item </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">http://192.168.150.1:8081;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥åï¼Œåªè¦æˆ‘ä»¬è°ƒç”¨<code>ngx.location.capture(&quot;/item&quot;)</code>ï¼Œå°±ä¸€å®šèƒ½å‘é€è¯·æ±‚åˆ°windowsçš„tomcatæœåŠ¡ã€‚</p><p>2ï¼‰å°è£…å·¥å…·ç±»</p><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒOpenRestyå¯åŠ¨æ—¶ä¼šåŠ è½½ä»¥ä¸‹ä¸¤ä¸ªç›®å½•ä¸­çš„å·¥å…·æ–‡ä»¶ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821104857413.png" alt="image-20210821104857413" tabindex="0" loading="lazy"><figcaption>image-20210821104857413</figcaption></figure><p>æ‰€ä»¥ï¼Œè‡ªå®šä¹‰çš„httpå·¥å…·ä¹Ÿéœ€è¦æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚</p><p>åœ¨<code>/usr/local/openresty/lualib</code>ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªcommon.luaæ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/openresty/lualib/common.lua</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å†…å®¹å¦‚ä¸‹:</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°è£…å‡½æ•°ï¼Œå‘é€httpè¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">location</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">capture</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        method</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">HTTP_GET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        args</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›404</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;httpè¯·æ±‚æŸ¥è¯¢å¤±è´¥, path: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;, args: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">body</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°†æ–¹æ³•å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _M</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _M</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå·¥å…·å°†read_httpå‡½æ•°å°è£…åˆ°_Mè¿™ä¸ªtableç±»å‹çš„å˜é‡ä¸­ï¼Œå¹¶ä¸”è¿”å›ï¼Œè¿™ç±»ä¼¼äºå¯¼å‡ºã€‚</p><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨<code>require(&#39;common&#39;)</code>æ¥å¯¼å…¥è¯¥å‡½æ•°åº“ï¼Œè¿™é‡Œçš„commonæ˜¯å‡½æ•°åº“çš„æ–‡ä»¶åã€‚</p><p>3ï¼‰å®ç°å•†å“æŸ¥è¯¢</p><p>æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œåˆ©ç”¨åˆšåˆšå°è£…çš„å‡½æ•°åº“å®ç°å¯¹tomcatçš„æŸ¥è¯¢ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¼•å…¥è‡ªå®šä¹‰commonå·¥å…·æ¨¡å—ï¼Œè¿”å›å€¼æ˜¯commonä¸­è¿”å›çš„ _M</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- ä» commonä¸­è·å–read_httpè¿™ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_http</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemStockJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/stock/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡ŒæŸ¥è¯¢åˆ°çš„ç»“æœæ˜¯jsonå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åŒ…å«å•†å“ã€åº“å­˜ä¸¤ä¸ªjsonå­—ç¬¦ä¸²ï¼Œé¡µé¢æœ€ç»ˆéœ€è¦çš„æ˜¯æŠŠä¸¤ä¸ªjsonæ‹¼æ¥ä¸ºä¸€ä¸ªjsonï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821110441222.png" alt="image-20210821110441222" tabindex="0" loading="lazy"><figcaption>image-20210821110441222</figcaption></figure><p>è¿™å°±éœ€è¦æˆ‘ä»¬å…ˆæŠŠJSONå˜ä¸ºluaçš„tableï¼Œå®Œæˆæ•°æ®æ•´åˆåï¼Œå†è½¬ä¸ºJSONã€‚</p><h3 id="_4-4-3-cjsonå·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#_4-4-3-cjsonå·¥å…·ç±»"><span>4.4.3.CJSONå·¥å…·ç±»</span></a></h3><p>OpenRestyæä¾›äº†ä¸€ä¸ªcjsonçš„æ¨¡å—ç”¨æ¥å¤„ç†JSONçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>å®˜æ–¹åœ°å€ï¼š https://github.com/openresty/lua-cjson/</p><p>1ï¼‰å¼•å…¥cjsonæ¨¡å—ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;cjson&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2ï¼‰åºåˆ—åŒ–ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;jack&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    age</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 21</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŠŠ table åºåˆ—åŒ–ä¸º json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰ååºåˆ—åŒ–ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;{&quot;name&quot;: &quot;jack&quot;, &quot;age&quot;: 21}&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- ååºåˆ—åŒ– jsonä¸º table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-4-å®ç°tomcatæŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-4-4-å®ç°tomcatæŸ¥è¯¢"><span>4.4.4.å®ç°TomcatæŸ¥è¯¢</span></a></h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„item.luaä¸­çš„ä¸šåŠ¡ï¼Œæ·»åŠ jsonå¤„ç†åŠŸèƒ½ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_http</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥cjsonåº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;cjson&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemStockJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/stock/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">itemJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stockJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- ç»„åˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">stock</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">sold</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">sold</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-5-åŸºäºidè´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#_4-4-5-åŸºäºidè´Ÿè½½å‡è¡¡"><span>4.4.5.åŸºäºIDè´Ÿè½½å‡è¡¡</span></a></h3><p>åˆšæ‰çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„tomcatæ˜¯å•æœºéƒ¨ç½²ã€‚è€Œå®é™…å¼€å‘ä¸­ï¼Œtomcatä¸€å®šæ˜¯é›†ç¾¤æ¨¡å¼ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821111023255.png" alt="image-20210821111023255" tabindex="0" loading="lazy"><figcaption>image-20210821111023255</figcaption></figure><p>å› æ­¤ï¼ŒOpenRestyéœ€è¦å¯¹tomcaté›†ç¾¤åšè´Ÿè½½å‡è¡¡ã€‚</p><p>è€Œé»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™æ˜¯è½®è¯¢æ¨¡å¼ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢/item/10001æ—¶ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡ä¼šè®¿é—®8081ç«¯å£çš„tomcatæœåŠ¡ï¼Œåœ¨è¯¥æœåŠ¡å†…éƒ¨å°±å½¢æˆäº†JVMè¿›ç¨‹ç¼“å­˜</li><li>ç¬¬äºŒæ¬¡ä¼šè®¿é—®8082ç«¯å£çš„tomcatæœåŠ¡ï¼Œè¯¥æœåŠ¡å†…éƒ¨æ²¡æœ‰JVMç¼“å­˜ï¼ˆå› ä¸ºJVMç¼“å­˜æ— æ³•å…±äº«ï¼‰ï¼Œä¼šæŸ¥è¯¢æ•°æ®åº“</li><li>...</li></ul><p>ä½ çœ‹ï¼Œå› ä¸ºè½®è¯¢çš„åŸå› ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢8081å½¢æˆçš„JVMç¼“å­˜å¹¶æœªç”Ÿæ•ˆï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å†æ¬¡è®¿é—®åˆ°8081æ—¶æ‰å¯ä»¥ç”Ÿæ•ˆï¼Œç¼“å­˜å‘½ä¸­ç‡å¤ªä½äº†ã€‚</p><p>æ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœèƒ½è®©åŒä¸€ä¸ªå•†å“ï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½è®¿é—®åŒä¸€ä¸ªtomcatæœåŠ¡ï¼Œé‚£ä¹ˆJVMç¼“å­˜å°±ä¸€å®šèƒ½ç”Ÿæ•ˆäº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å•†å“idåšè´Ÿè½½å‡è¡¡ï¼Œè€Œä¸æ˜¯è½®è¯¢ã€‚</p><h4 id="_1-åŸç†" tabindex="-1"><a class="header-anchor" href="#_1-åŸç†"><span>1ï¼‰åŸç†</span></a></h4><p>nginxæä¾›äº†åŸºäºè¯·æ±‚è·¯å¾„åšè´Ÿè½½å‡è¡¡çš„ç®—æ³•ï¼š</p><p>nginxæ ¹æ®è¯·æ±‚è·¯å¾„åšhashè¿ç®—ï¼ŒæŠŠå¾—åˆ°çš„æ•°å€¼å¯¹tomcatæœåŠ¡çš„æ•°é‡å–ä½™ï¼Œä½™æ•°æ˜¯å‡ ï¼Œå°±è®¿é—®ç¬¬å‡ ä¸ªæœåŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li>æˆ‘ä»¬çš„è¯·æ±‚è·¯å¾„æ˜¯ /item/10001</li><li>tomcatæ€»æ•°ä¸º2å°ï¼ˆ8081ã€8082ï¼‰</li><li>å¯¹è¯·æ±‚è·¯å¾„/item/1001åšhashè¿ç®—æ±‚ä½™çš„ç»“æœä¸º1</li><li>åˆ™è®¿é—®ç¬¬ä¸€ä¸ªtomcatæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯8081</li></ul><p>åªè¦idä¸å˜ï¼Œæ¯æ¬¡hashè¿ç®—ç»“æœä¹Ÿä¸ä¼šå˜ï¼Œé‚£å°±å¯ä»¥ä¿è¯åŒä¸€ä¸ªå•†å“ï¼Œä¸€ç›´è®¿é—®åŒä¸€ä¸ªtomcatæœåŠ¡ï¼Œç¡®ä¿JVMç¼“å­˜ç”Ÿæ•ˆã€‚</p><h4 id="_2-å®ç°" tabindex="-1"><a class="header-anchor" href="#_2-å®ç°"><span>2ï¼‰å®ç°</span></a></h4><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œå®ç°åŸºäºIDåšè´Ÿè½½å‡è¡¡ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰tomcaté›†ç¾¤ï¼Œå¹¶è®¾ç½®åŸºäºè·¯å¾„åšè´Ÿè½½å‡è¡¡ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> tomcat-cluster </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    hash </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">request_uri</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 192.168.150.1:8081;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 192.168.150.1:8082;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä¿®æ”¹å¯¹tomcatæœåŠ¡çš„åå‘ä»£ç†ï¼Œç›®æ ‡æŒ‡å‘tomcaté›†ç¾¤ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> /item </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">http://tomcat-cluster;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡æ–°åŠ è½½OpenResty</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-æµ‹è¯•"><span>3ï¼‰æµ‹è¯•</span></a></h4><p>å¯åŠ¨ä¸¤å°tomcatæœåŠ¡ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112420464.png" alt="image-20210821112420464" tabindex="0" loading="lazy"><figcaption>image-20210821112420464</figcaption></figure><p>åŒæ—¶å¯åŠ¨ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112444482.png" alt="image-20210821112444482" tabindex="0" loading="lazy"><figcaption>image-20210821112444482</figcaption></figure><p>æ¸…ç©ºæ—¥å¿—åï¼Œå†æ¬¡è®¿é—®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸åŒidçš„å•†å“ï¼Œè®¿é—®åˆ°äº†ä¸åŒçš„tomcatæœåŠ¡ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112559965.png" alt="image-20210821112559965" tabindex="0" loading="lazy"><figcaption>image-20210821112559965</figcaption></figure><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821112637430.png" alt="image-20210821112637430" tabindex="0" loading="lazy"><figcaption>image-20210821112637430</figcaption></figure><h2 id="_4-5-redisç¼“å­˜é¢„çƒ­" tabindex="-1"><a class="header-anchor" href="#_4-5-redisç¼“å­˜é¢„çƒ­"><span>4.5.Redisç¼“å­˜é¢„çƒ­</span></a></h2><p>Redisç¼“å­˜ä¼šé¢ä¸´å†·å¯åŠ¨é—®é¢˜ï¼š</p><p><strong>å†·å¯åŠ¨</strong>ï¼šæœåŠ¡åˆšåˆšå¯åŠ¨æ—¶ï¼ŒRedisä¸­å¹¶æ²¡æœ‰ç¼“å­˜ï¼Œå¦‚æœæ‰€æœ‰å•†å“æ•°æ®éƒ½åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶æ·»åŠ ç¼“å­˜ï¼Œå¯èƒ½ä¼šç»™æ•°æ®åº“å¸¦æ¥è¾ƒå¤§å‹åŠ›ã€‚</p><p><strong>ç¼“å­˜é¢„çƒ­</strong>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤§æ•°æ®ç»Ÿè®¡ç”¨æˆ·è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å°†è¿™äº›çƒ­ç‚¹æ•°æ®æå‰æŸ¥è¯¢å¹¶ä¿å­˜åˆ°Redisä¸­ã€‚</p><p>æˆ‘ä»¬æ•°æ®é‡è¾ƒå°‘ï¼Œå¹¶ä¸”æ²¡æœ‰æ•°æ®ç»Ÿè®¡ç›¸å…³åŠŸèƒ½ï¼Œç›®å‰å¯ä»¥åœ¨å¯åŠ¨æ—¶å°†æ‰€æœ‰æ•°æ®éƒ½æ”¾å…¥ç¼“å­˜ä¸­ã€‚</p><p>1ï¼‰åˆ©ç”¨Dockerå®‰è£…Redis</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redis</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 6379:6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redis</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redis-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --appendonly</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2ï¼‰åœ¨item-serviceæœåŠ¡ä¸­å¼•å…¥Redisä¾èµ–</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-data-redis&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰é…ç½®Redisåœ°å€</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">192.168.150.101</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ï¼‰ç¼–å†™åˆå§‹åŒ–ç±»</p><p>ç¼“å­˜é¢„çƒ­éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨æ—¶å®Œæˆï¼Œå¹¶ä¸”å¿…é¡»æ˜¯æ‹¿åˆ°RedisTemplateä¹‹åã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨InitializingBeanæ¥å£æ¥å®ç°ï¼Œå› ä¸ºInitializingBeanå¯ä»¥åœ¨å¯¹è±¡è¢«Springåˆ›å»ºå¹¶ä¸”æˆå‘˜å˜é‡å…¨éƒ¨æ³¨å…¥åæ‰§è¡Œã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.heima.item.config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.core.JsonProcessingException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.databind.ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.pojo.ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemStockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.InitializingBean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Autowired</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.data.redis.core.StringRedisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.stereotype.Component</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> RedisHandler</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> InitializingBean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> StringRedisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IItemService</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IItemStockService</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> MAPPER </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> afterPropertiesSet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åˆå§‹åŒ–ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 1.æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">itemList</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> itemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 2.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> itemList) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 3.æŸ¥è¯¢å•†å“åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stockList</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 4.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> stockList) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(stock);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:stock:id:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-6-æŸ¥è¯¢redisç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_4-6-æŸ¥è¯¢redisç¼“å­˜"><span>4.6.æŸ¥è¯¢Redisç¼“å­˜</span></a></h2><p>ç°åœ¨ï¼ŒRedisç¼“å­˜å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥å†OpenRestyä¸­å®ç°æŸ¥è¯¢Redisçš„é€»è¾‘äº†ã€‚å¦‚ä¸‹å›¾çº¢æ¡†æ‰€ç¤ºï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821113340111.png" alt="image-20210821113340111" tabindex="0" loading="lazy"><figcaption>image-20210821113340111</figcaption></figure><p>å½“è¯·æ±‚è¿›å…¥OpenRestyä¹‹åï¼š</p><ul><li>ä¼˜å…ˆæŸ¥è¯¢Redisç¼“å­˜</li><li>å¦‚æœRedisç¼“å­˜æœªå‘½ä¸­ï¼Œå†æŸ¥è¯¢Tomcat</li></ul><h3 id="_4-6-1-å°è£…rediså·¥å…·" tabindex="-1"><a class="header-anchor" href="#_4-6-1-å°è£…rediså·¥å…·"><span>4.6.1.å°è£…Rediså·¥å…·</span></a></h3><p>OpenRestyæä¾›äº†æ“ä½œRedisçš„æ¨¡å—ï¼Œæˆ‘ä»¬åªè¦å¼•å…¥è¯¥æ¨¡å—å°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†Redisæ“ä½œå°è£…åˆ°ä¹‹å‰çš„common.luaå·¥å…·åº“ä¸­ã€‚</p><p>ä¿®æ”¹<code>/usr/local/openresty/lualib/common.lua</code>æ–‡ä»¶ï¼š</p><p>1ï¼‰å¼•å…¥Redisæ¨¡å—ï¼Œå¹¶åˆå§‹åŒ–Rediså¯¹è±¡</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;resty.redis&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- åˆå§‹åŒ–redis</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> red</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">set_timeouts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰å°è£…å‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾Redisè¿æ¥ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> close_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pool_max_idle_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> -- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pool_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> --è¿æ¥æ± å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">set_keepalive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pool_max_idle_time</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pool_size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰å°è£…å‡½æ•°ï¼Œæ ¹æ®keyæŸ¥è¯¢Redisæ•°æ®</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- è·å–ä¸€ä¸ªè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿æ¥rediså¤±è´¥ : &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Rediså¤±è´¥: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;, key = &quot; </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    --å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">    close_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ï¼‰å¯¼å‡º</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°†æ–¹æ³•å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _M</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    read_redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _M</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæ•´çš„common.luaï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;resty.redis&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- åˆå§‹åŒ–redis</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> red</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">set_timeouts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> close_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pool_max_idle_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> -- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pool_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> --è¿æ¥æ± å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">set_keepalive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pool_max_idle_time</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pool_size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- è·å–ä¸€ä¸ªè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿æ¥rediså¤±è´¥ : &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Rediså¤±è´¥: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;, key = &quot; </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    --å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">    close_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°è£…å‡½æ•°ï¼Œå‘é€httpè¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">location</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">capture</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        method</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">HTTP_GET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        args</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›404</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;httpæŸ¥è¯¢å¤±è´¥, path: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;, args: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">body</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°†æ–¹æ³•å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _M</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    read_redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _M</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-2-å®ç°redisæŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-6-2-å®ç°redisæŸ¥è¯¢"><span>4.6.2.å®ç°RedisæŸ¥è¯¢</span></a></h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»ä¿®æ”¹item.luaæ–‡ä»¶ï¼Œå®ç°å¯¹Redisçš„æŸ¥è¯¢äº†ã€‚</p><p>æŸ¥è¯¢é€»è¾‘æ˜¯ï¼š</p><ul><li>æ ¹æ®idæŸ¥è¯¢Redis</li><li>å¦‚æœæŸ¥è¯¢å¤±è´¥åˆ™ç»§ç»­æŸ¥è¯¢Tomcat</li><li>å°†æŸ¥è¯¢ç»“æœè¿”å›</li></ul><p>1ï¼‰ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªæŸ¥è¯¢å‡½æ•°ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_http</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_redis</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰è€Œåä¿®æ”¹å•†å“æŸ¥è¯¢ã€åº“å­˜æŸ¥è¯¢çš„ä¸šåŠ¡ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821114528954.png" alt="image-20210821114528954" tabindex="0" loading="lazy"><figcaption>image-20210821114528954</figcaption></figure><p>3ï¼‰å®Œæ•´çš„item.luaä»£ç ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_http</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_redis</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥cjsonåº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;cjson&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:id:&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stockJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:stock:id:&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/stock/&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">itemJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stockJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- ç»„åˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">stock</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">sold</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">sold</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-7-nginxæœ¬åœ°ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_4-7-nginxæœ¬åœ°ç¼“å­˜"><span>4.7.Nginxæœ¬åœ°ç¼“å­˜</span></a></h2><p>ç°åœ¨ï¼Œæ•´ä¸ªå¤šçº§ç¼“å­˜ä¸­åªå·®æœ€åä¸€ç¯ï¼Œä¹Ÿå°±æ˜¯nginxçš„æœ¬åœ°ç¼“å­˜äº†ã€‚å¦‚å›¾ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821114742950.png" alt="image-20210821114742950" tabindex="0" loading="lazy"><figcaption>image-20210821114742950</figcaption></figure><h3 id="_4-7-1-æœ¬åœ°ç¼“å­˜api" tabindex="-1"><a class="header-anchor" href="#_4-7-1-æœ¬åœ°ç¼“å­˜api"><span>4.7.1.æœ¬åœ°ç¼“å­˜API</span></a></h3><p>OpenRestyä¸ºNginxæä¾›äº†<strong>shard dict</strong>çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨nginxçš„å¤šä¸ªworkerä¹‹é—´å…±äº«æ•°æ®ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p><p>1ï¼‰å¼€å¯å…±äº«å­—å…¸ï¼Œåœ¨nginx.confçš„httpä¸‹æ·»åŠ é…ç½®ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å°150m</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> lua_shared_dict</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> item_cache </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">150m</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰æ“ä½œå…±äº«å­—å…¸ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è·å–æœ¬åœ°ç¼“å­˜å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">shared</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">item_cache</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å­˜å‚¨, æŒ‡å®škeyã€valueã€è¿‡æœŸæ—¶é—´ï¼Œå•ä½sï¼Œé»˜è®¤ä¸º0ä»£è¡¨æ°¸ä¸è¿‡æœŸ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">item_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;value&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> item_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-2-å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-7-2-å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢"><span>4.7.2.å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</span></a></h3><p>1ï¼‰ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œä¿®æ”¹read_dataæŸ¥è¯¢å‡½æ•°ï¼Œæ·»åŠ æœ¬åœ°ç¼“å­˜é€»è¾‘ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">shared</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">item_cache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">expire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> item_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢Redisï¼Œ key: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">    item_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">expire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰ä¿®æ”¹item.luaä¸­æŸ¥è¯¢å•†å“å’Œåº“å­˜çš„ä¸šåŠ¡ï¼Œå®ç°æœ€æ–°çš„read_dataå‡½æ•°ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115108528.png" alt="image-20210821115108528" tabindex="0" loading="lazy"><figcaption>image-20210821115108528</figcaption></figure><p>å…¶å®å°±æ˜¯å¤šäº†ç¼“å­˜æ—¶é—´å‚æ•°ï¼Œè¿‡æœŸånginxç¼“å­˜ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œä¸‹æ¬¡è®¿é—®å³å¯æ›´æ–°ç¼“å­˜ã€‚</p><p>è¿™é‡Œç»™å•†å“åŸºæœ¬ä¿¡æ¯è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º30åˆ†é’Ÿï¼Œåº“å­˜ä¸º1åˆ†é’Ÿã€‚</p><p>å› ä¸ºåº“å­˜æ›´æ–°é¢‘ç‡è¾ƒé«˜ï¼Œå¦‚æœç¼“å­˜æ—¶é—´è¿‡é•¿ï¼Œå¯èƒ½ä¸æ•°æ®åº“å·®å¼‚è¾ƒå¤§ã€‚</p><p>3ï¼‰å®Œæ•´çš„item.luaæ–‡ä»¶ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_http</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> read_redis</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">read_redis</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥cjsonåº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;cjson&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">shared</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">item_cache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">expire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> item_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢Redisï¼Œ key: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">ERR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            val</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">    item_cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">expire</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:id:&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1800</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stockJSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:stock:id:&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/item/stock/&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">itemJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stockJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- ç»„åˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">stock</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">sold</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">sold</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_5-ç¼“å­˜åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_5-ç¼“å­˜åŒæ­¥"><span>5.ç¼“å­˜åŒæ­¥</span></a></h1><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æŸ¥è¯¢åˆ°çš„éƒ½æ˜¯ç¼“å­˜æ•°æ®ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸æ•°æ®åº“æ•°æ®å­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ¯”è¾ƒä¸¥é‡çš„åæœã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä¿è¯æ•°æ®åº“æ•°æ®ã€ç¼“å­˜æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¿™å°±æ˜¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒæ­¥ã€‚</p><h2 id="_5-1-æ•°æ®åŒæ­¥ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_5-1-æ•°æ®åŒæ­¥ç­–ç•¥"><span>5.1.æ•°æ®åŒæ­¥ç­–ç•¥</span></a></h2><p>ç¼“å­˜æ•°æ®åŒæ­¥çš„å¸¸è§æ–¹å¼æœ‰ä¸‰ç§ï¼š</p><p><strong>è®¾ç½®æœ‰æ•ˆæœŸ</strong>ï¼šç»™ç¼“å­˜è®¾ç½®æœ‰æ•ˆæœŸï¼Œåˆ°æœŸåè‡ªåŠ¨åˆ é™¤ã€‚å†æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°</p><ul><li>ä¼˜åŠ¿ï¼šç®€å•ã€æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®ï¼Œç¼“å­˜è¿‡æœŸä¹‹å‰å¯èƒ½ä¸ä¸€è‡´</li><li>åœºæ™¯ï¼šæ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œæ—¶æ•ˆæ€§è¦æ±‚ä½çš„ä¸šåŠ¡</li></ul><p><strong>åŒæ­¥åŒå†™</strong>ï¼šåœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œç›´æ¥ä¿®æ”¹ç¼“å­˜</p><ul><li>ä¼˜åŠ¿ï¼šæ—¶æ•ˆæ€§å¼ºï¼Œç¼“å­˜ä¸æ•°æ®åº“å¼ºä¸€è‡´</li><li>ç¼ºç‚¹ï¼šæœ‰ä»£ç ä¾µå…¥ï¼Œè€¦åˆåº¦é«˜ï¼›</li><li>åœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§ã€æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„ç¼“å­˜æ•°æ®</li></ul><p>**å¼‚æ­¥é€šçŸ¥ï¼š**ä¿®æ”¹æ•°æ®åº“æ—¶å‘é€äº‹ä»¶é€šçŸ¥ï¼Œç›¸å…³æœåŠ¡ç›‘å¬åˆ°é€šçŸ¥åä¿®æ”¹ç¼“å­˜æ•°æ®</p><ul><li>ä¼˜åŠ¿ï¼šä½è€¦åˆï¼Œå¯ä»¥åŒæ—¶é€šçŸ¥å¤šä¸ªç¼“å­˜æœåŠ¡</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§ä¸€èˆ¬ï¼Œå¯èƒ½å­˜åœ¨ä¸­é—´ä¸ä¸€è‡´çŠ¶æ€</li><li>åœºæ™¯ï¼šæ—¶æ•ˆæ€§è¦æ±‚ä¸€èˆ¬ï¼Œæœ‰å¤šä¸ªæœåŠ¡éœ€è¦åŒæ­¥</li></ul><p>è€Œå¼‚æ­¥å®ç°åˆå¯ä»¥åŸºäºMQæˆ–è€…Canalæ¥å®ç°ï¼š</p><p>1ï¼‰åŸºäºMQçš„å¼‚æ­¥é€šçŸ¥ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115552327.png" alt="image-20210821115552327" tabindex="0" loading="lazy"><figcaption>image-20210821115552327</figcaption></figure><p>è§£è¯»ï¼š</p><ul><li>å•†å“æœåŠ¡å®Œæˆå¯¹æ•°æ®çš„ä¿®æ”¹åï¼Œåªéœ€è¦å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°MQä¸­ã€‚</li><li>ç¼“å­˜æœåŠ¡ç›‘å¬MQæ¶ˆæ¯ï¼Œç„¶åå®Œæˆå¯¹ç¼“å­˜çš„æ›´æ–°</li></ul><p>ä¾ç„¶æœ‰å°‘é‡çš„ä»£ç ä¾µå…¥ã€‚</p><p>2ï¼‰åŸºäºCanalçš„é€šçŸ¥</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115719363.png" alt="image-20210821115719363" tabindex="0" loading="lazy"><figcaption>image-20210821115719363</figcaption></figure><p>è§£è¯»ï¼š</p><ul><li>å•†å“æœåŠ¡å®Œæˆå•†å“ä¿®æ”¹åï¼Œä¸šåŠ¡ç›´æ¥ç»“æŸï¼Œæ²¡æœ‰ä»»ä½•ä»£ç ä¾µå…¥</li><li>Canalç›‘å¬MySQLå˜åŒ–ï¼Œå½“å‘ç°å˜åŒ–åï¼Œç«‹å³é€šçŸ¥ç¼“å­˜æœåŠ¡</li><li>ç¼“å­˜æœåŠ¡æ¥æ”¶åˆ°canalé€šçŸ¥ï¼Œæ›´æ–°ç¼“å­˜</li></ul><p>ä»£ç é›¶ä¾µå…¥</p><h2 id="_5-2-å®‰è£…canal" tabindex="-1"><a class="header-anchor" href="#_5-2-å®‰è£…canal"><span>5.2.å®‰è£…Canal</span></a></h2><h3 id="_5-2-1-è®¤è¯†canal" tabindex="-1"><a class="header-anchor" href="#_5-2-1-è®¤è¯†canal"><span>5.2.1.è®¤è¯†Canal</span></a></h3><p><strong>Canal [kÉ™&#39;nÃ¦l]</strong>ï¼Œè¯‘æ„ä¸ºæ°´é“/ç®¡é“/æ²Ÿæ¸ ï¼Œcanalæ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼ŒåŸºäºJavaå¼€å‘ã€‚åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…&amp;æ¶ˆè´¹ã€‚GitHubçš„åœ°å€ï¼šhttps://github.com/alibaba/canal</p><p>Canalæ˜¯åŸºäºmysqlçš„ä¸»ä»åŒæ­¥æ¥å®ç°çš„ï¼ŒMySQLä¸»ä»åŒæ­¥çš„åŸç†å¦‚ä¸‹ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115914748.png" alt="image-20210821115914748" tabindex="0" loading="lazy"><figcaption>image-20210821115914748</figcaption></figure><ul><li>1ï¼‰MySQL master å°†æ•°æ®å˜æ›´å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—( binary logï¼‰ï¼Œå…¶ä¸­è®°å½•çš„æ•°æ®å«åšbinary log events</li><li>2ï¼‰MySQL slave å°† master çš„ binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)</li><li>3ï¼‰MySQL slave é‡æ”¾ relay log ä¸­äº‹ä»¶ï¼Œå°†æ•°æ®å˜æ›´åæ˜ å®ƒè‡ªå·±çš„æ•°æ®</li></ul><p>è€ŒCanalå°±æ˜¯æŠŠè‡ªå·±ä¼ªè£…æˆMySQLçš„ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œä»è€Œç›‘å¬masterçš„binary logå˜åŒ–ã€‚å†æŠŠå¾—åˆ°çš„å˜åŒ–ä¿¡æ¯é€šçŸ¥ç»™Canalçš„å®¢æˆ·ç«¯ï¼Œè¿›è€Œå®Œæˆå¯¹å…¶å®ƒæ•°æ®åº“çš„åŒæ­¥ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821115948395.png" alt="image-20210821115948395" tabindex="0" loading="lazy"><figcaption>image-20210821115948395</figcaption></figure><h3 id="_5-2-2-å®‰è£…canal" tabindex="-1"><a class="header-anchor" href="#_5-2-2-å®‰è£…canal"><span>5.2.2.å®‰è£…Canal</span></a></h3><p>å®‰è£…å’Œé…ç½®Canalå‚è€ƒè¯¾å‰èµ„æ–™æ–‡æ¡£ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821120017324.png" alt="image-20210821120017324" tabindex="0" loading="lazy"><figcaption>image-20210821120017324</figcaption></figure><h2 id="_5-3-ç›‘å¬canal" tabindex="-1"><a class="header-anchor" href="#_5-3-ç›‘å¬canal"><span>5.3.ç›‘å¬Canal</span></a></h2><p>Canalæä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œå½“Canalç›‘å¬åˆ°binlogå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥Canalçš„å®¢æˆ·ç«¯ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20210821120049024.png" alt="image-20210821120049024" tabindex="0" loading="lazy"><figcaption>image-20210821120049024</figcaption></figure><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Canalæä¾›çš„Javaå®¢æˆ·ç«¯ï¼Œç›‘å¬Canalé€šçŸ¥æ¶ˆæ¯ã€‚å½“æ”¶åˆ°å˜åŒ–çš„æ¶ˆæ¯æ—¶ï¼Œå®Œæˆå¯¹ç¼“å­˜çš„æ›´æ–°ã€‚</p><p>ä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨GitHubä¸Šçš„ç¬¬ä¸‰æ–¹å¼€æºçš„canal-starterå®¢æˆ·ç«¯ã€‚åœ°å€ï¼šhttps://github.com/NormanGyllenhaal/canal-client</p><p>ä¸SpringBootå®Œç¾æ•´åˆï¼Œè‡ªåŠ¨è£…é…ï¼Œæ¯”å®˜æ–¹å®¢æˆ·ç«¯è¦ç®€å•å¥½ç”¨å¾ˆå¤šã€‚</p><h3 id="_5-3-1-å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_5-3-1-å¼•å…¥ä¾èµ–"><span>5.3.1.å¼•å…¥ä¾èµ–ï¼š</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;top.javatool&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;canal-spring-boot-starter&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;1.2.1-RELEASE&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-2-ç¼–å†™é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-3-2-ç¼–å†™é…ç½®"><span>5.3.2.ç¼–å†™é…ç½®ï¼š</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">heima</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # canalçš„é›†ç¾¤åå­—ï¼Œè¦ä¸å®‰è£…canalæ—¶è®¾ç½®çš„åç§°ä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.150.101:11111</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # canalæœåŠ¡åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-3-ä¿®æ”¹itemå®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#_5-3-3-ä¿®æ”¹itemå®ä½“ç±»"><span>5.3.3.ä¿®æ”¹Itemå®ä½“ç±»</span></a></h3><p>é€šè¿‡@Idã€@Columnã€ç­‰æ³¨è§£å®ŒæˆItemä¸æ•°æ®åº“è¡¨å­—æ®µçš„æ˜ å°„ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.heima.item.pojo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.IdType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.TableField</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.TableId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.TableName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> lombok.Data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.data.annotation.Id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.data.annotation.Transient</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> javax.persistence.Column</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">TableName</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tb_item&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">TableId</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IdType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">AUTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//å•†å“id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//å•†å“åç§°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> title</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//å•†å“æ ‡é¢˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> price</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//ä»·æ ¼ï¼ˆåˆ†ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> image</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//å•†å“å›¾ç‰‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> category</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//åˆ†ç±»åç§°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> brand</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//å“ç‰Œåç§°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//è§„æ ¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> status</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//å•†å“çŠ¶æ€ 1-æ­£å¸¸ï¼Œ2-ä¸‹æ¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> createTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//åˆ›å»ºæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> updateTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//æ›´æ–°æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">TableField</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">exist</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Transient</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">TableField</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">exist</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Transient</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sold</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-4-ç¼–å†™ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#_5-3-4-ç¼–å†™ç›‘å¬å™¨"><span>5.3.4.ç¼–å†™ç›‘å¬å™¨</span></a></h3><p>é€šè¿‡å®ç°<code>EntryHandler&lt;T&gt;</code>æ¥å£ç¼–å†™ç›‘å¬å™¨ï¼Œç›‘å¬Canalæ¶ˆæ¯ã€‚æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li>å®ç°ç±»é€šè¿‡<code>@CanalTable(&quot;tb_item&quot;)</code>æŒ‡å®šç›‘å¬çš„è¡¨ä¿¡æ¯</li><li>EntryHandlerçš„æ³›å‹æ˜¯ä¸è¡¨å¯¹åº”çš„å®ä½“ç±»</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.heima.item.canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.github.benmanes.caffeine.cache.Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.config.RedisHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Autowired</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.stereotype.Component</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> top.javatool.canal.client.annotation.CanalTable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> top.javatool.canal.client.handler.EntryHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">CanalTable</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tb_item&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ItemHandler</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> EntryHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> RedisHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> redisHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> insert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        itemCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), item);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        redisHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">saveItem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> before</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> after</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        itemCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">after</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), after);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        redisHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">saveItem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(after);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åˆ é™¤æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        itemCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">invalidate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åˆ é™¤æ•°æ®åˆ°redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        redisHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">deleteItemById</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œå¯¹Redisçš„æ“ä½œéƒ½å°è£…åˆ°äº†RedisHandlerè¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæ˜¯æˆ‘ä»¬ä¹‹å‰åšç¼“å­˜é¢„çƒ­æ—¶ç¼–å†™çš„ä¸€ä¸ªç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.heima.item.config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.core.JsonProcessingException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.databind.ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.pojo.ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemStockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.InitializingBean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Autowired</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.data.redis.core.StringRedisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.stereotype.Component</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> RedisHandler</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> InitializingBean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> StringRedisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IItemService</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> itemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IItemStockService</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> MAPPER </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> afterPropertiesSet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åˆå§‹åŒ–ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 1.æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">itemList</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> itemService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 2.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> itemList) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 3.æŸ¥è¯¢å•†å“åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stockList</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stockService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 4.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> stockList) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(stock);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:stock:id:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> saveItem</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">JsonProcessingException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> deleteItemById</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redisé«˜çº§ç¯‡ä¹‹å®è·µ" tabindex="-1"><a class="header-anchor" href="#redisé«˜çº§ç¯‡ä¹‹å®è·µ"><span>Redisé«˜çº§ç¯‡ä¹‹å®è·µ</span></a></h2><p><strong>ä»Šæ—¥å†…å®¹</strong></p><blockquote><ul><li>Redisé”®å€¼è®¾è®¡</li><li>æ‰¹å¤„ç†ä¼˜åŒ–</li><li>æœåŠ¡ç«¯ä¼˜åŒ–</li><li>é›†ç¾¤æœ€ä½³å®è·µ</li></ul></blockquote><h2 id="_1ã€redisé”®å€¼è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_1ã€redisé”®å€¼è®¾è®¡"><span>1ã€Redisé”®å€¼è®¾è®¡</span></a></h2><h3 id="_1-1ã€ä¼˜é›…çš„keyç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-1ã€ä¼˜é›…çš„keyç»“æ„"><span>1.1ã€ä¼˜é›…çš„keyç»“æ„</span></a></h3><p>Redisçš„Keyè™½ç„¶å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æœ€å¥½éµå¾ªä¸‹é¢çš„å‡ ä¸ªæœ€ä½³å®è·µçº¦å®šï¼š</p><ul><li>éµå¾ªåŸºæœ¬æ ¼å¼ï¼š[ä¸šåŠ¡åç§°]:[æ•°æ®å]:[id]</li><li>é•¿åº¦ä¸è¶…è¿‡44å­—èŠ‚</li><li>ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦</li></ul><p>ä¾‹å¦‚ï¼šæˆ‘ä»¬çš„ç™»å½•ä¸šåŠ¡ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå…¶keyå¯ä»¥è®¾è®¡æˆå¦‚ä¸‹æ ¼å¼ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521120213631.png" alt="image-20220521120213631" tabindex="0" loading="lazy"><figcaption>image-20220521120213631</figcaption></figure><p>è¿™æ ·è®¾è®¡çš„å¥½å¤„ï¼š</p><ul><li>å¯è¯»æ€§å¼º</li><li>é¿å…keyå†²çª</li><li>æ–¹ä¾¿ç®¡ç†</li><li>æ›´èŠ‚çœå†…å­˜ï¼š keyæ˜¯stringç±»å‹ï¼Œåº•å±‚ç¼–ç åŒ…å«intã€embstrå’Œrawä¸‰ç§ã€‚embstråœ¨å°äº44å­—èŠ‚ä½¿ç”¨ï¼Œé‡‡ç”¨è¿ç»­å†…å­˜ç©ºé—´ï¼Œå†…å­˜å ç”¨æ›´å°ã€‚å½“å­—èŠ‚æ•°å¤§äº44å­—èŠ‚æ—¶ï¼Œä¼šè½¬ä¸ºrawæ¨¡å¼å­˜å‚¨ï¼Œåœ¨rawæ¨¡å¼ä¸‹ï¼Œå†…å­˜ç©ºé—´ä¸æ˜¯è¿ç»­çš„ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†å¦å¤–ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œåœ¨è¿™æ®µç©ºé—´é‡Œå­˜å‚¨SDSå†…å®¹ï¼Œè¿™æ ·ç©ºé—´ä¸è¿ç»­ï¼Œè®¿é—®çš„æ—¶å€™æ€§èƒ½ä¹Ÿå°±ä¼šæ”¶åˆ°å½±å“ï¼Œè¿˜æœ‰å¯èƒ½äº§ç”Ÿå†…å­˜ç¢ç‰‡</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521122320482.png" alt="image-20220521122320482" tabindex="0" loading="lazy"><figcaption>image-20220521122320482</figcaption></figure><h3 id="_1-2ã€æ‹’ç»bigkey" tabindex="-1"><a class="header-anchor" href="#_1-2ã€æ‹’ç»bigkey"><span>1.2ã€æ‹’ç»BigKey</span></a></h3><p>BigKeyé€šå¸¸ä»¥Keyçš„å¤§å°å’ŒKeyä¸­æˆå‘˜çš„æ•°é‡æ¥ç»¼åˆåˆ¤å®šï¼Œä¾‹å¦‚ï¼š</p><ul><li>Keyæœ¬èº«çš„æ•°æ®é‡è¿‡å¤§ï¼šä¸€ä¸ªStringç±»å‹çš„Keyï¼Œå®ƒçš„å€¼ä¸º5 MB</li><li>Keyä¸­çš„æˆå‘˜æ•°è¿‡å¤šï¼šä¸€ä¸ªZSETç±»å‹çš„Keyï¼Œå®ƒçš„æˆå‘˜æ•°é‡ä¸º10,000ä¸ª</li><li>Keyä¸­æˆå‘˜çš„æ•°æ®é‡è¿‡å¤§ï¼šä¸€ä¸ªHashç±»å‹çš„Keyï¼Œå®ƒçš„æˆå‘˜æ•°é‡è™½ç„¶åªæœ‰1,000ä¸ªä½†è¿™äº›æˆå‘˜çš„Valueï¼ˆå€¼ï¼‰æ€»å¤§å°ä¸º100 MB</li></ul><p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­å…ƒç´ çš„å¤§å°å‘¢ï¼Ÿredisä¹Ÿç»™æˆ‘ä»¬æä¾›äº†å‘½ä»¤</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521124650117.png" alt="image-20220521124650117" tabindex="0" loading="lazy"><figcaption>image-20220521124650117</figcaption></figure><p>æ¨èå€¼ï¼š</p><ul><li>å•ä¸ªkeyçš„valueå°äº10KB</li><li>å¯¹äºé›†åˆç±»å‹çš„keyï¼Œå»ºè®®å…ƒç´ æ•°é‡å°äº1000</li></ul><h4 id="_1-2-1ã€bigkeyçš„å±å®³" tabindex="-1"><a class="header-anchor" href="#_1-2-1ã€bigkeyçš„å±å®³"><span>1.2.1ã€BigKeyçš„å±å®³</span></a></h4><ul><li>ç½‘ç»œé˜»å¡ <ul><li>å¯¹BigKeyæ‰§è¡Œè¯»è¯·æ±‚æ—¶ï¼Œå°‘é‡çš„QPSå°±å¯èƒ½å¯¼è‡´å¸¦å®½ä½¿ç”¨ç‡è¢«å æ»¡ï¼Œå¯¼è‡´Rediså®ä¾‹ï¼Œä¹ƒè‡³æ‰€åœ¨ç‰©ç†æœºå˜æ…¢</li></ul></li><li>æ•°æ®å€¾æ–œ <ul><li>BigKeyæ‰€åœ¨çš„Rediså®ä¾‹å†…å­˜ä½¿ç”¨ç‡è¿œè¶…å…¶ä»–å®ä¾‹ï¼Œæ— æ³•ä½¿æ•°æ®åˆ†ç‰‡çš„å†…å­˜èµ„æºè¾¾åˆ°å‡è¡¡</li></ul></li><li>Redisé˜»å¡ <ul><li>å¯¹å…ƒç´ è¾ƒå¤šçš„hashã€listã€zsetç­‰åšè¿ç®—ä¼šè€—æ—¶è¾ƒæ—§ï¼Œä½¿ä¸»çº¿ç¨‹è¢«é˜»å¡</li></ul></li><li>CPUå‹åŠ› <ul><li>å¯¹BigKeyçš„æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šå¯¼è‡´CPUçš„ä½¿ç”¨ç‡é£™å‡ï¼Œå½±å“Rediså®ä¾‹å’Œæœ¬æœºå…¶å®ƒåº”ç”¨</li></ul></li></ul><h4 id="_1-2-2ã€å¦‚ä½•å‘ç°bigkey" tabindex="-1"><a class="header-anchor" href="#_1-2-2ã€å¦‚ä½•å‘ç°bigkey"><span>1.2.2ã€å¦‚ä½•å‘ç°BigKey</span></a></h4><h5 id="_1redis-cli-bigkeys" tabindex="-1"><a class="header-anchor" href="#_1redis-cli-bigkeys"><span>â‘ redis-cli --bigkeys</span></a></h5><p>åˆ©ç”¨redis-cliæä¾›çš„--bigkeyså‚æ•°ï¼Œå¯ä»¥éå†åˆ†ææ‰€æœ‰keyï¼Œå¹¶è¿”å›Keyçš„æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ä¸æ¯ä¸ªæ•°æ®çš„Top1çš„big key</p><p>å‘½ä»¤ï¼š<code>redis-cli -a å¯†ç  --bigkeys</code></p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521133359507.png" alt="image-20220521133359507" tabindex="0" loading="lazy"><figcaption>image-20220521133359507</figcaption></figure><h5 id="_2scanæ‰«æ" tabindex="-1"><a class="header-anchor" href="#_2scanæ‰«æ"><span>â‘¡scanæ‰«æ</span></a></h5><p>è‡ªå·±ç¼–ç¨‹ï¼Œåˆ©ç”¨scanæ‰«æRedisä¸­çš„æ‰€æœ‰keyï¼Œåˆ©ç”¨strlenã€hlenç­‰å‘½ä»¤åˆ¤æ–­keyçš„é•¿åº¦ï¼ˆæ­¤å¤„ä¸å»ºè®®ä½¿ç”¨MEMORY USAGEï¼‰</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521133703245.png" alt="image-20220521133703245" tabindex="0" loading="lazy"><figcaption>image-20220521133703245</figcaption></figure><p>scan å‘½ä»¤è°ƒç”¨å®Œåæ¯æ¬¡ä¼šè¿”å›2ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸‹ä¸€æ¬¡è¿­ä»£çš„å…‰æ ‡ï¼Œç¬¬ä¸€æ¬¡å…‰æ ‡ä¼šè®¾ç½®ä¸º0ï¼Œå½“æœ€åä¸€æ¬¡scan è¿”å›çš„å…‰æ ‡ç­‰äº0æ—¶ï¼Œè¡¨ç¤ºæ•´ä¸ªscanéå†ç»“æŸäº†ï¼Œç¬¬äºŒä¸ªè¿”å›çš„æ˜¯Listï¼Œä¸€ä¸ªåŒ¹é…çš„keyçš„æ•°ç»„</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.jedis.util.JedisConnectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.jupiter.api.AfterEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.jupiter.api.BeforeEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.jupiter.api.Test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> redis.clients.jedis.Jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> redis.clients.jedis.ScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> JedisTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">BeforeEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setUp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 1.å»ºç«‹è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // jedis = new Jedis(&quot;192.168.150.101&quot;, 6379);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> JedisConnectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getJedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 2.è®¾ç½®å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">auth</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;123321&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 3.é€‰æ‹©åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    final</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> STR_MAX_LEN </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    final</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> HASH_MAX_LEN </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 500</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testScan</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> maxLen</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> len</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cursor</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        do</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // æ‰«æå¹¶è·å–ä¸€éƒ¨åˆ†key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            ScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">scan</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(cursor);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // è®°å½•cursor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            cursor </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getResult</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (list </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // éå†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> list) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // åˆ¤æ–­keyçš„ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                switch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (type) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;string&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">strlen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> STR_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;hash&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">hlen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;list&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">llen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;set&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">scard</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;zset&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">zcard</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    default:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> maxLen) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Found big key : %s, type: %s, length or size: %d %n&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, key, type, len);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cursor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">AfterEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> tearDown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3ç¬¬ä¸‰æ–¹å·¥å…·" tabindex="-1"><a class="header-anchor" href="#_3ç¬¬ä¸‰æ–¹å·¥å…·"><span>â‘¢ç¬¬ä¸‰æ–¹å·¥å…·</span></a></h5><ul><li>åˆ©ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚ Redis-Rdb-Tools åˆ†æRDBå¿«ç…§æ–‡ä»¶ï¼Œå…¨é¢åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>https://github.com/sripathikrishnan/redis-rdb-tools</li></ul><h5 id="_4ç½‘ç»œç›‘æ§" tabindex="-1"><a class="header-anchor" href="#_4ç½‘ç»œç›‘æ§"><span>â‘£ç½‘ç»œç›‘æ§</span></a></h5><ul><li>è‡ªå®šä¹‰å·¥å…·ï¼Œç›‘æ§è¿›å‡ºRedisçš„ç½‘ç»œæ•°æ®ï¼Œè¶…å‡ºé¢„è­¦å€¼æ—¶ä¸»åŠ¨å‘Šè­¦</li><li>ä¸€èˆ¬é˜¿é‡Œäº‘æ­å»ºçš„äº‘æœåŠ¡å™¨å°±æœ‰ç›¸å…³ç›‘æ§é¡µé¢</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521140415785.png" alt="image-20220521140415785" tabindex="0" loading="lazy"><figcaption>image-20220521140415785</figcaption></figure><h4 id="_1-2-3ã€å¦‚ä½•åˆ é™¤bigkey" tabindex="-1"><a class="header-anchor" href="#_1-2-3ã€å¦‚ä½•åˆ é™¤bigkey"><span>1.2.3ã€å¦‚ä½•åˆ é™¤BigKey</span></a></h4><p>BigKeyå†…å­˜å ç”¨è¾ƒå¤šï¼Œå³ä¾¿æ—¶åˆ é™¤è¿™æ ·çš„keyä¹Ÿéœ€è¦è€—è´¹å¾ˆé•¿æ—¶é—´ï¼Œå¯¼è‡´Redisä¸»çº¿ç¨‹é˜»å¡ï¼Œå¼•å‘ä¸€ç³»åˆ—é—®é¢˜ã€‚</p><ul><li>redis 3.0 åŠä»¥ä¸‹ç‰ˆæœ¬ <ul><li>å¦‚æœæ˜¯é›†åˆç±»å‹ï¼Œåˆ™éå†BigKeyçš„å…ƒç´ ï¼Œå…ˆé€ä¸ªåˆ é™¤å­å…ƒç´ ï¼Œæœ€ååˆ é™¤BigKey</li></ul></li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521140621204.png" alt="image-20220521140621204" tabindex="0" loading="lazy"><figcaption>image-20220521140621204</figcaption></figure><ul><li>Redis 4.0ä»¥å <ul><li>Redisåœ¨4.0åæä¾›äº†å¼‚æ­¥åˆ é™¤çš„å‘½ä»¤ï¼šunlink</li></ul></li></ul><h3 id="_1-3ã€æ°å½“çš„æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_1-3ã€æ°å½“çš„æ•°æ®ç±»å‹"><span>1.3ã€æ°å½“çš„æ•°æ®ç±»å‹</span></a></h3><h4 id="ä¾‹1-æ¯”å¦‚å­˜å‚¨ä¸€ä¸ªuserå¯¹è±¡-æˆ‘ä»¬æœ‰ä¸‰ç§å­˜å‚¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä¾‹1-æ¯”å¦‚å­˜å‚¨ä¸€ä¸ªuserå¯¹è±¡-æˆ‘ä»¬æœ‰ä¸‰ç§å­˜å‚¨æ–¹å¼"><span>ä¾‹1ï¼šæ¯”å¦‚å­˜å‚¨ä¸€ä¸ªUserå¯¹è±¡ï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§å­˜å‚¨æ–¹å¼ï¼š</span></a></h4><h5 id="_1æ–¹å¼ä¸€-jsonå­—ç¬¦ä¸²" tabindex="-1"><a class="header-anchor" href="#_1æ–¹å¼ä¸€-jsonå­—ç¬¦ä¸²"><span>â‘ æ–¹å¼ä¸€ï¼šjsonå­—ç¬¦ä¸²</span></a></h5><table><thead><tr><th style="text-align:center;">user:1</th><th style="text-align:center;"><code>{&quot;name&quot;: &quot;Jack&quot;, &quot;age&quot;: 21}</code></th></tr></thead></table><p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ç²—æš´</p><p>ç¼ºç‚¹ï¼šæ•°æ®è€¦åˆï¼Œä¸å¤Ÿçµæ´»</p><h5 id="_2æ–¹å¼äºŒ-å­—æ®µæ‰“æ•£" tabindex="-1"><a class="header-anchor" href="#_2æ–¹å¼äºŒ-å­—æ®µæ‰“æ•£"><span>â‘¡æ–¹å¼äºŒï¼šå­—æ®µæ‰“æ•£</span></a></h5><table><thead><tr><th style="text-align:center;">user:1:name</th><th style="text-align:center;">Jack</th></tr></thead><tbody><tr><td style="text-align:center;">user:1:age</td><td style="text-align:center;">21</td></tr></tbody></table><p>ä¼˜ç‚¹ï¼šå¯ä»¥çµæ´»è®¿é—®å¯¹è±¡ä»»æ„å­—æ®µ</p><p>ç¼ºç‚¹ï¼šå ç”¨ç©ºé—´å¤§ã€æ²¡åŠæ³•åšç»Ÿä¸€æ§åˆ¶</p><h5 id="_3æ–¹å¼ä¸‰-hash-æ¨è" tabindex="-1"><a class="header-anchor" href="#_3æ–¹å¼ä¸‰-hash-æ¨è"><span>â‘¢æ–¹å¼ä¸‰ï¼šhashï¼ˆæ¨èï¼‰</span></a></h5><table><tr><td rowspan="2">user:1</td><td>name</td><td>jack</td></tr><tr><td>age</td><td>21</td></tr></table><p>ä¼˜ç‚¹ï¼šåº•å±‚ä½¿ç”¨ziplistï¼Œç©ºé—´å ç”¨å°ï¼Œå¯ä»¥çµæ´»è®¿é—®å¯¹è±¡çš„ä»»æ„å­—æ®µ</p><p>ç¼ºç‚¹ï¼šä»£ç ç›¸å¯¹å¤æ‚</p><h4 id="ä¾‹2-å‡å¦‚æœ‰hashç±»å‹çš„key-å…¶ä¸­æœ‰100ä¸‡å¯¹fieldå’Œvalue-fieldæ˜¯è‡ªå¢id-è¿™ä¸ªkeyå­˜åœ¨ä»€ä¹ˆé—®é¢˜-å¦‚ä½•ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ä¾‹2-å‡å¦‚æœ‰hashç±»å‹çš„key-å…¶ä¸­æœ‰100ä¸‡å¯¹fieldå’Œvalue-fieldæ˜¯è‡ªå¢id-è¿™ä¸ªkeyå­˜åœ¨ä»€ä¹ˆé—®é¢˜-å¦‚ä½•ä¼˜åŒ–"><span>ä¾‹2ï¼šå‡å¦‚æœ‰hashç±»å‹çš„keyï¼Œå…¶ä¸­æœ‰100ä¸‡å¯¹fieldå’Œvalueï¼Œfieldæ˜¯è‡ªå¢idï¼Œè¿™ä¸ªkeyå­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</span></a></h4><table><tr style="color:red;"><td>key</td><td>field</td><td>value</td></tr><tr><td rowspan="3">someKey</td><td>id:0</td><td>value0</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:999999</td><td>value999999</td></tr></table><p>å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>hashçš„entryæ•°é‡è¶…è¿‡500æ—¶ï¼Œä¼šä½¿ç”¨å“ˆå¸Œè¡¨è€Œä¸æ˜¯ZipListï¼Œå†…å­˜å ç”¨è¾ƒå¤š <ul><li><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521142943350.png" alt="image-20220521142943350" tabindex="0" loading="lazy"><figcaption>image-20220521142943350</figcaption></li></ul></li><li>å¯ä»¥é€šè¿‡hash-max-ziplist-entriesé…ç½®entryä¸Šé™ã€‚ä½†æ˜¯å¦‚æœentryè¿‡å¤šå°±ä¼šå¯¼è‡´BigKeyé—®é¢˜</li></ul><h5 id="æ–¹æ¡ˆä¸€" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆä¸€"><span>æ–¹æ¡ˆä¸€</span></a></h5><p>æ‹†åˆ†ä¸ºstringç±»å‹</p><table><tr style="color:red;"><td>key</td><td>value</td></tr><tr><td>id:0</td><td>value0</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:999999</td><td>value999999</td></tr></table><p>å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>stringç»“æ„åº•å±‚æ²¡æœ‰å¤ªå¤šå†…å­˜ä¼˜åŒ–ï¼Œå†…å­˜å ç”¨è¾ƒå¤š</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521143458010.png" alt="image-20220521143458010" tabindex="0" loading="lazy"><figcaption>image-20220521143458010</figcaption></figure><ul><li>æƒ³è¦æ‰¹é‡è·å–è¿™äº›æ•°æ®æ¯”è¾ƒéº»çƒ¦</li></ul><h5 id="æ–¹æ¡ˆäºŒ" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆäºŒ"><span>æ–¹æ¡ˆäºŒ</span></a></h5><p>æ‹†åˆ†ä¸ºå°çš„hashï¼Œå°† id / 100 ä½œä¸ºkeyï¼Œ å°†id % 100 ä½œä¸ºfieldï¼Œè¿™æ ·æ¯100ä¸ªå…ƒç´ ä¸ºä¸€ä¸ªHash</p><table><tr style="color:red;"><td>key</td><td>field</td><td>value</td></tr><tr><td rowspan="3">key:0</td><td>id:00</td><td>value0</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:99</td><td>value99</td></tr><tr><td rowspan="3">key:1</td><td>id:00</td><td>value100</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:99</td><td>value199</td></tr><tr><td colspan="3">....</td></tr><tr><td rowspan="3">key:9999</td><td>id:00</td><td>value999900</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:99</td><td>value999999</td></tr></table><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521144339377.png" alt="image-20220521144339377" tabindex="0" loading="lazy"><figcaption>image-20220521144339377</figcaption></figure><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.heima.test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> com.heima.jedis.util.JedisConnectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.jupiter.api.AfterEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.jupiter.api.BeforeEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.junit.jupiter.api.Test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> redis.clients.jedis.Jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> redis.clients.jedis.Pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> redis.clients.jedis.ScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> JedisTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">BeforeEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setUp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 1.å»ºç«‹è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // jedis = new Jedis(&quot;192.168.150.101&quot;, 6379);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> JedisConnectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getJedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 2.è®¾ç½®å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">auth</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;123321&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // 3.é€‰æ‹©åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testSetBigKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 650</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">hmset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;m2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testBigHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">hmset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;test:big:hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testBigString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;test:str:key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testSmallHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hashSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;(hashSize);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> k</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> hashSize;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> v</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> hashSize;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> v, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> v);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (v </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">hmset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;test:small:hash_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> k, map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">AfterEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> tearDown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_1-4ã€æ€»ç»“"><span>1.4ã€æ€»ç»“</span></a></h3><ul><li>Keyçš„æœ€ä½³å®è·µ <ul><li>å›ºå®šæ ¼å¼ï¼š[ä¸šåŠ¡å]:[æ•°æ®å]:[id]</li><li>è¶³å¤Ÿç®€çŸ­ï¼šä¸è¶…è¿‡44å­—èŠ‚</li><li>ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦</li></ul></li><li>Valueçš„æœ€ä½³å®è·µï¼š <ul><li>åˆç†çš„æ‹†åˆ†æ•°æ®ï¼Œæ‹’ç»BigKey</li><li>é€‰æ‹©åˆé€‚æ•°æ®ç»“æ„</li><li>Hashç»“æ„çš„entryæ•°é‡ä¸è¦è¶…è¿‡1000</li><li>è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´</li></ul></li></ul><h2 id="_2ã€æ‰¹å¤„ç†ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2ã€æ‰¹å¤„ç†ä¼˜åŒ–"><span>2ã€æ‰¹å¤„ç†ä¼˜åŒ–</span></a></h2><h3 id="_2-1ã€pipeline" tabindex="-1"><a class="header-anchor" href="#_2-1ã€pipeline"><span>2.1ã€Pipeline</span></a></h3><h4 id="_2-1-1ã€æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä¸redisæœåŠ¡å™¨æ˜¯è¿™æ ·äº¤äº’çš„" tabindex="-1"><a class="header-anchor" href="#_2-1-1ã€æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä¸redisæœåŠ¡å™¨æ˜¯è¿™æ ·äº¤äº’çš„"><span>2.1.1ã€æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä¸redisæœåŠ¡å™¨æ˜¯è¿™æ ·äº¤äº’çš„</span></a></h4><p>å•ä¸ªå‘½ä»¤çš„æ‰§è¡Œæµç¨‹</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521151459880.png" alt="image-20220521151459880" tabindex="0" loading="lazy"><figcaption>image-20220521151459880</figcaption></figure><p>Næ¡å‘½ä»¤çš„æ‰§è¡Œæµç¨‹</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521151524621.png" alt="image-20220521151524621" tabindex="0" loading="lazy"><figcaption>image-20220521151524621</figcaption></figure><p>rediså¤„ç†æŒ‡ä»¤æ˜¯å¾ˆå¿«çš„ï¼Œä¸»è¦èŠ±è´¹çš„æ—¶å€™åœ¨äºç½‘ç»œä¼ è¾“ã€‚äºæ˜¯ä¹å¾ˆå®¹æ˜“æƒ³åˆ°å°†å¤šæ¡æŒ‡ä»¤æ‰¹é‡çš„ä¼ è¾“ç»™redis</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/image-20220521151902080.png" alt="image-20220521151902080" tabindex="0" loading="lazy"><figcaption>image-20220521151902080</figcaption></figure><h4 id="_2-1-2ã€mset" tabindex="-1"><a class="header-anchor" href="#_2-1-2ã€mset"><span>2.1.2ã€MSet</span></a></h4><p>Redisæä¾›äº†å¾ˆå¤šMxxxè¿™æ ·çš„å‘½ä»¤ï¼Œå¯ä»¥å®ç°æ‰¹é‡æ’å…¥æ•°æ®ï¼Œä¾‹å¦‚ï¼š</p><ul><li>mset</li><li>hmset</li></ul><p>åˆ©ç”¨msetæ‰¹é‡æ’å…¥10ä¸‡æ¡æ•°æ®</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testMxx</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">[] arr </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">]</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> j</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        j </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        arr[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;test:key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        arr[j </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (j </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(arr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> e </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;time: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (e </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> b));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1-3ã€pipeline" tabindex="-1"><a class="header-anchor" href="#_2-1-3ã€pipeline"><span>2.1.3ã€Pipeline</span></a></h4><p>MSETè™½ç„¶å¯ä»¥æ‰¹å¤„ç†ï¼Œä½†æ˜¯å´åªèƒ½æ“ä½œéƒ¨åˆ†æ•°æ®ç±»å‹ï¼Œå› æ­¤å¦‚æœæœ‰å¯¹å¤æ‚æ•°æ®ç±»å‹çš„æ‰¹å¤„ç†éœ€è¦ï¼Œå»ºè®®ä½¿ç”¨Pipeline</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testPipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆ›å»ºç®¡é“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pipeline </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipelined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æ”¾å…¥å‘½ä»¤åˆ°ç®¡é“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;test:key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">%</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // æ¯æ”¾å…¥1000æ¡å‘½ä»¤ï¼Œæ‰¹é‡æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> e </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;time: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (e </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> b));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2ã€é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-2ã€é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†"><span>2.2ã€é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†</span></a></h3><p>å¦‚MSETæˆ–Pipelineè¿™æ ·çš„æ‰¹å¤„ç†éœ€è¦åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æºå¸¦å¤šæ¡å‘½ä»¤ï¼Œè€Œæ­¤æ—¶å¦‚æœRedisæ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œé‚£æ‰¹å¤„ç†å‘½ä»¤çš„å¤šä¸ªkeyå¿…é¡»è½åœ¨ä¸€ä¸ªæ’æ§½ä¸­ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚å¤§å®¶å¯ä»¥æƒ³ä¸€æƒ³è¿™æ ·çš„è¦æ±‚å…¶å®å¾ˆéš¾å®ç°ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ‰¹å¤„ç†æ—¶ï¼Œå¯èƒ½ä¸€æ¬¡è¦æ’å…¥å¾ˆå¤šæ¡æ•°æ®ï¼Œè¿™äº›æ•°æ®å¾ˆæœ‰å¯èƒ½ä¸ä¼šéƒ½è½åœ¨ç›¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œè¿™å°±ä¼šå¯¼è‡´æŠ¥é”™äº†</p><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°4ç§è§£å†³æ–¹æ¡ˆ</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653126446641.png" alt="1653126446641" tabindex="0" loading="lazy"><figcaption>1653126446641</figcaption></figure><p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šä¸²è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œå½“ç„¶ï¼Œæ‰§è¡Œèµ·æ¥å°±å¾ˆç®€å•äº†ï¼Œç¼ºç‚¹å°±æ˜¯è€—æ—¶è¿‡ä¹…ã€‚</p><p>ç¬¬äºŒç§æ–¹æ¡ˆï¼šä¸²è¡Œslotï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ‰§è¡Œå‰ï¼Œå®¢æˆ·ç«¯å…ˆè®¡ç®—ä¸€ä¸‹å¯¹åº”çš„keyçš„slotï¼Œä¸€æ ·slotçš„keyå°±æ”¾åˆ°ä¸€ä¸ªç»„é‡Œè¾¹ï¼Œä¸åŒçš„ï¼Œå°±æ”¾åˆ°ä¸åŒçš„ç»„é‡Œè¾¹ï¼Œç„¶åå¯¹æ¯ä¸ªç»„æ‰§è¡Œpipelineçš„æ‰¹å¤„ç†ï¼Œä»–å°±èƒ½ä¸²è¡Œæ‰§è¡Œå„ä¸ªç»„çš„å‘½ä»¤ï¼Œè¿™ç§åšæ³•æ¯”ç¬¬ä¸€ç§æ–¹æ³•è€—æ—¶è¦å°‘ï¼Œä½†æ˜¯ç¼ºç‚¹å‘¢ï¼Œç›¸å¯¹æ¥è¯´å¤æ‚ä¸€ç‚¹ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ¡ˆè¿˜éœ€è¦ä¼˜åŒ–ä¸€ä¸‹</p><p>ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼šå¹¶è¡Œslotï¼Œç›¸è¾ƒäºç¬¬äºŒç§æ–¹æ¡ˆï¼Œåœ¨åˆ†ç»„å®Œæˆåä¸²è¡Œæ‰§è¡Œï¼Œç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œå°±å˜æˆäº†å¹¶è¡Œæ‰§è¡Œå„ä¸ªå‘½ä»¤ï¼Œæ‰€ä»¥ä»–çš„è€—æ—¶å°±éå¸¸çŸ­ï¼Œä½†æ˜¯å®ç°å‘¢ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p><p>ç¬¬å››ç§ï¼šhash_tagï¼Œredisè®¡ç®—keyçš„slotçš„æ—¶å€™ï¼Œå…¶å®æ˜¯æ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†æ¥è®¡ç®—çš„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¸€æ¬¡å¤„ç†æ‰€æœ‰çš„keyï¼Œè¿™ç§æ–¹å¼è€—æ—¶æœ€çŸ­ï¼Œå®ç°ä¹Ÿç®€å•ï¼Œä½†æ˜¯å¦‚æœé€šè¿‡æ“ä½œkeyçš„æœ‰æ•ˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ‰€æœ‰çš„keyéƒ½è½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œäº§ç”Ÿæ•°æ®å€¾æ–œçš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨èä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼ã€‚</p><h4 id="_2-2-1-ä¸²è¡ŒåŒ–æ‰§è¡Œä»£ç å®è·µ" tabindex="-1"><a class="header-anchor" href="#_2-2-1-ä¸²è¡ŒåŒ–æ‰§è¡Œä»£ç å®è·µ"><span>2.2.1 ä¸²è¡ŒåŒ–æ‰§è¡Œä»£ç å®è·µ</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> JedisClusterTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> JedisCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> jedisCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">BeforeEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setUp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // é…ç½®è¿æ¥æ± </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        JedisPoolConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> poolConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> JedisPoolConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        poolConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setMaxTotal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        poolConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setMaxIdle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        poolConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setMinIdle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        poolConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setMaxWaitMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        HashSet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nodes</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashSet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">7001</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">7002</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">7003</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8001</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8002</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8003</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        jedisCluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> JedisCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(nodes, poolConfig);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testMSet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        jedisCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Jack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;male&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testMSet2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Jack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Male&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        //å¯¹Mapæ•°æ®è¿›è¡Œåˆ†ç»„ã€‚æ ¹æ®ç›¸åŒçš„slotæ”¾åœ¨ä¸€ä¸ªåˆ†ç»„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        //keyå°±æ˜¯slotï¼Œvalueå°±æ˜¯ä¸€ä¸ªç»„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt;&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">entrySet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Collectors</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">groupingBy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ClusterSlotHashUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">calculateSlot</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        //ä¸²è¡Œçš„å»æ‰§è¡Œmsetçš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">list</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> j</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                j </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                arr[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                arr[j </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            jedisCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(arr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">AfterEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> tearDown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (jedisCluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            jedisCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.2.2 Springé›†ç¾¤ç¯å¢ƒä¸‹æ‰¹å¤„ç†ä»£ç </p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">   @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testMSetInCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> map </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Rose&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Female&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        stringRedisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">multiSet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(map);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> strings </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stringRedisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">multiGet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Arrays</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">asList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        strings</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">println);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åŸç†åˆ†æ</strong></p><p>åœ¨RedisAdvancedClusterAsyncCommandsImpl ç±»ä¸­</p><p>é¦–å…ˆæ ¹æ®slotHashç®—å‡ºæ¥ä¸€ä¸ªpartitionedçš„mapï¼Œmapä¸­çš„keyå°±æ˜¯slotï¼Œè€Œä»–çš„valueå°±æ˜¯å¯¹åº”çš„å¯¹åº”ç›¸åŒslotçš„keyå¯¹åº”çš„æ•°æ®</p><p>é€šè¿‡ <code>RedisFuture&lt;String&gt; mset = super.mset(op);</code>è¿›è¡Œå¼‚æ­¥çš„æ¶ˆæ¯å‘é€</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> RedisFuture</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> mset</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> V</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> map) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> partitioned </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SlotHash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">partition</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(codec, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">keySet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">partitioned</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> RedisFuture</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> executions </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> partitioned</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">entrySet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> V</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> op </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(k </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> op</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(k, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(k)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        RedisFuture</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> mset </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(op);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        executions</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), mset);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> MultiNodeExecution</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">firstOfAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(executions);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æŒä¹…åŒ–é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æŒä¹…åŒ–é…ç½®"><span>3ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æŒä¹…åŒ–é…ç½®</span></a></h2><p>Redisçš„æŒä¹…åŒ–è™½ç„¶å¯ä»¥ä¿è¯æ•°æ®å®‰å…¨ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šé¢å¤–çš„å¼€é”€ï¼Œå› æ­¤æŒä¹…åŒ–è¯·éµå¾ªä¸‹åˆ—å»ºè®®ï¼š</p><ul><li>ç”¨æ¥åšç¼“å­˜çš„Rediså®ä¾‹å°½é‡ä¸è¦å¼€å¯æŒä¹…åŒ–åŠŸèƒ½</li><li>å»ºè®®å…³é—­RDBæŒä¹…åŒ–åŠŸèƒ½ï¼Œä½¿ç”¨AOFæŒä¹…åŒ–</li><li>åˆ©ç”¨è„šæœ¬å®šæœŸåœ¨slaveèŠ‚ç‚¹åšRDBï¼Œå®ç°æ•°æ®å¤‡ä»½</li><li>è®¾ç½®åˆç†çš„rewriteé˜ˆå€¼ï¼Œé¿å…é¢‘ç¹çš„bgrewrite</li><li>é…ç½®no-appendfsync-on-rewrite = yesï¼Œç¦æ­¢åœ¨rewriteæœŸé—´åšaofï¼Œé¿å…å› AOFå¼•èµ·çš„é˜»å¡</li><li>éƒ¨ç½²æœ‰å…³å»ºè®®ï¼š <ul><li>Rediså®ä¾‹çš„ç‰©ç†æœºè¦é¢„ç•™è¶³å¤Ÿå†…å­˜ï¼Œåº”å¯¹forkå’Œrewrite</li><li>å•ä¸ªRediså®ä¾‹å†…å­˜ä¸Šé™ä¸è¦å¤ªå¤§ï¼Œä¾‹å¦‚4Gæˆ–8Gã€‚å¯ä»¥åŠ å¿«forkçš„é€Ÿåº¦ã€å‡å°‘ä¸»ä»åŒæ­¥ã€æ•°æ®è¿ç§»å‹åŠ›</li><li>ä¸è¦ä¸CPUå¯†é›†å‹åº”ç”¨éƒ¨ç½²åœ¨ä¸€èµ·</li><li>ä¸è¦ä¸é«˜ç¡¬ç›˜è´Ÿè½½åº”ç”¨ä¸€èµ·éƒ¨ç½²ã€‚ä¾‹å¦‚ï¼šæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—</li></ul></li></ul><h2 id="_4ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æ…¢æŸ¥è¯¢ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_4ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æ…¢æŸ¥è¯¢ä¼˜åŒ–"><span>4ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-æ…¢æŸ¥è¯¢ä¼˜åŒ–</span></a></h2><h3 id="_4-1-ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-1-ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢"><span>4.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢</span></a></h3><p>å¹¶ä¸æ˜¯å¾ˆæ…¢çš„æŸ¥è¯¢æ‰æ˜¯æ…¢æŸ¥è¯¢ï¼Œè€Œæ˜¯ï¼šåœ¨Redisæ‰§è¡Œæ—¶è€—æ—¶è¶…è¿‡æŸä¸ªé˜ˆå€¼çš„å‘½ä»¤ï¼Œç§°ä¸ºæ…¢æŸ¥è¯¢ã€‚</p><p>æ…¢æŸ¥è¯¢çš„å±å®³ï¼šç”±äºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯å‘å‡ºæŒ‡ä»¤åï¼Œä»–ä»¬éƒ½ä¼šè¿›å…¥åˆ°redisåº•å±‚çš„queueæ¥æ‰§è¡Œï¼Œå¦‚æœæ­¤æ—¶æœ‰ä¸€äº›æ…¢æŸ¥è¯¢çš„æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚é˜»å¡ï¼Œä»è€Œå¼•èµ·æŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è§£å†³æ…¢æŸ¥è¯¢é—®é¢˜ã€‚</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653129590210.png" alt="1653129590210" tabindex="0" loading="lazy"><figcaption>1653129590210</figcaption></figure><p>æ…¢æŸ¥è¯¢çš„é˜ˆå€¼å¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šï¼š</p><p>slowlog-log-slower-thanï¼šæ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œå•ä½æ˜¯å¾®ç§’ã€‚é»˜è®¤æ˜¯10000ï¼Œå»ºè®®1000</p><p>æ…¢æŸ¥è¯¢ä¼šè¢«æ”¾å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼Œæ—¥å¿—çš„é•¿åº¦æœ‰ä¸Šé™ï¼Œå¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šï¼š</p><p>slowlog-max-lenï¼šæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆæœ¬è´¨æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼‰çš„é•¿åº¦ã€‚é»˜è®¤æ˜¯128ï¼Œå»ºè®®1000</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653130457771.png" alt="1653130457771" tabindex="0" loading="lazy"><figcaption>1653130457771</figcaption></figure><p>ä¿®æ”¹è¿™ä¸¤ä¸ªé…ç½®å¯ä»¥ä½¿ç”¨ï¼šconfig setå‘½ä»¤ï¼š</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653130475979.png" alt="1653130475979" tabindex="0" loading="lazy"><figcaption>1653130475979</figcaption></figure><h3 id="_4-2-å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-2-å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢"><span>4.2 å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢</span></a></h3><p>çŸ¥é“äº†ä»¥ä¸Šå†…å®¹ä¹‹åï¼Œé‚£ä¹ˆå’±ä»¬å¦‚ä½•å»æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—åˆ—è¡¨å‘¢ï¼š</p><ul><li>slowlog lenï¼šæŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—é•¿åº¦</li><li>slowlog get [n]ï¼šè¯»å–næ¡æ…¢æŸ¥è¯¢æ—¥å¿—</li><li>slowlog resetï¼šæ¸…ç©ºæ…¢æŸ¥è¯¢åˆ—è¡¨</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653130858066.png" alt="1653130858066" tabindex="0" loading="lazy"><figcaption>1653130858066</figcaption></figure><h2 id="_5ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-å‘½ä»¤åŠå®‰å…¨é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-å‘½ä»¤åŠå®‰å…¨é…ç½®"><span>5ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-å‘½ä»¤åŠå®‰å…¨é…ç½®</span></a></h2><p>å®‰å…¨å¯ä»¥è¯´æ˜¯æœåŠ¡å™¨ç«¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¯é¢˜ï¼Œå¦‚æœå®‰å…¨å‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆä¸€æ—¦è¿™ä¸ªæ¼æ´è¢«ä¸€äº›åäººçŸ¥é“äº†ä¹‹åï¼Œå¹¶ä¸”è¿›è¡Œæ”»å‡»ï¼Œé‚£ä¹ˆè¿™å°±ä¼šç»™å’±ä»¬çš„ç³»ç»Ÿå¸¦æ¥å¾ˆå¤šçš„æŸå¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™èŠ‚è¯¾å°±æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>Redisä¼šç»‘å®šåœ¨0.0.0.0:6379ï¼Œè¿™æ ·å°†ä¼šå°†RedisæœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œè€ŒRediså¦‚æœæ²¡æœ‰åšèº«ä»½è®¤è¯ï¼Œä¼šå‡ºç°ä¸¥é‡çš„å®‰å…¨æ¼æ´. æ¼æ´é‡ç°æ–¹å¼ï¼šhttps://cloud.tencent.com/developer/article/1039000</p><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸éœ€è¦å¯†ç ä¹Ÿèƒ½å¤Ÿç™»å½•å‘¢ï¼Œä¸»è¦æ˜¯Redisè€ƒè™‘åˆ°æ¯æ¬¡ç™»å½•éƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥Rediså°±æœ‰ä¸€ç§sshå…ç§˜é’¥ç™»å½•çš„æ–¹å¼ï¼Œç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œç§é’¥æ”¾åœ¨æœ¬åœ°ï¼Œå…¬é’¥æ”¾åœ¨redisç«¯ï¼Œå½“æˆ‘ä»¬ç™»å½•æ—¶æœåŠ¡å™¨ï¼Œå†ç™»å½•æ—¶å€™ï¼Œä»–ä¼šå»è§£æå…¬é’¥å’Œç§é’¥ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œåˆ™ä¸éœ€è¦åˆ©ç”¨redisçš„ç™»å½•ä¹Ÿèƒ½è®¿é—®ï¼Œè¿™ç§åšæ³•æœ¬èº«ä¹Ÿå¾ˆå¸¸è§ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå‰æï¼Œå‰æå°±æ˜¯å…¬é’¥å¿…é¡»ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ‰è¡Œï¼Œä½†æ˜¯Redisçš„æ¼æ´åœ¨äºåœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½æŠŠç§˜é’¥é€åˆ°LinuxæœåŠ¡å™¨ï¼Œä»è€Œäº§ç”Ÿæ¼æ´</p><p>æ¼æ´å‡ºç°çš„æ ¸å¿ƒçš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>Redisæœªè®¾ç½®å¯†ç </li><li>åˆ©ç”¨äº†Redisçš„config setå‘½ä»¤åŠ¨æ€ä¿®æ”¹Redisé…ç½®</li><li>ä½¿ç”¨äº†Rootè´¦å·æƒé™å¯åŠ¨Redis</li></ul><p>æ‰€ä»¥ï¼šå¦‚ä½•è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆ</p><p>ä¸ºäº†é¿å…è¿™æ ·çš„æ¼æ´ï¼Œè¿™é‡Œç»™å‡ºä¸€äº›å»ºè®®ï¼š</p><ul><li>Redisä¸€å®šè¦è®¾ç½®å¯†ç </li><li>ç¦æ­¢çº¿ä¸Šä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼škeysã€flushallã€flushdbã€config setç­‰å‘½ä»¤ã€‚å¯ä»¥åˆ©ç”¨rename-commandç¦ç”¨ã€‚</li><li>bindï¼šé™åˆ¶ç½‘å¡ï¼Œç¦æ­¢å¤–ç½‘ç½‘å¡è®¿é—®</li><li>å¼€å¯é˜²ç«å¢™</li><li>ä¸è¦ä½¿ç”¨Rootè´¦æˆ·å¯åŠ¨Redis</li><li>å°½é‡ä¸æ˜¯æœ‰é»˜è®¤çš„ç«¯å£</li></ul><h2 id="_6ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-rediså†…å­˜åˆ’åˆ†å’Œå†…å­˜é…ç½®" tabindex="-1"><a class="header-anchor" href="#_6ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-rediså†…å­˜åˆ’åˆ†å’Œå†…å­˜é…ç½®"><span>6ã€æœåŠ¡å™¨ç«¯ä¼˜åŒ–-Rediså†…å­˜åˆ’åˆ†å’Œå†…å­˜é…ç½®</span></a></h2><p>å½“Rediså†…å­˜ä¸è¶³æ—¶ï¼Œå¯èƒ½å¯¼è‡´Keyé¢‘ç¹è¢«åˆ é™¤ã€å“åº”æ—¶é—´å˜é•¿ã€QPSä¸ç¨³å®šç­‰é—®é¢˜ã€‚å½“å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°90%ä»¥ä¸Šæ—¶å°±éœ€è¦æˆ‘ä»¬è­¦æƒ•ï¼Œå¹¶å¿«é€Ÿå®šä½åˆ°å†…å­˜å ç”¨çš„åŸå› ã€‚</p><p><strong>æœ‰å…³ç¢ç‰‡é—®é¢˜åˆ†æ</strong></p><p>Redisåº•å±‚åˆ†é…å¹¶ä¸æ˜¯è¿™ä¸ªkeyæœ‰å¤šå¤§ï¼Œä»–å°±ä¼šåˆ†é…å¤šå¤§ï¼Œè€Œæ˜¯æœ‰ä»–è‡ªå·±çš„åˆ†é…ç­–ç•¥ï¼Œæ¯”å¦‚8,16,20ç­‰ç­‰ï¼Œå‡å®šå½“å‰keyåªéœ€è¦10ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶åˆ†é…8è‚¯å®šä¸å¤Ÿï¼Œé‚£ä¹ˆä»–å°±ä¼šåˆ†é…16ä¸ªå­—èŠ‚ï¼Œå¤šå‡ºæ¥çš„6ä¸ªå­—èŠ‚å°±ä¸èƒ½è¢«ä½¿ç”¨ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ ç¢ç‰‡é—®é¢˜</p><p><strong>è¿›ç¨‹å†…å­˜é—®é¢˜åˆ†æï¼š</strong></p><p>è¿™ç‰‡å†…å­˜ï¼Œé€šå¸¸æˆ‘ä»¬éƒ½å¯ä»¥å¿½ç•¥ä¸è®¡</p><p><strong>ç¼“å†²åŒºå†…å­˜é—®é¢˜åˆ†æï¼š</strong></p><p>ä¸€èˆ¬åŒ…æ‹¬å®¢æˆ·ç«¯ç¼“å†²åŒºã€AOFç¼“å†²åŒºã€å¤åˆ¶ç¼“å†²åŒºç­‰ã€‚å®¢æˆ·ç«¯ç¼“å†²åŒºåˆåŒ…æ‹¬è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºä¸¤ç§ã€‚è¿™éƒ¨åˆ†å†…å­˜å ç”¨æ³¢åŠ¨è¾ƒå¤§ï¼Œæ‰€ä»¥è¿™ç‰‡å†…å­˜ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦é‡ç‚¹åˆ†æçš„å†…å­˜é—®é¢˜ã€‚</p><table><thead><tr><th><strong>å†…å­˜å ç”¨</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>æ•°æ®å†…å­˜</td><td>æ˜¯Redisæœ€ä¸»è¦çš„éƒ¨åˆ†ï¼Œå­˜å‚¨Redisçš„é”®å€¼ä¿¡æ¯ã€‚ä¸»è¦é—®é¢˜æ˜¯BigKeyé—®é¢˜ã€å†…å­˜ç¢ç‰‡é—®é¢˜</td></tr><tr><td>è¿›ç¨‹å†…å­˜</td><td>Redisä¸»è¿›ç¨‹æœ¬èº«è¿â¾è‚¯å®šéœ€è¦å â½¤å†…å­˜ï¼Œå¦‚ä»£ç ã€å¸¸é‡æ± ç­‰ç­‰ï¼›è¿™éƒ¨åˆ†å†…å­˜â¼¤çº¦â¼å…†ï¼Œåœ¨â¼¤å¤šæ•°â½£äº§ç¯å¢ƒä¸­ä¸Redisæ•°æ®å â½¤çš„å†…å­˜ç›¸â½å¯ä»¥å¿½ç•¥ã€‚</td></tr><tr><td>ç¼“å†²åŒºå†…å­˜</td><td>ä¸€èˆ¬åŒ…æ‹¬å®¢æˆ·ç«¯ç¼“å†²åŒºã€AOFç¼“å†²åŒºã€å¤åˆ¶ç¼“å†²åŒºç­‰ã€‚å®¢æˆ·ç«¯ç¼“å†²åŒºåˆåŒ…æ‹¬è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºä¸¤ç§ã€‚è¿™éƒ¨åˆ†å†…å­˜å ç”¨æ³¢åŠ¨è¾ƒå¤§ï¼Œä¸å½“ä½¿ç”¨BigKeyï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</td></tr></tbody></table><p>äºæ˜¯æˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä¸€äº›å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°Redisç›®å‰çš„å†…å­˜åˆ†é…çŠ¶æ€ï¼š</p><ul><li>info memoryï¼šæŸ¥çœ‹å†…å­˜åˆ†é…çš„æƒ…å†µ</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132073570.png" alt="1653132073570" tabindex="0" loading="lazy"><figcaption>1653132073570</figcaption></figure><ul><li>memory xxxï¼šæŸ¥çœ‹keyçš„ä¸»è¦å ç”¨æƒ…å†µ</li></ul><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132098823.png" alt="1653132098823" tabindex="0" loading="lazy"><figcaption>1653132098823</figcaption></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹åˆ°äº†è¿™äº›é…ç½®ï¼Œæœ€å…³é”®çš„ç¼“å­˜åŒºå†…å­˜å¦‚ä½•å®šä½å’Œè§£å†³å‘¢ï¼Ÿ</p><p>å†…å­˜ç¼“å†²åŒºå¸¸è§çš„æœ‰ä¸‰ç§ï¼š</p><ul><li>å¤åˆ¶ç¼“å†²åŒºï¼šä¸»ä»å¤åˆ¶çš„repl_backlog_bufï¼Œå¦‚æœå¤ªå°å¯èƒ½å¯¼è‡´é¢‘ç¹çš„å…¨é‡å¤åˆ¶ï¼Œå½±å“æ€§èƒ½ã€‚é€šè¿‡replbacklog-sizeæ¥è®¾ç½®ï¼Œé»˜è®¤1mb</li><li>AOFç¼“å†²åŒºï¼šAOFåˆ·ç›˜ä¹‹å‰çš„ç¼“å­˜åŒºåŸŸï¼ŒAOFæ‰§è¡Œrewriteçš„ç¼“å†²åŒºã€‚æ— æ³•è®¾ç½®å®¹é‡ä¸Šé™</li><li>å®¢æˆ·ç«¯ç¼“å†²åŒºï¼šåˆ†ä¸ºè¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºï¼Œè¾“å…¥ç¼“å†²åŒºæœ€å¤§1Gä¸”ä¸èƒ½è®¾ç½®ã€‚è¾“å‡ºç¼“å†²åŒºå¯ä»¥è®¾ç½®</li></ul><p>ä»¥ä¸Šå¤åˆ¶ç¼“å†²åŒºå’ŒAOFç¼“å†²åŒº ä¸ä¼šæœ‰é—®é¢˜ï¼Œæœ€å…³é”®å°±æ˜¯å®¢æˆ·ç«¯ç¼“å†²åŒºçš„é—®é¢˜</p><p>å®¢æˆ·ç«¯ç¼“å†²åŒºï¼šæŒ‡çš„å°±æ˜¯æˆ‘ä»¬å‘é€å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ç”¨æ¥ç¼“å­˜å‘½ä»¤çš„ä¸€ä¸ªç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‘redisè¾“å…¥æ•°æ®çš„è¾“å…¥ç«¯ç¼“å†²åŒºå’Œrediså‘å®¢æˆ·ç«¯è¿”å›æ•°æ®çš„å“åº”ç¼“å­˜åŒºï¼Œè¾“å…¥ç¼“å†²åŒºæœ€å¤§1Gä¸”ä¸èƒ½è®¾ç½®ï¼Œæ‰€ä»¥è¿™ä¸€å—æˆ‘ä»¬æ ¹æœ¬ä¸ç”¨æ‹…å¿ƒï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªç©ºé—´ï¼Œredisä¼šç›´æ¥æ–­å¼€ï¼Œå› ä¸ºæœ¬æ¥æ­¤æ—¶æ­¤åˆ»å°±ä»£è¡¨ç€rediså¤„ç†ä¸è¿‡æ¥äº†ï¼Œæˆ‘ä»¬éœ€è¦æ‹…å¿ƒçš„å°±æ˜¯è¾“å‡ºç«¯ç¼“å†²åŒº</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132410073.png" alt="1653132410073" tabindex="0" loading="lazy"><figcaption>1653132410073</figcaption></figure><p>æˆ‘ä»¬åœ¨ä½¿ç”¨redisè¿‡ç¨‹ä¸­ï¼Œå¤„ç†å¤§é‡çš„big valueï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æˆ‘ä»¬çš„è¾“å‡ºç»“æœè¿‡å¤šï¼Œå¦‚æœè¾“å‡ºç¼“å­˜åŒºè¿‡å¤§ï¼Œä¼šå¯¼è‡´redisç›´æ¥æ–­å¼€ï¼Œè€Œé»˜è®¤é…ç½®çš„æƒ…å†µä¸‹ï¼Œ å…¶å®ä»–æ˜¯æ²¡æœ‰å¤§å°çš„ï¼Œè¿™å°±æ¯”è¾ƒå‘äº†ï¼Œå†…å­˜å¯èƒ½ä¸€ä¸‹å­è¢«å æ»¡ï¼Œä¼šç›´æ¥å¯¼è‡´å’±ä»¬çš„redisæ–­å¼€ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ª</p><p>1ã€è®¾ç½®ä¸€ä¸ªå¤§å°</p><p>2ã€å¢åŠ æˆ‘ä»¬å¸¦å®½çš„å¤§å°ï¼Œé¿å…æˆ‘ä»¬å‡ºç°å¤§é‡æ•°æ®ä»è€Œç›´æ¥è¶…è¿‡äº†redisçš„æ‰¿å—èƒ½åŠ›</p><h2 id="_7ã€æœåŠ¡å™¨ç«¯é›†ç¾¤ä¼˜åŒ–-é›†ç¾¤è¿˜æ˜¯ä¸»ä»" tabindex="-1"><a class="header-anchor" href="#_7ã€æœåŠ¡å™¨ç«¯é›†ç¾¤ä¼˜åŒ–-é›†ç¾¤è¿˜æ˜¯ä¸»ä»"><span>7ã€æœåŠ¡å™¨ç«¯é›†ç¾¤ä¼˜åŒ–-é›†ç¾¤è¿˜æ˜¯ä¸»ä»</span></a></h2><p>é›†ç¾¤è™½ç„¶å…·å¤‡é«˜å¯ç”¨ç‰¹æ€§ï¼Œèƒ½å®ç°è‡ªåŠ¨æ•…éšœæ¢å¤ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ä¸å½“ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>é›†ç¾¤å®Œæ•´æ€§é—®é¢˜</li><li>é›†ç¾¤å¸¦å®½é—®é¢˜</li><li>æ•°æ®å€¾æ–œé—®é¢˜</li><li>å®¢æˆ·ç«¯æ€§èƒ½é—®é¢˜</li><li>å‘½ä»¤çš„é›†ç¾¤å…¼å®¹æ€§é—®é¢˜</li><li>luaå’Œäº‹åŠ¡é—®é¢˜</li></ul><p><strong>é—®é¢˜1ã€åœ¨Redisçš„é»˜è®¤é…ç½®ä¸­ï¼Œå¦‚æœå‘ç°ä»»æ„ä¸€ä¸ªæ’æ§½ä¸å¯ç”¨ï¼Œåˆ™æ•´ä¸ªé›†ç¾¤éƒ½ä¼šåœæ­¢å¯¹å¤–æœåŠ¡ï¼š</strong></p><p>å¤§å®¶å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæœ‰å‡ ä¸ªslotä¸èƒ½ä½¿ç”¨ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•´ä¸ªé›†ç¾¤éƒ½ä¸èƒ½ç”¨äº†ï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­ï¼Œå…¶å®æœ€é‡è¦çš„æ˜¯å¯ç”¨æ€§ï¼Œæ‰€ä»¥éœ€è¦æŠŠå¦‚ä¸‹é…ç½®ä¿®æ”¹æˆnoï¼Œå³æœ‰slotä¸èƒ½ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬çš„redisé›†ç¾¤è¿˜æ˜¯å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡</p><figure><img src="https://jackchen-note.oss-cn-beijing.aliyuncs.com/Java/Redis/1653132740637.png" alt="1653132740637" tabindex="0" loading="lazy"><figcaption>1653132740637</figcaption></figure><p><strong>é—®é¢˜2ã€é›†ç¾¤å¸¦å®½é—®é¢˜</strong></p><p>é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´ä¼šä¸æ–­çš„äº’ç›¸Pingæ¥ç¡®å®šé›†ç¾¤ä¸­å…¶å®ƒèŠ‚ç‚¹çš„çŠ¶æ€ã€‚æ¯æ¬¡Pingæºå¸¦çš„ä¿¡æ¯è‡³å°‘åŒ…æ‹¬ï¼š</p><ul><li>æ’æ§½ä¿¡æ¯</li><li>é›†ç¾¤çŠ¶æ€ä¿¡æ¯</li></ul><p>é›†ç¾¤ä¸­èŠ‚ç‚¹è¶Šå¤šï¼Œé›†ç¾¤çŠ¶æ€ä¿¡æ¯æ•°æ®é‡ä¹Ÿè¶Šå¤§ï¼Œ10ä¸ªèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯å¯èƒ½è¾¾åˆ°1kbï¼Œæ­¤æ—¶æ¯æ¬¡é›†ç¾¤äº’é€šéœ€è¦çš„å¸¦å®½ä¼šéå¸¸é«˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´é›†ç¾¤ä¸­å¤§é‡çš„å¸¦å®½éƒ½ä¼šè¢«pingä¿¡æ¯æ‰€å ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¯æ€•çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»è§£å†³è¿™æ ·çš„é—®é¢˜</p><p><strong>è§£å†³é€”å¾„ï¼š</strong></p><ul><li>é¿å…å¤§é›†ç¾¤ï¼Œé›†ç¾¤èŠ‚ç‚¹æ•°ä¸è¦å¤ªå¤šï¼Œæœ€å¥½å°‘äº1000ï¼Œå¦‚æœä¸šåŠ¡åºå¤§ï¼Œåˆ™å»ºç«‹å¤šä¸ªé›†ç¾¤ã€‚</li><li>é¿å…åœ¨å•ä¸ªç‰©ç†æœºä¸­è¿è¡Œå¤ªå¤šRediså®ä¾‹</li><li>é…ç½®åˆé€‚çš„cluster-node-timeoutå€¼</li></ul><p><strong>é—®é¢˜3ã€å‘½ä»¤çš„é›†ç¾¤å…¼å®¹æ€§é—®é¢˜</strong></p><p>æœ‰å…³è¿™ä¸ªé—®é¢˜å’±ä»¬å·²ç»æ¢è®¨è¿‡äº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ‰¹å¤„ç†çš„å‘½ä»¤æ—¶ï¼Œredisè¦æ±‚æˆ‘ä»¬çš„keyå¿…é¡»è½åœ¨ç›¸åŒçš„slotä¸Šï¼Œç„¶åå¤§é‡çš„keyåŒæ—¶æ“ä½œæ—¶ï¼Œæ˜¯æ— æ³•å®Œæˆçš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¿…é¡»è¦å¯¹è¿™æ ·çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™äº›æ–¹æ¡ˆæˆ‘ä»¬ä¹‹å‰å·²ç»æ¢è®¨è¿‡äº†ï¼Œæ‰€ä»¥ä¸å†è¿™ä¸ªåœ°æ–¹èµ˜è¿°äº†ã€‚</p><p><strong>é—®é¢˜4ã€luaå’Œäº‹åŠ¡çš„é—®é¢˜</strong></p><p>luaå’Œäº‹åŠ¡éƒ½æ˜¯è¦ä¿è¯åŸå­æ€§é—®é¢˜ï¼Œå¦‚æœä½ çš„keyä¸åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•ä¿è¯luaçš„æ‰§è¡Œå’Œäº‹åŠ¡çš„ç‰¹æ€§çš„ï¼Œæ‰€ä»¥åœ¨é›†ç¾¤æ¨¡å¼æ˜¯æ²¡æœ‰åŠæ³•æ‰§è¡Œluaå’Œäº‹åŠ¡çš„</p><p><strong>é‚£æˆ‘ä»¬åˆ°åº•æ˜¯é›†ç¾¤è¿˜æ˜¯ä¸»ä»</strong></p><p>å•ä½“Redisï¼ˆä¸»ä»Redisï¼‰å·²ç»èƒ½è¾¾åˆ°ä¸‡çº§åˆ«çš„QPSï¼Œå¹¶ä¸”ä¹Ÿå…·å¤‡å¾ˆå¼ºçš„é«˜å¯ç”¨ç‰¹æ€§ã€‚å¦‚æœä¸»ä»èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯åœ¨ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä¸æ­å»ºRedisé›†ç¾¤</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/skxndbzu/JackChenBlogs/edit/main/src/posts/æ•°æ®åº“/redis/é«˜çº§ç¯‡.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 615880048@qq.com">é™ˆé“­é¹¤</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%AE%9E%E6%88%98%E7%AF%87.html" aria-label="å®æˆ˜ç¯‡"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>å®æˆ˜ç¯‡</div></a><a class="route-link auto-link next" href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/%E5%8E%9F%E7%90%86%E7%AF%87.html" aria-label="åŸç†ç¯‡"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">åŸç†ç¯‡<span class="font-icon icon iconfont icon-pen-to-square" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">åƒé‡Œä¹‹è¡Œ å§‹äºè¶³ä¸‹</div><div class="vp-copyright">Copyright Â© 2024 Jack-Chen </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BYKnUcUk.js" defer></script>
  </body>
</html>
